{"pages":[{"title":"å…³äºæˆ‘","text":"Founder of Workspacelovin ,iOSå¼€å‘è€…,æ­£åœ¨åŠªåŠ›åšå¥½äº§å“ã€‚ ä¸ªäººä¿¡æ¯ Blogï¼šhttp://hl1987.com Github: http://github.com/koalahl Weibo: å¯’å…ˆç”Ÿçš„æ±Ÿé›ª Twitter: Levi Han Emailï¼š hanangellove.@icloud.com ä¸ªäººé¡¹ç›®####Webç½‘ç«™ WorkspaceLovin | å‘ç°å…¨ä¸–ç•Œæœ€ä¼˜é›…çš„å·¥ä½œç¯å¢ƒ ####App ReadHub X-ç§‘æŠ€åª’ä½“èµ„è®¯èšåˆé˜…è¯»:ReadHux X æ˜¯ä¸€æ¬¾éå®˜æ–¹çš„ReadHub iOSå®¢æˆ·ç«¯ï¼Œä½¿ç”¨swiftå¼€å‘ï¼Œå³å°†ä¸Šæ¶ã€‚ ç«ç®­å¿«é€’:ç«ç®­å¿«é€’ğŸš€ï¼Œç®€å•å¥½ç”¨çš„å¿«é€’æŸ¥è¯¢app,swift3,å·²ä¸Šæ¶ ç®€è®°:ç®€è®°appï¼Œæ—¥è®°ç±»å·¥å…·ï¼Œæ–‡ä»¶å¤¹ç®¡ç†ï¼ŒåŸºäºswift3ï¼Œå·²ä¸Šæ¶ã€‚ ####Open Source LVTransition:swiftå°è£…çš„è½¬åœºåŠ¨ç”»ç»„ä»¶ LVPageMenuController:swiftå°è£…çš„å¤šé¡µé¢å¯æ»‘åŠ¨è§†å›¾æ§åˆ¶å™¨ï¼Œç±»ä¼¼ç½‘æ˜“æ–°é—»ã€‚ HLQRCode : ä½¿ç”¨AVFoundationå®ç°çš„äºŒç»´ç æ‰«æå’Œç”Ÿæˆä»¥åŠæ¡å½¢ç çš„æ‰«æã€‚ LVCategoryMenu : ç”µå•†äº§å“åˆ†ç±»è§†å›¾ç»„ä»¶ã€‚ PythonIniOS : ä¸€ä¸ªåœ¨iOSå®¢æˆ·ç«¯ä¸­æ‰§è¡Œpythonçš„æ–¹æ¡ˆã€‚ Moreâ€¦","link":"/about/index.html"},{"title":"all-tags","text":"","link":"/all-tags/index.html"},{"title":"å†å²æ–‡ç« ","text":"","link":"/archives/index.html"},{"title":"category","text":"","link":"/category/index-1.html"},{"title":"category","text":"","link":"/category/index.html"},{"title":"ä¼˜ç§€çš„æŠ€æœ¯åšå®¢","text":"ä»Šæ—¥å¤´æ¡æŠ€æœ¯åšå®¢ å¾®ä¿¡è¯»ä¹¦æŠ€æœ¯åšå®¢ MrPeakæ‚è´§é“ºï¼Œfacebook iOSå·¥ç¨‹å¸ˆ Bangâ€™s blog Bestswift-å¼ æ˜Ÿå®‡çš„æŠ€æœ¯åšå®¢ YYKitä½œè€…éƒ­è€€æºçš„æŠ€æœ¯åšå®¢ï¼Œã€Šæ·±å…¥ç†è§£Runloopã€‹ä½œè€…","link":"/link/index.html"},{"title":"Project","text":"","link":"/project/index.html"},{"title":"åˆ†ç±»","text":"","link":"/categories/index.html"},{"title":"all-categories","text":"","link":"/all-categories/index.html"},{"title":"search","text":"","link":"/search/index.html"},{"title":"æ ‡ç­¾äº‘","text":"","link":"/tags/index.html"},{"title":"tag","text":"","link":"/tag/index.html"},{"title":"all-archives","text":"","link":"/all-archives/index.html"},{"title":"iOSé¢è¯•é¢˜","text":"","link":"/iOSInterview/index.html"}],"posts":[{"title":"Effective-Objective C 2.0 è¦ç‚¹","text":"Effective-Ojective C 2.0 è¯»ä¹¦ç¬”è®° ç¬¬ä¸€ç« çš„å†…å®¹æ¯”è¾ƒåŸºç¡€ï¼Œå°±æ²¡æœ‰åˆ—åœ¨ç¬”è®°å½“ä¸­äº†ã€‚å¦å¤–è¯¥ç¬”è®°åªè®°å½•æ¯ä¸€ä¸ªè¦ç‚¹ä¹‹åçš„æ€»ç»“ï¼Œé‡ç‚¹åœ°æ–¹ä¼šå¦å¤–æ¢è®¨ã€‚ ç¬¬äºŒç«  æ¶ˆæ¯ã€å¯¹è±¡ã€è¿è¡ŒæœŸ 7.åœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡ åœ¨å¯¹è±¡å†…éƒ¨è¯»å–æ•°æ®æ—¶ï¼Œåº”è¯¥ç›´æ¥é€šè¿‡å®ä¾‹å˜é‡æ¥è¯»å–ï¼›è€Œå†™å…¥æ•°æ®æ—¶ï¼Œåº”è¯¥é€šè¿‡å±æ€§çš„è®¾ç½®æ–¹æ³•æ¥å†™ã€‚ åœ¨åˆå§‹åŒ–æ–¹æ³•å¤šåŠdeallocæ–¹æ³•ä¸­ï¼Œæ€»æ˜¯é€šè¿‡å®ä¾‹å˜é‡æ¥è¯»å†™æ•°æ®ã€‚ æœ‰æ—¶ä¼šä½¿ç”¨lazy initializitionæ–¹å¼æ¥åˆå§‹åŒ–æŸæ•°æ®ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦é€šè¿‡å±æ€§æ¥è¯»å–æ•°æ®ã€‚ 8.ç†è§£â€œå¯¹è±¡åŒç­‰æ€§â€è¿™ä¸€æ¦‚å¿µ è‹¥æƒ³æ£€æµ‹å¯¹è±¡çš„ç­‰åŒæ€§ï¼Œè¯·æä¾›isEqual:ä¸hashæ–¹æ³•ã€‚ ç›¸åŒçš„å¯¹è±¡å¿…é¡»å…·æœ‰ç›¸åŒçš„å“ˆå¸Œç ï¼Œä½†æ˜¯ä¸¤ä¸ªå“ˆå¸Œç ç›¸åŒçš„å¯¹è±¡å´æœªå¿…ç›¸åŒã€‚ ç¼–å†™hashæ–¹æ³•æ—¶ï¼Œåº”è¯¥ä½¿ç”¨è®¡ç®—é€Ÿåº¦å¿«è€Œä¸”å“ˆå¸Œå—ç¢°æ’å‡ ç‡ä½çš„ç®—æ³•ã€‚ 9.ä»¥ç±»ç°‡æ¨¡å¼éšè—å®ç°ç»†èŠ‚ ç±»ç°‡æ¨¡å¼å¯ä»¥æŠŠå®ç°ç»†èŠ‚éšè—åœ¨ä¸€å¥—ç®€å•çš„å…¬å…±æ¥å£åé¢ã€‚ ç³»ç»Ÿæ¡†æ¶ä¸­ç»å¸¸ä½¿ç”¨ç±»ç°‡ã€‚ ä»ç±»ç°‡çš„å…¬å…±æŠ½è±¡åŸºç±»ä¸­ç»§æ‰¿å­ç±»æ—¶è¦å½“å¿ƒï¼Œè‹¥æœ‰å¼€å‘æ–‡æ¡£ï¼Œåˆ™åº”é¦–å…ˆé˜…è¯»ã€‚ 10.åœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ® 1.å…³è”å¯¹è±¡çš„å­˜å‚¨ç­–ç•¥ï¼šæšä¸¾å€¼ OBJC_ASSOCIATION_ASSIGN â€”&gt;assignOBJC_ASSOCIATION_RETAIN_NONATOMIC â€”&gt;nonatomic,retainOBJC_ASSOCIATION_COPY_NONATOMIC â€”&gt;nonatomic,copyOBJC_ASSOCIATION_RETAIN â€”&gt;retainOBJC_ASSOCIATION_COPY â€”&gt;copy åˆ›å»ºå…³è”å¯¹è±¡æ–¹æ³•ï¼švoid objc_setAssociatedObject(id object,void *key,id value,objc_AssociationPolicy policy) ä»¥ç»™å®šçš„é”®è·å–æŸå¯¹è±¡çš„å…³è”å¯¹è±¡çš„å€¼id objc_getAssociatedObject(id object,void *key) ç§»é™¤è¯¥å¯¹è±¡çš„æ‰€æœ‰å…³è”å¯¹è±¡void objc_removeAssociatedObjects(id object) Note:è®¾ç½®å…³è”å¯¹è±¡æ—¶çš„keyæ˜¯ä¸€ä¸ªâ€œä¸é€æ˜æŒ‡é’ˆâ€ï¼ˆopaque pointerï¼šå…¶æ‰€æŒ‡å‘çš„æ•°æ®ç»“æ„ä¸å±€é™ä¸æŸç§ç‰¹å®šç±»å‹æŒ‡é’ˆï¼‰ï¼› åœ¨è®¾ç½®å…³è”å¯¹è±¡æ—¶ï¼Œé€šå¸¸ä½¿ç”¨é™æ€å…¨å±€å˜é‡ä½œä¸ºkeyã€‚ å¯ä»¥é€šè¿‡â€œassociateObjectâ€æœºåˆ¶æ¥å§ä¸¤ä¸ªå¯¹è±¡è¿èµ·æ¥ã€‚ å®šä¹‰å…³è”å¯¹è±¡æ—¶å¯æŒ‡å®šå†…å­˜ç®¡ç†è¯­ä¹‰ï¼Œç”¨äºæ¨¡ä»¿å®šä¹‰å±æ€§æ—¶æ‰€åœ¨ç”¨çš„æ‹¥æœ‰å…³ç³»å’Œéæ‹¥æœ‰å…³ç³»ã€‚ åªæœ‰åœ¨å…¶ä»–åšæ³•ä¸å¯è¡Œæ—¶æ‰é€‰ç”¨å…³è”å¯¹è±¡ï¼Œå› ä¸ºè¿™ç§åšæ³•é€šå¸¸ä¼šå¼•å…¥éš¾ä»¥æŸ¥æ‰¾çš„bugã€‚ 11.ç†è§£objc_msgSendçš„ä½œç”¨ã€‚ æ¶ˆæ¯ç”±æ¥å—è€…ã€é€‰æ‹©å™¨åŠå‚æ•°æ„æˆã€‚ç»™æŸå¯¹è±¡å‘é€æ¶ˆæ¯ï¼ˆinvoke a messageï¼‰ï¼Œä¹Ÿå°±ç›¸å½“äºåœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•ï¼ˆcalla methodï¼‰ å‘ç»™æŸå¯¹è±¡çš„å…¨éƒ¨æ¶ˆæ¯éƒ½è¦æœ‰åŠ¨æ€æ¶ˆæ¯æ´¾å‘ç³»ç»Ÿï¼ˆdynamic message dispatch systemï¼‰æ¥å¤„ç†ï¼Œè¯¥ç³»ç»Ÿä¼šæŸ¥å‡ºå¯¹åº”çš„æ–¹æ³•ï¼Œå¹¶æ‰§è¡Œå…¶ä»£ç ã€‚ 12.ç†è§£æ¶ˆæ¯è½¬å‘æœºåˆ¶ã€‚ è‹¥å¯¹è±¡æ— æ³•å“åº”æŸä¸ªé€‰æ‹©å™¨ä¸­çš„æ¶ˆæ¯ï¼Œåˆ™è¿›å…¥æ¶ˆæ¯è½¬å‘è¿‡ç¨‹ã€‚ é€šè¿‡è¿è¡ŒæœŸçš„åŠ¨æ€æ–¹æ³•è§£ææœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨éœ€è¦ç”¨åˆ°æŸä¸ªæ–¹æ³•æ—¶å†å°†å…¶åŠ å…¥ç±»ä¸­ã€‚ å¯¹è±¡å¯ä»¥æŠŠå…¶æ— æ³•è§£è¯»çš„æ¶ˆæ¯è½¬äº¤ç»™å…¶ä»–å¯¹è±¡æ¥å¤„ç†ã€‚ è‹¥ç»è¿‡ä¸Šè¿°ä¸¤æ­¥è¿˜æ˜¯æ²¡åŠæ³•å¤„ç†æ¶ˆæ¯ï¼Œåˆ™å¯åŠ¨å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ã€‚ 13.ä½¿ç”¨æ–¹æ³•è°ƒé…æŠ€æœ¯Method Swizzlingè°ƒè¯•é»‘ç›’æ–¹æ³•void method_exchangeImplementations(Method m1,Method m2) åœ¨è¿è¡ŒæœŸï¼Œå¯ä»¥å“é›·ä¸­æ–°å¢æˆ–æ›¿æ¢é€‰æ‹©å™¨æ‰€å¯¹åº”çš„æ–¹æ³•å®ç°ã€‚ ä½¿ç”¨å¦ä¸€ä»½å®ç°æ¥æ›¿æ¢åŸæœ‰çš„æ–¹æ³•å®ç°ï¼Œå«åšæ–¹æ³•è°ƒé…ï¼Œå¼€å‘è€…å¯ä»¥ç”¨æ­¤æŠ€æœ¯å‘åŸæœ‰å®ç°ä¸­æ·»åŠ æ–°åŠŸèƒ½ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰è°ƒè¯•ç¨‹åºçš„æ—¶å€™æ‰éœ€è¦åœ¨è¿è¡ŒæœŸä¿®æ”¹æ–¹æ³•å®ç°ï¼Œè¿™ç§åšæ³•ä¸å®œæ»¥ç”¨ã€‚ 14.ç†è§£â€œç±»å¯¹è±¡â€çš„ç”¨æ„ æ¯ä¸ªå®ä¾‹éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘Classå¯¹è±¡çš„æŒ‡é’ˆï¼ˆisaï¼‰ï¼Œç”¨æ„è¡¨æ˜å…¶ç±»å‹ï¼Œè€Œè¿™äº›Classå¯¹è±¡åˆ™æ„æˆäº†ç±»çš„ç»§æ‰¿ä½“ç³»ï¼ˆsuper_classæŒ‡é’ˆï¼‰ã€‚ å¦‚æœå¯¹è±¡ç±»å‹æ— æ³•å†ç¼–è¯‘æœŸç¡®å®šï¼Œé‚£ä¹ˆä¹…åº”è¯¥ä½¿ç”¨ç±»å‹ä¿¡æ¯æŸ¥è¯¢æ–¹æ³•æ¥æ¢çŸ¥ã€‚isMemberOfClassï¼ˆç‰¹å®šç±»å‹çš„ç±»ï¼‰ï¼ŒisKindOfClassï¼ˆè¯¥ç±»åŠå…¶æ´¾ç”Ÿç±»ï¼‰ å°½é‡ä½¿ç”¨ç±»å‹ä¿¡æ¯æŸ¥è¯¢æ–¹æ³•æ¥ç¡®å®šå¯¹è±¡ç±»å‹ï¼Œè€Œä¸è¦ç›´æ¥æ¯”è¾ƒç±»å¯¹è±¡ï¼Œå› ä¸ºæŸäº›å¯¹è±¡å¯èƒ½å®ç°äº†æ¶ˆæ¯è½¬å‘åŠŸèƒ½ã€‚ ç¬¬ä¸‰ç«  æ¥å£ä¸APIè®¾è®¡ 15.ä½¿ç”¨å‰ç¼€é¿å…å‘½åç©ºé—´å†²çªï¼Œè§£å†³duplicate symbolé—®é¢˜ã€‚16.ä½¿ç”¨å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ï¼Œå³å¸¦æœ‰ç‰¹å®šå‚æ•°çš„åˆå§‹åŒ–æ–¹æ³•ã€‚17.å®ç°descriptionæ–¹æ³•ç”¨æ¥è°ƒè¯•ç¨‹åºã€‚å¹¶ä¸”æœ€å¥½ç”¨å­—å…¸çš„æ–¹å¼è¾“å‡ºç±»çš„å±æ€§ï¼Œæ¡ç†æ¸…æ™°ã€‚18.å°½é‡ä½¿ç”¨ä¸å¯å˜å¯¹è±¡ã€‚19.ä½¿ç”¨æ¸…æ™°è€Œåè°ƒçš„å‘½åæ–¹å¼ã€‚å‚è€ƒObjective Cç¼–ç¨‹è§„èŒƒã€‚20.ä¸ºç§æœ‰æ–¹æ³•åæ·»åŠ å‰ç¼€ã€‚21.ç†è§£OCçš„é”™è¯¯æ¨¡å‹ã€‚OCåœ¨é‡åˆ°æå…¶ä¸¥é‡çš„é”™è¯¯åï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºä¼šé€€å‡ºï¼ˆcrashï¼‰ï¼Œæ‰€ä»¥ä¸ç”¨å¤ªè€ƒè™‘å¼‚å¸¸å®‰å…¨ã€‚å¦‚æœä¸å¤ªä¸¥é‡çš„é”™è¯¯ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®è¿”å›nil/0ï¼Œæˆ–è€…NSErrorã€‚22.ç†è§£NSCopyingåè®®ã€‚ å®ç°NSCopyingåè®®ã€‚ é‡å†™copyWithZoneæ–¹æ³•ã€‚ å¦‚æœç±»ä¸­æœ‰å¯å˜å±æ€§ï¼Œåˆ™åœ¨copyWithZoneæ–¹æ³•ä¸­åŒæ—¶éœ€è¦å¯¹å¯å˜å±æ€§è¿›è¡ŒmutableCopyã€‚ä¸¾ä¸ªä¾‹å­ï¼š 1234567891011121314151617181920212223242526272829303132#import &lt;Foundation/Foundation.h&gt;@interface EOCPerson : NSObject&lt;NSCopying&gt;@property (nonatomic,copy)NSString * firstname;@property (nonatomic,copy)NSString * lastname;- (id)initWithFirstName:(NSString *)fisrtname lastName:(NSString *)lastname;@end#import \"EOCPerson.h\"@implementation EOCPerson&#123; NSMutableSet * _friends;&#125;- (id)initWithFirstName:(NSString *)fisrtname lastName:(NSString *)lastname&#123; if (self == [super init]) &#123; _firstname = firstname; _lastname = lastname; &#125; return self;&#125;- (id)copyWithZone:(NSZone *)zone&#123; EOCPerson *copy = [[[self class] allocWithZone:zone] initWithFirstName:_firstname lastName:_lastname]; copy-&gt;_friends = [_friends mutableCopy]; return copy;&#125;@end è¦ç‚¹ï¼š è‡ªå®šä¹‰å¯¹è±¡è‹¥æƒ³è¦è¿›è¡Œcopyæ“ä½œï¼Œéœ€å®ç°NSCopyingåè®®ã€‚ è‡ªå®šä¹‰å¯¹è±¡è‹¥åˆ†ä¸ºå¯å˜å’Œä¸å¯å˜ç‰ˆæœ¬ï¼Œåˆ™éœ€å®ç°NSCopyingå’ŒNSMutableCopyingåè®®ã€‚ å¤åˆ¶å¯¹è±¡æ—¶éœ€è¦è€ƒè™‘ä½¿ç”¨æµ…æ‹·è´è¿˜æ˜¯æ·±æ‹·è´ã€‚ä¸€èˆ¬åº”è¯¥å°½é‡ä½¿ç”¨æµ…æ‹·è´ã€‚ è‡ªå®šä¹‰å¯¹è±¡è‹¥éœ€è¦æ·±æ‹·è´ï¼Œåˆ™å¯ä»¥æ–°å¢ä¸€ä¸ªä¸“é—¨æ‰§è¡Œæ·±æ‹·è´çš„æ–¹æ³•ã€‚ ç¬¬å››ç«  åè®®ä¸åˆ†ç±» 23.é€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡24.å°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°æ•°ä¸ªåˆ†ç±»ï¼ˆcategoryï¼‰ä¹‹ä¸­ã€‚25.æ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹åˆ†ç±»åç§°å‰åŠ å‰ç¼€ã€‚26.å°½é‡ä¸è¦åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§ï¼ˆå½“ç„¶éè¦åšä¹Ÿå¯ï¼‰27.ä½¿ç”¨class-continuationåˆ†ç±»ï¼ˆåŒ¿ååˆ†ç±»ï¼‰éšè—å®ç°ç»†èŠ‚28.é€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡ã€‚ä¾‹å¦‚ id,idã€‚ä»»æ„ä¸€ä¸ªéµå®ˆäº†ä¸Šè¿°åè®®çš„å¯¹è±¡éƒ½å¯ä»¥èµ‹å€¼ç»™è¿™ä¸ªå±æ€§ã€‚ ç¬¬äº”ç«  å†…å­˜ç®¡ç† 29.ç†è§£å¼•ç”¨è®¡æ•°ã€‚30.ä»¥ARCç®€åŒ–å¼•ç”¨è®¡æ•°ã€‚31.åœ¨deallocæ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬ã€‚32.ç¼–å†™â€œå¼‚å¸¸å®‰å…¨ä»£ç â€æ—¶åº”ç•™æ„å†…å­˜ç®¡ç†é—®é¢˜ã€‚33.ä»¥å¼±å¼•ç”¨é¿å…å¾ªç¯å¼•ç”¨ã€‚34.ä»¥â€œè‡ªåŠ¨é‡Šæ”¾æ± â€é™ä½å†…å­˜å³°å€¼ã€‚35.ä½¿ç”¨Zombie Objectè°ƒè¯•å†…å­˜é—®é¢˜ã€‚36.ä¸è¦ä½¿ç”¨retainCountã€‚ARCä¸‹å·²åºŸå¼ƒã€‚ ç¬¬å…­ç«  GCD 37.ç†è§£blockã€‚é‡ç‚¹çœ‹ä¸€ä¸‹blockçš„å†…éƒ¨ç»“æ„é‚£ä¸€èŠ‚ã€‚ blockä¸­çš„invokeå˜é‡ï¼Œæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œç±»å‹ä¸ºvoid(*)(void *,_)æŒ‡å‘äº†blockçš„å®ç°ä»£ç ï¼ˆéœ€è¦æ‰§è¡Œçš„å‡½æ•°ï¼‰ã€‚ blockä¸­çš„descriptoræ˜¯ä¸€ä¸ªç»“æ„ä½“æŒ‡é’ˆã€‚è¯¥ç»“æ„ä½“ä¸­åŒ…å«äº†è¿™ä¸ªblockçš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚blockçš„sizeã€‚ blockè¿˜ä¼šæŠŠä»å¤–éƒ¨æ•è·çš„å˜é‡æ‹·è´ä¸€ä»½ï¼Œæ”¾åœ¨descriptorå˜é‡çš„åé¢ã€‚æ‹·è´çš„å¹¶ä¸æ˜¯å¯¹è±¡æœ¬èº«ï¼Œè€Œæ˜¯è¿™äº›å¯¹è±¡çš„æŒ‡é’ˆå˜é‡ã€‚invokeå‡½æ•°æŠŠblockå¯¹è±¡æœ¬èº«ä½œä¸ºå‚æ•°ä¼ é€’è¿›æ¥ï¼Œå°±æ˜¯ä¸ºäº†èƒ½ æ‹¿åˆ°blockæ•è·çš„è¿™äº›å˜é‡ã€‚ blockè¢«å®šä¹‰æ—¶æ˜¯åˆ†é…åœ¨æ ˆå†…å­˜ä¸­ã€‚æ‰€ä»¥éœ€è¦copyä¸€ä»½ï¼Œå¤åˆ¶åˆ°å †å†…å­˜ä¸­ï¼Œå°±å¯ä»¥åœ¨å¤–éƒ¨ä½¿ç”¨ã€‚1234567891011121314151617181920//æ ˆblockï¼švoid(^block)(); if (/* condition */) &#123; block = ^()&#123; NSLog(@\"Block in Stack\"); &#125; &#125;else&#123; block = ^()&#123; NSLog(@\"Block in Stack still\"); &#125; &#125; block();//å †blockï¼švoid(^block)(); if (/* condition */) &#123; block = [^()&#123; NSLog(@\"Block in Heap\"); &#125; copy]; &#125;else&#123; block = [^()&#123; NSLog(@\"Block in Heap\"); &#125; copy]; &#125; block();//å…¨å±€blockï¼š void (^block)() = ^()&#123; NSLog(@\"I'm a global block\");&#125; 38.ä¸ºå¸¸ç”¨çš„blockåˆ›å»ºtypedefã€‚39.ç”¨handlerå—æ¥é™ä½ä»£ç åˆ†æ•£ã€‚å¸¸ç”¨äºå¼‚æ­¥ä»»åŠ¡æ—¶ã€‚40.ä½¿ç”¨blockæ—¶æ³¨æ„ä¸è¦å‡ºç°å¾ªç¯å¼•ç”¨ã€‚41.å¤šç”¨dispatch queueï¼Œå°‘ç”¨åŒæ­¥é”ã€‚ä¾‹å¦‚æ¶‰åŠåˆ°æ•°æ®çš„å­˜å–ã€‚ GCDä»¥å‰ï¼Œæœ‰ä¸¤ç§å®ç°é”çš„æ–¹å¼ï¼š 1.@synchronized(self){ â€¦ }.è¿™ç§æ–¹å¼ä¼šé™ä½ä»£ç æ‰§è¡Œæ•ˆç‡ï¼Œå› ä¸ºèŠ±æ‹¬å·å†…çš„ä»£ç éƒ½å…±ç”¨ä¸€ä¸ªåŒæ­¥é”ï¼Œä¸”é¡ºåºæ‰§è¡Œã€‚ 2.ä½¿ç”¨NSLockã€‚lock()æ–¹æ³•å’Œunlock()æ–¹æ³•ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨é€’å½’é”NSRecursiveLock,çº¿ç¨‹èƒ½å¤Ÿå¤šæ¬¡æŒæœ‰è¯¥é”ï¼Œè€Œä¸ä¼šå‡ºç°æ­»é”ç°è±¡ã€‚ ä¾‹å­ï¼šå±æ€§çš„è¯»å–å’Œè®¾ç½®ä¸­ã€‚ 42.å¤šç”¨GCDï¼Œå°‘ç”¨performeSelector. performSelectorç³»åˆ—æ–¹æ³•åœ¨å†…å­˜ç®¡ç†æ–¹é¢å®¹æ˜“æœ‰é™·é˜±ã€‚ç¼–è¯‘å™¨æ— æ³•ç¡®å®šå…¶å°†è¦æ‰§è¡Œçš„SELå…·ä½“æ˜¯ä»€ä¹ˆï¼Œå› æ­¤æ— æ³•é€šè¿‡ARCåœ¨ç¼–è¯‘æœŸæ’å…¥å†…å­˜ç®¡ç†æ–¹æ³•ã€‚ performSelectorèƒ½å¤Ÿå¤„ç†çš„SELæœ‰ç‚¹å±€é™ï¼Œé€‰æ‹©å™¨çš„è¿”å›ç±»å‹å’Œå‚æ•°ä¸ªæ•°éƒ½æœ‰é™åˆ¶ã€‚ 43.æŒæ¡GCDå’ŒOperationQueueæ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ—¶æœºã€‚ æ‰§è¡Œåå°ä»»åŠ¡æ—¶ï¼Œæ“ä½œé˜Ÿåˆ—æ›´æœ‰ä¼˜åŠ¿ã€‚ ä½¿ç”¨NSOperationå’ŒNSOperationQueueçš„å¥½å¤„ï¼š å–æ¶ˆæŸä¸ªæ“ä½œã€‚æ³¨æ„ï¼šå¯ä»¥å–æ¶ˆçš„æ˜¯é˜Ÿåˆ—ä¸­è¿˜æ²¡æœ‰æ‰§è¡Œçš„ä»»åŠ¡ã€‚ æŒ‡å®šæ“ä½œé—´çš„ä¾èµ–å…³ç³»ã€‚ é€šè¿‡KVOç›‘æµ‹NSOperationå¯¹è±¡çš„å±æ€§ã€‚ æŒ‡å®šOperationçš„ä¼˜å…ˆçº§ã€‚ é‡ç”¨operationsã€‚ 44.é€šè¿‡Dispatch_groupæœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡ dispatch_apply. è¿™ä¸ªä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚æ‰€ä»¥ä¸èƒ½æŠŠä¸»çº¿ç¨‹ä½œä¸ºè¯¥æ–¹æ³•æ‰§è¡Œçš„çº¿ç¨‹å‚æ•°ã€‚ 45.ä½¿ç”¨dispatch_onceæ¥æ‰§è¡Œåªéœ€è¦è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç ã€‚å¸¸ç”¨äºå•ä¾‹æ¨¡å¼ã€‚46.ä¸è¦ä½¿ç”¨dispatch_get_current_queue ç¬¬ä¸ƒç«  ç³»ç»Ÿæ¡†æ¶ 47.ç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶ã€‚ Fundation å’Œ CoreFoundationã€‚ æ— ç¼æ¡¥æ¥ï¼Œtoll-free-bridging,å¯ä»¥å°†CoreFoundationä¸­çš„Cè¯­è¨€æ•°æ®ç»“æ„è½¬æ¢ä¸ºFoundationä¸­çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥åå‘è½¬æ¢ã€‚ 48.å¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨forå¾ªç¯ã€‚ for(int i=0;i&lt;max;i++){} NSEnumerator. allObjects() å’ŒnextObject()æ–¹æ³•ã€‚ å¿«é€Ÿéå† fast enumeration. for inåŸºäºblockçš„éå†æ–¹å¼- enumerateObjectesUsingBlock:(void(^)(id object,NSUInteger index,BOOL *stop))blockâ€¦å…¶ä»–æ–¹æ³• 49.å¯¹è‡ªå®šä¹‰å†…å­˜ç®¡ç†è¯­ä¹‰çš„collectioné›†åˆç±»ä½¿ç”¨æ— ç¼æ¡¥æ¥ã€‚ __bridge __bridge_retained __bridge_transfer 1234567891011121314151617NSArray *nameArray = @[@\"g\",@\"c\",@\"d\"];//æ­£å‘æ¡¥æ¥ï¼šFoundationå¯¹è±¡-&gt;CoreFoundationæ•°æ®ç»“æ„CFArrayRef aCFArray = (__bridge CFArrayRef)nameArray ;NSLog(@\"CFArray's count is %li\",CFArrayGetCount(aCFArray));CFArrayRef bCFArray = (__bridge_retained CFArrayRef)nameArray;//æˆ–è€…ç”¨bCFArray = CFBridgingRetain(nameArray);NSLog(@\"CFArray's count is %li\",CFArrayGetCount(bCFArray));CFRelease(bCFArray);NSArray *names = (NSArray *)(__bridge_transfer NSArray *)aCFArray;// //æˆ–è€…ç”¨// NSArray * names = CFBridgingRelease(aCFArray);//NSLog(@\"%@\",names); 50.æ„å»ºç¼“å­˜æ—¶ä½¿ç”¨NSCacheè€Œä¸æ˜¯NSDictionaryã€‚ 51.ç²¾ç®€initializeå’Œloadçš„å®ç°ä»£ç ã€‚ ä¸¤ä¸ªéƒ½æ˜¯ç±»çš„åˆå§‹åŒ–æ–¹æ³•ã€‚ 1.load() å¯¹äºåŠ å…¥è¿è¡Œæ—¶çš„ç±»classå’Œåˆ†ç±»categoryæ¥è¯´ï¼Œå½“åŒ…å«ç±»å’Œåˆ†ç±»çš„ç¨‹åºåº“è½½å…¥ç³»ç»Ÿæ—¶ï¼Œå¿…å®šä¼šè°ƒç”¨+ (void)loadæ–¹æ³•ï¼Œä¸”åªè°ƒç”¨ä¸€æ¬¡ã€‚ å¯¹äºiOSç³»ç»Ÿï¼Œæ˜¯åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ã€‚å¯¹äºMac OS Xæ¥è¯´æ›´è‡ªç”±ï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨åŠ¨æ€åŠ è½½dynamic loadingè¿™ç§ç‰¹æ€§,ç­‰åº”ç”¨ç¨‹åºå¯åŠ¨å®Œæˆä¹‹åå†å»åŠ è½½ç¨‹åºåº“ã€‚è‹¥åˆ†ç±»å’Œç±»ä¸­éƒ½å®šä¹‰äº†loadæ–¹æ³•ï¼Œåˆ™å…ˆè°ƒç”¨ç±»çš„ï¼Œå†è°ƒç”¨åˆ†ç±»çš„ã€‚ loadæ–¹æ³•ä¸€èˆ¬åªç”¨æ¥è°ƒè¯•ç¨‹åºï¼Œè€Œä¸æ˜¯åœ¨å…¶ä¸­åšä»€ä¹ˆæ“ä½œã€‚ 2.initialize å¯¹äºæ¯ä¸ªç±»æ¥è¯´ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨é¦–æ¬¡ä½¿ç”¨è¯¥ç±»ä¹‹å‰è°ƒç”¨ï¼Œä¸”åªè°ƒç”¨ä¸€æ¬¡ã€‚å®ƒæ˜¯ç”±è¿è¡Œæ—¶ç³»ç»Ÿæ¥è°ƒç”¨ï¼Œè€Œä¸æ˜¯ç”±ä»£ç è°ƒç”¨ã€‚ ä¸loadçš„åŒºåˆ«ï¼š æƒ°æ€§è°ƒç”¨ã€‚åªæœ‰å½“ç”¨åˆ°è¿™ä¸ªç±»æ—¶ï¼Œæ‰ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœæŸä¸ªç±»æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œåˆ™ä¸ä¼šè¢«è°ƒç”¨ã€‚è€Œç¨‹åºå¿…é¡»é˜»å¡æŠŠæ‰€æœ‰ç±»çš„loadæ–¹æ³•æ‰§è¡Œå®Œæ‰èƒ½ç»§ç»­ã€‚ æ‰§è¡Œæ–¹æ³•æ—¶è¿è¡Œæ—¶ç³»ç»Ÿçš„çŠ¶æ€ã€‚initializerè¢«æ‰§è¡Œæ—¶ï¼Œruntime systemæ˜¯æ­£å¸¸çŠ¶æ€çš„ã€‚è€Œloadè¢«æ‰§è¡Œæ—¶ï¼Œruntime systemæ˜¯è„†å¼±çŠ¶æ€çš„ã€‚(è¿™ä¸ªè„†å¼±çŠ¶æ€æ˜¯æŒ‡æœ€å¥½ä¸è¦åœ¨loadæ–¹æ³•ä¸­ä½¿ç”¨åˆ«çš„ç±») initializeæ–¹æ³•éµå¾ªç»§æ‰¿è°ƒç”¨ã€‚å³å­ç±»å³ä½¿æ²¡æœ‰å®ç°initializeæ–¹æ³•ï¼Œä¹Ÿä¼šè°ƒç”¨çˆ¶ç±»çš„initializeæ–¹æ³•ã€‚è€Œloadæ–¹æ³•åˆ™ä¸ä¼šï¼Œå­ç±»è‹¥æ²¡æœ‰å®ç°loadæ–¹æ³•ï¼Œä¹Ÿä¸ä¼šå»è°ƒç”¨çˆ¶ç±»çš„loadã€‚ 52.åˆ«å¿˜äº†NSTimerä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡ã€‚ NSTimerå¯¹è±¡ä¼šå¼•ç”¨å…¶ç›®æ ‡å¯¹è±¡ï¼Œç›´åˆ°è®¡æ—¶å™¨æœ¬èº«å¤±æ•ˆä¸ºæ­¢ï¼Œè°ƒç”¨invalidateæ–¹æ³•å¯ä»¤è®¡æ—¶å™¨å¤±æ•ˆï¼Œå¦å¤–ï¼Œä¸€æ¬¡æ€§çš„è®¡æ—¶å™¨åœ¨è§¦å‘å®Œä»»åŠ¡ä¹‹åä¹Ÿä¼šå¤±æ•ˆã€‚ åå¤æ‰§è¡Œä»»åŠ¡çš„è®¡æ—¶å™¨ï¼Œå¾ˆå®¹æ˜“å¼•èµ·å¾ªç¯å¼•ç”¨ã€‚ å¯ä»¥æ‰©å……NSTimerçš„åŠŸèƒ½ï¼Œç”¨blockæ¥æ‰“ç ´è¿™ç§å¾ªç¯å¼•ç”¨ã€‚å¿…é¡»åˆ›å»ºåˆ†ç±»ï¼Œå°†ç›¸å…³å®ç°ä»£ç åŠ å…¥å…¶ä¸­ã€‚ 123456789101112131415161718192021222324252627282930313233343536//åˆ†ç±»æ–‡ä»¶.h/.m #import &lt;Foundation/Foundation.h&gt; @interface NSTimer (BlockTimer) + (NSTimer *)bt_scheduledTimerWithTimeInterval:(NSTimeInterval)interval block:(void(^)())block repeats:(BOOL)repeats; @end #import \"NSTimer+BlockTimer.h\" @implementation NSTimer (BlockTimer) + (NSTimer *)bt_scheduledTimerWithTimeInterval:(NSTimeInterval)interval block:(void(^)())block repeats:(BOOL)repeats&#123; return [self scheduledTimerWithTimeInterval:interval target:self selector:@selector(bt_doSomething:) userInfo:[block copy] repeats:repeats]; &#125; + (void)bt_doSomething:(NSTimer *)timer&#123; void(^block)() = timer.userInfo; if (block) &#123; block(); &#125; &#125; @end//åœ¨è°ƒç”¨æ—¶ __weak typeof(self)weakSelf = self; _timer = [NSTimer bt_scheduledTimerWithTimeInterval:1 block:^&#123; //ä¸éœ€è¦å†è½¬æˆstrongä¹Ÿå¯ä»¥å•Šï¼ï¼Ÿ [weakSelf printName:@\"hello\"]; ViewController * strongSelf = weakSelf; [strongSelf printName:@\"world\"]; &#125; repeats:YES];","link":"/2016/03/23/Effective-Objective-C-2-0-è¦ç‚¹/"},{"title":"Learn Swift - Section 4th æ‰©å±•ã€åè®®ã€æ³›å‹","text":"æ‰©å±• Extensionæ‰©å±•Extensionå°±æ˜¯å‘ä¸€ä¸ªå·²æœ‰çš„ç±»ã€ç»“æ„ä½“ã€æšä¸¾ç±»å‹æˆ–è€…åè®®ç±»å‹æ·»åŠ æ–°åŠŸèƒ½ï¼ˆfunctionalityï¼‰ã€‚è¿™åŒ…æ‹¬åœ¨æ²¡æœ‰æƒé™è·å–åŸå§‹æºä»£ç çš„æƒ…å†µä¸‹æ‰©å±•ç±»å‹çš„èƒ½åŠ›ï¼ˆå³é€†å‘å»ºæ¨¡ï¼‰ã€‚æ‰©å±•å’Œ Objective-C ä¸­çš„åˆ†ç±»ï¼ˆcategoriesï¼‰ç±»ä¼¼ã€‚ï¼ˆä¸è¿‡ä¸ Objective-C ä¸åŒçš„æ˜¯ï¼ŒSwift çš„æ‰©å±•æ²¡æœ‰åå­—ã€‚ï¼‰Swift ä¸­çš„æ‰©å±•å¯ä»¥ï¼š- æ·»åŠ è®¡ç®—å‹å±æ€§å’Œè®¡ç®—å‹é™æ€å±æ€§- å®šä¹‰å®ä¾‹æ–¹æ³•å’Œç±»å‹æ–¹æ³•- æä¾›æ–°çš„æ„é€ å™¨- å®šä¹‰ä¸‹æ ‡- å®šä¹‰å’Œä½¿ç”¨æ–°çš„åµŒå¥—ç±»å‹- ä½¿ä¸€ä¸ªå·²æœ‰ç±»å‹ç¬¦åˆæŸä¸ªåè®®- ä¹Ÿå¯ä»¥å¯¹ä¸€ä¸ªåè®®è¿›è¡Œæ‰©å±•123456789101112131415161718192021222324extension Int&#123; //è½¬æ¢æˆå°æ—¶ var hours : Int&#123; return self/3600 &#125; var ago : Int&#123; return -self &#125; //xä¹‹å‰çš„æ—¶é—´ func ago(x:Int) -&gt; Int &#123; return self - x &#125;&#125;let currentTime = 72003.hours3.hours.ago3.ago + currentTime//5ç§’ä¹‹å‰currentTime.ago(5)//1å°æ—¶ä¹‹å‰currentTime.hours.ago(1)currentTime.hours.ago(3600.hours)print(3.ago)åè®® Protocolåè®®å®šä¹‰äº†ä¸€ä¸ªè“å›¾ï¼Œè§„å®šäº†ç”¨æ¥å®ç°æŸä¸€ç‰¹å®šå·¥ä½œæˆ–è€…åŠŸèƒ½æ‰€å¿…éœ€çš„æ–¹æ³•å’Œå±æ€§ã€‚ç±»ï¼Œç»“æ„ä½“æˆ–æšä¸¾ç±»å‹éƒ½å¯ä»¥éµå¾ªåè®®ï¼Œå¹¶æä¾›å…·ä½“å®ç°æ¥å®Œæˆåè®®å®šä¹‰çš„æ–¹æ³•å’ŒåŠŸèƒ½ã€‚ä»»æ„èƒ½å¤Ÿæ»¡è¶³åè®®è¦æ±‚çš„ç±»å‹è¢«ç§°ä¸ºéµå¾ª(conform)è¿™ä¸ªåè®®ã€‚é™¤äº†éµå¾ªåè®®çš„ç±»å‹å¿…é¡»å®ç°é‚£äº›æŒ‡å®šçš„è§„å®šä»¥å¤–ï¼Œè¿˜å¯ä»¥å¯¹åè®®è¿›è¡Œæ‰©å±•ï¼Œå®ç°ä¸€äº›ç‰¹æ®Šçš„è§„å®šæˆ–è€…ä¸€äº›é™„åŠ çš„åŠŸèƒ½ï¼Œä½¿å¾—éµå¾ªçš„ç±»å‹èƒ½å¤Ÿæ”¶ç›Šã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344protocol SellProducts&#123; func sellProducts(product:String)&#125;class Person &#123; var name:String weak var delegate:Seller? lazy var someClosure:(Int,String)-&gt;String = &#123; //åœ¨é—­åŒ…ä¸­å°†selfä¿®é¥°ä¸ºæ— ä¸»å¼•ç”¨ã€‚å°†delegate ä¿®é¥°ä¸º å¼±å¼•ç”¨ [unowned self,weak delegate = self.delegate!]//æ•è·åˆ—è¡¨ (index:Int,strToProcess:String)-&gt;String in return \"\\(self.name),\\(self.delegate),\\(delegate)\" &#125; init(name:String,delegate:Seller?)&#123; self.name = name; self.delegate = delegate; &#125; func giveSellerProducts(product:String ) -&gt; Bool &#123; self.delegate?.sellProducts(product) return true &#125;&#125;class Seller : SellProducts&#123; var product:String? func sellProducts( product: String) &#123; self.product = product &#125;&#125;let seller = Seller()var person = Person (name: \"Hanliu\", delegate: seller)//åˆšå¼€å§‹selleræ˜¯æ²¡æœ‰å•†å“çš„ï¼Œè¦ç­‰åˆ°Personç»™sellerprint(seller.product)//personå‘Šè¯‰sellerï¼Œå¸®æˆ‘å–è‹¹æœperson.giveSellerProducts(\"apple\")//ç°åœ¨selleræ‰‹ä¸­å°±æœ‰äº†å•†å“äº†print(seller.product!)person.someClosure(1,\"haha\")åè®®ä¸­çš„å±æ€§ä¸€å®šè¦æŒ‡æ˜è¯»å†™çŠ¶æ€1234567891011121314151617protocol SomeProtocol &#123; var mustBeSettable:Int&#123;get set&#125;//è¡¨ç¤ºè¯¥å±æ€§æ˜¯å¯è¯»å¯å†™ var notNeededForSetable:String&#123;get&#125;//è¡¨ç¤ºåªè¯» static var someTypedProperty:String&#123;get set&#125;//ç±»å±æ€§(å½“åè®®éµå¾ªè€…æ˜¯classæ˜¯ï¼Œå¯ä»¥ç”¨classå…³é”®å­—)&#125;protocol FullyName &#123; var fullname:String&#123;get&#125;&#125;struct PersonName:FullyName &#123; var fullname: String var shortName :String&#125;let person = PersonName(fullname: \"Levi John\",shortName: \"LJ\")person.fullnameåè®®æœ¬èº«å¹¶ä¸å®ç°ä»»ä½•åŠŸèƒ½ï¼Œä½†æ˜¯åè®®å¯ä»¥è¢«ä½œä¸ºç±»å‹ä½¿ç”¨ã€‚å°±æ˜¯ä¸Stringã€Intè¿™äº›ç±»å‹çš„ä½œç”¨ç›¸åŒã€‚- ä½œä¸ºå‡½æ•°ã€æ–¹æ³•æˆ–æ„é€ å™¨ä¸­çš„å‚æ•°ç±»å‹æˆ–è¿”å›å€¼ç±»å‹- ä½œä¸ºå¸¸é‡ã€å˜é‡æˆ–å±æ€§çš„ç±»å‹- ä½œä¸ºæ•°ç»„ã€å­—å…¸æˆ–å…¶ä»–å®¹å™¨ä¸­çš„å…ƒç´ çš„ç±»å‹1234567891011121314151617181920protocol RandomGenerator &#123; func random()-&gt;Double&#125;class LinerGenerator:RandomGenerator &#123; func random() -&gt; Double &#123; return 11.0011 &#125;&#125;class Dice&#123; let slides:Int var generator:RandomGenerator//ä½œä¸ºå±æ€§ç±»å‹ init(slides:Int,generator:RandomGenerator)&#123;//ä½œä¸ºå‚æ•°ç±»å‹ self.slides = slides self.generator = generator &#125; func roll() -&gt; Int &#123; return Int(self.generator.random() * Double(slides))+1 &#125;&#125;åœ¨æ‰©å±•ä¸­éµå¾ªåè®®ï¼Œå¢åŠ åè®®æˆå‘˜ï¼ˆè¿™ç§æ–¹æ³•ä¸ç›´æ¥åœ¨ç±»åé¢éµå¾ªåè®®çš„æ•ˆæœç›¸åŒï¼‰ã€‚123456789101112protocol TextRepresentable &#123; var textDescription :String&#123;get&#125;&#125;extension Dice:TextRepresentable&#123; var textDescription:String &#123; return \"\\(slides) - slides\" &#125;&#125;let dice = Dice(slides: 8, generator: LinerGenerator())dice.textDescription//ç°åœ¨Diceçš„æ‰€æœ‰å®ä¾‹éƒ½å¯ä»¥ä½¿ç”¨textDescriptionå±æ€§äº†ã€‚åè®®ç±»å‹çš„é›†åˆ1234567let sir = Dice(slides: 1, generator: LinerGenerator())let sime = Dice(slides: 2, generator: LinerGenerator())let arrayOfProtocolElements:[TextRepresentable] = [dice,sir,sime]for element in arrayOfProtocolElements&#123; print(element.textDescription)&#125;åè®®èƒ½å¤Ÿç»§æ‰¿.123456789protocol TextGo:TextRepresentable&#123; var prettyTextDescription:String&#123;get&#125;&#125;extension Dice:TextGo&#123; var prettyTextDescription:String&#123; return textDescription + \"hello\"//å¯ä»¥ä½¿ç”¨ä¸Šå±‚åè®®çš„å±æ€§ &#125;&#125;ç±»ä¸“å±åè®®.åœ¨åè®®ç»§æ‰¿åˆ—è¡¨ä¸­çš„é¦–ä½æ·»åŠ classå…³é”®å­—,ç„¶åè¿™ä¸ªåè®®å°±åªèƒ½è¢«ç±»éµå¾ªï¼Œè€Œä¸èƒ½è¢«ç»“æ„ä½“æˆ–è€…æšä¸¾éµå¾ªã€‚123protocol ClassOnlyProtocol:class&#123; var mylove:String&#123;get&#125;&#125;æ£€æŸ¥åè®®ä¸€è‡´æ€§ä½¿ç”¨isã€as?ã€as!åè®®æœ¬èº«ä¹Ÿå¯ä»¥è¢«æ‰©å±•12345extension TextRepresentable&#123;//TextRepresentableæ˜¯ä¸ªåè®® var longTextDescription:String&#123; return \"\\(textDescription) + long\" &#125;&#125;ä¸ºåè®®æ‰©å±•æ·»åŠ é™åˆ¶æ¡ä»¶ whereæ‰©å±•CollectionTypeåè®®ï¼Œè®©å…¶éµå¾ªè€…çš„å…ƒç´ å¿…é¡»éµå¾ªTextRepresentableåè®®123456789101112131415161718192021222324extension CollectionType where Generator.Element:TextRepresentable&#123; var textDescription:String&#123; let items = self.map&#123;$0.textDescription&#125; return \"A hamster named \\(items)\" &#125;&#125;struct Hamster &#123; var name: String var textDescription: String &#123; return \"a hamster named \\(name)\" &#125;&#125;extension Hamster: TextRepresentable &#123;&#125;//è®©Hamsteréµå¾ªTextRepresentableåè®®let murrayTheHamster = Hamster(name: \"Murray\")let morganTheHamster = Hamster(name: \"Morgan\")let mauriceTheHamster = Hamster(name: \"Maurice\")let hamsters = [murrayTheHamster, morganTheHamster, mauriceTheHamster]å› ä¸ºArrayéµå¾ªäº†`CollectionType`åè®®ï¼Œè€Œhamsteråˆéµå¾ªäº†`TextRepresentable`åè®®ï¼Œæ‰€ä»¥å°±æ»¡è¶³äº†æ¡ä»¶ï¼Œæ­¤æ—¶ arrayå¯ä»¥ä½¿ç”¨`textDescription`å±æ€§print(hamsters.textDescription)ç»“æœï¼šA hamster named [\"a hamster named Murray\", \"a hamster named Morgan\", \"a hamster named Maurice\"]æ³›å‹ Generics æ³›å‹ä»£ç å¯ä»¥è®©ä½ å†™å‡ºæ ¹æ®è‡ªæˆ‘éœ€æ±‚å®šä¹‰ã€é€‚ç”¨äºä»»ä½•ç±»å‹çš„ï¼Œçµæ´»ä¸”å¯é‡ç”¨çš„å‡½æ•°å’Œç±»å‹ã€‚å®ƒçš„å¯ä»¥è®©ä½ é¿å…é‡å¤çš„ä»£ç ï¼Œç”¨ä¸€ç§æ¸…æ™°å’ŒæŠ½è±¡çš„æ–¹å¼æ¥è¡¨è¾¾ä»£ç çš„æ„å›¾ã€‚ æ³›å‹æ˜¯ Swift å¼ºå¤§ç‰¹å¾ä¸­çš„å…¶ä¸­ä¸€ä¸ªï¼Œè®¸å¤š Swift æ ‡å‡†åº“æ˜¯é€šè¿‡æ³›å‹ä»£ç æ„å»ºå‡ºæ¥çš„ã€‚äº‹å®ä¸Šï¼Œæ³›å‹çš„ä½¿ç”¨è´¯ç©¿äº†æ•´æœ¬è¯­è¨€æ‰‹å†Œï¼Œåªæ˜¯ä½ æ²¡æœ‰å‘ç°è€Œå·²ã€‚ä¾‹å¦‚ï¼ŒSwift çš„æ•°ç»„å’Œå­—å…¸ç±»å‹éƒ½æ˜¯æ³›å‹é›†ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªIntæ•°ç»„ï¼Œä¹Ÿå¯åˆ›å»ºä¸€ä¸ªStringæ•°ç»„ï¼Œæˆ–è€…ç”šè‡³äºå¯ä»¥æ˜¯ä»»ä½•å…¶ä»– Swift çš„ç±»å‹æ•°æ®æ•°ç»„ã€‚åŒæ ·çš„ï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºå­˜å‚¨ä»»ä½•æŒ‡å®šç±»å‹çš„å­—å…¸ï¼ˆdictionaryï¼‰ï¼Œè€Œä¸”è¿™äº›ç±»å‹å¯ä»¥æ˜¯æ²¡æœ‰é™åˆ¶çš„ æ³›å‹å‡½æ•°12345func swapTwoValues&lt;T&gt;(inout a:T,inout b:T)&#123; let tempValue = a a = b b = tempValue&#125; T è¡¨ç¤ºä¸€ä¸ªå ä½å‘½åç±»å‹ å°–æ‹¬å·è¡¨ç¤ºå®ƒé‡Œé¢çš„Tæ˜¯ç”±å‡½æ•°swapTwoValueså®šä¹‰çš„ä¸€ä¸ªç±»å‹ï¼Œswiftä¸ä¼šå»æŸ¥æ‰¾å‘½åä¸ºTçš„å®é™…ç±»å‹ å‚æ•°åˆ—è¡¨ä¸­çš„Tæ²¡æœ‰å®é™…ç±»å‹ï¼Œä»…è¡¨ç¤ºä¸¤ä¸ªå‚æ•°çš„ç±»å‹éœ€è¦ç›¸åŒ å®ç°ä¸€ä¸ªæ³›å‹ç‰ˆæœ¬çš„æ ˆ123456789101112struct Stack&lt;T&gt;&#123; var items = [T]() mutating func push(item:T)&#123; items.append(item) &#125; mutating func pop()&#123; items.removeLast() &#125;&#125;//æ³›å‹å®ä¾‹çš„åˆ›å»º,éƒ½å¿…é¡»æŒ‡å®šTçš„ç±»å‹var stack = Stack(items: [\"\"])var stack2 = Stack&lt;String&gt;() //æ‰©å±•ä¸€ä¸ªæ³›å‹ç±»å‹:æ·»åŠ ä¸€ä¸ªå±æ€§1234567extension Stack&#123; var topItem:T?&#123; return items.isEmpty ? nil : items[items.count - 1] &#125;&#125;stack2.topItem å…³è”ç±»å‹ï¼ˆAssociated Typeï¼‰ swift2.2è²Œä¼¼ä¿®æ”¹äº†ã€‚å£°æ˜çš„æ—¶å€™ç”¨associatedtype å®ç°çš„æ—¶å€™ç”¨typealias123456789101112131415161718192021protocol Container&#123; associatedtype ItemType var count:Int&#123;get&#125; mutating func append(item:ItemType) subscript (i:Int)-&gt;ItemType&#123;get&#125;&#125;//è®©æ³›å‹Stackéµå¾ªContaineråè®®extension Stack:Container&#123; //typealias ItemType = T //è¿™ä¸€è¡Œä¹Ÿæ˜¯å¯ä»¥å»æ‰ï¼Œå› ä¸ºswifté€šè¿‡ç±»å‹æ¨æ–­å¯ä»¥åˆ¤æ–­å‡ºTçš„ç±»å‹ mutating func append(item: T) &#123; return self.push(item)//æˆ–è€…ï¼šitems.append(item) &#125; var count:Int&#123; return items.count &#125; subscript(i:Int)-&gt;T&#123; return items[i] &#125;&#125;","link":"/2016/04/28/Learn-Swift-Section-Four-æ‰©å±•ã€åè®®ã€æ³›å‹/"},{"title":"Learn Swift - Section 3rd ç±»ä¸ç»“æ„ä½“","text":"ç±»ä¸ç»“æ„ä½“çš„å…±åŒç‚¹ï¼š å®šä¹‰å±æ€§ç”¨äºå­˜å‚¨å€¼ å®šä¹‰æ–¹æ³•ç”¨äºæä¾›åŠŸèƒ½ å®šä¹‰é™„å±è„šæœ¬ç”¨äºè®¿é—®å€¼ å®šä¹‰æ„é€ å™¨ç”¨äºç”Ÿæˆåˆå§‹åŒ–å€¼ é€šè¿‡æ‰©å±•ä»¥å¢åŠ é»˜è®¤å®ç°çš„åŠŸèƒ½ å®ç°åè®®ä»¥æä¾›æŸç§æ ‡å‡†åŠŸèƒ½ ä¸ç»“æ„ä½“ç›¸æ¯”ï¼Œç±»è¿˜æœ‰å¦‚ä¸‹çš„é™„åŠ åŠŸèƒ½ï¼š ç»§æ‰¿å…è®¸ä¸€ä¸ªç±»ç»§æ‰¿å¦ä¸€ä¸ªç±»çš„ç‰¹å¾ ç±»å‹è½¬æ¢å…è®¸åœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œè§£é‡Šä¸€ä¸ªç±»å®ä¾‹çš„ç±»å‹ è§£æ„å™¨å…è®¸ä¸€ä¸ªç±»å®ä¾‹é‡Šæ”¾ä»»ä½•å…¶æ‰€è¢«åˆ†é…çš„èµ„æº å¼•ç”¨è®¡æ•°å…è®¸å¯¹ä¸€ä¸ªç±»çš„å¤šæ¬¡å¼•ç”¨ æ›´å¤šä¿¡æ¯è¯·å‚è§ç»§æ‰¿ï¼Œç±»å‹è½¬æ¢ï¼Œææ„è¿‡ç¨‹ï¼Œå’Œè‡ªåŠ¨å¼•ç”¨è®¡æ•°ã€‚ æ³¨æ„ ç»“æ„ä½“æ€»æ˜¯é€šè¿‡è¢«å¤åˆ¶çš„æ–¹å¼åœ¨ä»£ç ä¸­ä¼ é€’ï¼Œä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°ã€‚ 1.å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹å€¼ç±»å‹è¢«èµ‹äºˆç»™ä¸€ä¸ªå˜é‡ã€å¸¸é‡æˆ–è€…è¢«ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå…¶å€¼ä¼šè¢«æ‹·è´ã€‚ åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¤§é‡ä½¿ç”¨äº†å€¼ç±»å‹ã€‚å®é™…ä¸Šï¼Œåœ¨ Swift ä¸­ï¼Œæ‰€æœ‰çš„åŸºæœ¬ç±»å‹ï¼šæ•´æ•°ï¼ˆIntegerï¼‰ã€æµ®ç‚¹æ•°ï¼ˆfloating-pointï¼‰ã€å¸ƒå°”å€¼ï¼ˆBooleanï¼‰ã€å­—ç¬¦ä¸²ï¼ˆstring)ã€æ•°ç»„ï¼ˆarrayï¼‰å’Œå­—å…¸ï¼ˆdictionaryï¼‰ï¼Œéƒ½æ˜¯å€¼ç±»å‹ï¼Œå¹¶ä¸”åœ¨åº•å±‚éƒ½æ˜¯ä»¥ç»“æ„ä½“çš„å½¢å¼æ‰€å®ç°ã€‚ åœ¨ Swift ä¸­ï¼Œæ‰€æœ‰çš„ç»“æ„ä½“å’Œæšä¸¾ç±»å‹éƒ½æ˜¯å€¼ç±»å‹ã€‚è¿™æ„å‘³ç€å®ƒä»¬çš„å®ä¾‹ï¼Œä»¥åŠå®ä¾‹ä¸­æ‰€åŒ…å«çš„ä»»ä½•å€¼ç±»å‹å±æ€§ï¼Œåœ¨ä»£ç ä¸­ä¼ é€’çš„æ—¶å€™éƒ½ä¼šè¢«å¤åˆ¶ã€‚ â€œä¸å€¼ç±»å‹ä¸åŒï¼Œå¼•ç”¨ç±»å‹åœ¨è¢«èµ‹äºˆåˆ°ä¸€ä¸ªå˜é‡ã€å¸¸é‡æˆ–è€…è¢«ä¼ é€’åˆ°ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå…¶å€¼ä¸ä¼šè¢«æ‹·è´ã€‚å› æ­¤ï¼Œå¼•ç”¨çš„æ˜¯å·²å­˜åœ¨çš„å®ä¾‹æœ¬èº«è€Œä¸æ˜¯å…¶æ‹·è´ã€‚â€ 1234567var marray = [\"lopl\",\"liu\",\"han\"]func modifyArray() &#123; var saray = marray saray.removeAtIndex(2)&#125;modifyArray()marray//å¹¶æ²¡æœ‰å˜ï¼Œè¯´æ˜æ˜¯å€¼æ‹·è´ 2.å°†ç»“æ„ä½“å®ä¾‹èµ‹å€¼ç»™ä¸€ä¸ªå¸¸é‡ï¼Œåˆ™æ— æ³•ä¿®æ”¹ç»“æ„ä½“ä¸­çš„å±æ€§ï¼Œå³ä½¿å±æ€§æ˜¯å˜é‡ã€‚123456789101112131415161718192021222324252627struct Cars &#123; var name = \"\"&#125;let car = Cars()car.name = \"Audi\"//è€Œç±»åˆ™å¯ä»¥ä¿®æ”¹ï¼Œå› ä¸ºç±»æ˜¯å¼•ç”¨ç±»å‹ã€‚class CreateNewLife&#123; var name = \"\"&#125;class Animals &#123; var kind = \"\" let planet = \"Earth\" lazy var createNewLife = CreateNewLife()&#125;let life = CreateNewLife()let anAnimal = Animals()anAnimal.kind = \"Human\"print(anAnimal,life)if life === anAnimal &#123; print(\"same class\")&#125;else&#123; print(\"Different class\")&#125;print(anAnimal.createNewLife.name)//è¿™æ—¶CreateNewLifeå®ä¾‹æ‰ä¼šè¢«åˆ›å»ºanAnimal.createNewLife.name = \"liven\"print(anAnimal.kind,anAnimal.createNewLife.name) 3.ç»“æ„ä½“å’Œç±»ä¸­çš„å±æ€§å®šä¹‰-getterå’Œsetter12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758struct Point&#123; var x = 0.0,y = 0.0&#125;struct Size &#123; var width = 0.0,height = 0.0&#125;struct Rect &#123; var origin = Point() var size = Size() var center:Point&#123;//è®¡ç®—å±æ€§:å³å†™äº†getæˆ–setçš„å±æ€§ã€‚å¦‚æœåªæœ‰getï¼Œå°±æ˜¯åªè¯»å±æ€§ get&#123; let centerX = origin.x + size.width/2 let centerY = origin.y + size.height/2 return Point(x: centerX, y: centerY) &#125; set(newCenter)&#123; origin.x = newCenter.x - size.width/2 origin.y = newCenter.y - size.height/2 &#125; &#125; var arcPoint:Point&#123;//å±æ€§è§‚å¯Ÿå™¨didSet,willSet willSet(newValue)&#123;//ä¼šå°†æ–°çš„å€¼ä¼ å…¥ print(\"will set arcPoint \\(newValue)\") &#125; didSet(oldValue)&#123;//ä¼šå°†æ—§çš„å€¼ä¼ å…¥ //arcPoint = Point(x: 8, y: 9) print(\"did set arcPoint \\(arcPoint) \\(oldValue)\") &#125; &#125; static var name = \"my rect\"//Type propertyç±»å‹å±æ€§ //å€¼ç±»å‹å±æ€§ä¸€èˆ¬ä¸èƒ½åœ¨å®ƒè‡ªå·±çš„å®ä¾‹æ–¹æ³•ä¸­ä¿®æ”¹ï¼›å¦‚æœéè¦ä¿®æ”¹ï¼Œéœ€è¦åŠ å…³é”®å­—mutating mutating func bigger(x:Double,y:Double) &#123; size.width += x size.height += y &#125;&#125;Rect.nameRect.name = \"xxxx\"Rect.namevar rect = Rect(origin: Point(x: 10,y: 10), size: Size(width: 20,height: 30), arcPoint: Point(x: 1, y: 1))print(rect.arcPoint)rect.arcPoint = Point(x: 3, y: 4)print(rect.arcPoint)var rect2 = rectrect2.arcPoint = Point(x: 6, y: 6)print(rect.arcPoint,rect2.arcPoint)rect.bigger(20, y: 20)print(rect.size)class SomeClass &#123; class var overrideProperty:Int&#123;//getçœç•¥äº†ã€‚classå…³é”®å­—è¡¨ç¤ºé‡å†™çˆ¶ç±»çš„getterå®ç° return 10 &#125;&#125; 4.æ–¹æ³•1234567891011121314151617181920212223242526272829303132333435363738394041424344454647struct LevelTraker &#123; static var highestUnlockedLevel = 1 static func unlockLevel(level:Int)&#123; if (level == highestUnlockedLevel + 1) &#123;highestUnlockedLevel = level&#125; &#125; static func levelIsUnlocked(level:Int)-&gt;Bool&#123; return level &lt;= highestUnlockedLevel &#125; var currentLevel = 1 mutating func advanceLevel(level:Int)-&gt;Bool&#123; if LevelTraker.levelIsUnlocked(level) &#123; currentLevel = level return true &#125;else&#123; return false &#125; &#125;&#125;class Player &#123; var traker = LevelTraker() var playerName:String func completeLevel(level:Int) -&gt;Bool&#123; LevelTraker.unlockLevel(level+1) if traker.advanceLevel(level+1)&#123; return true &#125;else&#123; print(\"Level \\(level) hasn't been unlocked\") return false &#125; &#125; init(name:String)&#123; playerName = name &#125;&#125;var level111 = LevelTraker()var level121 = LevelTraker()level121.currentLevel = 2print(level111.currentLevel, level121.currentLevel)var player = Player(name:\"han\")player.traker.currentLevelplayer.completeLevel(1)player.traker.currentLevelLevelTraker.highestUnlockedLevelplayer.completeLevel(5) 5.æ„é€ è¿‡ç¨‹123456789101112131415161718class Cars&#123; var brand:String var usage:String //æ„é€ å‡½æ•° init()&#123; brand = \"BMW\" usage = \"Family\" &#125; init(_brand:String,_usage:String)&#123; brand = _brand usage = _usage &#125;&#125;let audi = Cars(_brand: \"Audi\", _usage: \"Sports\")print(audi.brand,audi.usage)let car2 = Cars()print(car2.brand,car2.usage) 6.å½“å±æ€§æœ‰é»˜è®¤å€¼ï¼Œä¸”æ²¡æœ‰æ„é€ æ–¹æ³•æ—¶ï¼Œç»“æ„ä½“å’Œç±»æ‹¥æœ‰é»˜è®¤æ„é€ æ–¹æ³•ã€‚ä½†æ˜¯ç»“æ„ä½“å¯ä»¥æœ‰å¸¦å±æ€§å‚æ•°çš„é»˜è®¤æ„é€ æ–¹æ³•ï¼ˆé€ä¸€æˆå‘˜æ„é€ å™¨ï¼‰ï¼Œè€Œç±»æ²¡æœ‰ã€‚12345678910111213struct People &#123; var name:String? var sex:String?&#125;class Books &#123; var type:String? var category:String? var available = true&#125;let p = People()let semdsd = People(name: \"han\", sex: \"famale\")let book = Books()//var book2 = Books(type:\"epub\",category:\"Computer\",available:true) 7.ææ„è¿‡ç¨‹/** ææ„å™¨åªé€‚ç”¨äºç±»ç±»å‹ï¼Œä¸èƒ½ç”¨äºç»“æ„ä½“ã€‚ææ„å™¨ç”¨deinitå…³é”®å­—ã€‚*/1234567891011121314class Telephones &#123; var type:String? var category:String? var available = true init() &#123; // &#125; deinit&#123; //ææ„ä»£ç ã€‚ã€‚ã€‚ print(\"\\(type)\") available = false &#125;&#125; / ææ„è¿‡ç¨‹ä¼šåœ¨ARCå›æ”¶å®ä¾‹æ—¶è¢«ç³»ç»Ÿè°ƒç”¨ï¼Œä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ã€‚ / 8.ç±»å®ä¾‹ä¹‹é—´çš„å¾ªç¯å¼ºå¼•ç”¨è§£å†³æ–¹å¼ï¼š1.ä½¿ç”¨weakå…³é”®å­—ï¼Œå¼±å¼•ç”¨2.ä½¿ç”¨unownedï¼Œæ— ä¸»å¼•ç”¨ 9.è§£å†³é—­åŒ…å¼•èµ·çš„å¾ªç¯å¼•ç”¨â€“å®šä¹‰æ•è·åˆ—è¡¨1234567891011121314151617181920212223242526272829303132333435363738394041424344protocol SellProducts&#123; func sellProducts(product:String)&#125;class Person &#123; var name:String weak var delegate:Seller? lazy var someClosure:(Int,String)-&gt;String = &#123; //åœ¨é—­åŒ…ä¸­å°†selfä¿®é¥°ä¸ºæ— ä¸»å¼•ç”¨ã€‚å°†delegate ä¿®é¥°ä¸º å¼±å¼•ç”¨ [unowned self,weak delegate = self.delegate!]//æ•è·åˆ—è¡¨ (index:Int,strToProcess:String)-&gt;String in return \"\\(self.name),\\(self.delegate),\\(delegate)\" &#125; init(name:String,delegate:Seller?)&#123; self.name = name; self.delegate = delegate; &#125; func giveSellerProducts(product:String ) -&gt; Bool &#123; self.delegate?.sellProducts(product) return true &#125;&#125;class Seller : SellProducts&#123; var product:String? func sellProducts( product: String) &#123; self.product = product &#125;&#125;let seller = Seller()var person = Person (name: \"Hanliu\", delegate: seller)//åˆšå¼€å§‹selleræ˜¯æ²¡æœ‰å•†å“çš„ï¼Œè¦ç­‰åˆ°Personç»™sellerprint(seller.product)//personå‘Šè¯‰sellerï¼Œå¸®æˆ‘å–è‹¹æœperson.giveSellerProducts(\"apple\")//ç°åœ¨selleræ‰‹ä¸­å°±æœ‰äº†å•†å“äº†print(seller.product!)person.someClosure(1,\"haha\")","link":"/2016/04/26/Learn-Swift-Section-Three/"},{"title":"Learn Swift - Section 1st åŸºç¡€çŸ¥è¯†","text":"import UIKit var str = â€œHello, playgroundâ€ //å¸¸é‡å’Œå˜é‡let maxLoginCount = 10var currentLoginCount = 5 //ç±»å‹æ ‡æ³¨var message = â€œwelcomeâ€//ç±»å‹æ¨æ–­ä¸ºStringvar messageWithTypeAnnotation:String message = â€œwelcome hereâ€messageWithTypeAnnotation = â€œwelcome goâ€ print(â€œBig world (message)â€)//(message) å­—ç¬¦ä¸²è½¬ä¹‰print(â€œBig worldâ€, message)// let newString = â€œBig world â€œ + â€œ(message) â€œ + messageprint(newString)//å¤šè¡Œè¯­å¥ç”¨åˆ†å·let cat = â€œğŸ±â€; print(cat) let a:Int32 = 10let uintb:UInt8 = 255 //ç±»å‹åˆ«åtypealias SLInt = UInt64let i:SLIntvar maxInt64 = SLInt.max //å…ƒç»„let HttpErrorCode = (404,â€NotFoundâ€)print(HttpErrorCode) typealias HttpStateCode = (Int32,String)var errorMsg = HttpErrorCodevar normal: HttpStateCode = (200,â€OKâ€)print(normal) let (stateCode,stateMsg) = HttpErrorCodeprint(â€œHTTP code is (stateCode)â€)//é€šè¿‡ä¸‹æ ‡è®¿é—®å…ƒç»„å…ƒç´ print(HttpErrorCode.1) //éšå¼è§£æå¯é€‰ç±»å‹ let possibleString:String? = â€œan optional stringâ€let forcedString:String = possibleString! let possibleString2:String! = â€œan implicitly optional stirngâ€let forcedString2:String = possibleString2 //å¯é€‰ç»‘å®šif let bingStr = possibleString2{ print(bingStr)} //é”™è¯¯å¤„ç† func canThrowAnError() throws{ } func makeASanwich() -&gt; Bool { return false}func buyNewDishes() -&gt; Void { } do{ try canThrowAnError() makeASanwich()}catch Error.MissingNeededMetarail{ buyNewDishes()} //æ–­è¨€let num = 4assert(num&gt;0, â€œaå¤§äº0â€) //ç©ºåˆè¿ç®—ç¬¦ ??let defaultColor:String = â€œredâ€var userDefinedColor:String? //userDefinedColor = â€œorangeâ€var currentColorToUse = userDefinedColor ?? defaultColor//ç­‰ä»·äºvar currentColorToUse2 = userDefinedColor != nil ? userDefinedColor! : defaultColor //åŒºé—´è¿ç®—ç¬¦//1.é—­åŒºé—´ (aâ€¦b) åŒ…å«aå’Œbfor index in (1â€¦5){ print(index) print(â€œ(index) 5 = (index 5)â€)}//2.åŠå¼€åŒºé—´ (a..&lt;b)for index in (1..&lt;5){ print(index) print(â€œ(index) 5 = (index 5)â€)} //å­—ç¬¦ä¸² String//Stringæ˜¯å€¼ç±»å‹for charactor in â€œYou R AğŸ¶â€.characters{ print(charactor)}//ç‹¬ç«‹çš„å­—ç¬¦å¸¸é‡æˆ–å˜é‡let singleCharactor:Character = â€œ!â€ //é€šè¿‡å€¼ç±»å‹ä¸ºcharacterçš„æ•°ç»„æ¥åˆ›å»ºå­—ç¬¦ä¸²let characters:[Character] = [â€œcâ€,â€aâ€,â€tâ€,â€ğŸ±â€]let catString = String(characters)print(catString) //æ’å€¼è¿ç®— åæ–œæ \\let multiplier = 4print(â€œ(multiplier) times 5.12 = (Double(multiplier) * 5.12)â€)print(â€œ\\r messageâ€+â€ \\u{E9}â€) //Unicodelet ccc1:Character = â€œ\\u{65}â€let ccc2:Character = â€œ\\u{65}\\u{301}â€ print(message)message.startIndexmessage.endIndex//å‰ä¸€ä¸ªindexmessage.endIndex.predecessor()//åä¸€ä¸ªindexmessage.startIndex.successor()//ä»starIndexå¼€å§‹ åé¢çš„ç¬¬iä¸ªindexlet xx = message.startIndex.advancedBy(4)message.removeAtIndex(message.startIndex.advancedBy(4))print(message)//indices è·å–å­—ç¬¦ä¸²çš„å…¨éƒ¨ç´¢å¼• ã€‚ç©ºæ ¼ä¸ç®—ã€‚ã€‚ã€‚for index in message.characters.indices{ print(â€œ(message[index])â€)} message.insert(â€œuâ€, atIndex: xx) message = â€œhttp:â€+messageprint(message)//å‰åç¼€var hasPrefix = message.hasPrefix(â€œhttpâ€)var hasSuffix = message.hasSuffix(â€œpngâ€) //é›†åˆç±»å‹ï¼šæ•°ç»„Array é›†åˆSet å­—å…¸Dictionary //ä¸å¯å˜å’Œå¯å˜/â€œå¦‚æœåˆ›å»ºä¸€ä¸ªArraysã€Setsæˆ–Dictionarieså¹¶ä¸”æŠŠå®ƒåˆ†é…æˆä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªé›†åˆå°†ä¼šæ˜¯å¯å˜çš„ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºä¹‹åæ·»åŠ æ›´å¤šæˆ–ç§»é™¤å·²å­˜åœ¨çš„æ•°æ®é¡¹æ¥æ”¹å˜è¿™ä¸ªé›†åˆçš„å¤§å°ã€‚å¦‚æœæˆ‘ä»¬æŠŠArraysã€Setsæˆ–Dictionariesåˆ†é…æˆå¸¸é‡ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸å¯å˜çš„ï¼Œå®ƒçš„å¤§å°ä¸èƒ½è¢«æ”¹å˜ã€‚â€ /let immutableArray = Intvar mutableArray = Int let strArray = [â€œworldâ€] mutableArray.append(1)var array1:[String] = Array()array1.append(â€œhelloâ€)array1.appendContentsOf(strArray)array1.insert(â€œgogogogâ€, atIndex: 1)array1.countarray1.isEmpty array1[0â€¦1] = [â€œappleâ€,â€pearâ€];array1//æ•°ç»„çš„éå†for item in array1{ print(item)} for (index,item) in array1.enumerate(){ print(item,array1[index])} //é›†åˆvar asset = Set()asset.countasset.insert(â€œhash stringâ€)asset.remove(â€œhashâ€)//setç±»å‹å¿…é¡»æ˜¾å¼å£°æ˜,å…·ä½“å…ƒç´ ç±»å‹å¯ä»¥çœç•¥let asset2:Set = [â€œaâ€]let asset3:Set = [â€œaâ€,â€vâ€]asset2.hashValue == asset3.hashValueasset.hashValue == asset2.hashValue let asset4 = Set.init(arrayLiteral: â€œaâ€,â€bâ€,â€câ€)let asset5 = Set.init(array1)//é›†åˆæ“ä½œï¼šäº¤é›†ã€å¤–é›†ã€åˆé›†,å‡é›† asset3.intersect(asset4)asset3.exclusiveOr(asset4)asset3.union(asset4)asset3.subtract(asset4) asset3 == asset4asset3.isSubsetOf(asset4)asset3.isSupersetOf(asset3)asset3.isStrictSupersetOf(asset3)//æ˜¯å¦æ˜¯è¶…é›†ï¼Œå¹¶ä¸”ä¸æ˜¯åŒä¸€é›†åˆasset3.isStrictSubsetOf(asset3)//æ˜¯å¦æ˜¯å­é›†ï¼Œå¹¶ä¸”ä¸æ˜¯åŒä¸€é›†åˆ asset3.isDisjointWith(asset4)//åˆ¤æ–­é›†åˆæ˜¯å¦ä¸å«æœ‰ç›¸åŒçš„å€¼ã€‚falseè¯´æ˜åŒ…å«ç›¸åŒçš„å€¼ //å­—å…¸ Dictionaryvar dic1 = Dictionary()var dic2 = Int:Stringdic1.updateValue(â€œvalueâ€, forKey: 0)//updateValueæ–¹æ³•è¿”å›å€¼æ˜¯è¯¥keyçš„æ—§å€¼dic1.updateValue(â€œnewValueâ€, forKey: 0)print(dic1)dic1[1] = â€œahaoâ€dic1[2] = â€œddddâ€print(dic1) for (key,value) in dic1{ print(key ,value)} print(dic1.keys.sort())print(dic1.values.sort()) //æ§åˆ¶æµç¨‹ //gamelet finalSqura = 25var board = Intboard[03] = +08; board[06] = +11; board[09] = +09; board[10] = +02board[14] = -10; board[19] = -11; board[22] = -02; board[24] = -08var square = 0var diceRoll = 0 gameLoop:while square != finalSqura{ //if ++diceRoll == 7 { diceRoll = 1 } switch square + diceRoll { case finalSqura: break gameLoop case let newSquare where newSquare &gt; finalSqura: coutinue gameLoop default: square += diceRoll square += board[square] }}print(â€œgame overâ€) //æ£€æŸ¥APIå¯ç”¨æ€§if #available(iOS 9, *){ }else{ }func checkOSVersion() -&gt; NSString { //å¿…é¡»åœ¨å‡½æ•°ä½“å†…ä½¿ç”¨ï¼›å¿…é¡»è·Ÿç€elseï¼›å¿…é¡»èƒ½è·³å‡ºelse guard #available(OSX 10.11, *) else { return â€œ10.10â€ } return â€œ10.11â€} checkOSVersion() //å‡½æ•°åµŒå¥—func stepForword(input:Int)-&gt;Int{ return input - 1}func stepBackword(input:Int)-&gt;Int{ return input + 1}func chooseStep(value:Int) -&gt; (Int)-&gt;Int { return value &gt; 0 ? stepForword : stepBackword}func xxxx(tempFunction:(Int)-&gt;Int) -&gt;Int { return 1}//å¦‚æœæˆ‘å†åŠ ä¸€ä¸ªå‡½æ•°åµŒå¥—func nextStep(tempFunction:((Int)-&gt;Int)-&gt;Int) -&gt; Int{ return 0}let number = 3let myFunction = chooseStep(number)myFunction(number) let names = [â€œChrisâ€, â€œAlexâ€, â€œEwaâ€, â€œBarryâ€, â€œDaniellaâ€]func absendOrdesend(s1:String,s2:String) -&gt; Bool { return s1&gt;s2}//ä½¿ç”¨å‡½æ•°çš„è¿”å›å€¼ä½œä¸ºå‚æ•°names.sort()names.sort(absendOrdesend)//é—­åŒ…è¡¨è¾¾å¼ {(parameter:Type)-&gt;ReturnType in }Objective-Cä¸­çš„blockReturnType ^(parameter){ return } //ä½¿ç”¨é—­åŒ…çš„è¿”å›å€¼ä½œä¸ºå‚æ•°names.sort({(s1:String,s2:String) -&gt; Bool in return s1 &gt; s2}) //å› ä¸ºnamesæ•°ç»„å‚æ•°ç±»å‹ç¡®å®šï¼Œæ‰€ä»¥æ ¹æ®ç±»å‹æ¨æ–­,çœç•¥å‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹names.sort({s1,s2 in return s1&gt;s2})names.sort({s1,s2 in s1&gt;s2})names.sort({$0&gt;$1})names.sort(&gt;)//æ ¹æ®Stringå¯¹&gt;è¿™ä¸ªç¬¦å·çš„å®šä¹‰æ¨æ–­ //å°¾éšé—­åŒ…//å…ˆå®šä¹‰ä¸€ä¸ªclosurelet bigger = {(a:Int,b:Int)-&gt;Bool in return a&gt;b}//å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªé—­åŒ…func exchangeNumerWithClosure(bigger:(Int,Int)-&gt;Bool){ if bigger(2,3) { print(â€œbiggerâ€) }else{ print(â€œlowerâ€) }}//å‡½æ•°è°ƒç”¨æ—¶//æ²¡æœ‰ä½¿ç”¨å°¾éšé—­åŒ…//exchangeNumerWithClosure({(a:Int,b:Int)-&gt;Bool in// return a&gt;b//}) //ä½¿ç”¨å°¾éšé—­åŒ…//exchangeNumerWithClosure(){(a:Int,b:Int)-&gt;Bool in return a&gt;b }exchangeNumerWithClosure(){(a:Int,b:Int) -&gt;Bool in a&gt;b}//åŒç†ï¼Œå°¾éšé—­åŒ…names.sort(){$0&gt;$1}names.sort{$0&gt;$1}//å¦‚æœå‡½æ•°åªéœ€è¦é—­åŒ…è¡¨è¾¾å¼ä¸€ä¸ªå‚æ•°ï¼Œå½“æ‚¨ä½¿ç”¨å°¾éšé—­åŒ…æ—¶,å¯ä»¥çœç•¥()","link":"/2016/04/26/Learn-Swift-Section-One/"},{"title":"Learn Swift - Section 2nd é›†åˆç±»å‹å’Œæšä¸¾","text":"Arraã€Dictionaryã€Setå’Œæšä¸¾ //Arrayçš„map()æ–¹æ³•let digitNames = [ 0: â€œZeroâ€, 1: â€œOneâ€, 2: â€œTwoâ€, 3: â€œThreeâ€, 4: â€œFourâ€, 5: â€œFiveâ€, 6: â€œSixâ€, 7: â€œSevenâ€, 8: â€œEightâ€, 9: â€œNineâ€]let numbers = [132,11,87,90,49,87,22,29,5,10,87]//mapæ–¹æ³•ä¼šè¯»å–æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œlet strings = numbers.map { (element) -&gt; String in var output = â€œâ€ var number = element while number &gt; 0 { output = digitNames[number % 10]! + output number /= 10 } return output}//æŠŠæ¯ä¸ªå…ƒç´ éƒ½+1let so = numbers.map{(element)-&gt;Int in return element + 1}let lo = numbers.flatMap{(element)-&gt;Int in return element + 3 }let split1 = numbers.split(70)let split2 = numbers.split(87)let split3 = numbers.split(87, maxSplit: 1, allowEmptySlices: true)let split4 = numbers.split(87, maxSplit: 6, allowEmptySlices: true)let split5 = numbers.split(87, maxSplit: 6, allowEmptySlices: false) //è¿‡æ»¤å‡ºæ»¡è¶³æ¡ä»¶çš„å­åºåˆ—ã€‚æ¡ä»¶ç”±é—­åŒ…å®šä¹‰numbers.filter { (element) -&gt; Bool in return element &gt; 50}numbers.filter{(element) in element &gt; 50}numbers.filter{ $0 &gt; 50} let scores = [â€œxiaomingâ€:66,â€liâ€:89,â€hanâ€:78,â€mingâ€:100,â€xiagâ€:34]scores.filter { (name,score) in score &gt; 60} //â€œå°†é—­åŒ…æ ‡æ³¨ä¸º@noescapeä½¿ä½ èƒ½åœ¨é—­åŒ…ä¸­éšå¼åœ°å¼•ç”¨selfâ€func functionWithNoescapeClosure(@noescape closure:()-&gt;Void){ closure()}var completionHandlers:[() -&gt; Void] = []func functionWithEscapeClosure(completionHandler:()-&gt;Void){ completionHandler() completionHandlers.append(completionHandler)} class SomeClass { var x = 200 func doSomething(){ functionWithEscapeClosure({self.x = 100}) functionWithNoescapeClosure({x = 300})//éšå¼å¼•ç”¨self } }let some = SomeClass()some.doSomething()print(some.x) completionHandlers.first?()print(some.x) //è‡ªåŠ¨é—­åŒ… ä½¿ç”¨@autoclosureï¼Œå°±å¯ä»¥ä¸ç”¨åŠ é—­åŒ…çš„{}var names = [â€œcharisâ€,â€levisâ€,â€luosâ€,â€dericâ€,â€htomeâ€]let customerProvider = {names.removeAtIndex(0)}//æ³¨æ„ç±»å‹æ˜¯()-&gt;Stringfunc customName(@autoclosure customerProvider:()-&gt;String) { print(â€œcostomerâ€™s name is (customerProvider())â€)} customName(names.removeAtIndex(0))//é—­åŒ…ä½“ä¸éœ€è¦åŠ {}ï¼Œå°±å¥½åƒæ˜¯å‚æ•°ä¸€æ ·ã€‚ //æšä¸¾-ä¸€ç­‰å…¬æ°‘ ä¸ç±»classä¸€æ ·enum Compose{ case North case South case West case East}//æˆå‘˜å€¼çš„ç±»å‹ä¸ºæšä¸¾çš„åå­—Composelet directionToHead = Compose.East //å¸¦æœ‰å…³è”å€¼çš„æšä¸¾enum Barcode { case UPCA(Int,Int,Int)//å…³è”äº†Intç±»å‹çš„å€¼ case QRCode(String)//å…³è”äº†Stringç±»å‹çš„å€¼} var productorCode = Barcode.QRCode(â€œkasdjfiwoeklfâ€) productorCode = .UPCA(2,5,1) switch productorCode{ case let .UPCA(first,second,third): print(â€œ(first) (second) (third)â€) case var .QRCode(code): print(â€œcode is (code)â€)} //åŸå§‹å€¼ Raw Valuesenum ASCII:Character{//å¸¦æœ‰åˆå§‹ç±»å‹çš„æšä¸¾ case Tab = â€œ\\tâ€ case Return = â€œ\\râ€ case changeLine = â€œ\\nâ€} //å…³è”å€¼å¯ä»¥ä½¿æšä¸¾çš„åµŒå¥—æˆä¸ºå¯èƒ½.å¦‚æœåµŒå¥—ï¼Œåˆ™éœ€è¦æ·»åŠ indirectå…³é”®å­—enum Add{ case Number(Int) indirect case Addition(Add,Add)}func evaluate(add:Add) -&gt; Int { switch add { case .Number(let i): return i case .Addition(let left, let right): return evaluate(left) + evaluate(right) }} let a = Add.Number(10)let b = Add.Number(2)let c = Add.Addition(a,b) evaluate(a)evaluate(c)","link":"/2016/04/26/Learn-Swift-Section-Two/"},{"title":"NSURLSessionåˆæ¢","text":"NSURLSessionæ˜¯Appleè‡ªiOS7.0ä¹‹ååŠ å…¥åˆ°Cocoa SDKä¸­ï¼Œç”¨ä»¥æ›¿ä»£NSURLConnectionã€‚å®ƒæ‹¥æœ‰æ›´ç®€æ´æ˜“æ‡‚çš„APIæ–¹æ³•ã€‚iOSä¸­å¸¸ç”¨çš„ç½‘ç»œåº“ä¾‹å¦‚AFNetworkingåœ¨3.0ç‰ˆæœ¬ä¸­å°±å…¨éƒ¨æ›¿æ¢ä¸ºäº†NSURLSessionã€‚ä¹‹å‰é¡¹ç›®ä¸­ä¸€ç›´ä½¿ç”¨çš„AFNetworking2.xç‰ˆæœ¬ï¼Œä¹Ÿæ²¡æœ‰èŠ±æ—¶é—´å»ä»”ç»†ç ”ç©¶NSURLSessionï¼Œç‰¹æ­¤å‘¨æœ«ç²—ç•¥çš„çœ‹äº†çœ‹ï¼Œä¸€äº›æ–¹æ³•ä¹Ÿæ˜¯è¯•äº†è¯•ã€‚ NSURLSessionç»§æ‰¿ç»“æ„ï¼š NSURLSession - sessionå¯¹è±¡ã€‚ NSURLSessionConfiguration - å½“åˆå§‹åŒ–sessionå¯¹è±¡æ—¶è®¾ç½®sessionçš„é…ç½®ä¿¡æ¯ã€‚ NSURLSessoinTask - taskåŸºç±» NSURLSessionDataTask - è·å–urlå†…å®¹ï¼Œè¿”å›NSDataå¯¹è±¡ã€‚ NSURLSessionUploadTask - ä¸Šä¼ æ–‡ä»¶çš„taskï¼Œå¹¶å–å›å¯¹åº”urlå†…å®¹ï¼Œè¿”å›NSDataå¯¹è±¡ã€‚ NSURLSessionDownloadTask - è·å–urlå†…å®¹ï¼Œå¹¶è¿”å›ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶åœ¨æ²™ç›’ä¸­ï¼ˆtmpç›®å½•ä¸‹ï¼‰ã€‚ NSURLSessionä¹Ÿæä¾›äº†å››ç»„ä»£ç†æ–¹æ³•ï¼š NSURLSessionDelegate â€” Defines delegate methods to handle session-level events NSURLSessionTaskDelegate â€” Defines delegate methods to handle task-level events common to all task types NSURLSessionDataDelegate â€” Defines delegate methods to handle task-level events specific to data and upload tasks NSURLSessionDownloadDelegate â€” Defines delegate methods to handle task-level events specific to download tasks é¦–å…ˆæ¥çœ‹çœ‹æ™®é€šçš„sessoinè¯·æ±‚æ–¹æ³•ã€‚åœ¨completionHandlerä¸­è¿”å›çš„æ˜¯NSDataã€‚ 123456789NSURLSession *session = [NSURLSession sharedSession];NSURLSessionDataTask * dataTask = [session dataTaskWithRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:url]] completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) &#123; self.fileName = response.suggestedFilename; [self saveToFile]; [self.fileHandler seekToEndOfFile]; [self.fileHandler writeData:data]; [self.fileHandler closeFile];&#125;];[dataTask resume];//å¼€å§‹ä»»åŠ¡ã€‚resumeæœ‰ç»§ç»­ã€æ¢å¤ã€é‡æ–°å¼€å§‹çš„æ„æ€ï¼Œå½“å¤„ç†æ–­ç‚¹ç»­ä¼ æ—¶å°±èƒ½ä½“ä¼šåˆ°æ­¤å«ä¹‰äº†ã€‚ å†æ¥çœ‹çœ‹download taskçš„è¯·æ±‚æ–¹å¼ï¼Œä¸Šé¢æåˆ°è¿‡ï¼Œdownload taskæœ€åè¿”å›çš„æ˜¯ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å°†å…¶ä¿å­˜åˆ°å…¶ä»–æ²™ç›’ç›®å½•ä¸­ï¼Œå°±éœ€è¦ç”¨åˆ°NSFileManageräº†ã€‚123456789NSURLSessionDownloadTask * downloadTask = [session downloadTaskWithRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:url]] completionHandler:^(NSURL * _Nullable location, NSURLResponse * _Nullable response, NSError * _Nullable error) &#123; self.fileName = response.suggestedFilename; NSString * directory = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) lastObject]; NSString * filePath = [directory stringByAppendingPathComponent:self.fileName]; NSFileManager * fileManager = [NSFileManager defaultManager]; [fileManager moveItemAtPath:location.path toPath:filePath error:nil];&#125;]; [downloadTask resume]; é‚£æœ‰æ—¶å€™æˆ‘ä»¬æƒ³å–å¾—ä¸‹è½½è¿›åº¦ä¿¡æ¯ï¼Œç”¨blockæ–¹å¼å°±ä¸è¡Œäº†ï¼Œæ‰€ä»¥å°±éœ€è¦ç”¨åˆ°ç³»ç»Ÿæä¾›çš„ä»£ç†æ–¹æ³•äº†ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨NSURLSessionDownloadDelegate.æ­¤æ—¶sessionçš„åˆ›å»ºæ–¹å¼å°±æ˜¯å¦ä¸€ç§æ–¹å¼ï¼Œè®¾ç½®delegateä¸ºselfã€‚ 12345NSURLSession * session = [NSURLSession sessionWithConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration] delegate:self delegateQueue:[NSOperationQueue mainQueue]];self.downloadTask = [session downloadTaskWithRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:url]]];[self.downloadTask resume]; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546#pragma mark - NSURLSessionDownloadDelegate/** * ä¸‹è½½å®Œæ¯• * * @param location æ–‡ä»¶ä¸´æ—¶åœ°å€ */- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTaskdidFinishDownloadingToURL:(NSURL *)location&#123; NSLog(@\"æ–‡ä»¶å­˜æ”¾ä½ç½®%@\",location.path);// [self.startOrPauseOfSession setTitle:@\"å¼€å§‹\" forState:UIControlStateNormal]; self.fileName = @\"QQ4.1.0.dmg\"; NSString * directory = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) lastObject]; NSString * filePath = [directory stringByAppendingPathComponent:self.fileName]; NSFileManager * fileManager = [NSFileManager defaultManager]; [fileManager moveItemAtPath:location.path toPath:filePath error:nil];&#125;/** * æ¯æ¬¡å†™å…¥æ²™ç›’å®Œæ¯• * åœ¨è¿™é‡Œé¢ç›‘å¬ä¸‹è½½è¿›åº¦ï¼ŒtotalBytesWritten/totalBytesExpectedToWrite * * @param bytesWritten è¿™æ¬¡å†™å…¥çš„å¤§å° * @param totalBytesWritten å·²ç»å†™å…¥æ²™ç›’çš„å¤§å° * @param totalBytesExpectedToWrite æ–‡ä»¶æ€»å¤§å° */- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didWriteData:(int64_t)bytesWritten totalBytesWritten:(int64_t)totalBytesWrittentotalBytesExpectedToWrite:(int64_t)totalBytesExpectedToWrite&#123; self.progressView.progress = (double)totalBytesWritten/totalBytesExpectedToWrite; self.progressLabel.text = [NSString stringWithFormat:@\"%.1f%%\",(double)totalBytesWritten/totalBytesExpectedToWrite * 100];&#125;/** * æ¢å¤ä¸‹è½½åè°ƒç”¨ï¼Œ */- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didResumeAtOffset:(int64_t)fileOffsetexpectedTotalBytes:(int64_t)expectedTotalBytes&#123;&#125; 12345678910#pragma mark - PrivateMethod- (void)saveToFile&#123; NSString * cacheDirectory = [NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES) lastObject]; NSLog(@\"%@\",cacheDirectory); NSString * filePath = [cacheDirectory stringByAppendingPathComponent:self.fileName]; NSFileManager * fileManager = [NSFileManager defaultManager]; [fileManager createFileAtPath:filePath contents:nil attributes:nil]; //åˆ›å»ºæ“ä½œæ•°æ®çš„æ–‡ä»¶handler self.fileHandler = [NSFileHandle fileHandleForWritingAtPath:filePath];&#125; æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹NSURLSessionå®˜æ–¹æ–‡æ¡£","link":"/2016/01/10/NSURLSessionåˆæ¢/"},{"title":"LearnSwift-å°ç™½å­¦ä¹ mapï¼Œreduceæ–¹æ³•","text":"æ•°ç»„çš„mapã€reduceæ–¹æ³• mapæ–¹æ³•å°†éå†åºåˆ—ä¸­æ¯ä¸ªå…ƒç´ 123[1,2,3,4,5,6].map &#123; (i) -&gt; Int in return i * 2&#125; ç®€åŒ–ç‰ˆ1[1,2,3,4,5,6].map(&#123;$0 * 2&#125;) reduce: i è¿™é‡Œæ˜¯ä¸€ä¸ªç´¯åŠ å™¨ï¼ˆå¹¶ä¸è¡¨ç¤ºç›¸åŠ ï¼‰ï¼Œä¿å­˜äº†å‰ä¸€æ¬¡è¿ç®—çš„ç»“æœã€‚1234[1,2,3,4,5,6].reduce(1) &#123; (i, element) -&gt; Int in print(i,element) return i * element&#125; ä¸Šé¢çš„reduceæ–¹æ³•å¯ä»¥ç®€åŒ–ä¸º1[1,2,3,4,5,6].reduce(1, combine: *) ä¸‹é¢æ¥çœ‹çœ‹flatMap,è¯¥å‡½æ•°ä¼šå¿½ç•¥ä¸ºnilçš„é›†åˆå…ƒç´ ã€‚123456789101112let persons: [[String: AnyObject]] = [[\"name\": \"Carl Saxon\", \"city\": \"New York, NY\", \"age\": 44], [\"name\": \"Travis Downing\", \"city\": \"El Segundo, CA\", \"age\": 34], [\"name\": \"Liz Parker\", \"city\": \"San Francisco, CA\", \"age\": 32], [\"name\": \"John Newden\", \"city\": \"New Jersey, NY\", \"age\": 21], [\"name\": \"Hector Simons\", \"city\": \"San Diego, CA\", \"age\": 37], [\"name\": \"Brian Neo\", \"age\": 27]] //æ³¨æ„è¿™å®¶ä¼™æ²¡æœ‰ city é”®å€¼//æ‰¾åˆ°ä½åœ¨CAçš„å±…æ°‘ã€‚func peopleFromState(state:String,persons:[[String:AnyObject]]) -&gt; Int&#123; return persons.flatMap &#123; $0[\"city\"]?.componentsSeparatedByString(\", \").last&#125;.filter &#123; $0 == state&#125;.count&#125;peopleFromState(\"CA\", persons: persons) ç”¨reduceå®ç°mapã€flatMap123456789func rmap(element:[Int],transform:(Int)-&gt;Int ) -&gt;[Int]&#123; return element.reduce([Int](), combine: &#123; (var accemulator:[Int], obj:Int) -&gt; [Int] in print(accemulator,obj) accemulator.append(transform(obj)) return accemulator &#125;)&#125;rmap([1,2,3,4,5,6], transform: &#123;$0 * 2&#125;) 1234567func rmap2(element:[Int],transform:(Int)-&gt;Int) -&gt; [Int] &#123; return element.reduce([Int](), combine: &#123;$0 + [transform($1)]&#125;)&#125;let array = rmap2([1,2,3,4,5,6], transform: &#123;$0 * 2&#125;)print(array)ç»“æœéƒ½æ˜¯[2, 4, 6, 8, 10, 12] ç†è§£ $0, $1$0,$1æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œç±»å‹æ ¹æ®æ‰€åœ¨å‡½æ•°çš„å‚æ•°ç±»å‹å†³å®šã€‚ä¸ºä½•å®ƒä»¬æ˜¯è¿™ä¸ªç±»å‹å‘¢ï¼Ÿå…¶æ‰€åœ¨å‡½æ•°æ˜¯combineï¼Œé‚£ä¹ˆ$0å’Œ$1çš„ç±»å‹éƒ½æ˜¯ç”±combineè¿™ä¸ª(å‡½æ•°/é—­åŒ…/æ–¹æ³•)çš„ç¬¬äºŒä¸ªå‚æ•°ç±»å‹å†³å®šçš„ã€‚æ‰€ä»¥æˆ‘ä»¬æ¥çœ‹çœ‹reduceå‡½æ•°çš„å®šä¹‰ï¼š1public func reduce&lt;T&gt;(initial: T, @noescape combine: (T, Self.Generator.Element) throws -&gt; T) rethrows $0ä»£è¡¨ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå…¶ç±»å‹è¿™é‡Œæ˜¯[Int],$1ä»£è¡¨çš„æ˜¯combineå†…çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ‰€ä»¥å…¶ç±»å‹å°±æ˜¯Intçš„ã€‚ ç”¨reduceå®ç°filter123456789101112131415161718192021222324func rfilter(element:[Int],filter:(Int)-&gt;Bool)-&gt; [Int]&#123; return element.reduce([Int](), combine: &#123; (var acc:[Int], value:Int) -&gt; [Int] in if filter(value)&#123; acc.append(value) &#125; return acc &#125;)&#125;let xxc = rfilter([1,2,3,4,5,6], filter: &#123; $0 &gt; 3&#125;)print(xxc)func rfilter2(element:[Int],filter:(Int)-&gt;Bool)-&gt; [Int]&#123; return element.reduce([Int](), combine: &#123; guard filter($1) else&#123; return $0&#125; return $0 + [$1] &#125;)&#125;let oos = rfilter2([1,2,3,4,5,6], filter: &#123;$0 &gt; 3 &#125;)print(oos) å†çœ‹å‰é¢æè¿‡çš„é—®é¢˜ï¼šæ‰¾åˆ°ä½åœ¨CAçš„å±…æ°‘ã€‚å¹¶ä¸”è®¡ç®—ä»–ä»¬çš„å¹³å‡å¹´é¾„123456789101112131415161718func peopleFromState(state:String,persons:[[String:AnyObject]]) -&gt; (population:Int,averageAge:CGFloat)&#123; //return persons.flatMap &#123; $0[\"city\"]?.componentsSeparatedByString(\", \").last&#125;.filter &#123; $0 == state&#125;.count typealias Result = (population:Int,averageAge:CGFloat) let u = persons.reduce((populatoin:0,averageAge:0.0)) &#123; (var result:Result, dic:[String:AnyObject]) -&gt; Result in guard let locationStr = dic[\"city\"]?.componentsSeparatedByString(\", \").last,let personAge = dic[\"age\"] where locationStr == state else&#123; return result&#125; return (result.population + 1,result.averageAge + CGFloat(personAge as! NSNumber)) &#125; return (u.populatoin,u.averageAge / CGFloat(u.populatoin))&#125;let result = peopleFromState(\"CA\", persons: persons)result.population // 3result.averageAge // 34.333333334","link":"/2016/05/06/LearnSwift-å°ç™½å­¦ä¹ mapï¼Œreduceæ–¹æ³•/"},{"title":"Categoryæ·»åŠ å±æ€§æ‰€æƒ³åˆ°çš„","text":"iOSä¸­categoryå’Œextensionç›¸è¾…ç›¸æˆï¼Œé•¿å¾—ä¹Ÿå¾ˆç›¸ä¼¼ã€‚categoryä¸extensionçš„ä¸»è¦åŒºåˆ«ï¼š Categoryï¼šåˆ†ç±»ã€ç±»åˆ« categoryä¸»è¦ç”¨æ¥å¢åŠ ç±»çš„æ–¹æ³•ï¼Œå¹¶ä¸”é€‚ç”¨äºå­ç±»ã€‚ categoryä¸èƒ½æ·»åŠ å®ä¾‹å˜é‡ï¼ˆè¿™ä¸ªå¹¶ä¸æ˜¯å±æ€§ï¼‰ï¼Œå¯ä»¥æ·»åŠ readonlyçš„å±æ€§ã€‚ å¦‚æœè¦æ·»åŠ readwriteçš„å±æ€§çš„è¯ï¼Œéœ€è¦ç”¨åˆ°runtimeæ–¹æ³•ã€‚ Extensionï¼šæ‰©å±• å¯ä»¥å¢åŠ è¢«æ‰©å±•ç±»çš„å±æ€§å’Œæ–¹æ³•ã€‚ Extensionå¯ä»¥ç†è§£ä¸ºåŒ¿åç±»åˆ«ã€‚ å®šä¹‰çš„æ–¹æ³•å¿…é¡»åœ¨implementationä¸­å®ç°ã€‚ ä¸‹é¢ä¸»è¦çœ‹çœ‹categoryçš„ä½¿ç”¨ï¼š1.æ·»åŠ readonlyå±æ€§ 12345678@interface UITableViewCell (AccessoryView)///åœ¨Cellå³ä¾§æ·»åŠ çš„ä¸€ä¸ªè‡ªå®šä¹‰label@property (nonatomic,strong,readonly)UILabel *accessoryLabel;@property (nonatomic,strong,readonly)UIImageView *accessoryImageView;@end .mæ–‡ä»¶ä¸­é‡å†™getteræ–¹æ³• 123456789101112131415161718192021222324252627282930313233@implementation UITableViewCell (AccessoryView)- (UILabel *)accessoryLabel&#123; for (id obj in self.subviews) &#123; if ([obj class] == [UILabel class]) &#123; [obj removeFromSuperview];//å› ä¸ºaccessoryLabelæ˜¯æ·»åŠ åœ¨cellä¸Šçš„ï¼Œè€Œæ²¡æœ‰åœ¨cell.contentViewä¸Šã€‚ &#125; &#125; UILabel * accessoryLabel = [[UILabel alloc]initWithFrame:CGRectMake(kWidth-200, 0, 160, CGRectGetHeight(self.frame))]; accessoryLabel.textColor = [UIColor lightGrayColor]; accessoryLabel.font = [UIFont systemFontOfSize:12]; accessoryLabel.textAlignment = NSTextAlignmentRight; [self addSubview:accessoryLabel]; return accessoryLabel;&#125;- (UIImageView *)accessoryImageView&#123; for (id obj in self.subviews) &#123; if ([obj class] == [UIImageView class]) &#123; [obj removeFromSuperview]; &#125; &#125; UIImageView *accessoryImageView = [[UIImageView alloc]initWithFrame:CGRectMake(kWidth-100, 10, 60, 60)]; accessoryImageView.layer.cornerRadius = 30; accessoryImageView.layer.masksToBounds = YES; [self addSubview:accessoryImageView]; return accessoryImageView; &#125;@end å¦‚æœæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ™®é€šçš„å±æ€§@property (nonatomic,strong)NSString * name;,é‚£ä¹ˆimplementationä¸­ä¼šæŠ¥warningï¼š 2.è¿è¡Œæ—¶æ·»åŠ å±æ€§ï¼š 12345@interface NSError (Message)@property (nonatomic,copy)NSString * errorMsg;@end .m 1234567891011121314static void * strKey = &amp;strKey;@implementation NSError (Message)- (void)setErrorMsg:(NSString *)errorMsg&#123; objc_setAssociatedObject(self, &amp; strKey, errorMsg, OBJC_ASSOCIATION_COPY_NONATOMIC);&#125;- (NSString *)errorMsg&#123; return objc_getAssociatedObject(self, &amp;strKey);&#125;@end åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¤§å¤šæ•°æ—¶å€™è¿˜æ˜¯ç”¨çš„categoryè¾ƒå¤šã€‚åé¢ä¼šç»™å‡ºä¸€äº›å¸¸ç”¨çš„ç±»çš„categoryã€‚","link":"/2015/12/03/Categoryæ·»åŠ å±æ€§æ‰€æƒ³åˆ°çš„/"},{"title":"Blockå®ç°åŸç†","text":"Blockä¸€ç›´æ˜¯iOSå¼€å‘ä¸­å¸¸ç”¨çš„æŠ€å·§ï¼Œç±»ä¼¼äºCè¯­è¨€ä¸­çš„æŒ‡é’ˆå‡½æ•°ã€‚å¤šç”¨äºå‚æ•°å›è°ƒï¼Œå¼‚æ­¥åŠ è½½ç­‰ã€‚ä¸‹é¢å°±æ¥æ¢ç©¶ä»¥ä¸‹blockæ˜¯å¦‚ä½•å®ç°çš„ã€‚è¿™ç¯‡æ˜¯è®°å½•æ ¹æ®ç½‘ä¸Šçš„æ–‡ç« è¿›è¡Œçš„å®é™…æ“ä½œã€‚Cå‡½æ•°çš„ç”Ÿæˆä¸­é—´ç¼–è¯‘ä»£ç çš„ç¼–è¯‘æ–¹æ³•æ˜¯clang -rewrite-objc xxxx.cã€‚ç”±äºç¼–è¯‘æ–‡ä»¶ä¸­å†…å®¹è¾ƒå¤šï¼Œè¿™é‡Œæˆ‘ä»¬åªæˆªå–æœ‰å…³blockçš„éƒ¨åˆ†ã€‚ é¦–å…ˆï¼Œçœ‹çœ‹æ²¡æœ‰blockçš„Cå‡½æ•°ä»¥åŠç¼–è¯‘åçš„ç»“æœï¼š12345#include &lt;stdio.h&gt;int main()&#123; return 0;&#125; ç¼–è¯‘ä»£ç ä¸­çš„blockï¼šè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªblockçš„Cå®ç°ã€‚12345678#ifndef BLOCK_IMPL#define BLOCK_IMPLstruct __block_impl &#123; void *isa; int Flags; int Reserved; void *FuncPtr;&#125;; *isaè¯´æ˜blockä¹Ÿå¯ä»¥ä½œä¸ºå¯¹è±¡ä½¿ç”¨ï¼ˆä¾‹å¦‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªmyBlockç±»å‹çš„block1ï¼‰ï¼ŒæŒ‡é’ˆå˜é‡FunPtråº”è¯¥å°±æ˜¯æŒ‡å‘äº†blockä»£ç å—çš„å‡½æ•°é¦–åœ°å€æ¥ç€æˆ‘ä»¬åŠ ä¸€ä¸ªblockåˆ°.cæ–‡ä»¶ä¸­ï¼Œå¹¶è¿›è¡Œç¼–è¯‘ã€‚12345678910111213#include &lt;stdio.h&gt;int main()&#123;int i = 10;void(^myBlock)(void) = ^(void)&#123; printf(\"hello world! %d\\n\",i);&#125;;myBlock();return 0;&#125; ç¼–è¯‘åï¼š12345678910111213141516171819202122232425262728293031struct __main_block_impl_0 &#123; struct __block_impl impl; struct __main_block_desc_0* Desc; int i; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int _i, int flags=0) : i(_i) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125;&#125;;static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123; int i = __cself-&gt;i; // bound by copy printf(\"hello world! %d\\n\",i); &#125;static struct __main_block_desc_0 &#123; size_t reserved; size_t Block_size;&#125; __main_block_desc_0_DATA = &#123; 0, sizeof(struct __main_block_impl_0)&#125;;int main()&#123; int i = 10; void(*myBlock)(void) = (void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, i); ((void (*)(__block_impl *))((__block_impl *)myBlock)-&gt;FuncPtr)((__block_impl *)myBlock); return 0;&#125; 3.å‡å¦‚æˆ‘ä»¬è¦ä¿®æ”¹å‡½æ•°ä¸­å±€éƒ¨å˜é‡çš„å€¼ï¼Œåˆ™éœ€è¦åŠ ä¸Š__blockä¿®é¥°ç¬¦ï¼Œåé¢æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™æ ·æ‰å¯ä»¥ä¿®æ”¹ã€‚1234567891011121314#include &lt;stdio.h&gt;int main()&#123;__block int i = 10;void(^myBlock)(void) = ^(void)&#123;i = 12; printf(\"hello world! %d\\n\",i);&#125;;myBlock();return 0;&#125; ç¼–è¯‘åçš„cppä»£ç ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445struct __Block_byref_i_0 &#123; void *__isa;__Block_byref_i_0 *__forwarding; int __flags; int __size; int i;&#125;;struct __main_block_impl_0 &#123; struct __block_impl impl; struct __main_block_desc_0* Desc; __Block_byref_i_0 *i; // by ref __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, __Block_byref_i_0 *_i, int flags=0) : i(_i-&gt;__forwarding) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125;&#125;;static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123; __Block_byref_i_0 *i = __cself-&gt;i; // bound by ref (i-&gt;__forwarding-&gt;i) = 12; printf(\"hello world! %d\\n\",(i-&gt;__forwarding-&gt;i)); &#125;static void __main_block_copy_0(struct __main_block_impl_0*dst, struct __main_block_impl_0*src) &#123;_Block_object_assign((void*)&amp;dst-&gt;i, (void*)src-&gt;i, 8/*BLOCK_FIELD_IS_BYREF*/);&#125;static void __main_block_dispose_0(struct __main_block_impl_0*src) &#123;_Block_object_dispose((void*)src-&gt;i, 8/*BLOCK_FIELD_IS_BYREF*/);&#125;static struct __main_block_desc_0 &#123; size_t reserved; size_t Block_size; void (*copy)(struct __main_block_impl_0*, struct __main_block_impl_0*); void (*dispose)(struct __main_block_impl_0*);&#125; __main_block_desc_0_DATA = &#123; 0, sizeof(struct __main_block_impl_0), __main_block_copy_0, __main_block_dispose_0&#125;;int main()&#123; __attribute__((__blocks__(byref))) __Block_byref_i_0 i = &#123;(void*)0,(__Block_byref_i_0 *)&amp;i, 0, sizeof(__Block_byref_i_0), 10&#125;; void(*myBlock)(void) = (void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, (__Block_byref_i_0 *)&amp;i, 570425344); ((void (*)(__block_impl *))((__block_impl *)myBlock)-&gt;FuncPtr)((__block_impl *)myBlock); return 0;&#125;","link":"/2015/12/16/Blockå®ç°åŸç†/"},{"title":"NS_ENUMä¸NSString","text":"NS_ENUMä¸NSString åœ¨é¡¹ç›®ä¸­ç»å¸¸ä¼šä½¿ç”¨åˆ°æšä¸¾ç±»å‹ï¼šNS_ENUM,enum,ä½†æ˜¯ç³»ç»Ÿæä¾›çš„æšä¸¾ç±»å‹åªèƒ½è®¾ç½®ä¸ºNSIntegerç±»å‹ï¼Œä¸èƒ½ä¿å­˜å¯¹è±¡ç±»å‹å…¥NSStringã€‚ä¼ ç»Ÿçš„ç”¨#define æ–¹å¼ï¼ŒSwitch case è½¬æ¢æ–¹å¼ï¼Œå¦å¤–è¿˜å‘ç°äº†å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼š 12typedef enum &#123;value1, value2, value3&#125; myValue;#define myValueString(enum) [@[@\"value1\",@\"value2\",@\"value3\"] objectAtIndex:enum] 12345678910111213141516171819202122typedef enum &#123; a, b, c &#125; FirstThreeAlpha;- (NSString*) convertToString:(FirstThreeAlpha) whichAlpha &#123; NSString *result = nil; switch(whichAlpha) &#123; case a: result = @\"a\"; break; case b: result = @\"b\"; break; case c: result = @\"c\"; break; default: result = @\"unknown\"; &#125; return result;&#125; 12345678910111213typedef NS_ENUM(NSInteger,CabinetOperationType)&#123; CabinetOperationTypeNothing = 0, CabinetOperationTypeAdd = 1, //åŠ å…¥é…’æŸœ CabinetOperationTypeTake = 2, //ä»é…’æŸœæé…’ CabinetOperationTypeAddAndSend = 3 //åŠ å…¥é…’æŸœä»˜æ¬¾å¹¶ç›´æ¥èµ äºˆæŸäºº &#125;;NSString *const CabinetOperationTypeString[] = &#123; [CabinetOperationTypeNothing] = @\"\", [CabinetOperationTypeAdd] = @\"1\", [CabinetOperationTypeTake] = @\"2\", [CabinetOperationTypeAddAndSend] = @\"3\"&#125;; æ­¤æ³•å’Œä¸Šé¢çš„å®šä¹‰NSStringæ•°ç»„ç›¸ä¼¼ï¼Œä½†æ˜¯æ˜¯ç”¨äº†å‡½æ•°æ€æƒ³ã€‚123456789101112131415161718192021222324typedef enum &#123; UIImageOrientationUp = 0, // default orientation, set to 0 so that it always starts from 0 UIImageOrientationDown, // 180 deg rotation UIImageOrientationLeft, // 90 deg CCW UIImageOrientationRight, // 90 deg CW UIImageOrientationUpMirrored, // as above but image mirrored along other axis. horizontal flip UIImageOrientationDownMirrored, // horizontal flip UIImageOrientationLeftMirrored, // vertical flip UIImageOrientationRightMirrored, // vertical flip&#125; UIImageOrientation;NSString *stringWithUIImageOrientation(UIImageOrientation input) &#123; NSArray *arr = @[ @\"UIImageOrientationUp\", // default orientation @\"UIImageOrientationDown\", // 180 deg rotation @\"UIImageOrientationLeft\", // 90 deg CCW @\"UIImageOrientationRight\", // 90 deg CW @\"UIImageOrientationUpMirrored\", // as above but image mirrored along other axis. horizontal flip @\"UIImageOrientationDownMirrored\", // horizontal flip @\"UIImageOrientationLeftMirrored\", // vertical flip @\"UIImageOrientationRightMirrored\", // vertical flip ]; return (NSString *)[arr objectAtIndex:input];&#125; ç»¼åˆä¼—å¤šæ–¹æ¡ˆå¾—å‡ºï¼Œè¦ç†Ÿç»ƒä½¿ç”¨typedefã€#define å°±å¯ä»¥æé«˜æ•ˆç‡ã€‚æ›´å¤šå¯ä»¥å‚è€ƒstackoverflowï¼šenum Values to NSString (iOS)","link":"/2016/01/07/NS-ENUMä¸NSString/"},{"title":"MVVM in Practice","text":"MVVM in Practice - RWDevCon Session - raywenderlich.com MVVMå·²ç»è¢«è°ˆè®ºå¾ˆå¤šäº†ï¼Œå´ä¸€ç›´æ²¡æœ‰æ·±å…¥ç†è§£å’Œå®è·µï¼Œæœ¬ç¯‡æ˜¯åœ¨è§‚çœ‹è¯¥è§†é¢‘åçš„å°ç»“ã€‚ è¯¥è§†é¢‘ä¸­è®²è§£äº†MVCåˆ°MVVMçš„è¿ç§»é‡æ„å’Œé‡ç‚¹ï¼Œå¹¶æ²¡æœ‰æ¶‰åŠåˆ°FRPï¼Œåˆå­¦è€…å¯ä»¥å¾ˆå¿«è¿›å…¥MVVMä¸­ã€‚ æ¦‚å¿µMVVMï¼š Model-View-ViewModelã€‚é€šè¿‡åˆ†ç¦»ViewControllerä¸­é€»è¾‘ä»£ç åˆ°ç‹¬ç«‹çš„ViewModelä¸­ï¼Œå®ç°ä¸šåŠ¡é€»è¾‘åˆ†ç¦»å’ŒVCç˜¦èº«ã€‚ é‡ç‚¹ï¼šData BindingiOSä¸­çš„æ•°æ®ç»‘å®šæ–¹å¼ï¼š KVO Delegate Funtional Reactive Programming Property Observer 1234567 var str = \"Hello, playground\" &#123; didSet &#123; print(\"new str : \\(str)\") &#125;&#125;str = \"hello swift\" å®ç°ä¸€ä¸ªData Bindingç±»:Box 123456789101112131415161718192021222324252627class Box&lt;T&gt; &#123; typealias Listener = (T) -&gt; Void var listener : Listener? var value:T &#123; didSet &#123; listener?(value) &#125; &#125; init(_ value:T) &#123; self.value = value &#125; func bind(listener:Listener?) &#123; self.listener = listener listener?(value) &#125;&#125;var bindedObj = Box(\"\")bindedObj.bind &#123; print(\"new value:\\($0)\")&#125;bindedObj.value = \"2017\" å¯ä»¥çœ‹å‡ºæ˜¯ä½¿ç”¨äº†closureæ¥å®ç°bingdingçš„ã€‚åŒç†ï¼ŒCocoaä¸­çš„å…¶ä»–ç±»éƒ½å¯ä»¥å†™ä¸€ä¸ªextensionå®ç°ç»‘å®šã€‚ æé—®ç¯èŠ‚ï¼ˆåªç»™å‡ºå›ç­”ä¸­çš„é‡ç‚¹å†…å®¹ï¼‰ ä¸ºä»€ä¹ˆViewModelä½¿ç”¨çš„æ˜¯classè€Œä¸æ˜¯structï¼Ÿ Ashï¼šè¯´æ˜¯å› ä¸ºä»–è®¤ä¸ºè¿™ä¸ªViewModelä¸­ä¸ä»…æ˜¯æ•°æ®é€»è¾‘ï¼Œè¿˜åŒ…å«æœ‰å…¶ä»–åŠŸèƒ½é€»è¾‘ä»£ç ã€‚ ä¸ºä»€ä¹ˆdispatchAfterä¸­ä½¿ç”¨weak selfï¼Œè€ŒviewControllerä¸­ä½¿ç”¨unowned selfï¼Ÿ Ashï¼šé€šå¸¸æ¥è¯´ï¼Œweakä¿®é¥°çš„å˜é‡æœ‰å¯èƒ½æ˜¯ä¸ºnilçš„ï¼Œè€Œunownedä¿®é¥°çš„å˜é‡ä½ ä¼šä¿è¯å®ƒä¸æ˜¯optionalçš„ã€‚ MVVMçš„Benifitså’ŒLimitation Benifits: Breaks up code by responsibility Simplifies Testing Code reusablibity Limitation: Requires binding(or other workarounds) Potential for boilerplate code Sometimes feels like overkill Doesnâ€™t cover every case å»¶ä¼¸é˜…è¯» ReactiveCocoa/RxSwift Getting Started With RxSwift and RxCocoa","link":"/2017/08/30/MVVM-in-Practice/"},{"title":"QRCodeä¸Core Image","text":"ç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šå…³äºäºŒç»´ç æ–¹é¢çš„æ–‡ç« äº†ï¼Œå†™è¿™ç¯‡æ–‡ç« çš„ç›®çš„æ˜¯å› ä¸ºè¦è®°å½•ä¸€ä¸ªå…³äºä¿å­˜äºŒç»´ç å›¾ç‰‡åˆ°ç›¸å†Œçš„é—®é¢˜ï¼Œé¡ºä¾¿å›é¡¾ä¸€ä¸‹iOSå¼€å‘ä¸­ä½¿ç”¨äºŒç»´ç çš„å†å²ã€‚å¥½äº†ï¼ŒåºŸè¯å°‘è¯´ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼ è¦è®¨è®ºçš„é—®é¢˜åœ¨å‚è€ƒBuilding a QR Code Generator with Core Image Filtersè¿™ç¯‡æ–‡ç« ï¼Œå®Œæˆäº†äºŒç»´ç ç”Ÿæˆçš„æ —å­ã€‚äºŒç»´ç çš„æ‰«æåˆ™æ˜¯ç”¨äº†AVFoundationæ¡†æ¶æ¥ç¼–å†™çš„GithubÂ·HLQRCodeã€‚æœ€åæƒ³æŠŠç”Ÿæˆçš„äºŒç»´ç å›¾ç‰‡ä¿å­˜åˆ°ç›¸å†Œä¸­å´æ²¡æœ‰æˆåŠŸã€‚å‚è€ƒäº†ç½‘ä¸Šçš„ä»£ç ï¼Œä½¿ç”¨äº†CIImag-&gt;CGImage-&gt;writeImageToAlbumçš„æ–¹å¼ã€‚ä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920CIContext * context = [CIContext contextWithOptions:nil];CGImageRef cgimg = [context createCGImage:self.qrcodeImg fromRect:[self.qrcodeImg extent] ];ALAssetsLibrary *library = [[ALAssetsLibrary alloc] init];[library writeImageToSavedPhotosAlbum:cgimg metadata:[self.qrcodeImg properties] completionBlock:^(NSURL *assetURL, NSError *error) &#123; if(error != NULL)&#123; msg = @\"ä¿å­˜å›¾ç‰‡å¤±è´¥\" ; &#125;else&#123; NSLog(@\"%@\",assetURL); msg = @\"ä¿å­˜å›¾ç‰‡æˆåŠŸ\" ; &#125; UIAlertView *alert = [[UIAlertView alloc] initWithTitle:nil message:msg delegate:self cancelButtonTitle:@\"ç¡®å®š\" otherButtonTitles:nil]; [alert show];&#125;];ä½†æ˜¯è¿™æ ·æ— è®ºæ€ä¹ˆæ ·éƒ½æ— æ³•åœ¨ç›¸å†Œä¸­çœ‹åˆ°ä¿å­˜çš„äºŒç»´ç å›¾ç‰‡ã€‚è¿˜æŠ¥é”™message &quot;BSXPCMessage received error for message: Connection interrupted&quot;ã€‚å¯¹æ¯”å‚è€ƒçš„ä»£ç éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå´æ‰¾ä¸å‡ºåŸå› ã€‚æˆ‘å°±åœ¨æ–‡ç« è¯„è®ºä¸­ç•™è¨€é—®äº†è¿™ä¸ªé—®é¢˜ï¼Œåæ¥ä¸€ä¸ªæœ‹å‹æå‡ºäº†è§£å†³æ–¹æ¡ˆï¼Œä»”ç»†ä¸€çœ‹é¡¿æ—¶æç„¶å¤§æ‚Ÿã€‚è§£å†³æ–¹å¼åŠè¦ç‚¹ 1CIContext * context = [CIContext contextWithOptions:@&#123;kCIContextUseSoftwareRenderer:@YES&#125;]; çœ‹åˆ°åŒºåˆ«äº†å—ï¼Ÿæ˜¯çš„ï¼Œå¤šäº†ä¸€ä¸ªoptionå‚æ•°kCIContextUseSoftwareRenderer.ç„¶ååœ¨development docä¸­æŸ¥çœ‹äº†å…³äºcontextWithOptionsæ–¹æ³•çš„æè¿°ï¼šcontextWithOptions:You can create a CPU-based context by providing the key kCIContextUseSoftwareRenderer. A CPU-based context supports larger input and output images than a GPU-based context. It also allows your app to perform processing in the background, such as when saving the rendered output to the Photo Library. GPU rendering is faster than CPU rendering, but the resulting image is not displayed on the device until after is it copied to CPU memory and converted to another image type, such as a UIImage object. @Apple Development Docdeveloper.apple.com/library/prerelease/ios/documentation/GraphicsImaging/Reference/QuartzCoreFramework/Classes/CIContext_Class/index.html#//apple_ref/occ/clm/CIContext/contextWithOptions: é¡¿æ—¶è§‰å¾—è‡ªå·±å½“æ—¶å¥½ç¬¨ï¼Œéƒ½æ²¡æœ‰æƒ³åˆ°å»æŸ¥ä¸€ä¸‹å¼€å‘æ–‡æ¡£ã€‚o(â•¯â–¡â•°)o NSString *kCIContextOutputColorSpace; - A key for the color space to use for images before they are rendered to the context. ä½¿ç”¨OpenGLES NSString *kCIContextWorkingColorSpace; - A key for the color space to use for image operations. ä½¿ç”¨OpenGLES NSString *kCIContextUseSoftwareRenderer; - A key for enabling software renderer use. If the associated NSNumber object is YES, then the software renderer is required. ä½¿ç”¨CPU NSString *kCIContextPriorityRequestLow; - A key for enabling low-priority GPU use. NSString *kCIContextWorkingFormat; - An option for the color format to use for intermediate results when rendering with the context. contextWithOptionsæ–¹æ³•é»˜è®¤æ˜¯åœ¨GPUä¸Šå¤„ç†å›¾åƒã€‚æ ¹æ®ä¸åŒçš„å‚æ•°è®¾ç½®ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚ä»¥ä¸Šè¿™äº›å…¶å®ä¸æ˜¯å¾ˆç†è§£ï¼Œå›§ã€‚å…·ä½“å‚è€ƒContext Options äºŒç»´ç çš„å†å²åœ¨iOS7ä»¥å‰ï¼ŒiOSå¼€å‘ä½¿ç”¨äºŒç»´ç éƒ½æ˜¯ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ã€‚æ¯”è¾ƒæµè¡Œçš„å°±æ˜¯ZXingå’ŒZbaräº†ã€‚ä¸è¯´å®ƒä»¬çš„å®ç°åŸç†äº†ï¼Œé‡åˆ°æœ€å¤šçš„é—®é¢˜å°±æ˜¯ä¸å…¶ä»–ç¬¬ä¸‰æ–¹åº“ï¼ˆæ¯”å¦‚æ”¯ä»˜å®SDKï¼Œç™¾åº¦åœ°å›¾SDKï¼‰ç»§æ‰¿åœ¨ä¸€èµ·æ—¶å‡ºç°duplicate symboläº†ã€‚è§£å†³æ–¹æ³•ä¹Ÿå¾ˆéº»çƒ¦ï¼šä¿®æ”¹æºç ï¼Œé‡æ–°ç¼–è¯‘é™æ€åº“.aæ–‡ä»¶ã€‚ ä¸è¿‡ç°åœ¨å¾ˆå°‘ç”¨åˆ°äºŒç»´ç äº†ï¼Œè¦ç”¨ä¹Ÿè¦ç”¨ç³»ç»Ÿè‡ªå¸¦çš„æ¡†æ¶å“Ÿ~ï¼ æ€»ç»“1.é‡åˆ°é—®é¢˜å…ˆæŸ¥çœ‹å¼€å‘æ–‡æ¡£ï¼Œå†Googleï¼2.ç ”ç©¶é—®é¢˜è¦æ·±å…¥ï¼åé¢å­¦ä¹ ä¸€ä¸‹Core Imageçš„ä¸œè¥¿ï¼Œè¿˜æœ‰ä¸ä¹‹çš„GPUImageåº“ï¼ å‚è€ƒæ–‡ç« Core Image Programming GuideBSXPCMessage received error for message: Connection interrupted","link":"/2016/03/05/QRCodeçš„é‚£äº›äº‹å„¿/"},{"title":"Xcode8ä¸­NavigationBaræ’å…¥èƒŒæ™¯å‡ºé”™çš„è§£å†³æ–¹æ³•","text":"insertSubviewæ˜¯æŠŠbackgroundViewæ’å…¥åˆ°UINavigationBarä¸­ï¼ŒUINavigationBarä½œä¸ºå…¶superviewã€‚æ¯æ¬¡è·³è½¬å›æ¥ä¹‹åï¼Œä¼šé‡æ–°èµ‹å€¼ï¼ˆå¯èƒ½ï¼‰æ‰€ä»¥æˆ‘ä»¬è¦æŠŠbackgroundViewæ”¾å…¥åˆ°UIBarBackgroundä¸­ã€‚ ä»¥å‰å†™è¿‡ä¸€ä¸ªå¯¼èˆªæ ä¸­æ’å…¥èƒŒæ™¯æ”¹å˜å¯¼èˆªæ èƒŒæ™¯è‰²çš„ç±»ã€‚ 1insertSubview(backgroundView!, at: 0) åœ¨xcode8 çš„view hierarchayè¡¨ç°ä¸ºï¼š ä½†æ˜¯ç°åœ¨å‡ºç°çš„é—®é¢˜æ˜¯è¿”å›åˆ°é¦–é¡µåï¼Œå¯¼èˆªæ è¢«èƒŒæ™¯viewé®ç›–äº† è§£å†³æ–¹æ³•ï¼š1self.subviews[0].insertSubview(backgroundView!, at: 0)","link":"/2016/10/05/Xcode8ä¸­NavigationBaræ’å…¥èƒŒæ™¯å‡ºé”™çš„è§£å†³æ–¹æ³•/"},{"title":"SDWebImage4.0æºç é˜…è¯»","text":"å‚æ‹œä¸€ä¸‹SDWebImageçš„æºç ã€‚å¹¶ä¸æ˜¯è¯´ä¸€å®šè¦è¯»å¦‚ä½•å¦‚ä½•ã€åªæ˜¯è§‰å¾—æºç çš„é˜…è¯»æ˜¯ä¸€ç§å¾ˆå¥½çš„å­¦ä¹ æ–¹å¼ã€‚æ— è®ºä»æ¶æ„è¿˜æ˜¯æŠ€æœ¯ç‚¹æ–¹é¢ã€‚ ç›®å½• å¸¸è§ç–‘é—®(é¢è¯•å¤§å…¨ï¼Ÿ) ç£ç›˜ç›®å½•ä½äºå“ªé‡Œï¼Ÿ æœ€å¤§å¹¶å‘æ•°ã€è¶…æ—¶æ—¶é•¿ï¼Ÿ å›¾ç‰‡å¦‚ä½•å‘½åï¼Ÿ å¦‚ä½•è¯†åˆ«å›¾ç‰‡ç±»å‹? æ‰€æŸ¥æ‰¾åˆ°çš„å›¾ç‰‡çš„æ¥æº? æ‰€æœ‰ä¸‹è½½çš„å›¾ç‰‡éƒ½å°†è¢«å†™å…¥ç¼“å­˜ï¼Ÿç£ç›˜å‘¢ï¼Ÿä½•æ—¶ç¼“å­˜çš„ï¼Ÿ ç£ç›˜ç¼“å­˜çš„æ—¶é•¿ï¼Ÿæ¸…ç†æ“ä½œçš„æ—¶é—´ç‚¹ï¼Ÿ ç£ç›˜æ¸…ç†çš„åŸåˆ™ï¼Ÿ ä¸‹è½½å›¾ç‰‡æ—¶ã€ä¼šä½¿ç”¨ç¼“å­˜åè®®ä¹ˆ? ä¸‹è½½å›¾ç‰‡çš„URLå¿…é¡»æ˜¯NSURLä¹ˆï¼Ÿ è¯»å–ç¼“å­˜ä»¥åŠè¯»å–ç£ç›˜çš„æ—¶å€™å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ ç›¸å…³çŸ¥è¯†ç‚¹ NS_OPTIONSæšä¸¾ä¸ä½è¿ç®— å†…è”å‡½æ•° å‡†å¤‡å·¥ä½œ å·¥ä½œåŸç† ä¸šåŠ¡å±‚çº§ æ ¸å¿ƒä»£ç (æ­£å¸¸è¯»å–ä¸‹è½½å›¾ç‰‡) æœ€ä¸Šå±‚ï¼šUIView+WebCache é€»è¾‘å±‚ï¼šSDWebImageManager ä¸šåŠ¡å±‚ï¼š ç¼“å­˜&amp;&amp;ç£ç›˜æ“ä½œ(SDImageCache) ä¸‹è½½æ“ä½œ(SDWebImageDownloader) ä¸€äº›å¯å‘ åˆ†å±‚çš„æ¥å£APIè®¾è®¡ çº¿ç¨‹å®‰å…¨ å†…è”å‡½æ•° ç²¾ç»†çš„ç¼“å­˜ç®¡ç†åŸåˆ™ å›è°ƒè®¾è®¡ å¸¸è§ç–‘é—®(é¢è¯•å¤§å…¨ï¼Ÿ)è™½ç„¶æˆ‘æ›´æ¨èé˜…è¯»æºç ã€å¯å¦‚æœå®åœ¨æ²¡æ—¶é—´ã€‚è¿™ä¸€æ®µåªè¦èŠ±è´¹å‡ åˆ†é’Ÿã€‚æˆ‘è¿˜æ˜¯æ¯”è¾ƒå–œæ¬¢æŠŠå¹²è´§æ”¾åœ¨å‰é¢ã€æ–¹ä¾¿ä¼¸æ‰‹å…š(æ¯”å¦‚æˆ‘)ã€‚ä¸è¿‡ä¹Ÿä¸èƒ½ä¿è¯æ¶µç›–å…¨éƒ¨é—®é¢˜ã€æ¬¢è¿ç•™è¨€ã€‚ ç£ç›˜ç›®å½•ä½äºå“ªé‡Œï¼Ÿ ç¼“å­˜åœ¨ç£ç›˜æ²™ç›’ç›®å½•ä¸‹ Library/CachesäºŒçº§ç›®å½•ä¸º~/Library/Caches/default/com.hackemist.SDWebImageCache.default 12345678910111213141516171819202122232425- (instancetype)init &#123; return [self initWithNamespace:@&quot;default&quot;]; // ~Library/Caches/default&#125;- (nonnull instancetype)initWithNamespace:(nonnull NSString *)ns &#123; NSString *path = [self makeDiskCachePath:ns]; return [self initWithNamespace:ns diskCacheDirectory:path];&#125;- (nonnull instancetype)initWithNamespace:(nonnull NSString *)ns diskCacheDirectory:(nonnull NSString *)directory &#123; if ((self = [super init])) &#123; NSString *fullNamespace = [@&quot;com.hackemist.SDWebImageCache.&quot; stringByAppendingString:ns] // Init the disk cache if (directory != nil) &#123; _diskCachePath = [directory stringByAppendingPathComponent:fullNamespace]; &#125; else &#123; NSString *path = [self makeDiskCachePath:ns]; _diskCachePath = path; &#125;// _diskCachePath = ~/Library/Caches/default/com.hackemist.SDWebImageCache.default&#125; ä½ ä¹Ÿå¯ä»¥é€šè¿‡[[SDImageCache sharedImageCache] addReadOnlyCachePath:bundledPath];æ¥è‡ªå®šä¹‰ä¸€ä¸ªè·¯å¾„ã€‚ ä½†è¿™ä¸ªè·¯å¾„ä¸ä¼šè¢«å­˜å‚¨ä½¿ç”¨ã€æ˜¯ç»™å¼€å‘è€…è‡ªå®šä¹‰é¢„è£…å›¾ç‰‡çš„è·¯å¾„ã€‚ æœ€å¤§å¹¶å‘æ•°ã€è¶…æ—¶æ—¶é•¿ï¼Ÿ 123_downloadQueue = [NSOperationQueue new];_downloadQueue.maxConcurrentOperationCount = 6;_downloadTimeout = 15.0; å›¾ç‰‡å¦‚ä½•å‘½åï¼Ÿ è¿™é‡Œå†™å…¥ç¼“å­˜å’Œå†™å…¥ç£ç›˜æ˜¯ä¸åŒçš„ã€‚å†™å…¥ç¼“å­˜æ—¶ã€ç›´æ¥ç”¨å›¾ç‰‡urlä½œä¸ºkey 123//å†™å…¥ç¼“å­˜NSUInteger cost = SDCacheCostForImage(image);[self.memCache setObject:image forKey:key cost:cost]; å†™å…¥ç£ç›˜æ—¶ã€ç”¨urlçš„MD5ç¼–ç ä½œä¸ºkeyã€‚å¯ä»¥é˜²æ­¢æ–‡ä»¶åè¿‡é•¿ 12345678910111213141516- (nullable NSString *)cachedFileNameForKey:(nullable NSString *)key &#123; const char *str = key.UTF8String; if (str == NULL) &#123; str = &quot;&quot;; &#125; unsigned char r[CC_MD5_DIGEST_LENGTH]; CC_MD5(str, (CC_LONG)strlen(str), r); NSURL *keyURL = [NSURL URLWithString:key]; NSString *ext = keyURL ? keyURL.pathExtension : key.pathExtension; NSString *filename = [NSString stringWithFormat:@&quot;%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%@&quot;, r[0], r[1], r[2], r[3], r[4], r[5], r[6], r[7], r[8], r[9], r[10], r[11], r[12], r[13], r[14], r[15], ext.length == 0 ? @&quot;&quot; : [NSString stringWithFormat:@&quot;.%@&quot;, ext]]; return filename; //key == https://gss2.bdstatic.com/-fo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike80%2C5%2C5%2C80%2C26/sign=034361ab922397ddc274905638ebd9d2/d31b0ef41bd5ad64dddebb.jpg; //filename == f029945f95894e152771806785bc4f18.jpg;&#125; å¦‚ä½•è¯†åˆ«å›¾ç‰‡ç±»å‹? é€šè¿‡NSDataæ•°æ®çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è¿›è¡Œåˆ¤æ–­ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344+ (SDImageFormat)sd_imageFormatForImageData:(nullable NSData *)data &#123; if (!data) &#123; return SDImageFormatUndefined; &#125; // File signatures table: http://www.garykessler.net/library/file_sigs.html uint8_t c; [data getBytes:&amp;c length:1]; switch (c) &#123; case 0xFF: return SDImageFormatJPEG; case 0x89: return SDImageFormatPNG; case 0x47: return SDImageFormatGIF; case 0x49: case 0x4D: return SDImageFormatTIFF; case 0x52: &#123; if (data.length &gt;= 12) &#123; //RIFF....WEBP NSString *testString = [[NSString alloc] initWithData:[data subdataWithRange:NSMakeRange(0, 12)] encoding:NSASCIIStringEncoding]; if ([testString hasPrefix:@&quot;RIFF&quot;] &amp;&amp; [testString hasSuffix:@&quot;WEBP&quot;]) &#123; return SDImageFormatWebP; &#125; &#125; break; &#125; case 0x00: &#123; if (data.length &gt;= 12) &#123; //....ftypheic ....ftypheix ....ftyphevc ....ftyphevx NSString *testString = [[NSString alloc] initWithData:[data subdataWithRange:NSMakeRange(4, 8)] encoding:NSASCIIStringEncoding]; if ([testString isEqualToString:@&quot;ftypheic&quot;] || [testString isEqualToString:@&quot;ftypheix&quot;] || [testString isEqualToString:@&quot;ftyphevc&quot;] || [testString isEqualToString:@&quot;ftyphevx&quot;]) &#123; return SDImageFormatHEIC; &#125; &#125; break; &#125; &#125; return SDImageFormatUndefined;&#125; æ‰€æŸ¥æ‰¾åˆ°çš„å›¾ç‰‡çš„æ¥æº? 1234567891011121314typedef NS_ENUM(NSInteger, SDImageCacheType) &#123; /** * ä»ç½‘ä¸Šä¸‹è½½ */ SDImageCacheTypeNone, /** * ä»ç£ç›˜è·å¾— */ SDImageCacheTypeDisk, /** * ä»å†…å­˜è·å¾— */ SDImageCacheTypeMemory&#125;; æ‰€æœ‰ä¸‹è½½çš„å›¾ç‰‡éƒ½å°†è¢«å†™å…¥ç¼“å­˜ï¼Ÿç£ç›˜å‘¢ï¼Ÿä½•æ—¶ç¼“å­˜çš„ï¼Ÿ ç£ç›˜ä¸æ˜¯å¼ºåˆ¶å†™å…¥ã€‚ä»æšä¸¾SDWebImageOptionså¯è§ 1234567typedef NS_OPTIONS(NSUInteger, SDWebImageOptions) &#123; /** * ç¦ç”¨ç£ç›˜ç¼“å­˜ */ SDWebImageCacheMemoryOnly = 1 &lt;&lt; 2,&#125; è€ŒMemoryç¼“å­˜åº”è¯¥æ˜¯å¿…é¡»å†™å…¥çš„(å› ä¸ºæˆ‘å¹¶æ²¡æ‰¾åˆ°å“ªé‡Œå¯ä»¥ç¦æ­¢)ã€‚ç¼“å­˜çš„æ—¶é—´ç‚¹ã€æœ‰ä¸¤ä¸ª(å¼€å‘è€…ä¹Ÿå¯ä»¥ä¸»åŠ¨ç¼“å­˜)ã€ä¸”éƒ½æ˜¯ç”±SDWebImageManagerè¿›è¡Œã€‚å…¶ä¸€æ˜¯ä¸‹è½½æˆåŠŸåã€è‡ªåŠ¨ä¿å­˜ã€‚æˆ–è€…å¼€å‘è€…é€šè¿‡ä»£ç†å¤„ç†å›¾ç‰‡å¹¶è¿”å›åç¼“å­˜ 123456789101112131415- (nullable UIImage *)imageManager:(nonnull SDWebImageManager *)imageManager transformDownloadedImage:(nullable UIImage *)image withURL:(nullable NSURL *)imageURL;=========&gt;&gt;SDWebImageManager//è·å–è½¬æ¢ç”¨æˆ·åçš„å›¾ç‰‡UIImage *transformedImage = [self.delegate imageManager:self transformDownloadedImage:downloadedImage withURL:url];//ç”¨æˆ·å¤„ç†æˆåŠŸif (transformedImage &amp;&amp; finished) &#123; BOOL imageWasTransformed = ![transformedImage isEqual:downloadedImage]; //ç”¨æˆ·å¤„ç†çš„åè‹¥æœªç”Ÿæˆæ–°çš„å›¾ç‰‡ã€åˆ™ä¿å­˜ä¸‹è½½çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ //ä¸ç„¶åˆ™ç”±imageCacheå†…éƒ¨ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ä¿å­˜ [self.imageCache storeImage:transformedImage imageData:(imageWasTransformed ? nil : downloadedData) forKey:key toDisk:cacheOnDisk completion:nil];&#125; å…¶äºŒæ˜¯å½“ç¼“å­˜ä¸­æ²¡æœ‰ã€ä½†æ˜¯ä»ç¡¬ç›˜ä¸­æŸ¥è¯¢åˆ°äº†å›¾ç‰‡ã€‚ 12345678910111213141516@autoreleasepool &#123; //æœç´¢ç¡¬ç›˜ NSData *diskData = [self diskImageDataBySearchingAllPathsForKey:key]; UIImage *diskImage = [self diskImageForKey:key]; //ç¼“å­˜åˆ°å†…å­˜ã€é»˜è®¤ä¸ºYES if (diskImage &amp;&amp; self.config.shouldCacheImagesInMemory) &#123; NSUInteger cost = SDCacheCostForImage(diskImage); //ä½¿ç”¨NSChacheç¼“å­˜ã€‚ [self.memCache setObject:diskImage forKey:key cost:cost]; &#125; if (doneBlock) &#123; dispatch_async(dispatch_get_main_queue(), ^&#123; doneBlock(diskImage, diskData, SDImageCacheTypeDisk); &#125;); &#125;&#125; ç£ç›˜ç¼“å­˜çš„æ—¶é•¿ï¼Ÿæ¸…ç†æ“ä½œçš„æ—¶é—´ç‚¹ï¼Ÿ é»˜è®¤ä¸ºä¸€å‘¨1static const NSInteger kDefaultCacheMaxCacheAge = 60 * 60 * 24 * 7; // 1 week èƒ½å¤Ÿä»¥æ—¶é—´æ¸…é™¤ç£ç›˜çš„æ–¹æ³•ä¸º 1- (void)deleteOldFilesWithCompletionBlock:(nullable SDWebImageNoParamsBlock)completionBlock; è°ƒç”¨çš„æ—¶æœºä¸º 12345678[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(deleteOldFiles) name:UIApplicationWillTerminateNotification object:nil]; [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(backgroundDeleteOldFiles) name:UIApplicationDidEnterBackgroundNotification object:nil]; ä¹Ÿå°±æ˜¯å½“ç¨‹åºé€€å‡ºåˆ°åå°ã€æˆ–è€…è¢«æ€æ­»çš„æ—¶å€™ã€‚è¿™é‡Œã€è¿˜æœ‰å¦å¤–ä¸€ä¸ªç‚¹ã€‚Long-Running Taskä»»åŠ¡ 12345678910111213141516171819202122- (void)backgroundDeleteOldFiles &#123; Class UIApplicationClass = NSClassFromString(@&quot;UIApplication&quot;); if(!UIApplicationClass || ![UIApplicationClass respondsToSelector:@selector(sharedApplication)]) &#123; return; &#125; UIApplication *application = [UIApplication performSelector:@selector(sharedApplication)]; //åå°ä»»åŠ¡æ ‡è¯†--æ³¨å†Œä¸€ä¸ªåå°ä»»åŠ¡ __block UIBackgroundTaskIdentifier bgTask = [application beginBackgroundTaskWithExpirationHandler:^&#123; //è¶…æ—¶ï¼ˆå¤§æ¦‚150ç§’ï¼Ÿï¼‰è‡ªåŠ¨ç»“æŸåå°ä»»åŠ¡ //ç»“æŸåå°ä»»åŠ¡ [application endBackgroundTask:bgTask]; bgTask = UIBackgroundTaskInvalid; &#125;]; [self deleteOldFilesWithCompletionBlock:^&#123; //ç»“æŸåå°ä»»åŠ¡ [application endBackgroundTask:bgTask]; bgTask = UIBackgroundTaskInvalid; &#125;];&#125; æ­£å¸¸ç¨‹åºåœ¨è¿›å…¥åå°åã€è™½ç„¶å¯ä»¥ç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚ä½†æ˜¯åœ¨æ—¶é—´å¾ˆçŸ­å†…å°±ä¼šè¢«æŒ‚èµ·å¾…æœºã€‚Long-Runningå¯ä»¥è®©ç³»ç»Ÿä¸ºappå†å¤šåˆ†é…ä¸€äº›æ—¶é—´æ¥å¤„ç†ä¸€äº›è€—æ—¶ä»»åŠ¡ã€‚ ç£ç›˜æ¸…ç†çš„åŸåˆ™ï¼Ÿ é¦–å…ˆã€é€šè¿‡æ—¶é—´è¿›è¡Œæ¸…ç†ã€‚ï¼ˆæœ€åä¿®æ”¹æ—¶é—´&gt;ä¸€å‘¨ï¼‰ç„¶åã€æ ¹æ®å æ®å†…å­˜å¤§å°è¿›è¡Œæ¸…ç†ã€‚ï¼ˆå¦‚æœå æ®å†…å­˜å¤§äºä¸Šé™ã€åˆ™æŒ‰æ—¶é—´æ’åºã€åˆ é™¤åˆ°ä¸Šé™çš„1/2ã€‚ï¼‰è¿™é‡Œæˆ‘å¹¶æ²¡æœ‰çœ‹åˆ°ä½¿ç”¨é¢‘ç‡ä¼˜å…ˆçº§åˆ¤æ–­ã€æ‰€ä»¥åº”è¯¥æ˜¯æ²¡æœ‰ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687- (void)deleteOldFilesWithCompletionBlock:(nullable SDWebImageNoParamsBlock)completionBlock &#123; //å¼‚æ­¥æ¸…ç†è¶…æ—¶å›¾ç‰‡ dispatch_async(self.ioQueue, ^&#123; //è·å–ç£ç›˜ç›®å½• NSURL *diskCacheURL = [NSURL fileURLWithPath:self.diskCachePath isDirectory:YES]; //NSURLIsDirectoryKey åˆ¤æ–­æ˜¯å¦ä¸ºç›®å½• //NSURLContentModificationDateKey åˆ¤æ–­æœ€åä¿®æ”¹æ—¶é—´ //NSURLTotalFileAllocatedSizeKey åˆ¤æ–­æ–‡ä»¶å¤§å° NSArray&lt;NSString *&gt; *resourceKeys = @[NSURLIsDirectoryKey, NSURLContentModificationDateKey, NSURLTotalFileAllocatedSizeKey]; //æ¨¡å…·å™¨--éå†ç£ç›˜è·¯å¾„ä¸‹çš„æ–‡ä»¶ NSDirectoryEnumerator *fileEnumerator = [_fileManager enumeratorAtURL:diskCacheURL includingPropertiesForKeys:resourceKeys options:NSDirectoryEnumerationSkipsHiddenFiles errorHandler:NULL]; //è®¡ç®—ä¸€å‘¨å‰(éœ€è¦é‡Šæ”¾)ã€çš„æ—¶é—´ NSDate *expirationDate = [NSDate dateWithTimeIntervalSinceNow:-self.config.maxCacheAge]; //ä¿å­˜ç¼“å­˜æ–‡ä»¶Dic NSMutableDictionary&lt;NSURL *, NSDictionary&lt;NSString *, id&gt; *&gt; *cacheFiles = [NSMutableDictionary dictionary]; //ç¼“å­˜æ€»å¤§å° NSUInteger currentCacheSize = 0; //éœ€è¦åˆ é™¤çš„urlè·¯å¾„ NSMutableArray&lt;NSURL *&gt; *urlsToDelete = [[NSMutableArray alloc] init]; //éå†ç£ç›˜æ–‡ä»¶æšä¸¾å™¨ for (NSURL *fileURL in fileEnumerator) &#123; NSError *error; //è·å–æ¯ä¸ªæ–‡ä»¶æ‰€å¯¹åº”çš„ä¸‰ä¸ªå‚æ•°ï¼ˆresourceKeysï¼‰ NSDictionary&lt;NSString *, id&gt; *resourceValues = [fileURL resourceValuesForKeys:resourceKeys error:&amp;error]; // Skip directories and errors. if (error || !resourceValues || [resourceValues[NSURLIsDirectoryKey] boolValue]) &#123; //å¦‚æœæ˜¯æ–‡ä»¶å¤¹åˆ™è·³è¿‡ continue; &#125; // Remove files that are older than the expiration date; NSDate *modificationDate = resourceValues[NSURLContentModificationDateKey]; if ([[modificationDate laterDate:expirationDate] isEqualToDate:expirationDate]) &#123; //å¦‚æœæ—¶é—´è¶…è¿‡æŒ‡å®šæ—¥æœŸã€åŠ å…¥åˆ é™¤æ•°ç»„ã€‚è·³è¿‡ [urlsToDelete addObject:fileURL]; continue; &#125; //è·å–æ–‡ä»¶å¤§å°ã€å¹¶ä¸”æŠŠè·¯å¾„ä¸å¤§å°å­˜å…¥å­—å…¸ã€‚ // Store a reference to this file and account for its total size. NSNumber *totalAllocatedSize = resourceValues[NSURLTotalFileAllocatedSizeKey]; currentCacheSize += totalAllocatedSize.unsignedIntegerValue; cacheFiles[fileURL] = resourceValues; &#125; //éå†åˆ é™¤æ–‡ä»¶ for (NSURL *fileURL in urlsToDelete) &#123; [_fileManager removeItemAtURL:fileURL error:nil]; &#125; //å¦‚æœå‰©ä½™æ–‡ä»¶å¤§å°ä»è¶…è¿‡é˜ˆå€¼ //ä¼˜å…ˆåˆ é™¤æœ€è€çš„æ–‡ä»¶ if (self.config.maxCacheSize &gt; 0 &amp;&amp; currentCacheSize &gt; self.config.maxCacheSize) &#123; // Target half of our maximum cache size for this cleanup pass. const NSUInteger desiredCacheSize = self.config.maxCacheSize / 2; // å°†å‰©ä½™çš„æ–‡ä»¶æŒ‰ä¿®æ”¹æ—¶é—´æ’åº NSArray&lt;NSURL *&gt; *sortedFiles = [cacheFiles keysSortedByValueWithOptions:NSSortConcurrent usingComparator:^NSComparisonResult(id obj1, id obj2) &#123; return [obj1[NSURLContentModificationDateKey] compare:obj2[NSURLContentModificationDateKey]]; &#125;]; // åˆ é™¤æ–‡ä»¶ for (NSURL *fileURL in sortedFiles) &#123; if ([_fileManager removeItemAtURL:fileURL error:nil]) &#123; NSDictionary&lt;NSString *, id&gt; *resourceValues = cacheFiles[fileURL]; NSNumber *totalAllocatedSize = resourceValues[NSURLTotalFileAllocatedSizeKey]; currentCacheSize -= totalAllocatedSize.unsignedIntegerValue; //ç›´åˆ°ä½äºé˜ˆå€¼çš„äºŒåˆ†ä¹‹ä¸€ if (currentCacheSize &lt; desiredCacheSize) &#123; break; &#125; &#125; &#125; &#125; //å›è°ƒç»™ä¸»çº¿ç¨‹ if (completionBlock) &#123; dispatch_async(dispatch_get_main_queue(), ^&#123; completionBlock(); &#125;); &#125; &#125;);&#125; ä¸‹è½½å›¾ç‰‡æ—¶ã€ä¼šä½¿ç”¨ç½‘ç»œåè®®ç¼“å­˜é€»è¾‘ä¹ˆ? é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šã€ç”±ä»¥ä¸‹ä»£ç å¯è§ã€‚ 1234NSURLRequestCachePolicy cachePolicy = options &amp; SDWebImageDownloaderUseNSURLCache ? NSURLRequestUseProtocolCachePolicy : NSURLRequestReloadIgnoringLocalCacheData; NSMutableURLRequest *request = [[NSMutableURLRequest alloc] initWithURL:url cachePolicy:cachePolicy timeoutInterval:timeoutInterval]; é™¤éå°†optionsé…ç½®æˆSDWebImageDownloaderUseNSURLCacheã€å¦åˆ™æ¯æ¬¡éƒ½ä¼šä»åŸåœ°å€é‡æ–°ä¸‹è½½ã€è€Œä¸æ˜¯ç”¨ç½‘ç»œåè®®çš„ç¼“å­˜é€»è¾‘ã€‚ ä¸‹è½½å›¾ç‰‡çš„URLå¿…é¡»æ˜¯NSURLä¹ˆï¼Ÿ ä¸æ˜¯ã€åœ¨SDWebImageManagerä¸­æœ‰è¿‡å®¹é”™å¤„ç†ã€‚æ‰€ä»¥å³ä¾¿ä½ ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ã€ä¾æ—§å¯ä»¥æ­£ç¡®çš„æŸ¥æ‰¾ã€‚ 1234567if ([url isKindOfClass:NSString.class]) &#123; url = [NSURL URLWithString:(NSString *)url]; &#125; if (![url isKindOfClass:NSURL.class]) &#123; url = nil; &#125; ä½†æ˜¯ç”±äºAPIæš´éœ²å‡ºçš„æ˜¯(nullable NSURL *)ã€å¦‚æœä½ ä¼ å…¥å­—ç¬¦ä¸²ã€ä¼šæœ‰é»„è‰²è­¦å‘Š è¯»å–ç¼“å­˜ä»¥åŠè¯»å–ç£ç›˜çš„æ—¶å€™å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ è¯»å–ç¼“å­˜è¯»å–ç¼“å­˜çš„æ—¶å€™æ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡Œã€‚ç”±äºä½¿ç”¨NSCacheè¿›è¡Œå­˜å‚¨ã€æ‰€ä»¥ä¸éœ€è¦æ‹…å¿ƒå•ä¸ªvalueå¯¹è±¡çš„çº¿ç¨‹å®‰å…¨ã€‚ è¯»å–ç£ç›˜ç£ç›˜çš„è¯»å–è™½ç„¶åˆ›å»ºäº†ä¸€ä¸ªNSOperationå¯¹è±¡ã€ä½†æ®æˆ‘æ‰€è§è¿™ä¸ªå¯¹è±¡åªæ˜¯ç”¨æ¥æ ‡è®°è¯¥æ“ä½œæ˜¯å¦è¢«å–æ¶ˆã€ä»¥åŠå–æ¶ˆä¹‹åä¸å†è¯»å–ç£ç›˜æ–‡ä»¶çš„ä½œç”¨ã€‚çœŸæ­£çš„ç£ç›˜ç¼“å­˜æ˜¯åœ¨å¦ä¸€ä¸ªIOä¸“å±çº¿ç¨‹ä¸­çš„ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ä¸‹è¿›è¡Œçš„ã€‚å¦‚æœä½ æœç´¢self.ioQueueè¿˜èƒ½å‘ç°ã€ä¸åªæ˜¯è¯»å–ç£ç›˜å†…å®¹ã€‚åŒ…æ‹¬åˆ é™¤ã€å†™å…¥ç­‰æ‰€æœ‰ç£ç›˜å†…å®¹éƒ½æ˜¯åœ¨è¿™ä¸ªIOçº¿ç¨‹è¿›è¡Œã€ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ä½†è®¡ç®—å¤§å°ã€è·å–æ–‡ä»¶æ€»æ•°ç­‰æ“ä½œã€‚åˆ™æ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡Œã€‚ 12345678910111213141516171819202122232425262728_ioQueue = dispatch_queue_create(&quot;com.hackemist.SDWebImageCache&quot;, DISPATCH_QUEUE_SERIAL);==========&gt;&gt;&gt;&gt;&gt;&lt;&lt;&lt;&lt;&lt;&lt;===========NSOperation *operation = [NSOperation new]; dispatch_async(self.ioQueue, ^&#123; if (operation.isCancelled) &#123; // do not call the completion if cancelled return; &#125; @autoreleasepool &#123; //æœç´¢ç¡¬ç›˜ NSData *diskData = [self diskImageDataBySearchingAllPathsForKey:key]; UIImage *diskImage = [self diskImageForKey:key]; //ç¼“å­˜åˆ°å†…å­˜ã€é»˜è®¤ä¸ºYES if (diskImage &amp;&amp; self.config.shouldCacheImagesInMemory) &#123; NSUInteger cost = SDCacheCostForImage(diskImage); //ä½¿ç”¨NSChacheç¼“å­˜ã€‚ [self.memCache setObject:diskImage forKey:key cost:cost]; &#125; if (doneBlock) &#123; dispatch_async(dispatch_get_main_queue(), ^&#123; doneBlock(diskImage, diskData, SDImageCacheTypeDisk); &#125;); &#125; &#125; &#125;); return operation; ç›¸å…³çŸ¥è¯†ç‚¹å¦‚æœå¯¹ä¸€äº›çŸ¥è¯†ç‚¹ä¸äº†è§£ã€å¯èƒ½å¯¹ä»£ç ç†è§£é€ æˆå›°æ‰°ã€‚åˆ—ä¸¾ä¸€ä¸‹ã€‚ NS_OPTIONSæšä¸¾ä¸ä½è¿ç®— ä¸Šæ–‡ä¸­çš„SDWebImageOptionsä¾¿æ˜¯ä¸€ä¸ªä½ç§»æšä¸¾ 123456789101112131415typedef NS_OPTIONS(NSUInteger, SDWebImageOptions) &#123; SDWebImageRetryFailed = 1 &lt;&lt; 0, SDWebImageLowPriority = 1 &lt;&lt; 1, SDWebImageCacheMemoryOnly = 1 &lt;&lt; 2, SDWebImageProgressiveDownload = 1 &lt;&lt; 3, SDWebImageRefreshCached = 1 &lt;&lt; 4, SDWebImageContinueInBackground = 1 &lt;&lt; 5, SDWebImageHandleCookies = 1 &lt;&lt; 6, SDWebImageAllowInvalidSSLCertificates = 1 &lt;&lt; 7, SDWebImageHighPriority = 1 &lt;&lt; 8, SDWebImageDelayPlaceholder = 1 &lt;&lt; 9, SDWebImageTransformAnimatedImage = 1 &lt;&lt; 10, SDWebImageAvoidAutoSetImage = 1 &lt;&lt; 11, SDWebImageScaleDownLargeImages = 1 &lt;&lt; 12&#125;; å’Œæˆ‘ä»¬æ™®é€šç”¨çš„æšä¸¾ 12345typedef NS_ENUM(NSInteger, SDImageCacheType) &#123; SDImageCacheTypeNone, SDImageCacheTypeDisk, SDImageCacheTypeMemory&#125;; ä»è¡¨é¢çœ‹æœ‰ä¸¤ç‚¹ä¸åŒï¼š æšä¸¾å£°æ˜ï¼šNS_ENUM&amp;&amp; NS_OPTIONSå…¶å®ä»å®šä¹‰çš„æ•ˆæœä¸Šæ¥è®²ã€äºŒè€…ä½œç”¨ç›¸åŒã€‚æ›´å¤šçš„æ˜¯è¯­ä¹‰åŒ–çš„è§’åº¦ã€‚å‰è€…æ˜¯æ™®é€šæšä¸¾ã€åè€…æ˜¯ä½ç§»æšä¸¾ã€‚ æšä¸¾ä¸­çš„ä½è¿ç®—ç¬¦å·&lt;&lt;.ä½è¿ç®—ä¸­ã€æœ‰ä¸‰ç§åŸºæœ¬è¿ç®—ç¬¦å·. æŒ‰ä½ä¸â€&amp;â€ åªæœ‰å¯¹åº”çš„ä¸¤ä¸ªäºŒè¿›ä½å‡ä¸º1æ—¶ï¼Œç»“æœä½æ‰ä¸º1ï¼Œå¦åˆ™ä¸º0æ¯”å¦‚9&amp;5ï¼Œå…¶å®å°±æ˜¯1001&amp;0101=0001ï¼Œå› æ­¤9&amp;5=1&gt;äºŒè¿›åˆ¶ä¸­ï¼Œä¸1ç›¸&amp;å°±ä¿æŒåŸä½ï¼Œä¸0ç›¸&amp;å°±ä¸º0 æŒ‰ä½æˆ–â€|â€ åªè¦å¯¹åº”çš„äºŒä¸ªäºŒè¿›ä½æœ‰ä¸€ä¸ªä¸º1æ—¶ï¼Œç»“æœä½å°±ä¸º1ï¼Œå¦åˆ™ä¸º0ã€‚æ¯”å¦‚9|5ï¼Œå…¶å®å°±æ˜¯1001|0101=1101ï¼Œå› æ­¤9|5=13 å·¦ç§»â€&lt;&lt;â€ æŠŠæ•´æ•°açš„å„äºŒè¿›ä½å…¨éƒ¨å·¦ç§»nä½ï¼Œé«˜ä½ä¸¢å¼ƒï¼Œä½ä½è¡¥0ã€‚å·¦ç§»nä½å…¶å®å°±æ˜¯ä¹˜ä»¥2çš„næ¬¡æ–¹ã€‚ä¾‹å¦‚1&lt;&lt;2 å°±æ˜¯0001å·¦ç§»2ä¸º0100ï¼Œå› æ­¤1&lt;&lt;2=4 äºæ˜¯ã€åœ¨ä½¿ç”¨ä½ç§»æšä¸¾çš„æ—¶å€™ã€æˆ‘ä»¬å°±æœ‰äº†è¿™ç§å†™æ³•ï¼š1options:SDWebImageRetryFailed | SDWebImageCacheMemoryOnly]; ä¸Šé¢çš„æ„æ€æ˜¯ã€‚è¿™ä¸ªæ“ä½œæ˜¯å¦‚æœå¤±è´¥äº†éœ€è¦é‡è¯•ã€å¹¶ä¸”åªå†™å…¥ç¼“å­˜ã€‚å…¶ä¸­ options=SDWebImageRetryFailed | SDWebImageCacheMemoryOnlyä¹Ÿå°±æ˜¯0b00000001| 0b00000100 = 0b00000101 åè¿›åˆ¶ä¸­ = 5. åœ¨å†…éƒ¨åˆ¤æ–­æ—¶å€™å°±æœ‰äº†å¦‚ä¸‹å†™æ³•ï¼š12//æ˜¯å¦ç£ç›˜ç¼“å­˜BOOL cacheOnDisk = !(options &amp; SDWebImageCacheMemoryOnly); ç­‰ä»·äº 0101 &amp; 0100 = 0100 ç»“æœä¸ºçœŸã€‚å€˜è‹¥ 1BOOL lowPriority = !(options &amp; SDWebImageLowPriority); ç­‰ä»·äº 0101 &amp; 0010 = 0000 ç»“æœä¸ºå‡ã€‚ å†…è”å‡½æ•° åœ¨å†™å…¥ç¼“å­˜æ—¶ã€å‡ºç°äº†è¿™æ ·ä¸€è¡Œä»£ç  12NSUInteger cost = SDCacheCostForImage(diskImage);[self.memCache setObject:diskImage forKey:key cost:cost]; å…¶ä¸­SDCacheCostForImageæŒ‡å‘ä¸€ä¸ªé™æ€å†…è”å‡½æ•° 1234567FOUNDATION_STATIC_INLINE NSUInteger SDCacheCostForImage(UIImage *image) &#123;#if SD_MAC return image.size.height * image.size.width;#elif SD_UIKIT || SD_WATCH return image.size.height * image.size.width * image.scale * image.scale;#endif&#125; å…¶ä¸­FOUNDATION_STATIC_INLINEä½œä¸ºå®æŒ‡å‘static inlineã€æ‰€ä»¥ä¹Ÿç­‰ä»·äº 1234567static __inline__ NSUInteger SDCacheCostForImage(UIImage *image) &#123;#if SD_MAC return image.size.height * image.size.width;#elif SD_UIKIT || SD_WATCH return image.size.height * image.size.width * image.scale * image.scale;#endif&#125; ç”¨å®å†™æ–¹æ³•ã€æˆ‘ä»¬éƒ½ç”¨è¿‡ã€‚ä½†æ˜¯è¡¨è¾¾å¼å½¢å¼çš„å®å®šä¹‰æœ‰ä¸€å®šçš„å¼Šç«¯ã€‚ï¼ˆæ¯”å¦‚å‚æ•°æ£€æŸ¥ã€è¶Šç•Œç­‰ç­‰ï¼‰ã€‚ å†…è”å‡½æ•°å®Œå…¨å¯ä»¥å–ä»£è¡¨è¾¾å¼å½¢å¼çš„å®å®šä¹‰ã€‚é¡ºä¾¿è°ˆè°ˆä¸ºä»€ä¹ˆè¦ç”¨å†…è”å‡½æ•°å§ã€‚ æ•ˆç‡æ¥çœ‹ å‡½æ•°ä¹‹é—´è°ƒç”¨ï¼Œæ˜¯å†…å­˜åœ°å€ä¹‹é—´çš„è°ƒç”¨ã€å½“å‡½æ•°è°ƒç”¨å®Œæ¯•ä¹‹åè¿˜ä¼šè¿”å›åŸæ¥å‡½æ•°æ‰§è¡Œçš„åœ°å€ã€‚å‡½æ•°è°ƒç”¨å°†ä¼šæœ‰æ—¶é—´å¼€é”€ã€‚ å†…è”å‡½æ•°åœ¨æ±‡ç¼–ä¸­æ²¡æœ‰callè¯­å¥ã€‚å–æ¶ˆäº†å‡½æ•°çš„å‚æ•°å‹æ ˆ ç›¸æ¯”è¡¨è¾¾å¼å½¢å¼çš„å®å®šä¹‰ éœ€è¦é¢„ç¼–è¯‘.å› ä¸ºinlineå†…è”å‡½æ•°ä¹Ÿæ˜¯å‡½æ•°ã€ä¸éœ€è¦é¢„ç¼–è¯‘ã€‚ è°ƒç”¨æ—¶å€™ä¼šé¦–å…ˆæ£€æŸ¥å®ƒçš„å‚æ•°çš„ç±»å‹ã€ä¿è¯è°ƒç”¨æ­£ç¡®ã€‚ å¯ä»¥ä½¿ç”¨æ‰€åœ¨ç±»çš„ä¿æŠ¤æˆå‘˜åŠç§æœ‰æˆå‘˜ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ å†…è”å‡½æ•°ä¸­å°½é‡ä¸è¦ä½¿ç”¨è¯¸å¦‚å¾ªç¯è¯­å¥ç­‰å¤§é‡ä»£ç ã€å¯èƒ½ä¼šå¯¼è‡´ç¼–è¯‘å™¨æ”¾å¼ƒå†…è”åŠ¨ä½œã€‚ å†…è”å‡½æ•°çš„å®šä¹‰é¡»åœ¨è°ƒç”¨ä¹‹å‰ã€‚ å‡†å¤‡å·¥ä½œéšæ‰‹ä¸‹è½½äº†ä¸€ä¸ªæœ€æ–°çš„ (4.2.3) GitHub1234567891011121314PODS:- SDWebImage (4.2.3):- SDWebImage/Core (= 4.2.3)- SDWebImage/Core (4.2.3)DEPENDENCIES:- SDWebImageSPEC CHECKSUMS:SDWebImage: 791bb72962b3492327ddcac4b1880bd1b5458431PODFILE CHECKSUM: 7fbc0b76fb4d0b0b2afa7d3a90b7bd68dea25abbCOCOAPODS: 1.3.1 å·¥ä½œåŸç†å¼•ç”¨GitHubä¸Šä¸€ä¸ªå¯¼å›¾ 1ã€å¤–éƒ¨APIå…¥å£ã€‚é€šè¿‡UIImageView+WebCache çš„ sd_setImageWithURLæ–¹æ³•(ç­‰)ä½œä¸ºå…¥å£æ¥åŠ è½½å›¾ç‰‡ã€‚ 2ã€å†…éƒ¨APIæ±‡æ€»ã€‚é€šè¿‡UIView+WebCacheçš„â€™sd_internalSetImageWithURLâ€™å¯¹UIImageViewã€UIButton ã€MKAnnotationViewä¸­å›¾ç‰‡çš„ä¸‹è½½è¯·æ±‚è¿›è¡Œæ±‡æ€»ã€‚ 3ã€å¼€å§‹åŠ è½½å›¾ç‰‡ã€‚é€šè¿‡SDWebImageManagerçš„loadImageWithURLå¯¹å›¾ç‰‡è¿›è¡ŒåŠ è½½ã€‚ 4ã€æŸ¥æ‰¾æœ¬åœ°é€šè¿‡SDImageCacheçš„queryCacheOperationForKeyæŸ¥æ‰¾ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨å›¾ç‰‡ã€‚å¦‚æœä¸å­˜åœ¨å†é€šè¿‡diskImageDataBySearchingAllPathsForKeyè¿›è¡Œç£ç›˜æœç´¢ã€‚ 5ã€è¿”å›æœ¬åœ°å›¾ç‰‡ç»™SDWebImageManager 6ã€ä¸‹è½½å›¾ç‰‡å¦‚æœæœ¬åœ°æŸ¥è¯¢ä¸åˆ°å¯¹åº”å›¾ç‰‡ã€åˆ™é€šè¿‡SDImageDownloaderçš„downloadImageè¿›è¡Œå›¾ç‰‡ä¸‹è½½ã€‚ 7ã€ä¸‹è½½å®Œæ¯•è¿”å›å›¾ç‰‡ç»™SDWebImageManager 8ã€ç”±UIView+WebCacheé€šè¿‡storeImageå°†ä¸‹è½½å›¾ç‰‡ä¿å­˜æœ¬åœ° 9ã€è¿”å›å›¾ç‰‡ç»™UIView+WebCache 10ã€è®¾ç½®å›¾ç‰‡å…¶ä¸­ã€‚ ä¸šåŠ¡å±‚çº§ æ•´ä¸ªæ¶æ„ç®€å•åˆ†ä¸ºä¸‰å±‚ã€‚ æœ€ä¸Šå±‚ï¼šè´Ÿè´£ä¸šåŠ¡çš„æ¥å…¥ã€å›¾ç‰‡çš„æ’å…¥ 12345#import &quot;UIImageView+WebCache.h&quot;#import &quot;UIButton+WebCache.h&quot;#import &quot;UIImageView+HighlightedWebCache.h&quot;//ä»¥åŠå…¶æ±‡æ€»çš„#import &quot;UIView+WebCache.h&quot; é€»è¾‘å±‚è´Ÿè´£ä¸åŒç±»å‹ä¸šåŠ¡çš„åˆ†å‘ã€‚è¯»å–(æˆ–å†™å…¥)ç¼“å­˜(æˆ–ç£ç›˜)ã€ä¸‹è½½ç­‰å…·ä½“é€»è¾‘å¤„ç†ã€‚ 1#import &quot;SDWebImageManager.h&quot; ä¸šåŠ¡å±‚è´Ÿè´£å…·ä½“ä¸šåŠ¡çš„å®ç° 1234//ç¼“å­˜&amp;&amp;ç£ç›˜æ“ä½œ#import &quot;SDImageCache.h&quot;//ä¸‹è½½æ“ä½œ#import &quot;SDWebImageDownloader.h&quot; å½“ç„¶ã€è¿˜æœ‰å…¶ä»–çš„å·¥å…·ç±»ã€‚ä½†ä¸»è¦çš„ã€å°±æ˜¯ä¸Šé¢å‡ ä¸ªã€‚ æ ¸å¿ƒä»£ç ï¼ˆæ­£å¸¸è¯»å–ä¸‹è½½å›¾ç‰‡ï¼‰ æœ€ä¸Šå±‚ï¼šUIView+WebCache æ‰€æœ‰çš„ä»£ç æœ€ç»ˆéƒ½ä¼šæ±‡æ€»åˆ° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131#import &quot;UIView+WebCache.h&quot;/** * @param url å›¾ç‰‡åœ°å€é“¾æ¥ * @param placeholder å ä½å›¾ * @param options ä¸‹è½½å›¾ç‰‡çš„æšä¸¾ã€‚åŒ…æ‹¬ä¼˜å…ˆçº§ã€æ˜¯å¦å†™å…¥ç¡¬ç›˜ç­‰ * @param operationKey ä¸€ä¸ªè®°å½•å½“å‰å¯¹è±¡æ­£åœ¨åŠ è½½æ“ä½œçš„keyã€ä¿è¯åªæœ‰æœ€æ–°çš„æ“ä½œåœ¨è¿›è¡Œã€é»˜è®¤ä¸ºç±»åã€‚ æ‰€ä»¥å¦‚æœä½ æƒ³ä¸‹è½½å¤šä¸ªå›¾ç‰‡å¹¶ä¸”éƒ½å±•ç¤ºä¸€ä¸‹ã€å¯ä»¥å°è¯•è‡ªå®šä¹‰å‡ ä¸ªoperationKeyæ¥æ“ä½œã€‚ï¼ˆæˆ‘çŒœï¼‰ * @param setImageBlock ç»™å¼€å‘è€…è‡ªå®šä¹‰setå›¾ç‰‡çš„callback * @param progressBlock ä¸‹è½½è¿›åº¦callback * @param completedBlock ä¸‹è½½å®Œæˆçš„callbackï¼ˆsdå·²ç»ç»™ä½ setå¥½äº†ã€åªæ˜¯ä¼šæŠŠå›¾ç‰‡ç»™ä½ ç½¢äº†ï¼‰ * @param context ä¸€äº›é¢å¤–çš„ä¸Šä¸‹æ–‡å­—å…¸ã€‚æ¯”å¦‚ä½ å¯ä»¥æä¸€ä¸ªä¸“å±çš„imageManagerè¿›æ¥å¹²æ´»ã€‚ */- (void)sd_internalSetImageWithURL:(nullable NSURL *)url placeholderImage:(nullable UIImage *)placeholder options:(SDWebImageOptions)options operationKey:(nullable NSString *)operationKey setImageBlock:(nullable SDSetImageBlock)setImageBlock progress:(nullable SDWebImageDownloaderProgressBlock)progressBlock completed:(nullable SDExternalCompletionBlock)completedBlock context:(nullable NSDictionary *)context &#123; //ä»¥å½“å‰å®ä¾‹çš„classä½œä¸ºOperationKey NSString *validOperationKey = operationKey ?: NSStringFromClass([self class]); //æ¸…é™¤å½“å‰OperationKeyä¸‹æ­£åœ¨è¿›è¡Œçš„æ“ä½œã€‚èŠ‚çœæ— ç”¨åŠŸ [self sd_cancelImageLoadOperationWithKey:validOperationKey]; //ç»™å¯¹è±¡å®ä¾‹ç»‘å®šimageURLKey = url objc_setAssociatedObject(self, &amp;imageURLKey, url, OBJC_ASSOCIATION_RETAIN_NONATOMIC); //æ˜¯å¦å…ˆåŠ è½½å ä½å›¾ if (!(options &amp; SDWebImageDelayPlaceholder)) &#123; if ([context valueForKey:SDWebImageInternalSetImageGroupKey]) &#123; dispatch_group_t group = [context valueForKey:SDWebImageInternalSetImageGroupKey]; dispatch_group_enter(group); &#125; //åˆ°ä¸»çº¿åŸæ›´æ–°UI dispatch_main_async_safe(^&#123; //set å ä½å›¾ [self sd_setImage:placeholder imageData:nil basedOnClassOrViaCustomSetImageBlock:setImageBlock]; &#125;); &#125; if (url) &#123; // å°èŠèŠ± if ([self sd_showActivityIndicatorView]) &#123; [self sd_addActivityIndicator]; &#125; // å…è®¸å¼€å‘è€…æŒ‡å®šä¸€ä¸ªmanageræ¥è¿›è¡Œæ“ä½œ SDWebImageManager *manager; if ([context valueForKey:SDWebImageExternalCustomManagerKey]) &#123; manager = (SDWebImageManager *)[context valueForKey:SDWebImageExternalCustomManagerKey]; &#125; else &#123; manager = [SDWebImageManager sharedManager]; &#125; __weak __typeof(self)wself = self; id &lt;SDWebImageOperation&gt; operation = [manager loadImageWithURL:url options:options progress:progressBlock completed:^(UIImage *image, NSData *data, NSError *error, SDImageCacheType cacheType, BOOL finished, NSURL *imageURL) &#123; //å›¾ç‰‡ä¸‹è½½||è¯»å–å®Œæˆ __strong __typeof (wself) sself = wself; //å°èŠèŠ± [sself sd_removeActivityIndicator]; if (!sself) &#123; return; &#125; BOOL shouldCallCompletedBlock = finished || (options &amp; SDWebImageAvoidAutoSetImage); //æ˜¯å¦ä¸æ’å…¥å›¾ç‰‡ //1ã€æœ‰å›¾ç‰‡ã€ä½†æ˜¯ä¸»åŠ¨é…ç½® //2ã€æ²¡å›¾ç‰‡ã€è®¾ç½®äº†å»¶è¿ŸåŠ è½½å ä½å›¾ BOOL shouldNotSetImage = ((image &amp;&amp; (options &amp; SDWebImageAvoidAutoSetImage)) || (!image &amp;&amp; !(options &amp; SDWebImageDelayPlaceholder))); SDWebImageNoParamsBlock callCompletedBlockClojure = ^&#123; // if (!sself) &#123; return; &#125; if (!shouldNotSetImage) &#123; [sself sd_setNeedsLayout]; &#125; if (completedBlock &amp;&amp; shouldCallCompletedBlock) &#123; //æ“ä½œå®Œæˆçš„å›è°ƒ completedBlock(image, error, cacheType, url); &#125; &#125;; // case 1a: we got an image, but the SDWebImageAvoidAutoSetImage flag is set // OR // case 1b: we got no image and the SDWebImageDelayPlaceholder is not set if (shouldNotSetImage) &#123; //å¦‚æœä¸æ˜¾ç¤ºå›¾ç‰‡ã€ç›´æ¥å›è°ƒã€‚ dispatch_main_async_safe(callCompletedBlockClojure); return; &#125; /**è‡ªåŠ¨æ’å…¥å›¾ç‰‡***/ UIImage *targetImage = nil; NSData *targetData = nil; if (image) &#123; // case 2a: we got an image and the SDWebImageAvoidAutoSetImage is not set targetImage = image; targetData = data; &#125; else if (options &amp; SDWebImageDelayPlaceholder) &#123; // case 2b: we got no image and the SDWebImageDelayPlaceholder flag is set targetImage = placeholder; targetData = nil; &#125; if ([context valueForKey:SDWebImageInternalSetImageGroupKey]) &#123; dispatch_group_t group = [context valueForKey:SDWebImageInternalSetImageGroupKey]; dispatch_group_enter(group); dispatch_main_async_safe(^&#123; [sself sd_setImage:targetImage imageData:targetData basedOnClassOrViaCustomSetImageBlock:setImageBlock]; &#125;); // ensure completion block is called after custom setImage process finish dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123; callCompletedBlockClojure(); &#125;); &#125; else &#123; dispatch_main_async_safe(^&#123; [sself sd_setImage:targetImage imageData:targetData basedOnClassOrViaCustomSetImageBlock:setImageBlock]; callCompletedBlockClojure(); &#125;); &#125; &#125;]; //åœ¨è¯»å–å›¾ç‰‡ä¹‹å‰ã€‚å‘æ­£åœ¨è¿›è¡ŒåŠ è½½çš„HashMapä¸­åŠ å…¥å½“å‰operation [self sd_setImageLoadOperation:operation forKey:validOperationKey]; &#125; else &#123; dispatch_main_async_safe(^&#123; [self sd_removeActivityIndicator]; if (completedBlock) &#123; NSError *error = [NSError errorWithDomain:SDWebImageErrorDomain code:-1 userInfo:@&#123;NSLocalizedDescriptionKey : @&quot;Trying to load a nil url&quot;&#125;]; completedBlock(nil, error, SDImageCacheTypeNone, url); &#125; &#125;); &#125;&#125; ä¸€ä¸ªç®€å•çš„æµç¨‹å›¾ UIView+WebCacheæµç¨‹å›¾ é€»è¾‘å±‚ï¼šSDWebImageManager SDWebImageä¸­æœ€æ ¸å¿ƒçš„ç±»ã€è°ƒåº¦è¿™å›¾ç‰‡çš„ä¸‹è½½(SDWebImageDownloader)ä»¥åŠç¼“å­˜(SDImageCache)ã€‚ æ­¤å¤–ã€SDWebImageManagerå¹¶ä¸ä¾æ‰˜äºUIView+WebCacheã€å®Œå…¨å¯ä»¥å•ç‹¬ä½¿ç”¨ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169- (id &lt;SDWebImageOperation&gt;)loadImageWithURL:(nullable NSURL *)url options:(SDWebImageOptions)options progress:(nullable SDWebImageDownloaderProgressBlock)progressBlock completed:(nullable SDInternalCompletionBlock)completedBlock &#123; NSAssert(completedBlock != nil, @&quot;If you mean to prefetch the image, use -[SDWebImagePrefetcher prefetchURLs] instead&quot;); //æ‰€ä»¥ã€æˆ‘ä»¬å¹¶ä¸éœ€è¦åœ¨å¤–éƒ¨æŠŠå­—ç¬¦ä¸²å˜ä¸ºNSURLã€‚ if ([url isKindOfClass:NSString.class]) &#123; url = [NSURL URLWithString:(NSString *)url]; &#125; if (![url isKindOfClass:NSURL.class]) &#123; url = nil; &#125; //ä¸‹è½½æ“ä½œçš„å¯¹è±¡ __block SDWebImageCombinedOperation *operation = [SDWebImageCombinedOperation new]; __weak SDWebImageCombinedOperation *weakOperation = operation; BOOL isFailedUrl = NO; if (url) &#123; @synchronized (self.failedURLs) &#123; //çº¿ç¨‹å®‰å…¨ isFailedUrl = [self.failedURLs containsObject:url]; &#125; &#125; //urlä¸ºç©º || (æœªè®¾ç½®å¤±è´¥é‡è¯• &amp;&amp; è¿™ä¸ªurlå·²ç»å¤±è´¥è¿‡) if (url.absoluteString.length == 0 || (!(options &amp; SDWebImageRetryFailed) &amp;&amp; isFailedUrl)) &#123; //å‘å‡ºä¸€ä¸ªè·å–å¤±è´¥çš„å›è°ƒ [self callCompletionBlockForOperation:operation completion:completedBlock error:[NSError errorWithDomain:NSURLErrorDomain code:NSURLErrorFileDoesNotExist userInfo:nil] url:url]; return operation; &#125; //å°†æ“ä½œæ·»åŠ åˆ°æ­£åœ¨è¿›è¡Œçš„æ“ä½œæ•°æ±  @synchronized (self.runningOperations) &#123; [self.runningOperations addObject:operation]; &#125; //é»˜è®¤å°±æ˜¯urlä½œä¸ºkeyã€ä¹Ÿå¯ä»¥è‡ªå®šä¹‰manangerçš„ç›¸å…³block NSString *key = [self cacheKeyForURL:url]; //é€šè¿‡keyã€æŸ¥æ‰¾æœ¬åœ°å›¾ç‰‡ operation.cacheOperation = [self.imageCache queryCacheOperationForKey:key done:^(UIImage *cachedImage, NSData *cachedData, SDImageCacheType cacheType) &#123; if (operation.isCancelled) &#123; //æ“ä½œè¢«å–æ¶ˆã€ç§»é™¤æ“ä½œæ±  [self safelyRemoveOperationFromRunning:operation]; return; &#125; //æœ¬åœ°æ²¡æœ‰å›¾ç‰‡ || åˆ·æ–°ç¼“å­˜ if ((!cachedImage || options &amp; SDWebImageRefreshCached) &amp;&amp; (![self.delegate respondsToSelector:@selector(imageManager:shouldDownloadImageForURL:)] || [self.delegate imageManager:self shouldDownloadImageForURL:url])) &#123; //æœ‰æœ¬åœ°å›¾ç‰‡ã€‚ä½†éœ€è¦è¢«åˆ·æ–° if (cachedImage &amp;&amp; options &amp; SDWebImageRefreshCached) &#123; //å…ˆå›è°ƒå‡ºå»æœ¬åœ°å›¾ç‰‡ã€‚å†ç»§ç»­ä¸‹è½½æ“ä½œ [self callCompletionBlockForOperation:weakOperation completion:completedBlock image:cachedImage data:cachedData error:nil cacheType:cacheType finished:YES url:url]; &#125; //ä¸‹é¢æ˜¯æ ¹æ®è°ƒç”¨è€…ä¼ è¿›æ¥çš„optionï¼Œæ¥åŒ¹é…è®¾ç½®äº†å“ªäº›ï¼Œå°±ç»™downloaderOptionsèµ‹å€¼å“ªäº›option SDWebImageDownloaderOptions downloaderOptions = 0; if (options &amp; SDWebImageLowPriority) downloaderOptions |= SDWebImageDownloaderLowPriority; if (options &amp; SDWebImageProgressiveDownload) downloaderOptions |= SDWebImageDownloaderProgressiveDownload; if (options &amp; SDWebImageRefreshCached) downloaderOptions |= SDWebImageDownloaderUseNSURLCache; if (options &amp; SDWebImageContinueInBackground) downloaderOptions |= SDWebImageDownloaderContinueInBackground; if (options &amp; SDWebImageHandleCookies) downloaderOptions |= SDWebImageDownloaderHandleCookies; if (options &amp; SDWebImageAllowInvalidSSLCertificates) downloaderOptions |= SDWebImageDownloaderAllowInvalidSSLCertificates; if (options &amp; SDWebImageHighPriority) downloaderOptions |= SDWebImageDownloaderHighPriority; if (options &amp; SDWebImageScaleDownLargeImages) downloaderOptions |= SDWebImageDownloaderScaleDownLargeImages; if (cachedImage &amp;&amp; options &amp; SDWebImageRefreshCached) &#123; // force progressive off if image already cached but forced refreshing downloaderOptions &amp;= ~SDWebImageDownloaderProgressiveDownload; // ignore image read from NSURLCache if image if cached but force refreshing downloaderOptions |= SDWebImageDownloaderIgnoreCachedResponse; &#125; //ä¸‹è½½å›¾ç‰‡ SDWebImageDownloadToken *subOperationToken = [self.imageDownloader downloadImageWithURL:url options:downloaderOptions progress:progressBlock completed:^(UIImage *downloadedImage, NSData *downloadedData, NSError *error, BOOL finished) &#123; __strong __typeof(weakOperation) strongOperation = weakOperation; if (!strongOperation || strongOperation.isCancelled) &#123; // Do nothing if the operation was cancelled // See #699 for more details // if we would call the completedBlock, there could be a race condition between this block and another completedBlock for the same object, so if this one is called second, we will overwrite the new data &#125; else if (error) &#123; [self callCompletionBlockForOperation:strongOperation completion:completedBlock error:error url:url]; if ( error.code != NSURLErrorNotConnectedToInternet &amp;&amp; error.code != NSURLErrorCancelled &amp;&amp; error.code != NSURLErrorTimedOut &amp;&amp; error.code != NSURLErrorInternationalRoamingOff &amp;&amp; error.code != NSURLErrorDataNotAllowed &amp;&amp; error.code != NSURLErrorCannotFindHost &amp;&amp; error.code != NSURLErrorCannotConnectToHost &amp;&amp; error.code != NSURLErrorNetworkConnectionLost) &#123; @synchronized (self.failedURLs) &#123; //å¤±è´¥è®°å½• [self.failedURLs addObject:url]; &#125; &#125; &#125; else &#123; if ((options &amp; SDWebImageRetryFailed)) &#123; //å¤±è´¥é‡æ–°ä¸‹è½½ @synchronized (self.failedURLs) &#123; //ä»å¤±è´¥è®°å½•ç§»é™¤ [self.failedURLs removeObject:url]; &#125; &#125; //æ˜¯å¦ç£ç›˜ç¼“å­˜ BOOL cacheOnDisk = !(options &amp; SDWebImageCacheMemoryOnly); if (self != [SDWebImageManager sharedManager] &amp;&amp; self.cacheKeyFilter &amp;&amp; downloadedImage) &#123; //ç¼©æ”¾ downloadedImage = [self scaledImageForKey:key image:downloadedImage]; &#125; if (options &amp; SDWebImageRefreshCached &amp;&amp; cachedImage &amp;&amp; !downloadedImage) &#123; //æ˜¯å¦éœ€è¦è½¬æ¢å›¾ç‰‡ //æˆåŠŸä¸‹è½½å›¾ç‰‡ã€è‡ªå®šä¹‰å®ç°äº†å›¾ç‰‡å¤„ç†çš„ä»£ç† &#125; else if (downloadedImage &amp;&amp; (!downloadedImage.images || (options &amp; SDWebImageTransformAnimatedImage)) &amp;&amp; [self.delegate respondsToSelector:@selector(imageManager:transformDownloadedImage:withURL:)]) &#123; dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^&#123; //è·å–è½¬æ¢ç”¨æˆ·åçš„å›¾ç‰‡ UIImage *transformedImage = [self.delegate imageManager:self transformDownloadedImage:downloadedImage withURL:url]; //ç”¨æˆ·å¤„ç†æˆåŠŸ if (transformedImage &amp;&amp; finished) &#123; BOOL imageWasTransformed = ![transformedImage isEqual:downloadedImage]; //ç”¨æˆ·å¤„ç†çš„åè‹¥æœªç”Ÿæˆæ–°çš„å›¾ç‰‡ã€åˆ™ä¿å­˜ä¸‹è½½çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ //ä¸ç„¶åˆ™ç”±imageCacheå†…éƒ¨ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ä¿å­˜ [self.imageCache storeImage:transformedImage imageData:(imageWasTransformed ? nil : downloadedData) forKey:key toDisk:cacheOnDisk completion:nil]; &#125; //å›è°ƒ [self callCompletionBlockForOperation:strongOperation completion:completedBlock image:transformedImage data:downloadedData error:nil cacheType:SDImageCacheTypeNone finished:finished url:url]; &#125;); &#125; else &#123; //ä¸‹è½½æˆåŠŸä¸”æœªè‡ªå®šä¹‰ä»£ç†--é»˜è®¤ä¿å­˜ if (downloadedImage &amp;&amp; finished) &#123; [self.imageCache storeImage:downloadedImage imageData:downloadedData forKey:key toDisk:cacheOnDisk completion:nil]; &#125; [self callCompletionBlockForOperation:strongOperation completion:completedBlock image:downloadedImage data:downloadedData error:nil cacheType:SDImageCacheTypeNone finished:finished url:url]; &#125; &#125; if (finished) &#123; [self safelyRemoveOperationFromRunning:strongOperation]; &#125; &#125;]; @synchronized(operation) &#123; operation.cancelBlock = ^&#123; [self.imageDownloader cancel:subOperationToken]; __strong __typeof(weakOperation) strongOperation = weakOperation; [self safelyRemoveOperationFromRunning:strongOperation]; &#125;; &#125; &#125; else if (cachedImage) &#123; //æœ¬åœ°æœ‰å›¾ç‰‡--å›è°ƒã€å…³é—­å½“å‰æ“ä½œ __strong __typeof(weakOperation) strongOperation = weakOperation; [self callCompletionBlockForOperation:strongOperation completion:completedBlock image:cachedImage data:cachedData error:nil cacheType:cacheType finished:YES url:url]; [self safelyRemoveOperationFromRunning:operation]; &#125; else &#123; //æœ¬åœ°æ²¡æœ‰ã€ä¹Ÿä¸ä¸‹è½½--å›è°ƒã€å…³é—­å½“å‰æ“ä½œ __strong __typeof(weakOperation) strongOperation = weakOperation; [self callCompletionBlockForOperation:strongOperation completion:completedBlock image:nil data:nil error:nil cacheType:SDImageCacheTypeNone finished:YES url:url]; [self safelyRemoveOperationFromRunning:operation]; &#125; &#125;]; return operation;&#125; SDWebImageManageræµç¨‹å›¾ ä¸šåŠ¡å±‚: ç¼“å­˜&amp;&amp;ç£ç›˜æ“ä½œ(SDImageCache)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146- (nullable NSOperation *)queryCacheOperationForKey:(nullable NSString *)key done:(nullable SDCacheQueryCompletedBlock)doneBlock &#123; if (!key) &#123; if (doneBlock) &#123; doneBlock(nil, nil, SDImageCacheTypeNone); &#125; return nil; &#125; // First check the in-memory cache... //æœç´¢ç£ç›˜ç¼“å­˜ UIImage *image = [self imageFromMemoryCacheForKey:key]; if (image) &#123; NSData *diskData = nil; if (image.images) &#123; diskData = [self diskImageDataBySearchingAllPathsForKey:key]; &#125; if (doneBlock) &#123; doneBlock(image, diskData, SDImageCacheTypeMemory); &#125; return nil; &#125; NSOperation *operation = [NSOperation new]; dispatch_async(self.ioQueue, ^&#123; if (operation.isCancelled) &#123; // do not call the completion if cancelled return; &#125; @autoreleasepool &#123; //æœç´¢ç¡¬ç›˜ NSData *diskData = [self diskImageDataBySearchingAllPathsForKey:key]; UIImage *diskImage = [self diskImageForKey:key]; //ç¼“å­˜åˆ°å†…å­˜ã€é»˜è®¤ä¸ºYES if (diskImage &amp;&amp; self.config.shouldCacheImagesInMemory) &#123; NSUInteger cost = SDCacheCostForImage(diskImage); //ä½¿ç”¨NSChacheç¼“å­˜ã€‚ [self.memCache setObject:diskImage forKey:key cost:cost]; &#125; if (doneBlock) &#123; dispatch_async(dispatch_get_main_queue(), ^&#123; doneBlock(diskImage, diskData, SDImageCacheTypeDisk); &#125;); &#125; &#125; &#125;); return operation;&#125;//æŸ¥è¯¢ç¼“å­˜- (nullable UIImage *)imageFromMemoryCacheForKey:(nullable NSString *)key &#123; //self.memCache ä¸ºNSCacheå®ä¾‹ return [self.memCache objectForKey:key];&#125;//æŸ¥è¯¢ç£ç›˜- (nullable UIImage *)diskImageForKey:(nullable NSString *)key &#123; NSData *data = [self diskImageDataBySearchingAllPathsForKey:key]; if (data) &#123; //å›¾ç‰‡è§£ç ã€è°ƒæ•´æ–¹å‘ UIImage *image = [[SDWebImageCodersManager sharedInstance] decodedImageWithData:data]; //è°ƒæ•´å›¾ç‰‡ç¼©æ”¾æ¯”ä¾‹ @2x/@3x image = [self scaledImageForKey:key image:image]; //å‹ç¼©å›¾ç‰‡ if (self.config.shouldDecompressImages) &#123; image = [[SDWebImageCodersManager sharedInstance] decompressedImageWithImage:image data:&amp;data options:@&#123;SDWebImageCoderScaleDownLargeImagesKey: @(NO)&#125;]; &#125; return image; &#125; else &#123; return nil; &#125;&#125;//å†™å…¥ç¼“å­˜ &amp;&amp; ç£ç›˜- (void)storeImage:(nullable UIImage *)image imageData:(nullable NSData *)imageData forKey:(nullable NSString *)key toDisk:(BOOL)toDisk completion:(nullable SDWebImageNoParamsBlock)completionBlock &#123; if (!image || !key) &#123; if (completionBlock) &#123; completionBlock(); &#125; return; &#125; // if memory cache is enabled if (self.config.shouldCacheImagesInMemory) &#123; //å†™å…¥ç¼“å­˜ NSUInteger cost = SDCacheCostForImage(image); [self.memCache setObject:image forKey:key cost:cost]; &#125; if (toDisk) &#123; //å†™å…¥ç£ç›˜ dispatch_async(self.ioQueue, ^&#123; @autoreleasepool &#123; NSData *data = imageData; if (!data &amp;&amp; image) &#123; // If we do not have any data to detect image format, check whether it contains alpha channel to use PNG or JPEG format SDImageFormat format; if (SDCGImageRefContainsAlpha(image.CGImage)) &#123; format = SDImageFormatPNG; &#125; else &#123; format = SDImageFormatJPEG; &#125; data = [[SDWebImageCodersManager sharedInstance] encodedDataWithImage:image format:format]; &#125; [self storeImageDataToDisk:data forKey:key]; &#125; if (completionBlock) &#123; dispatch_async(dispatch_get_main_queue(), ^&#123; completionBlock(); &#125;); &#125; &#125;); &#125; else &#123; if (completionBlock) &#123; completionBlock(); &#125; &#125;&#125;//æ­£å¼å†™å…¥ç£ç›˜- (void)storeImageDataToDisk:(nullable NSData *)imageData forKey:(nullable NSString *)key &#123; if (!imageData || !key) &#123; return; &#125; [self checkIfQueueIsIOQueue]; //å¦‚æœæ–‡ä»¶ä¸­ä¸å­˜åœ¨ç£ç›˜ç¼“å­˜è·¯å¾„ åˆ™åˆ›å»º if (![_fileManager fileExistsAtPath:_diskCachePath]) &#123; [_fileManager createDirectoryAtPath:_diskCachePath withIntermediateDirectories:YES attributes:nil error:NULL]; &#125; // get cache Path for image key å¾—åˆ°è¯¥keyçš„ç¼“å­˜è·¯å¾„ NSString *cachePathForKey = [self defaultCachePathForKey:key]; // transform to NSUrl å°†ç¼“å­˜è·¯å¾„è½¬åŒ–ä¸ºurl NSURL *fileURL = [NSURL fileURLWithPath:cachePathForKey]; //å°†imageDataå­˜å‚¨èµ·æ¥ [_fileManager createFileAtPath:cachePathForKey contents:imageData attributes:nil]; // disable iCloud backup å¦‚æœè°ƒç”¨è€…å…³é—­icloud å…³é—­iCloudå¤‡ä»½ if (self.config.shouldDisableiCloud) &#123; [fileURL setResourceValue:@YES forKey:NSURLIsExcludedFromBackupKey error:nil]; &#125;&#125; ç”±äºæ­¤å¤„åªå½’çº³æ­£å¸¸è¯»å–ä¸‹è½½æµç¨‹çš„ä»£ç ã€æ‰€ä»¥å…¶ä½™å…³äºå›¾ç‰‡è¿‡æœŸ&amp;&amp;é‡Šæ”¾æµç¨‹çš„ä»£ç æ²¡æœ‰åˆ—å‡ºã€‚åé¢ä¼šé€ä¸€è¿›è¡Œå½’çº³ã€‚ æŸ¥æ‰¾æœ¬åœ°æµç¨‹å›¾ ä¸‹è½½æ“ä½œ(SDWebImageDownloader)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117- (nullable SDWebImageDownloadToken *)downloadImageWithURL:(nullable NSURL *)url options:(SDWebImageDownloaderOptions)options progress:(nullable SDWebImageDownloaderProgressBlock)progressBlock completed:(nullable SDWebImageDownloaderCompletedBlock)completedBlock &#123; __weak SDWebImageDownloader *wself = self; return [self addProgressCallback:progressBlock completedBlock:completedBlock forURL:url createCallback:^SDWebImageDownloaderOperation *&#123; //åˆ›å»ºä¸‹è½½operation __strong __typeof (wself) sself = wself; //è¶…æ—¶æ—¶é—´ NSTimeInterval timeoutInterval = sself.downloadTimeout; if (timeoutInterval == 0.0) &#123; timeoutInterval = 15.0; &#125; // In order to prevent from potential duplicate caching (NSURLCache + SDImageCache) we disable the cache for image requests if told otherwise //åˆ›å»ºä¸‹è½½ç­–ç•¥ //SDWebImageDownloaderUseNSURLCache åˆ™ä½¿ç”¨ NSURLRequestUseProtocolCachePolicy ç¼“å­˜åè®® //é»˜è®¤NSURLRequestReloadIgnoringLocalCacheDataä»åŸåœ°å€é‡æ–°ä¸‹è½½ NSURLRequestCachePolicy cachePolicy = options &amp; SDWebImageDownloaderUseNSURLCache ? NSURLRequestUseProtocolCachePolicy : NSURLRequestReloadIgnoringLocalCacheData; //åˆ›å»ºä¸‹è½½è¯·æ±‚ NSMutableURLRequest *request = [[NSMutableURLRequest alloc] initWithURL:url cachePolicy:cachePolicy timeoutInterval:timeoutInterval]; request.HTTPShouldHandleCookies = (options &amp; SDWebImageDownloaderHandleCookies); request.HTTPShouldUsePipelining = YES; if (sself.headersFilter) &#123; request.allHTTPHeaderFields = sself.headersFilter(url, [sself.HTTPHeaders copy]); &#125; else &#123; //é»˜è®¤ image/*;q=0.8 request.allHTTPHeaderFields = sself.HTTPHeaders; &#125; //åˆ›å»ºä¸‹è½½æ“ä½œ SDWebImageDownloaderOperation *operation = [[sself.operationClass alloc] initWithRequest:request inSession:sself.session options:options]; //æ˜¯å¦è§£å‹ operation.shouldDecompressImages = sself.shouldDecompressImages; //è¯ä¹¦ if (sself.urlCredential) &#123; operation.credential = sself.urlCredential; &#125; else if (sself.username &amp;&amp; sself.password) &#123; //é»˜è®¤ è´¦å·å¯†ç ä¸ºç©ºçš„é€šç”¨è¯ä¹¦ operation.credential = [NSURLCredential credentialWithUser:sself.username password:sself.password persistence:NSURLCredentialPersistenceForSession]; &#125; //ä¼˜å…ˆçº§ã€‚é»˜è®¤éƒ½ä¸æ˜¯ if (options &amp; SDWebImageDownloaderHighPriority) &#123; operation.queuePriority = NSOperationQueuePriorityHigh; &#125; else if (options &amp; SDWebImageDownloaderLowPriority) &#123; operation.queuePriority = NSOperationQueuePriorityLow; &#125; //å‘ä¸‹è½½é˜Ÿåˆ— NSOperationQueue ä¸­ æ·»åŠ æœ¬æ¬¡ä¸‹è½½æ“ä½œ [sself.downloadQueue addOperation:operation]; //è®¾ç½®ä¸‹è½½çš„é¡ºåº æ˜¯æŒ‰ç…§é˜Ÿåˆ—è¿˜æ˜¯æ ˆ if (sself.executionOrder == SDWebImageDownloaderLIFOExecutionOrder) &#123; // Emulate LIFO execution order by systematically adding new operations as last operation&apos;s dependency [sself.lastAddedOperation addDependency:operation]; sself.lastAddedOperation = operation; &#125; return operation; &#125;];&#125;//é€šè¿‡progressBlock&amp;&amp;completedBlockä»¥åŠUrlå’ŒSDWebImageDownloaderOperationå¯¹tokenè¿›è¡ŒåŒ…è£…- (nullable SDWebImageDownloadToken *)addProgressCallback:(SDWebImageDownloaderProgressBlock)progressBlock completedBlock:(SDWebImageDownloaderCompletedBlock)completedBlock forURL:(nullable NSURL *)url createCallback:(SDWebImageDownloaderOperation *(^)(void))createCallback &#123; // The URL will be used as the key to the callbacks dictionary so it cannot be nil. If it is nil immediately call the completed block with no image or data. if (url == nil) &#123; if (completedBlock != nil) &#123; completedBlock(nil, nil, nil, NO); &#125; return nil; &#125; __block SDWebImageDownloadToken *token = nil; dispatch_barrier_sync(self.barrierQueue, ^&#123; SDWebImageDownloaderOperation *operation = self.URLOperations[url]; if (!operation) &#123; operation = createCallback(); //å°†urlä½œä¸ºkeyã€å¯¹åº”çš„ä¸‹è½½æ“ä½œoperationä½œä¸ºvalueä¿å­˜ã€‚ self.URLOperations[url] = operation; __weak SDWebImageDownloaderOperation *woperation = operation; operation.completionBlock = ^&#123; dispatch_barrier_sync(self.barrierQueue, ^&#123; SDWebImageDownloaderOperation *soperation = woperation; if (!soperation) return; if (self.URLOperations[url] == soperation) &#123; //ä¸‹è½½å®Œæˆã€ç§»é™¤æ“ä½œ [self.URLOperations removeObjectForKey:url]; &#125;; &#125;); &#125;; &#125; //å°†æˆprogressBlockä»¥åŠcompletedBlockç»„è£…æˆSDCallbacksDictionary. id downloadOperationCancelToken = [operation addHandlersForProgress:progressBlock completed:completedBlock]; //ç”Ÿæˆä¸‹è½½ä»»åŠ¡æ ‡è¯†ã€‚ç”¨äºmanagerå°†æ¥å®šä½å¯¹åº”æ“ä½œç”¨ token = [SDWebImageDownloadToken new]; token.url = url; token.downloadOperationCancelToken = downloadOperationCancelToken; &#125;); return token;&#125; SDWebImageDownloaderOperationæ˜¯å…·ä½“ä¸‹è½½æ“ä½œã€è®¾è®¡å¾ˆå¤šç½‘ç»œå±‚çš„ä¸œè¥¿ã€‚å°†æ¥å¯ä»¥å•ç‹¬å¼€ä¸€ç¯‡ã€ç»“åˆAFNetWorkingæ²¡å‡†ä¼šæ›´å¥½ã€‚ ä¸€äº›å¯å‘ åˆ†å±‚çš„æ¥å£APIè®¾è®¡ã€‚ 12345#import &quot;UIImageView+WebCache.h&quot;#import &quot;UIButton+WebCache.h&quot;#import &quot;UIImageView+HighlightedWebCache.h&quot;//ä»¥åŠå…¶æ±‡æ€»çš„#import &quot;UIView+WebCache.h&quot; æ‰€æœ‰å¤–å±‚APIä¸å…·ä½“ä¸šåŠ¡æ— å…³ã€‚ä½¿å¾—SDWebImageManagerå¯ä»¥è„±ç¦»Viewå±‚å•ç‹¬è¿ä½œã€‚ çº¿ç¨‹å®‰å…¨ 123456789@synchronized (self.runningOperations) &#123; [self.runningOperations addObject:operation]; &#125;if (url) &#123; @synchronized (self.failedURLs) &#123; isFailedUrl = [self.failedURLs containsObject:url]; &#125;&#125;..... æ‰€æœ‰å¯èƒ½å¼•èµ·èµ„æºæŠ¢å¤ºçš„å¯¹è±¡æ“ä½œã€å…¨éƒ¨æœ‰æ¡ä»¶é”ä¿æŠ¤ã€‚ä½†æ˜¯ç”±äºå†…åµŒå¼‚å¸¸å¤„ç†ä»£ç çš„å­˜åœ¨ã€æ¡ä»¶é”çš„æ€§èƒ½æ˜¯æ‰€æœ‰é”ä¸­æœ€å·®çš„ã€‚ä¸çŸ¥é“ä¸ºä»€ä¹ˆSDä¸­ä½¿ç”¨è¿™ä¹ˆå¤šã€‚ å†…è”å‡½æ•° æ›´é«˜æ•ˆçš„çŸ­å‡½æ•°æ‰§è¡Œã€æ›¿ä»£è¡¨è¾¾å¼å½¢å¼çš„å®å®šä¹‰ã€‚ ç²¾ç»†çš„ç¼“å­˜ç®¡ç†åŸåˆ™ è¯¦å‚ä¸Šæ–‡æåˆ°çš„ã€Šç£ç›˜æ¸…ç†çš„åŸåˆ™ï¼Ÿã€‹ å›è°ƒè®¾è®¡ SDWebImageä¸­ä½¿ç”¨äº†ä¸¤ç§ã€Blockä»¥åŠDelegateã€‚ Blockä½¿ç”¨çš„å¾ˆå¤šã€ä¸¾ä¸¤ä¸ªä¾‹å­ã€‚ 123456789101112131415======&gt;#import &quot;UIView+WebCache.h&quot;- (void)sd_internalSetImageWithURL:(nullable NSURL *)url placeholderImage:(nullable UIImage *)placeholder options:(SDWebImageOptions)options operationKey:(nullable NSString *)operationKey setImageBlock:(nullable SDSetImageBlock)setImageBlock progress:(nullable SDWebImageDownloaderProgressBlock)progressBlock completed:(nullable SDExternalCompletionBlock)completedBlock context:(nullable NSDictionary *)context;======&gt;SDWebImageDownloader- (nullable SDWebImageDownloadToken *)downloadImageWithURL:(nullable NSURL *)url options:(SDWebImageDownloaderOptions)options progress:(nullable SDWebImageDownloaderProgressBlock)progressBlock completed:(nullable SDWebImageDownloaderCompletedBlock)completedBlock; å†æ¥çœ‹ä»£ç† 1234567891011121314@protocol SDWebImageManagerDelegate &lt;NSObject&gt;@optional/** * Controls which image should be downloaded when the image is not found in the cache. * * @param imageManager The current `SDWebImageManager` * @param imageURL The url of the image to be downloaded * * @return Return NO to prevent the downloading of the image on cache misses. If not implemented, YES is implied. */- (BOOL)imageManager:(nonnull SDWebImageManager *)imageManager shouldDownloadImageForURL:(nullable NSURL *)imageURL;- (nullable UIImage *)imageManager:(nonnull SDWebImageManager *)imageManager transformDownloadedImage:(nullable UIImage *)image withURL:(nullable NSURL *)imageURL; ä¸éš¾çœ‹å‡ºã€SDWebImageå¯¹å›è°ƒçš„ä½¿ç”¨å€¾å‘äºï¼š Blockå•ä¸ªå›¾ç‰‡çš„åˆ†ç±»ã€å•ä¸ªå›¾ç‰‡çš„ä¸‹è½½ã€‚æ¯ä¸ªæ“ä½œä»»åŠ¡ä¸­å¿…ç°çš„progressä»¥åŠcompletedã€‚æ‰€ä»¥ã€æœ‰å¾ˆå¼ºçš„ä¸ªä½“ç»‘å®šéœ€è¦æˆ–è€…ä½¿ç”¨æ¬¡æ•°ä¸å¤šæ—¶ã€å€¾å‘ä½¿ç”¨block DelegateSDWebImageManagerä¸‹è½½å®Œæˆä¹‹åçš„è‡ªå®šä¹‰å›¾ç‰‡å¤„ç†ã€æ˜¯å¦ä¸‹è½½æŸä¸ªurlã€‚è¿™ä¸¤ä¸ªæ–¹æ³•å¦‚æœéœ€è¦çš„è¯éƒ½æ˜¯å°†ä¼šè°ƒç”¨å¤šæ¬¡çš„ã€‚æ‰€ä»¥ã€ç”¨Delegateæ›´å¥½ã€å¯ä»¥å°†æ–¹æ³•å¸¸é©»ã€‚ åŒç†UITableViewçš„ä½¿ç”¨Delegateã€æ˜¯ç”¨ä¸ºåœ¨æ»šåŠ¨é€”ä¸­ã€ä»£ç†æ–¹æ³•éœ€è¦è¢«ä¸æ–­çš„æ‰§è¡Œã€‚UIButtonä¹Ÿæ˜¯å°†ä¼šè¢«å¤šæ¬¡ç‚¹å‡»ã€‚UIViewçš„åŠ¨ç”»/GCDåˆ™å¯ä»¥ä½¿ç”¨Blockã€å› ä¸ºåªæ‰§è¡Œä¸€æ¬¡ã€ç”¨å®Œé‡Šæ”¾ã€‚æ‰€ä»¥ã€åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ã€æˆ‘ä»¬ä¹Ÿå¯ä»¥å‚è€ƒä¸Šè¿°åŸåˆ™è¿›è¡Œè®¾è®¡ã€‚ NSMapTable ç”¨NSMapTableä»£æ›¿å­—å…¸æ¥å­˜å‚¨å½“å‰æ­£åœ¨è¿›è¡Œçš„æ“ä½œã€å¹¶ä¸”å°†valueè®¾ç½®ä¸ºNSMapTableWeakMemoryã€‚é˜²æ­¢å¯¹åº”valueå› ä¸ºå¼ºå¼•ç”¨ä¸èƒ½è‡ªåŠ¨é‡Šæ”¾ã€‚ æš‚æ—¶æƒ³åˆ°çš„å°±è¿™äº›ã€æ›´å¤šé—®é¢˜æ¬¢è¿ç•™è¨€ã€‚ä½œè€…ï¼škirito_songé“¾æ¥ï¼šhttps://www.jianshu.com/p/3b8a7ae966d3ä¾†æºï¼šç®€ä¹¦è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚","link":"/2018/04/24/SDWebImage4-0æºç é˜…è¯»/"},{"title":"UIButtonè®¾ç½®æ–‡å­—å›¾ç‰‡å±…ä¸­ã€UIViewç›¸å…³æ–¹æ³•ä»¥åŠUIåˆ‡å›¾çš„é‡è¦æ€§","text":"åˆæ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜ï¼Œo(â•¯â–¡â•°)oã€‚UIButtonä½œä¸ºæœ€æœ€å¸¸ç”¨çš„æ§ä»¶ï¼Œæƒ³å¿…éƒ½æ˜¯å¾ˆç†Ÿæ‚‰çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ§ä»¶ä¸­ å¦‚æ­¤è®¾è®¡åœ¨å¾ˆå¤šç”µå•†å®¢æˆ·ç«¯ä¸­éƒ½æœ‰æ¶‰åŠï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆéš¾åº¦ã€‚ ä½†æ˜¯æˆ‘é‡åˆ°çš„é—®é¢˜å°±æ˜¯ä»»å‡­å¦‚ä½•è®¾ç½®è¾¹è·ï¼Œå°±æ˜¯å¯¹ä¸é½ï¼Œå…¶ä¸­è¿˜è¦è€ƒè™‘å±å¹•é€‚é…çš„é—®é¢˜ã€‚Orzâ€¦æœ€åå»å·¥ç¨‹é‡ŒæŸ¥çœ‹ç›¸åº”çš„å›¾ç‰‡å¤§å°ï¼Œæ‰å‘ç°æ¯ä¸ªå›¾ç‰‡çš„å°ºå¯¸å®½é«˜éƒ½ä¸åŒï¼Œå¾ˆéšæ„ã€‚ è¿™æåŠå¤©ï¼ŒåŸæ¥æ˜¯å›¾ç‰‡å°ºå¯¸çš„é—®é¢˜ï¼Œæƒ³æƒ³è¿™UIï¼Œå”‰ï¼ UIButtonè®¾ç½®æ–‡å­—å›¾ç‰‡å±…ä¸­ UIButtonå›¾ç‰‡ã€æ–‡å­—å±…ä¸­çš„è°ƒæ•´ä¸»è¦å°±æ˜¯å››ä¸ªå‚æ•°ï¼šï¼ˆ``ï¼‰ contentHorizontalAlignment:è®¾ç½®çœŸä¸ªButtonå†…å®¹ï¼ˆåŒ…æ‹¬imageViewå’ŒtitleLabelï¼‰çš„æ°´å¹³ä½ç½®ã€‚ contentVerticalAlignment:è®¾ç½®æ•´ä¸ªButtonå†…å®¹ï¼ˆåŒ…æ‹¬imageViewå’ŒtitleLabelï¼‰çš„å‚ç›´ä½ç½®ï¼Œè¿™é‡Œç”¨ä¸åˆ°ã€‚ imageEdgeInsets:è®¾ç½®imageViewçš„è¾¹è·ã€‚ titleEdgeInsets:è®¾ç½®titleLabelçš„è¾¹è·ã€‚ 1234567891011121314typedef NS_ENUM(NSInteger, UIControlContentVerticalAlignment) &#123; UIControlContentVerticalAlignmentCenter = 0, UIControlContentVerticalAlignmentTop = 1, UIControlContentVerticalAlignmentBottom = 2, UIControlContentVerticalAlignmentFill = 3,&#125;;typedef NS_ENUM(NSInteger, UIControlContentHorizontalAlignment) &#123; UIControlContentHorizontalAlignmentCenter = 0, UIControlContentHorizontalAlignmentLeft = 1, UIControlContentHorizontalAlignmentRight = 2, UIControlContentHorizontalAlignmentFill = 3,&#125;; åœ¨è¿™é‡Œç»™å‡ºæˆ‘ç”¨çš„é€šç”¨æ–¹æ³•ï¼Œbuttoné«˜åº¦ä¸º50ä¸ºä¾‹ï¼š1.è®¾ç½®buttonçš„contentHorizontalAlignmentä¸ºUIControlContentHorizontalAlignmentLeft,è¿™æ ·ä¾¿äºæ ¹æ®buttonå¤§å°è®¡ç®—ã€‚å½“ç„¶éè¦ç”¨centerè®¡ç®—ä¹Ÿå¯ï¼2.è®¾ç½®imageViewçš„Edgeï¼š kButtonImageViewEdgeInsets(btn) UIEdgeInsetsMake(0,(kOptionBtnWidth - btn.imageView.frame.size.width)/2, 20, 0);3.è®¾ç½®titleLabelçš„Edgeï¼š #define kButtonTitleEdgeInsets(btn) UIEdgeInsetsMake(30, (kOptionBtnWidth - btn.titleLabel.frame.size.width)/2-btn.titleLabel.frame.origin.x, 0, 20);ã€‚ åªè¦ä¼ å…¥ç›¸åº”çš„buttonå°±å¯ä»¥äº†ï¼Œå…¶ä¸­buttonçš„å®½åº¦ç”±æ­¤å¾—æ¥#define kOptionBtnWidth (CGRectGetWidth(frame)/kOptionBtnCount)ã€‚ UIViewçš„ç›¸å…³æ–¹æ³• ç›´æ¥é‡‡ç”¨ä¸Šè¿°è®¾ç½®buttonçš„æ–¹æ³•æ˜¯æœ‰æ¡ä»¶çš„ï¼Œå³ç¡®å®šäº†å½“å‰Buttonçš„å®½åº¦ã€‚æˆ‘ä»¬çœ‹åˆ°è¦è®¡ç®—buttonçš„å®½åº¦ï¼Œå¾—é€šè¿‡è¯»å–å±å¹•å®½åº¦å¾—çŸ¥ã€‚appä¸­åˆå§‹åŒ–UIViewçš„æ–¹å¼é€šå¸¸æœ‰ä¸¤ç§ï¼š1.xib/Storyboardï¼Œç„¶åå…³è”.h,.mæ–‡ä»¶ã€‚2.è‡ªå®šä¹‰UIViewå­ç±»,é€šè¿‡initWithFrameæ–¹æ³•è®¾ç½®ã€‚ å½“åœ¨UIViewçš„å­ç±»ä¸­å®ç°æ—¶ï¼Œå› ä¸ºæ­¤æ—¶å±å¹•å®½åº¦å·²ç»é€šè¿‡åˆå§‹åŒ–æ–¹æ³•ä¸­å¾—çŸ¥ï¼Œæ‰€ä»¥ä¸éœ€è¦å†å¤šè®¾ç½®ã€‚è€Œé€šè¿‡xib/sbå…³è”çš„å­ç±»åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œè‹¥æ‰“å°self.frameï¼Œå°±æ˜¯å½“å‰xibçš„å®½åº¦ï¼Œè€Œä¸æ˜¯å®é™…å±å¹•å®½åº¦ã€‚æ‰€ä»¥ä¸èƒ½å†åˆå§‹åŒ–æ–¹æ³•ä¸­è®¾ç½®buttonçš„å±æ€§ã€‚ ç¬¬ä¸€æ­¥é‡å†™çˆ¶ç±»æ–¹æ³•ï¼Œä¸‹é¢ä¸¤ä¸ªä»»é€‰å…¶ä¸€ã€‚12- (void)updateConstraints;-éœ€è¦é‡å†™çˆ¶ç±»çš„updateConstraintsæ–¹æ³•ã€‚- (void)layoutSubviews; ç¬¬äºŒæ­¥å¯¹æ¯ä¸ªbuttonè°ƒç”¨layoutIfNeededæ–¹æ³•ï¼Œè®©å…¶ç«‹å³åˆ·æ–°å¸ƒå±€ã€‚ è¿™ä¸ªæ˜¯æ²¡æœ‰è°ƒç”¨layoutIfNeededçš„æƒ…å†µï¼š ä»¥ä¸Šã€‚ å‚è€ƒæ–‡æ¡£UIView Class ReferenceUIView)","link":"/2016/03/31/UIButtonè®¾ç½®æ–‡å­—å›¾ç‰‡å±…ä¸­-è®ºUIåˆ‡å›¾çš„é‡è¦æ€§/"},{"title":"Xibä¸ä¹‹å…³è”çš„è‡ªå®šä¹‰Class","text":"æœ€è¿‘é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼šç‚¹å‡»ã€çŒœä½ å–œæ¬¢ã€‘è§†å›¾è¿›å…¥å•†å“è¯¦æƒ…åï¼Œå†è¿”å›åˆ°é¦–é¡µæ—¶ï¼Œæ²¡æœ‰åŸå…ˆçš„æ•°æ®äº†ã€‚ æ‰“å¼€Revealçœ‹äº†ä¸‹å±‚çº§å…³ç³»ï¼ŒåŸæ¥æ˜¯è¢«äºŒæ¬¡ç”Ÿæˆçš„ç•Œé¢è¦†ç›–äº†ã€‚å†ç»†çœ‹ä¸€ä¸‹ï¼Œä¸Šé¢çš„è§†å›¾éƒ½è¢«äºŒæ¬¡ç”Ÿæˆäº†ã€‚çœŸæ˜¯å“”äº†ç‹—äº†ï¼ drawRectæ–¹æ³•å¥½å§ï¼Œä¿®æ”¹ä»£ç å§ã€‚å› ä¸ºè¿™äº›è§†å›¾éƒ½æ˜¯åœ¨xibä¸Šåˆ›å»ºå¥½äº†ï¼Œå¦å¤–æ–°å»ºäº†ä¸ä¹‹å¯¹åº”çš„è‡ªå®šä¹‰ç±»ï¼Œæ‰€ä»¥éƒ½ç›´æ¥ç”¨çš„drawRectæ–¹æ³•å»åˆå§‹åŒ–UIå…ƒç´ ã€‚1234- (void)drawRect:(CGRect)rect &#123; [self initSubViews];&#125; The default implementation of this method does nothing. Subclasses that use technologies such as Core Graphics and UIKit to draw their viewâ€™s content should override this method and implement their drawing code there. You do not need to override this method if your view sets its content in other ways. For example, you do not need to override this method if your view just displays a background color or if your view sets its content directly using the underlying layer object. If you subclass UIView directly, your implementation of this method does not need to call super. However, if you are subclassing a different view class, you should call super at some point in your implementation.This method is called when a view is first displayed or when an event occurs that invalidates a visible part of the view. You should never call this method directly yourself. To invalidate part of your view, and thus cause that portion to be redrawn, call the setNeedsDisplay or setNeedsDisplayInRect: method instead. @Apple Developdeveloper.apple.com/library/prerelease/ios/documentation/UIKit/Reference/UIView_Class/index.html#//apple_ref/swift/instm/UIView/c:objc(cs)UIView(im)drawRect: è¿™é‡Œå°±å‡ºç°äº†é—®é¢˜ã€‚åœ¨æ¯æ¬¡é‡æ–°è¿”å›åˆ°é¦–é¡µåï¼ŒdrawRectæ–¹æ³•åˆè¢«é‡æ–°è°ƒç”¨äº†ä¸€æ¬¡ï¼Œæ‰€ä»¥ç”Ÿæˆäº†æ–°çš„è§†å›¾è¦†ç›–äº†åŸæ¥çš„è§†å›¾ï¼Œä½†æ˜¯åˆæ²¡æœ‰è¯·æ±‚æ•°æ®ï¼Œæ‰€ä»¥å°±çœ‹ä¸åˆ°äº†ã€‚drawRectæ–¹æ³•åªè¢«é‡æ–°è°ƒç”¨äº†ä¸€æ¬¡ï¼Œåœ¨è¿™ä¹‹åå°±ä¸ä¼šå†è¢«è°ƒç”¨ã€‚ å› ä¸ºä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å°±ä¸ç”¨drawRectå»åˆå§‹åŒ–é¡µé¢å…ƒç´ äº†ï¼Œè€Œæ˜¯ç”¨äº†initWithCorderæ–¹æ³•ã€‚æ³¨æ„å› ä¸ºè§†å›¾æ˜¯è¢«ç›´æ¥åˆ›å»ºåœ¨xibä¸Šçš„ï¼Œå¹¶æ²¡æœ‰æ‰§è¡ŒinitWithFrameæ–¹æ³•ã€‚ 12345678- (instancetype)initWithCoder:(NSCoder *)aDecoder&#123; self = [super initWithCoder:aDecoder]; if (self) &#123; [self initSubViews]; &#125; return self;&#125; æ€»ç»“1.å°½é‡ä¸è¦ä½¿ç”¨drawRectæ–¹æ³•ï¼Œæ€§èƒ½ä¸‹é™å‰å®³æ’’ã€‚2.å·²ç»åœ¨xibä¸Šåˆ›å»ºçš„è§†å›¾ï¼Œä¸å…¶å…³è”çš„å­ç±»ä¸­initWithFrameæ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨ã€‚","link":"/2016/03/04/Xibä¸ä¹‹å…³è”çš„è‡ªå®šä¹‰Class/"},{"title":"SDWebImageå†…éƒ¨å®ç°è¿‡ç¨‹","text":"SDWebImageå†…éƒ¨å®ç°è¿‡ç¨‹(æ–°ç‰ˆæœ¬åœ¨å„æ–¹æ³•å‰åŠ ä¸Šäº†sd_å‰ç¼€ï¼Œä»¥åŒºåˆ†UIImageView+AFNetworkingä¸­çš„æ–¹æ³•) 1.å…¥å£ setImageWithURL:placeholderImage:options:ä¼šå…ˆæŠŠ placeholderImage æ˜¾ç¤ºï¼Œç„¶å SDWebImageManager æ ¹æ® URL å¼€å§‹å¤„ç†å›¾ç‰‡ã€‚ 2.è¿›å…¥ SDWebImageManager-downloadWithURL:delegate:options:userInfo:ï¼Œäº¤ç»™ SDImageCache ä»ç¼“å­˜æŸ¥æ‰¾å›¾ç‰‡æ˜¯å¦å·²ç»ä¸‹è½½ queryDiskCacheForKey:delegate:userInfo:. 3.å…ˆä»å†…å­˜å›¾ç‰‡ç¼“å­˜æŸ¥æ‰¾æ˜¯å¦æœ‰å›¾ç‰‡ï¼Œå¦‚æœå†…å­˜ä¸­å·²ç»æœ‰å›¾ç‰‡ç¼“å­˜ï¼ŒSDImageCacheDelegate å›è°ƒ imageCache:didFindImage:forKey:userInfo: åˆ° SDWebImageManagerã€‚ 4.SDWebImageManagerDelegate å›è°ƒ webImageManager:didFinishWithImage:åˆ° UIImageView+WebCache ç­‰å‰ç«¯å±•ç¤ºå›¾ç‰‡ã€‚ 5.å¦‚æœå†…å­˜ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œç”Ÿæˆ NSInvocationOperation æ·»åŠ åˆ°é˜Ÿåˆ—å¼€å§‹ä»ç¡¬ç›˜æŸ¥æ‰¾å›¾ç‰‡æ˜¯å¦å·²ç»ç¼“å­˜ã€‚ 6.æ ¹æ® URLKey åœ¨ç¡¬ç›˜ç¼“å­˜ç›®å½•ä¸‹å°è¯•è¯»å–å›¾ç‰‡æ–‡ä»¶ã€‚è¿™ä¸€æ­¥æ˜¯åœ¨ NSOperation è¿›è¡Œçš„æ“ä½œï¼Œæ‰€ä»¥å›ä¸»çº¿ç¨‹è¿›è¡Œç»“æœå›è°ƒ notifyDelegate:ã€‚ 7.å¦‚æœä¸Šä¸€æ“ä½œä»ç¡¬ç›˜è¯»å–åˆ°äº†å›¾ç‰‡ï¼Œå°†å›¾ç‰‡æ·»åŠ åˆ°å†…å­˜ç¼“å­˜ä¸­ï¼ˆå¦‚æœç©ºé—²å†…å­˜è¿‡å°ï¼Œä¼šå…ˆæ¸…ç©ºå†…å­˜ç¼“å­˜ï¼‰ã€‚SDImageCacheDelegate å›è°ƒ imageCache:didFindImage:forKey:userInfo:ã€‚è¿›è€Œå›è°ƒå±•ç¤ºå›¾ç‰‡ã€‚ 8.å¦‚æœä»ç¡¬ç›˜ç¼“å­˜ç›®å½•è¯»å–ä¸åˆ°å›¾ç‰‡ï¼Œè¯´æ˜æ‰€æœ‰ç¼“å­˜éƒ½ä¸å­˜åœ¨è¯¥å›¾ç‰‡ï¼Œéœ€è¦ä¸‹è½½å›¾ç‰‡ï¼Œå›è°ƒ imageCache:didNotFindImageForKey:userInfo:ã€‚ 9.å…±äº«æˆ–é‡æ–°ç”Ÿæˆä¸€ä¸ªä¸‹è½½å™¨ SDWebImageDownloader å¼€å§‹ä¸‹è½½å›¾ç‰‡ã€‚ 10.å›¾ç‰‡ä¸‹è½½ç”± NSURLConnection æ¥åšï¼Œå®ç°ç›¸å…³ delegate æ¥åˆ¤æ–­å›¾ç‰‡ä¸‹è½½ä¸­ã€ä¸‹è½½å®Œæˆå’Œä¸‹è½½å¤±è´¥ã€‚ 11.connection:didReceiveData:ä¸­åˆ©ç”¨ ImageIO åšäº†æŒ‰å›¾ç‰‡ä¸‹è½½è¿›åº¦åŠ è½½æ•ˆæœã€‚ 12.connectionDidFinishLoading:æ•°æ®ä¸‹è½½å®Œæˆåäº¤ç»™ SDWebImageDecoder åšå›¾ç‰‡è§£ç å¤„ç†ã€‚ 13.å›¾ç‰‡è§£ç å¤„ç†åœ¨ä¸€ä¸ª NSOperationQueue å®Œæˆï¼Œä¸ä¼šæ‹–æ…¢ä¸»çº¿ç¨‹ UIã€‚å¦‚æœæœ‰éœ€è¦å¯¹ä¸‹è½½çš„å›¾ç‰‡è¿›è¡ŒäºŒæ¬¡å¤„ç†ï¼Œæœ€å¥½ä¹Ÿåœ¨è¿™é‡Œå®Œæˆï¼Œæ•ˆç‡ä¼šå¥½å¾ˆå¤šã€‚ 14.åœ¨ä¸»çº¿ç¨‹ notifyDelegateOnMainThreadWithInfo: å®£å‘Šè§£ç å®Œæˆï¼ŒimageDecoder:didFinishDecodingImage:userInfo: å›è°ƒç»™ SDWebImageDownloaderã€‚ 15.imageDownloader:didFinishWithImage: å›è°ƒç»™ SDWebImageManager å‘ŠçŸ¥å›¾ç‰‡ä¸‹è½½å®Œæˆã€‚ 16.é€šçŸ¥æ‰€æœ‰çš„ downloadDelegates ä¸‹è½½å®Œæˆï¼Œå›è°ƒç»™éœ€è¦çš„åœ°æ–¹å±•ç¤ºå›¾ç‰‡ã€‚ 17.å°†å›¾ç‰‡ä¿å­˜åˆ° SDImageCache ä¸­ï¼Œå†…å­˜ç¼“å­˜å’Œç¡¬ç›˜ç¼“å­˜åŒæ—¶ä¿å­˜ã€‚å†™æ–‡ä»¶åˆ°ç¡¬ç›˜ä¹Ÿåœ¨ä»¥å•ç‹¬ NSInvocationOperation å®Œæˆï¼Œé¿å…æ‹–æ…¢ä¸»çº¿ç¨‹ã€‚ 18.SDImageCache åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šæ³¨å†Œä¸€äº›æ¶ˆæ¯é€šçŸ¥ï¼Œåœ¨å†…å­˜è­¦å‘Šæˆ–é€€åˆ°åå°çš„æ—¶å€™æ¸…ç†å†…å­˜å›¾ç‰‡ç¼“å­˜ï¼Œåº”ç”¨ç»“æŸçš„æ—¶å€™æ¸…ç†è¿‡æœŸå›¾ç‰‡ã€‚ 19.SDWI ä¹Ÿæä¾›äº† UIButton+WebCache å’Œ MKAnnotationView+WebCacheï¼Œæ–¹ä¾¿ä½¿ç”¨ã€‚ 20.SDWebImagePrefetcher å¯ä»¥é¢„å…ˆä¸‹è½½å›¾ç‰‡ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ã€‚ ä»ä¸Šé¢æµç¨‹å¯ä»¥çœ‹å‡ºï¼Œå½“ä½ è°ƒç”¨setImageWithURL:æ–¹æ³•çš„æ—¶å€™ï¼Œä»–ä¼šè‡ªåŠ¨å»ç»™ä½ å¹²è¿™ä¹ˆå¤šäº‹ï¼Œå½“ä½ éœ€è¦åœ¨æŸä¸€å…·ä½“æ—¶åˆ»åšäº‹æƒ…çš„æ—¶å€™ï¼Œä½ å¯ä»¥è¦†ç›–è¿™äº›æ–¹æ³•ã€‚æ¯”å¦‚åœ¨ä¸‹è½½æŸä¸ªå›¾ç‰‡çš„è¿‡ç¨‹ä¸­è¦å“åº”ä¸€ä¸ªäº‹ä»¶ï¼Œå°±è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼š è¦†ç›–æ–¹æ³•ï¼ŒæŒ‡å“ªæ‰“å“ªï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸‹è½½imagePath2çš„æ—¶å€™å“åº”12345678910SDWebImageManager *manager = [SDWebImageManager sharedManager]; [manager downloadImageWithURL:imagePath2 options:SDWebImageRetryFailed progress:^(NSInteger receivedSize, NSInteger expectedSize) &#123; NSLog(@\"æ˜¾ç¤ºå½“å‰è¿›åº¦\"); &#125; completed:^(UIImage *image, NSError *error, SDImageCacheType cacheType, BOOL finished, NSURL *imageURL) &#123; NSLog(@\"ä¸‹è½½å®Œæˆ\");&#125;]; å½“æœåŠ¡å™¨æ›´æ–°äº†æŸä¸€å¼ å›¾ç‰‡èµ„æºæ—¶ï¼Œå®¢æˆ·ç«¯éœ€è¦é‡æ–°åŠ è½½ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¾ç½®SDWebImageOptionä¸ºSDWebImageRefreshCachedï¼›é™„ä¸Šå…¨éƒ¨çš„SDWebImageOptionsï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172typedef NS_OPTIONS(NSUInteger, SDWebImageOptions) &#123; /** * By default, when a URL fail to be downloaded, the URL is blacklisted so the library won't keep trying. * This flag disable this blacklisting. */ SDWebImageRetryFailed = 1 &lt;&lt; 0, /** * By default, image downloads are started during UI interactions, this flags disable this feature, * leading to delayed download on UIScrollView deceleration for instance. */ SDWebImageLowPriority = 1 &lt;&lt; 1, /** * This flag disables on-disk caching */ SDWebImageCacheMemoryOnly = 1 &lt;&lt; 2, /** * This flag enables progressive download, the image is displayed progressively during download as a browser would do. * By default, the image is only displayed once completely downloaded. */ SDWebImageProgressiveDownload = 1 &lt;&lt; 3, /** * Even if the image is cached, respect the HTTP response cache control, and refresh the image from remote location if needed. * The disk caching will be handled by NSURLCache instead of SDWebImage leading to slight performance degradation. * This option helps deal with images changing behind the same request URL, e.g. Facebook graph api profile pics. * If a cached image is refreshed, the completion block is called once with the cached image and again with the final image. * * Use this flag only if you can't make your URLs static with embeded cache busting parameter. */ SDWebImageRefreshCached = 1 &lt;&lt; 4, /** * In iOS 4+, continue the download of the image if the app goes to background. This is achieved by asking the system for * extra time in background to let the request finish. If the background task expires the operation will be cancelled. */ SDWebImageContinueInBackground = 1 &lt;&lt; 5, /** * Handles cookies stored in NSHTTPCookieStore by setting * NSMutableURLRequest.HTTPShouldHandleCookies = YES; */ SDWebImageHandleCookies = 1 &lt;&lt; 6, /** * Enable to allow untrusted SSL ceriticates. * Useful for testing purposes. Use with caution in production. */ SDWebImageAllowInvalidSSLCertificates = 1 &lt;&lt; 7, /** * By default, image are loaded in the order they were queued. This flag move them to * the front of the queue and is loaded immediately instead of waiting for the current queue to be loaded (which * could take a while). */ SDWebImageHighPriority = 1 &lt;&lt; 8, /** * By default, placeholder images are loaded while the image is loading. This flag will delay the loading * of the placeholder image until after the image has finished loading. */ SDWebImageDelayPlaceholder = 1 &lt;&lt; 9, /** * We usually don't call transformDownloadedImage delegate method on animated images, * as most transformation code would mangle it. * Use this flag to transform them anyway. */ SDWebImageTransformAnimatedImage = 1 &lt;&lt; 10,&#125;;","link":"/2016/03/08/SDWebImageå†…éƒ¨å®ç°è¿‡ç¨‹/"},{"title":"TableViewCellæ ¹æ®å†…å®¹è‡ªé€‚åº”é«˜åº¦çš„æ–¹æ³•","text":"æœ¬æ–‡åŒæ—¶å‚è€ƒ http://blog.sunnyxx.com/2015/05/17/cell-height-calculation/ ä¸€ï¼šæ ¹æ®cellå†…å®¹æ‰‹åŠ¨è®¡ç®—cellé«˜åº¦ æ— è®ºä½¿ç”¨xibè¿˜æ˜¯ä»£ç å†™æ§ä»¶ï¼Œæ ¸å¿ƒæ€æƒ³éƒ½æ˜¯æ ¹æ®cellä¸­contentå†…å®¹çš„é«˜åº¦æ¥è®¡ç®—cellçš„é«˜åº¦ã€‚1.åœ¨è·å–åˆ°cellæ•°æ®æºçš„æ—¶å€™è®¡ç®—å†…å®¹é«˜åº¦ã€‚å¯ä»¥è®¾ç½®ä¸€ä¸ªsizeå±æ€§ï¼Œç”¨æ¥è®°å½•ã€‚2.å¦‚æœæ˜¯xibï¼Œå»æ‰autolayout3.åœ¨cellForRowAtIndexPathæ–¹æ³•ä¸­å¡«å……cellæ•°æ®çš„æ—¶å€™ï¼Œæ ¹æ®å†…å®¹é«˜åº¦ï¼Œè®¾ç½®æ§ä»¶é«˜åº¦4.åœ¨heightForRowAtIndexpathæ–¹æ³•ä¸­ï¼Œè®¾ç½®æ¯ä¸€ä¸ªcell çš„é«˜åº¦ äºŒï¼šSelf sizing cell + autolayout Self sizing cell æ˜¯iOS8ä¸­æ·»åŠ ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œç”¨æ¥è‡ªé€‚åº”cellé«˜åº¦ã€‚åŒæ—¶æ‰“å¼€ä»¥ä¸‹å‚æ•°ï¼š12self.tableView.estimatedRowHeight = 213;//æ·»åŠ ä¼°ç®—é«˜åº¦ï¼Œè¦ä¸ç„¶è‡ªåŠ¨ç®—é«˜å¤±æ•ˆï¼Ÿself.tableView.rowHeight = UITableViewAutomaticDimension; ä¸‰ï¼šUITableView+FDTemplateLayoutCell ä½¿ç”¨çš„API:12345678#import &lt;UITableView+FDTemplateLayoutCell.h&gt; - (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath &#123; return [tableView fd_heightForCellWithIdentifier:@\"identifer\" cacheByIndexPath:indexPath configuration:^(id cell) &#123; // é…ç½® cell çš„æ•°æ®æºï¼Œå’Œ \"cellForRow\" å¹²çš„äº‹ä¸€è‡´ï¼Œæ¯”å¦‚ï¼š cell.entity = self.feedEntities[indexPath.row]; &#125;]; &#125; https://github.com/forkingdog/UITableView-FDTemplateLayoutCell ä¸‹é¢ç»™å‡ºç¬¬ä¸€ç§æ‰‹åŠ¨è®¡ç®—é«˜åº¦çš„ä»£ç æ€è·¯ï¼šè¯¦ç»†æ­¥éª¤ï¼š 12345678HLComment *comment = [HLComment new]; comment.floor = obj[@\"floor\"]; comment.commentId = obj[@\"id\"]; comment.content = obj[@\"content\"]; //è®¡ç®—contentå†…å®¹é«˜åº¦12345 NSDictionary *atrri = @&#123;NSFontAttributeName: [UIFont systemFontOfSize:15]&#125;; CGRect rect = [comment.content boundingRectWithSize:CGSizeMake(220, 1000) options:NSStringDrawingUsesLineFragmentOrigin attributes:atrri context:nil];comment.size = rect.size;//ä¿å­˜è¿™ä¸ªé«˜åº¦ //å¡«å……cellå†…å®¹æ—¶ï¼Œæ ¹æ®contenté«˜åº¦æ¥è®¾ç½®labelé«˜åº¦12345678910111213- (void)fillCellWithModel:(HLItem *)item&#123; â€¦. CGRect frame = _content.frame;//_content æ˜¯å†…å®¹label frame.size = item.size; _content.frame = frame; â€¦..&#125; å¦å¤–åœ¨heightForRowAtIndexPath ä¸­æ·»åŠ ä¸€å®šçš„ä½™é‡ã€‚123456789101112131415161718//è‡ªé€‚åº”cellé«˜åº¦- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath&#123; //NSLog(@\"è®¡ç®—cellé«˜åº¦\");; if (indexPath.row == 0) &#123; return self.item.size.height+140; &#125; HLComment *item = _dataSource[indexPath.row-1]; return item.size.height+60;&#125;","link":"/2015/12/16/TableViewCellæ ¹æ®å†…å®¹è‡ªé€‚åº”é«˜åº¦çš„æ–¹æ³•/"},{"title":"iOSä¸­å¤„ç†å››èˆäº”å…¥çš„é—®é¢˜","text":"å¤„ç†å››èˆäº”å…¥ä¸»è¦ä½¿ç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼š12345678910-(NSString *)notRounding:(float)price afterPoint:(int)position&#123; NSDecimalNumberHandler* roundingBehavior = [NSDecimalNumberHandler decimalNumberHandlerWithRoundingMode:NSRoundDown scale:position raiseOnExactness:NO raiseOnOverflow:NO raiseOnUnderflow:NO raiseOnDivideByZero:NO]; NSDecimalNumber *ouncesDecimal; NSDecimalNumber *roundedOunces; ouncesDecimal = [[NSDecimalNumber alloc] initWithFloat:price]; roundedOunces = [ouncesDecimal decimalNumberByRoundingAccordingToBehavior:roundingBehavior]; [ouncesDecimal release]; return [NSString stringWithFormat:@\"%@\",roundedOunces];&#125;ä»‹ç»ä¸€ä¸‹å‚æ•°ï¼šprice:éœ€è¦å¤„ç†çš„æ•°å­—ï¼Œpositionï¼šä¿ç•™å°æ•°ç‚¹ç¬¬å‡ ä½ï¼Œç„¶åè°ƒç”¨1234float s =0.126; NSString *sb = [self notRounding:s afterPoint:2]; NSLog(@\"sb = %@\",sb);è¾“å‡ºç»“æœä¸ºï¼šsb = 0.12 æ¥ä¸‹æ¥ä»‹ç»NSDecimalNumberHandleråˆå§‹åŒ–æ—¶çš„å…³é”®å‚æ•°ï¼šdecimalNumberHandlerWithRoundingModeï¼šNSRoundDownï¼ŒNSRoundDownä»£è¡¨çš„å°±æ˜¯ åªèˆä¸å…¥ã€‚scaleçš„å‚æ•°positionä»£è¡¨ä¿ç•™å°æ•°ç‚¹åå‡ ä½ã€‚","link":"/2015/12/05/iOSä¸­å¤„ç†å››èˆäº”å…¥çš„é—®é¢˜/"},{"title":"iOS è“ç‰™4.0å¼€å‘","text":"iOS è“ç‰™4.0å¼€å‘ èƒŒæ™¯ï¼š1.iOSçš„è“ç‰™ä¸èƒ½ç”¨æ¥ä¼ è¾“æ–‡ä»¶ã€‚2.iOSä¸iOSè®¾å¤‡ä¹‹é—´è¿›è¡Œæ•°æ®é€šä¿¡ï¼Œä½¿ç”¨gameKit.framework3.iOSä¸å…¶ä»–éiOSè®¾å¤‡è¿›è¡Œæ•°æ®é€šä¿¡ï¼Œä½¿ç”¨coreBluetooth.frameworkiOSä¸­è“ç‰™çš„å®ç°æ–¹æ¡ˆ iOSä¸­æä¾›äº†4ä¸ªæ¡†æ¶ç”¨äºå®ç°è“ç‰™è¿æ¥GameKit.frameworkï¼ˆç”¨æ³•ç®€å•ï¼‰åªèƒ½ç”¨äºiOSè®¾å¤‡ä¹‹é—´çš„è¿æ¥ï¼Œå¤šç”¨äºæ¸¸æˆï¼ˆæ¯”å¦‚äº”å­æ£‹å¯¹æˆ˜ï¼‰ï¼Œä»iOS7å¼€å§‹è¿‡æœŸ MultipeerConnectivity.frameworkåªèƒ½ç”¨äºiOSè®¾å¤‡ä¹‹é—´çš„è¿æ¥ï¼Œä»iOS7å¼€å§‹å¼•å…¥ï¼Œä¸»è¦ç”¨äºæ–‡ä»¶å…±äº«ï¼ˆä»…é™äºæ²™ç›’çš„æ–‡ä»¶ï¼‰ ExternalAccessory.frameworkå¯ç”¨äºç¬¬ä¸‰æ–¹è“ç‰™è®¾å¤‡äº¤äº’ï¼Œä½†æ˜¯è“ç‰™è®¾å¤‡å¿…é¡»ç»è¿‡è‹¹æœMFiè®¤è¯ï¼ˆå›½å†…è¾ƒå°‘ï¼‰ CoreBluetooth.frameworkï¼ˆæ—¶ä¸‹çƒ­é—¨ï¼‰å¯ç”¨äºç¬¬ä¸‰æ–¹è“ç‰™è®¾å¤‡äº¤äº’ï¼Œå¿…é¡»è¦æ”¯æŒè“ç‰™4.0ç¡¬ä»¶è‡³å°‘æ˜¯4sï¼Œç³»ç»Ÿè‡³å°‘æ˜¯iOS6è“ç‰™4.0ä»¥ä½åŠŸè€—è‘—ç§°ï¼Œä¸€èˆ¬ä¹Ÿå«BLEï¼ˆBluetoothLowEnergyï¼‰ç›®å‰åº”ç”¨æ¯”è¾ƒå¤šçš„æ¡ˆä¾‹ï¼šè¿åŠ¨æ‰‹åã€åµŒå…¥å¼è®¾å¤‡ã€æ™ºèƒ½å®¶å±… ä¸‹é¢å…·ä½“ä»‹ç»ä½¿ç”¨CoreBluetooth.frameworkçš„ä»£ç æ­¥éª¤ï¼š 12345678910111213141516171819202122232425//è“ç‰™ç³»ç»Ÿåº“#import &lt;CoreBluetooth/CoreBluetooth.h&gt;//å¿…é¡»è¦ç”±UUIDæ¥å”¯ä¸€æ ‡ç¤ºå¯¹åº”çš„serviceå’Œcharacteristic#define kServiceUUID @\"5C476471-1109-4EBE-A826-45B4F9D74FB9\"#define kCharacteristicHeartRateUUID @\"82C7AC0F-6113-4EC9-92D1-5EEF44571398\"#define kCharacteristicBodyLocationUUID @\"537B5FD6-1889-4041-9C35-F6949D1CA034\"@interface ViewController ()&lt;CBCentralManagerDelegate,CBPeripheralDelegate&gt;@property (nonatomic,strong)CBCentralManager * centralManager;@property (nonatomic,strong)CBPeripheral * peripheral;@end åˆ›å»ºä¸­å¿ƒè§’è‰²1234567891011121314#import &lt;CoreBluetooth/CoreBluetooth.h&gt; - (void)viewDidLoad&#123; [super viewDidLoad]; //åˆå§‹åŒ–è“ç‰™ central manager _centralManager = [[CBCentralManager alloc]initWithDelegate:self queue:dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0) options:nil]; &#125; æ‰«æå¤–è®¾1[manager scanForPeripheralsWithServices:nil options:@&#123;CBCentralManagerRestoredStateScanOptionsKey:@(YES)&#125;]; è¿æ¥å¤–è®¾12345678910111213- (void)centralManager:(CBCentralManager *)central didDiscoverPeripheral:(CBPeripheral *)peripheral advertisementData:(NSDictionary *)advertisementData RSSI:(NSNumber *)RSSI &#123; if([peripheral.name isEqualToString:BLE_SERVICE_NAME])&#123; [self connect:peripheral]; &#125;s); &#125; -(BOOL)connect:(CBPeripheral *)peripheral&#123; self.manager.delegate = self; [self.manager connectPeripheral:peripheral options:[NSDictionary dictionaryWithObject:[NSNumber numberWithBool:YES] forKey:CBConnectPeripheralOptionNotifyOnDisconnectionKey]];&#125; æ‰«æå¤–è®¾ä¸­çš„æœåŠ¡å’Œç‰¹å¾1234567891011- (void)centralManager:(CBCentralManager *)central didConnectPeripheral:(CBPeripheral *)peripheral &#123; NSLog(@\"Did connect to peripheral: %@\", peripheral); _testPeripheral = peripheral; [peripheral setDelegate:self]; &lt;br&gt;//æŸ¥æ‰¾æœåŠ¡ [peripheral discoverServices:nil]; &#125; å‘ç°æœåŠ¡ï¼š123456789101112131415161718192021222324252627282930- (void)peripheral:(CBPeripheral *)peripheral didDiscoverServices:(NSError *)error &#123; NSLog(@\"didDiscoverServices\"); if (error) &#123; NSLog(@\"Discovered services for %@ with error: %@\", peripheral.name, [error localizedDescription]); if ([self.delegate respondsToSelector:@selector(DidNotifyFailConnectService:withPeripheral:error:)]) [self.delegate DidNotifyFailConnectService:nil withPeripheral:nil error:nil]; return; &#125; for (CBService *service in peripheral.services) &#123; //å‘ç°æœåŠ¡ if ([service.UUID isEqual:[CBUUID UUIDWithString:UUIDSTR_ISSC_PROPRIETARY_SERVICE]]) &#123; NSLog(@\"Service found with UUID: %@\", service.UUID); &lt;br&gt;//æŸ¥æ‰¾ç‰¹å¾ [peripheral discoverCharacteristics:nil forService:service]; break; &#125; &#125; &#125; å‘ç°æœåŠ¡ä¸­çš„ç‰¹å¾ï¼š12345678910111213141516171819202122- (void)peripheral:(CBPeripheral *)peripheral didDiscoverCharacteristicsForService:(CBService *)service error:(NSError *)error&#123; if (error) &#123; NSLog(@\"Discovered characteristics for %@ with error: %@\", service.UUID, [error localizedDescription]); [self error]; return; &#125; NSLog(@\"æœåŠ¡ï¼š%@\",service.UUID); for (CBCharacteristic *characteristic in service.characteristics) &#123; //å‘ç°ç‰¹å¾ if ([characteristic.UUID isEqual:[CBUUID UUIDWithString:@\"xxxxxxx\"]]) &#123; NSLog(@\"ç›‘å¬ï¼š%@\",characteristic);&lt;br&gt;//ç›‘å¬ç‰¹å¾ [self.peripheral setNotifyValue:YES forCharacteristic:characteristic]; &#125; &#125;&#125; ä¸å¤–è®¾è¿›è¡Œæ•°æ®äº¤äº’è¯»å–æ•°æ®ï¼š12345678910111213- (void)peripheral:(CBPeripheral *)peripheral didUpdateValueForCharacteristic:(CBCharacteristic *)characteristic error:(NSError *)error&#123; if (error) &#123; NSLog(@\"Error updating value for characteristic %@ error: %@\", characteristic.UUID, [error localizedDescription]); self.error_b = BluetoothError_System; [self error]; return; &#125; // NSLog(@\"æ”¶åˆ°çš„æ•°æ®ï¼š%@\",characteristic.value); [self decodeData:characteristic.value];&#125;å†™æ•°æ®ï¼š123NSData *d2 = [[PBABluetoothDecode sharedManager] HexStringToNSData:@\"0x02\"]; [self.peripheral writeValue:d2 forCharacteristic:characteristic type:CBCharacteristicWriteWithoutResponse];","link":"/2016/03/08/iOS-è“ç‰™4-0å¼€å‘/"},{"title":"cocos2d-x + Luaæ¥å…¥iOSåŸç”ŸSDKçš„å®ç°æ–¹æ¡ˆ","text":"æœ¬æ–‡è½¬è½½è‡ªcocos2d-x + Luaæ¥å…¥iOSåŸç”ŸSDKçš„å®ç°æ–¹æ¡ˆ-è‘—ä½œæƒå½’åŸä½œè€…æ‰€æœ‰ ç›¸ä¿¡å¾ˆå¤šæœ‹å‹åœ¨ä½¿ç”¨cocos2d-x+luaå¼€å‘æ¸¸æˆæ—¶éƒ½é‡åˆ°è¿‡æ¥å…¥iOSåŸç”ŸSDKçš„é—®é¢˜ï¼Œæ¯”å¦‚å¸¸è§çš„æ¥åº”ç”¨å†…æ”¯ä»˜SDKï¼Œå¹¿å‘ŠSDKæˆ–æ˜¯ä¸€äº›ç¤¾äº¤å¹³å°SDKç­‰ç­‰ï¼Œæˆ‘ä¹Ÿæ²¡å°‘æ¥è¿‡è¿™ç±»SDKã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯å¯¹æˆ‘åšè¿‡é¡¹ç›®ä¸­æ¥å…¥iOSåŸç”ŸSDKå®ç°æ–¹æ¡ˆçš„ä¸€ä¸ªæ€»ç»“ï¼Œåœ¨è¿™é‡Œåˆ†äº«ç»™å¤§å®¶ï¼Œå¸Œæœ›å¯¹è‡ªå·±å’Œå¤§å®¶çš„å¼€å‘å·¥ä½œéƒ½æœ‰å¸®åŠ©ã€‚ åœ¨å±•å¼€æ­£æ–‡ä¹‹å‰ï¼Œå…ˆåšå‡ ç‚¹è¯´æ˜ï¼š 1.æˆ‘è¿™é‡Œè¯´çš„iOSåŸç”ŸSDKæ˜¯æŒ‡é‚£äº›å®Œå…¨ç”¨Objective-Cè¯­è¨€å¼€å‘ï¼Œä¸ºåŸç”ŸiOSç¨‹åºè®¾è®¡çš„SDKã€‚swiftå¾ˆå¥½å¾ˆå¼ºå¤§ï¼Œä¸è¿‡æˆ‘è¿˜æ²¡ç”¨è¿‡ï¼Œæƒ­æ„§ï¼Œä¸è¿‡è¯­è¨€ç»ˆå½’åªæ˜¯è¡¨è¾¾æ–¹å¼è€Œå·²ï¼Œè§£å†³é—®é¢˜çš„æ€è·¯éƒ½æ˜¯ä¸€æ ·çš„ï¼› 2.è¿™é‡Œå‡è®¾æ¸¸æˆçš„ä¸»è¦é€»è¾‘ä½¿ç”¨luaå®ç°ï¼Œå¯¹äºä¸»è¦é€»è¾‘ä½¿ç”¨C++å®ç°çš„ï¼Œç”¨æœ¬æ–‡çš„æ€è·¯ä¸€æ ·å¯è¡Œï¼Œå¹¶ä¸”è®¾è®¡ä¸Šæ›´ç®€å•ï¼Œæ¥ç€å¾€ä¸‹çœ‹å°±çŸ¥é“äº†ï¼šï¼‰ 3.æœ¬æ–‡ä»¥quick-cocos2d-x 2.1ç‰ˆæœ¬ä¸ºä¾‹è¿›è¡Œè®²è§£ï¼Œä¸»è¦å› ä¸ºè¿™ä¸ªæ˜¯æˆ‘ä¹‹å‰åšé¡¹ç›®ç”¨å¾—æœ€å¤šçš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œ-xæ–°ç‰ˆæœ¬å˜åŠ¨æ¯”è¾ƒå¤§ï¼Œä½†æ˜¯ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œè§£å†³é—®é¢˜çš„æ€è·¯æ˜¯ç›¸åŒçš„ã€‚ â€”â€”â€”â€”â€”â€”-æ­£å¼å¼€å§‹çš„åˆ†å‰²çº¿â€”â€”â€”â€”â€”â€”- å¥½äº†ï¼Œæˆ‘ä»¬æ­£å¼å¼€å§‹ã€‚å¼€é—¨è§å±±ï¼ è§£å†³è¿™ç§æ¥å…¥é—®é¢˜ï¼Œå®é™…ä¸Šæœ€ä¸»è¦æ˜¯è§£å†³ä¸åŒè¯­è¨€äº¤äº’çš„é—®é¢˜ï¼Œä¸€æ—¦è·¨è¿‡è¯­è¨€äº¤äº’çš„éšœç¢ï¼Œå‰©ä¸‹çš„äº‹æƒ…å°±so easy! ç”±äºæ¶‰åŠåˆ°Lua,C++,Objective-Cä¸‰ç§è¯­è¨€ï¼Œè¿™ä¸ªé—®é¢˜è¡¨é¢ä¸Šçœ‹èµ·æ¥é”™ç»¼å¤æ‚ï¼Œä½†å…¶å®åªè¦å†·é™åœ°ï¼ˆ=ã€‚=ï¼‰æ¢³ç†ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å¾—åˆ°æ­£ç¡®çš„æ€è·¯ã€‚ å› ä¸ºæˆ‘ä»¬æ¸¸æˆçš„é€»è¾‘ä¸»è¦æ˜¯ç”¨Luaå®ç°çš„ï¼ˆå‰é¢å·²ç»åšè¿‡å‡è®¾ï¼‰ï¼Œè€ŒSDKæ˜¯ç”¨Objective-Cå®ç°ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦è§£å†³Luaä¸Objective-Cçš„äº¤äº’é—®é¢˜ï¼Œå³æœ€ç»ˆå¸Œæœ›è¾¾åˆ°çš„ç›®æ ‡æ˜¯ï¼Œåœ¨Luaå±‚é¢â€œè°ƒç”¨â€Objective-Cçš„ä»£ç ï¼ˆæ³¨æ„è¿™é‡Œçš„è°ƒç”¨æ˜¯åŠ å¼•å·çš„ï¼Œé—´æ¥çš„è°ƒç”¨ï¼‰ï¼Œè€Œå½“Objective-Cå±‚é¢æ”¶åˆ°SDKçš„å›è°ƒï¼Œå†é€šçŸ¥Luaã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒLuaå¹¶æ²¡æœ‰ç®€å•çš„æ–¹æ³•ç›´æ¥å’ŒObjective-Cäº¤æµï¼Œä½†æ˜¯Luaå¯ä»¥é€šè¿‡Lua Bindingå’ŒC/C++äº¤æµï¼Œè€Œæˆ‘ä»¬åˆçŸ¥é“ï¼ŒC++å’ŒObjective-Cå¯ä»¥æ··ç¼–ï¼Œå³C++å¯ä»¥ç›´æ¥è°ƒç”¨ï¼ˆè¿™é‡Œè°ƒç”¨æ²¡å¼•å·ï¼Œæ˜¯çœŸçš„ç›´æ¥è°ƒç”¨ï¼‰Objective-Cçš„ä»£ç ã€‚æƒ³åˆ°è¿™é‡Œï¼Œæ€è·¯å°±å¾ˆæ˜æ˜¾äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨C++ä¸ºLuaå’ŒObjective-Cçš„äº¤äº’å……å½“æ¡¥æ¢ï¼Œè¿›è€Œå®ç°Luaåˆ°Objective-Cçš„äº¤äº’ã€‚ æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹å›¾è¡¨è¾¾æˆ‘ä»¬çš„æ€è·¯ï¼Œæˆ‘ä»¬è¿™é‡Œå°†è¯­è¨€äº¤äº’çš„è¿‡ç¨‹åˆ†æˆäº†4ä¸ªå°éƒ¨åˆ†ï¼š æ•´ä¸ªè¯­è¨€äº¤äº’çš„è¿‡ç¨‹å¯ä»¥æ€»ç»“ä¸ºï¼šLuaè°ƒç”¨Lua Bindingçš„C++æ¥å£ï¼ŒC++æ¥å£è°ƒç”¨æ··ç¼–çš„Objective-Cæ¥å£ï¼Œè€ŒObjective-Cé€šè¿‡blockå½¢å¼çš„å›è°ƒï¼Œå°†ç»“æœé€šçŸ¥ç»™C++ï¼ŒC++é€šè¿‡Luaçš„C APIå°†æœ€ç»ˆç»“æœè¿”å›ç»™Luaã€‚è¿™æ ·ä¸€è¶Ÿä¸‹æ¥ï¼Œå°±å®Œæˆäº†Luaä¸Objective-Cçš„æ•´ä¸ªäº¤äº’è¿‡ç¨‹ã€‚ ç®€å•çš„è¯´ä¸€ä¸‹è¿™4éƒ¨åˆ†ï¼š 1.Lua Binding å°†C/C++æ¥å£å¯¼å‡ºç»™Luaè°ƒç”¨çš„æ–¹æ³•ï¼Œç”±äºç¯‡å¹…çš„åŸå› è¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œå…·ä½“å¯ä»¥å‚è€ƒLuaçš„æ–‡æ¡£ï¼Œä»¥åŠç½‘ä¸Šå…¶ä»–åœ°æ–¹çš„æ–‡ç« ã€‚ 2.æ··ç¼– Objective-Cçš„ä¸€å¤§ä¼˜ç‚¹å°±æ˜¯å¯ä»¥å’ŒCä¸C++æ··ç¼–ä½¿ç”¨ï¼Œå°±åƒåŒä¸€ä¸ªè¯­è¨€ä¸€æ ·å…±å­˜åœ¨ä¸€ä¸ªå®ç°æ–‡ä»¶é‡Œé¢ã€‚å…·ä½“æ··ç¼–è§„åˆ™ä¹Ÿä¸è¯´äº†ï¼Œè¿™é‡Œåªæä¸¤ä¸ªå°ç»†èŠ‚ï¼š ä¸€ï¼Œåœ¨XCodeä¸‹æ··ç¼–çš„å®ç°æ–‡ä»¶åç¼€æ˜¯.mmï¼Œè€Œä¸èƒ½æ˜¯.cppæˆ–è€…æ˜¯.mï¼› äºŒï¼Œæ··ç¼–çš„å®ç°æ–‡ä»¶å¼•ç”¨å¤´æ–‡ä»¶çš„åœ°æ–¹ï¼ŒC++æˆ–è€…Cçš„ç”¨#includeï¼Œè€ŒObjective-Cç”¨#importï¼Œç›¸äº’æ²¡æœ‰å½±å“ã€‚ 3.Blockå›è°ƒ Blockæ˜¯Objective-Cä¸€ä¸ªéå¸¸æ£’çš„ç‰¹æ€§ï¼Œæ›´æ£’çš„æ˜¯åœ¨Blocké‡Œé¢è¿˜å¯ä»¥ç›´æ¥å†™C++ä»£ç ï¼šï¼‰å…·ä½“æƒ³äº†è§£çš„å¯ä»¥çœ‹è‹¹æœå®˜æ–¹æ–‡æ¡£ã€‚ å…¶å®åœ¨æœ€åˆï¼Œæˆ‘æ›¾ç»å°è¯•è¿‡ä½¿ç”¨å‘é€é€šçŸ¥çš„æ–¹å¼æ¥å®ç°Objective-Cå¯¹C++çš„å›è°ƒï¼Œå³Objective-Cæ”¶åˆ°SDKå›è°ƒï¼Œç»™C++éƒ¨åˆ†å‘é€é™„å¸¦å›è°ƒä¿¡æ¯çš„é€šçŸ¥ï¼Œè™½ç„¶cocos2d-xä¸­æœ‰ç°æˆçš„NotificationCenteræ¥å¸®åŠ©å®ç°ï¼Œä½†è¿™ç§æ–¹å¼çš„ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„å¼Šç«¯æ˜¯å¤§å¤§å¢åŠ äº†C++ä»£ç å’ŒObjective-Cä»£ç çš„è€¦åˆåº¦ï¼ŒObjective-Céƒ¨åˆ†ä¹Ÿè¦æ··ç¼–C++è°ƒç”¨C++çš„NotificationCenterå‘é€šçŸ¥ï¼ŒC++éƒ¨åˆ†ä¹Ÿè¦æ··ç¼–Objective-Cä»£ç ï¼Œè°ƒç”¨C++çš„NotificationCenteræ”¶é€šçŸ¥ï¼Œè¿™ç§ç»“æ„å®åœ¨æ˜¯æœ‰å¤Ÿçƒ¦èºçš„ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œä½¿ç”¨Blockå›è°ƒå°±å¹²å‡€åˆ©è½å¤ªå¤šï¼ŒObjective-Cè¿™è¾¹ä¸€åˆ‡éƒ½æ˜¯çº¯ç²¹çš„ï¼Œå®ƒå¹¶ä¸éœ€è¦çŸ¥é“è‡ªå·±è¦è¢«C++è°ƒç”¨è¿˜æ˜¯Objective-Cè°ƒç”¨ï¼Œä¹Ÿä¸éœ€è¦èŠ±å¾ˆå¤šç²¾åŠ›åœ¨è¿”å›å›è°ƒä¸Šï¼Œåªéœ€è¦å¹²å¥½è‡ªå·±çš„æœ¬èŒå·¥ä½œï¼Œç„¶ååœ¨é€‚å½“çš„æ—¶å€™è°ƒç”¨Blockå°±ä¸€åˆ‡æå®šã€‚ 4.Lua C API Lua C APIç”¨äºC/C++ä¸Luaçš„äº¤äº’ï¼Œåœ¨cocos2d-xä¸­è¿™äº›C APIå·²ç»è¢«å°è£…æˆäº†æ›´åŠ æ˜“ç”¨çš„C++ Class APIã€‚è¿™é‡Œè¦æåˆ°çš„æ˜¯ï¼Œåœ¨ç”¨è¿™å¥—APIè°ƒç”¨Luaå‡½æ•°çš„æ—¶å€™ï¼Œä¸ºäº†ä¼ å‚ï¼Œéœ€è¦å‚æ•°å…¥æ ˆçš„æ“ä½œï¼Œè¿™ä¸ªå…¥æ ˆçš„é¡ºåºå½±å“åˆ°äº†Luaå‡½æ•°æ¥å—åˆ°å‚æ•°çš„é¡ºåºï¼Œä¸è¿‡å¥½åœ¨è§„åˆ™å¾ˆç®€å•ï¼šå…ˆå…¥æ ˆçš„å‚æ•°æ’åœ¨å‰æˆ–è€…è¯´æ˜¯å…¥æ ˆé¡ºåºå’Œå®å‚é¡ºåºç›¸åŒã€‚ä¸¾ä¾‹ï¼Œå¦‚æœC++è¿™è¾¹è°ƒç”¨Luaå‡½æ•°funcæ—¶ï¼Œå…¥æ ˆçš„é¡ºåºæ˜¯Aï¼ŒBï¼ŒCï¼Œé‚£ä¹ˆå°±æ˜¯è°ƒç”¨å‡½æ•°func(A,B,C) â€”â€”â€”â€”â€”â€”-æ¸å…¥ä½³å¢ƒçš„åˆ†å‰²çº¿â€”â€”â€”â€”â€”â€”- åœ¨æ•´ä¸ªè¯­è¨€äº¤äº’çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè®¤ä¸ºLuaæ˜¯é¡¶å±‚ï¼ŒObjective-Cæ˜¯åº•å±‚ï¼Œé‚£ä¹ˆåœ¨å®é™…æ¸¸æˆä¸­äº¤äº’çš„è¿‡ç¨‹å°±æ˜¯ä¸€ä¸ªè‡ªé¡¶å‘ä¸‹çš„è¿‡ç¨‹ï¼Œç„¶è€Œæˆ‘ä»¬åœ¨å®ç°å„å±‚çº§ä»£ç çš„æ—¶å€™ï¼Œéœ€è¦è‡ªåº•å‘ä¸Šå®Œæˆï¼Œå› ä¸ºåœ¨é¡¶å±‚Luaä»£ç ä¸­çš„é€»è¾‘ï¼Œæ˜¯ç”±åº•å±‚Objective-C SDKçš„æ¥å£ä¸åŠŸèƒ½å†³å®šçš„ã€‚å³æˆ‘ä»¬éœ€è¦å…ˆæ ¹æ®SDKä¸­åŸå§‹çš„Objective-Cçš„æ¥å£ï¼Œåšé€‚åˆæˆ‘ä»¬æ¸¸æˆObjective-Cå°è£…ä»£ç†ç±»ï¼Œç„¶åæ ¹æ®å°è£…ç»“æœå®ç°C++çš„bridgeæ¥å£ï¼Œæœ€åå†å®ç°Luaçš„å¯¹åº”é€»è¾‘ã€‚ æ ¹æ®ä»¥ä¸Šåˆ†æï¼Œä»å±‚çº§çš„è§’åº¦ï¼Œè®¾è®¡å¦‚ä¸‹ï¼š é™¤è¿‡Luaçš„é€»è¾‘ï¼Œæˆ‘ä»¬æœ€é‡è¦éœ€è¦å®ç°çš„ä¸¤éƒ¨åˆ†å†…å®¹ï¼šC++ Bridge Class å’Œ Objective-C SDK Delegate Classã€‚å‰è€…æ˜¯èµ·æ¡¥æ¢ä½œç”¨çš„æ¥å£ç±»ï¼ŒåŸåˆ™ä¸Šä¸åšä»»ä½•ä¸æ¸¸æˆé€»è¾‘ç›¸å…³çš„æ•°æ®å¤„ç†ï¼Œè€Œåè€…è´Ÿè´£å°è£…åŸå§‹çš„SDKæ¥å£ï¼Œæ¥æ”¶ä»¥åŠåˆæ­¥å¤„ç†SDKå›è°ƒæ•°æ®ã€‚å‰è€…çš„å®ç°ä¾èµ–äºåè€…çš„å®ç°ï¼Œè€Œåè€…çš„å®ç°åˆä¾èµ–äºSDKã€‚SDKå–å¾—çš„æ•°æ®æœ€ç»ˆé€šè¿‡å±‚å±‚ä¼ é€’ï¼Œäº¤ç»™Luaé€»è¾‘å¤„ç†ï¼Œæœ€ç»ˆä¿è¯å¯¹æ•°æ®å¤„ç†çš„æ¸¸æˆé€»è¾‘å°½å¯èƒ½å¤šçš„æ”¾åˆ°Luaå±‚ä¸­ã€‚ è¿™æ ·è®¾è®¡çš„å¥½å¤„æœ‰å¾ˆå¤šï¼Œä¸€æ–¹é¢ï¼Œé¡¶å±‚çš„æ¸¸æˆé€»è¾‘å˜åŠ¨ï¼Œä¸å½±å“ä¸‹å±‚å¤šè¯­è¨€äº¤äº’ä»£ç ï¼Œå¦ä¸€æ–¹é¢ï¼Œåº•å±‚çš„SDKå˜åŠ¨ï¼Œå¦‚ç‰ˆæœ¬æ›´æ–°ç”šè‡³æ›´æ¢ï¼Œä¸å½±å“ä¸Šå±‚æ¸¸æˆé€»è¾‘ï¼Œå¤šå±‚æ¬¡ç»“æ„æœ‰æ•ˆåœ°é™ä½äº†å¤æ‚åº¦ï¼Œéš”ç¦»äº†å˜åŒ–ï¼Œå¯¹äºé¢‘ç¹çš„éœ€æ±‚å˜æ›´ï¼Œè¿™ç§ç»“æ„ä¹Ÿå¯ä»¥ä¿è¯æ‰©å±•çš„ä¾¿åˆ©ã€‚ â€”â€”â€”â€”â€”â€”-æ€»ç»“çš„åˆ†å‰²çº¿â€”â€”â€”â€”â€”â€”- ç»¼ä¸Šæ‰€è¿°ï¼Œè§£å†³æ¥å…¥iOSåŸç”ŸSDKçš„é—®é¢˜ï¼Œä¸»è¦éœ€è¦4æ­¥ï¼š æ ¹æ®SDKæ¥å£ä¸åŠŸèƒ½å®ç°Objective-C SDK Delegate Classï¼› æ ¹æ®Objective-C SDK Delegate Classå®ç°å¯¹åº”çš„C++ Bridge Classï¼› æ ¹æ®C++ Bridge Classç”Ÿæˆå¯¹åº”çš„Lua Bindingä»£ç ï¼› å†™Luaå±‚é€»è¾‘ã€‚ â€”â€”â€”â€”â€”â€”-æœ€åçš„åˆ†å‰²çº¿â€”â€”â€”â€”â€”â€”- å¥½äº†ï¼Œæœ€åï¼Œåˆåˆ°äº†æ¿€åŠ¨äººå¿ƒçš„ä¸Šä»£ç çš„ç¯èŠ‚äº†ï¼šï¼‰ä¸‹é¢å°±ä»¥æŸiOSç¬¬ä¸‰æ–¹è®¡è´¹SDKä¸ºä¾‹ï¼Œæ¥è¯´æ˜ä¸‹å®ç°æ¥å…¥çš„æ­¥éª¤ã€‚ è¿™ä¸ªSDKåªæœ‰ä¸€ä¸ªå¤´æ–‡ä»¶GameBilling.hï¼Œä¸»è¦ä½¿ç”¨åˆ°çš„æ–¹æ³•å’ŒProtocolå¦‚ä¸‹ï¼šï¼ˆä¸ºäº†é¿å…ç¯‡å¹…è¿‡é•¿ç­‰åŸå› ï¼ŒæŠŠæ³¨é‡Šå’Œä¸å¿…è¦çš„ä»£ç éƒ½åˆ æ‰äº†ï¼‰ã€‚æˆ‘ç”¨ä»£ç æ³¨é‡Šçš„æ–¹å¼è¯´æ˜äº†å„æ–¹æ³•çš„ç”¨é€”ã€‚ 1234567891011121314 1 // åˆå§‹åŒ–è®¡è´¹SDK 2 + (GameBilling *)initializeGameBilling; 3 4 // å‘Šè¯‰SDKæ¸¸æˆå±å¹•çš„Orientationï¼Œä»¥ä¾¿SDKå±•ç¤ºæ­£ç¡®çš„UI 5 - (void)setDialogOrientationMask:(UIInterfaceOrientationMask)orientationMask; 6 7 // ç¡®è®¤ä»˜è´¹ï¼Œæ˜¾ç¤ºä»˜è´¹UI 8 - (void)doBillingWithUIAndBillingIndex:(NSString *)billingIndex isRepeated:(BOOL)isRepeated cpParam:(NSString*)cpParam; 9 10 // Delegateå›è°ƒï¼Œå‘Šè¯‰è°ƒç”¨è€…ä»˜è´¹æ˜¯å¦æˆåŠŸç­‰ä¿¡æ¯11 @protocol GameBillingDelegate&lt;NSObject&gt;12 @required13 - (void)onBillingResult:(BillingResultType)resultCode billingIndex:(NSString *)index message:(NSString *)message;14 @end ä»¥ä¸Šå‰ä¸¤ä¸ªæ–¹æ³•ç”¨äºåˆå§‹åŒ–SDKï¼Œå¹¶ä¸”å’Œæ¸¸æˆçš„é€»è¾‘æ²¡ä»€ä¹ˆå¤ªå¤§å…³ç³»ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå¯¹ä»–ä»¬çš„è°ƒç”¨æ”¾åœ¨ç¨‹åºå¼€å§‹çš„ä½ç½®ï¼Œä¸å¿…å¯¼å‡ºç»™Luaã€‚ç¬¬ä¸‰ä¸ªæ–¹æ³•åœ¨ç”¨æˆ·ç¡®è®¤ä»˜è´¹æ—¶ä½¿ç”¨ï¼Œéœ€è¦å¯¼å‡ºç»™Luaï¼Œå½“ç”¨æˆ·åœ¨æ¸¸æˆç•Œé¢åšç›¸åº”æ“ä½œæ—¶å€™è°ƒç”¨ã€‚æœ€åçš„delegateçš„å›è°ƒï¼Œæˆ‘ä»¬ç”¨å‰é¢æåˆ°çš„Objective-C SDK Delegate Classæ¥æ¥æ”¶ï¼Œå¹¶ä½œåˆæ­¥å¤„ç†ï¼Œå†ç”¨Blockä¼ ç»™C++ Bridge Class. å¥½çš„ï¼Œé‚£æˆ‘ä»¬å…ˆæ¥å®ŒæˆObjective-C SDK Delegate Classã€‚è¿™é‡Œè¿™ä¸ªObjective-Cåšæˆäº†ä¸ªç®€å•çš„å•ä¾‹æ¥ä½¿ç”¨ï¼Œå®é™…å¯èƒ½ä¸éœ€è¦è¿™ä¹ˆåšã€‚ å…ˆå®Œæˆå¤´æ–‡ä»¶ï¼Œè¿™é‡Œå‘½åä¸ºCMGCIAPiOS.hï¼Œå¦‚ä¸‹ï¼š 12345678910111213141516171819202122 1 #import \"GameBilling.h\" 2 3 // å£°æ˜Block 4 typedef void (^BillingResultCallback)(BOOL success, NSString *index,NSString *message); 5 6 @interface CMGCIAPiOS : NSObject&lt;GameBillingDelegate&gt; 7 &#123; 8 GameBilling *_sdk; 9 NSString *_billingIndex;10 BillingResultCallback _callback;11 &#125;12 13 +(id)sharedInstance;14 15 -(void)setDialogOrientationMask:(UIInterfaceOrientationMask)orientationMask;16 17 -(void)doBillingWithUIAndBillingIndex:(NSString *)billingIndex 18 isRepeated:(BOOL)isRepeated 19 cpParam:(NSString*)cpParam20 resultCallback:(BillingResultCallback)callback;21 22 @end åº”è¯¥å¾ˆæ¸…æ¥šï¼Œå°±ä¸å¤šåšè¯´æ˜äº†ã€‚ ä¸‹é¢æ˜¯å®ç°æ–‡ä»¶CMGCIAPiOS.mï¼Œå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071 1 #import \"CMGCIAPiOS.h\" 2 3 @implementation CMGCIAPiOS 4 5 static CMGCIAPiOS *_sharedInstance = nil; 6 7 + (id)sharedInstance 8 &#123; 9 @synchronized(self)10 &#123;11 if (_sharedInstance == nil)12 &#123;13 _sharedInstance = [[CMGCIAPiOS alloc] init];14 &#125;15 &#125;16 return _sharedInstance;17 &#125;18 19 -(id) init20 &#123;21 if( (self = [super init]) ) 22 &#123;23 _sdk = [GameBilling initializeGameBilling];24 _sdk.delegate = self;25 &#125;26 return self;27 &#125;28 29 -(void)setDialogOrientationMask:(UIInterfaceOrientationMask)orientationMask30 &#123;31 [_sdk setDialogOrientationMask:orientationMask];32 &#125;33 34 - (void)doBillingWithUIAndBillingIndex:(NSString *)billingIndex 35 isRepeated:(BOOL)isRepeated 36 cpParam:(NSString*)cpParam37 resultCallback:(BillingResultCallback)callback38 &#123;39 40 if (_callback != nil)41 &#123;42 [_callback release];43 _callback = nil;44 &#125;45 46 _callback = [callback copy]; // æ³¨æ„è¦copy47 48 [_sdk doBillingWithUIAndBillingIndex:billingIndex 49 isRepeated:isRepeated 50 cpParam:cpParam];51 &#125;52 53 #pragma mark - GameBillingDelegate54 - (void)onBillingResult:(BillingResultType)resultCode55 billingIndex:(NSString *)index 56 message:(NSString *)message57 &#123;58 BOOL b = (resultCode == BillingResultType_PaySuccess || resultCode == BillingResultType_PaySuccess_Activated);59 NSLog(@\"billing = %@ %@ %@\", b ? @\"yes\":@\"no\", index, message);60 61 if (_callback != nil)62 &#123;63 _callback(b,index,message);64 65 // è°ƒç”¨å®Œæˆå°±é‡Šæ”¾æ‰66 [_callback release];67 _callback = nil;68 &#125;69 &#125;70 71 @end å¯ä»¥çœ‹åˆ°å¯¹æåˆ°çš„å‡ ä¸ªæ–¹æ³•éƒ½åšäº†å°è£…ï¼Œå¹¶ä¸”æ¥æ”¶äº†å›è°ƒã€‚ ä¸‹é¢æ˜¯C++ Bridge Classéƒ¨åˆ†ï¼Œå¤´æ–‡ä»¶CMGCIAP.h: 123456789101112131415161718192021222324 1 #include &lt;iostream&gt; 2 3 class CMGCIAP 4 &#123; 5 public: 6 CMGCIAP(); 7 ~CMGCIAP(); 8 9 public:10 static CMGCIAP *sharedInstance();11 12 bool init();13 14 void setDoBillingCallbackScriptHandler(int scriptHandler); // for lua callback15 16 void doBillingWithUI(const char* billingIndex,17 bool isRepeated,18 const char* cpParam);19 20 private:21 22 int m_doBillingCallbackScriptHandler;23 24 &#125;; ç”±äºç”¨cocos2d-xçš„toluaå·¥å…·åšLua Bindingçš„åŸå› ï¼Œæˆ‘æŠŠè®¾ç½®Luaå›è°ƒçš„æ–¹æ³•å•ç‹¬æå‡ºæ¥äº†ï¼Œå¦‚ä¸‹ï¼š 1 void setDoBillingCallbackScriptHandler(int scriptHandler);æ›´å¥½çš„åšæ³•æ˜¯æŠŠè¿™ä¸ªscriptHandleræ”¾åˆ°ä¸‹é¢è¿™ä¸ªå‡½æ•°ä¸­ï¼Œè¿™æ ·æ¥å£å°±å¯ä»¥å’ŒObjectiveçš„ä¿æŒä¸€è‡´äº†ã€‚ 1 void doBillingWithUI(const char billingIndex,2 bool isRepeated,3 const char cpParam);ä¸è¿‡ä¹Ÿæ²¡å…³ç³»ï¼Œç‹¬ç«‹è®¾ç½®Luaå›è°ƒå‡½æ•°ä¹Ÿæœ‰æ›´çµæ´»çš„ä¼˜ç‚¹ã€‚ æ³¨æ„ï¼ŒC++ Bridge Classå¤´æ–‡ä»¶ä¸€å®šä¿æŒâ€œçº¯æ´æ€§â€ï¼Œåšçº¯ç²¹çš„C++æ–‡ä»¶ï¼Œä¸èƒ½å‡ºç°Objective-Cçš„ä»»ä½•ä»£ç ï¼Œå¦åˆ™å°±ç ´åäº†ä¸Šé¢è®²åˆ°çš„å±‚æ¬¡ç»“æ„ã€‚ ä¸‹é¢æ˜¯å®ç°æ–‡ä»¶CMGCIAP.mm: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071 1 #include \"CMGCIAP.h\" 2 #include \"cocos2d.h\" 3 #include \"script_support/CCScriptSupport.h\" 4 5 #import \"CMGCIAPiOS.h\" 6 #import &lt;Foundation/Foundation.h&gt; 7 #import &lt;UIKit/UIKit.h&gt; 8 9 USING_NS_CC;10 11 static CMGCIAP* s_sharedInstance = NULL;12 13 CMGCIAP::CMGCIAP()14 &#123;15 m_doBillingCallbackScriptHandler = 0;16 &#125;17 18 CMGCIAP::~CMGCIAP()19 &#123;20 21 &#125;22 23 CMGCIAP *CMGCIAP::sharedInstance()24 &#123;25 if (s_sharedInstance == NULL)26 &#123;27 s_sharedInstance = new CMGCIAP();28 &#125;29 30 return s_sharedInstance;31 &#125;32 33 // initæ–¹æ³•å°è£…äº†å¯¹SDKçš„åˆå§‹åŒ–34 bool CMGCIAP::init()35 &#123;36 // ç”±äºæ˜¯ç«–å±çš„æ¸¸æˆï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥è®¾ç½®å¥½äº†37 [[CMGCIAPiOS sharedInstance] setDialogOrientationMask:UIInterfaceOrientationMaskPortrait];38 39 return true;40 &#125;41 42 void CMGCIAP::setDoBillingCallbackScriptHandler(int scriptHandler)43 &#123;44 m_doBillingCallbackScriptHandler = scriptHandler;45 &#125;46 47 void CMGCIAP::doBillingWithUI(const char* billingIndex,48 bool isRepeated,49 const char* cpParam)50 &#123;51 52 NSString *billingIndexString = [NSString stringWithUTF8String:billingIndex];53 54 NSString *cpParamString = [NSString stringWithUTF8String:cpParam];55 56 [[CMGCIAPiOS sharedInstance] doBillingWithUIAndBillingIndex:billingIndexString57 isRepeated:isRepeated58 cpParam:cpParamString59 resultCallback:^(BOOL success, NSString *index,NSString *message)&#123;60 61 //é€šè¿‡Blockå°†è¿”å›ç»“æœä¼ ç»™Luaï¼ŒObjective-Cåˆ°C++çš„æ— ç¼è¿æ¥ï¼šï¼‰62 63 CCLuaStack *stack = CCLuaEngine::defaultEngine()-&gt;getLuaStack();64 stack-&gt;clean();65 stack-&gt;pushBoolean(success);66 stack-&gt;pushString([index UTF8String]);67 stack-&gt;pushString([message UTF8String]);68 stack-&gt;executeFunctionByHandler(m_doBillingCallbackScriptHandler, 3);69 70 &#125;];71 &#125; å¥½äº†ï¼Œæ¥ä¸‹æ¥åªéœ€è¦å¯¹C++ Bridge ClassåšLua Bindingï¼Œç”Ÿæˆç»‘å®šæ–‡ä»¶ï¼Œå¦‚æœç”¨toluaåšç»‘å®šï¼Œç»‘å®šé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š 12345678910 1 class CMGCIAP 2 &#123; 3 static CMGCIAP *sharedInstance(); 4 5 void setDoBillingCallbackScriptHandler(LUA_FUNCTION nHandler); 6 7 void doBillingWithUI(const char* billingIndex, 8 bool isRepeated, 9 const char* cpParam);10 &#125; OKï¼Œåˆ°è¿™é‡Œä¸»è¦çš„ç¼–ç å·¥ä½œå°±å®Œæˆäº†ï¼Œè®°å¾—è¦åœ¨ç¨‹åºçš„é€‚å½“ä½ç½®åšå¥½Lua Bindingåˆå§‹åŒ–å·¥ä½œã€‚ å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œåœ¨ä»¥ä¸Šå·¥ä½œå®Œæˆåï¼Œåœ¨Luaé‡Œé¢å·²ç»å¯ä»¥ç›´æ¥è°ƒç”¨SDKçš„æ¥å£äº†ï¼Œæ¥ä¸‹æ¥çš„äº‹æƒ…å°±é ä½ ä»¬äº†ï¼šï¼‰","link":"/2017/09/21/cocos2d-x-Luaæ¥å…¥iOSåŸç”ŸSDKçš„å®ç°æ–¹æ¡ˆ/"},{"title":"iOSå¼€å‘æŠ€æœ¯æ ˆ","text":"æé†’è‡ªå·±ï¼š Objective-Câ€¢ objective-cè¯­è¨€åŸºç¡€â€¢ library,frameworkçš„åˆ¶ä½œâ€¢ Runtimeç¼–ç¨‹â€¢ LLVMåŸç†å’Œè°ƒä¼˜ æ“ä½œç³»ç»Ÿâ€¢ iOSå†…å­˜ç®¡ç†å’Œè°ƒä¼˜â€¢ iOSçš„æ–‡ä»¶ç³»ç»Ÿå’Œæ²™ç›’æœºåˆ¶â€¢ iOSå¤šçº¿ç¨‹ç¼–ç¨‹ï¼ˆThread,GCD,NSOperationï¼‰â€¢ iOSç½‘ç»œå’ŒæœåŠ¡å™¨ç¼–ç¨‹ï¼ˆNSURLConnection,NSURLSessionï¼‰â€¢ iOSç³»ç»Ÿçš„å„ç§å®‰å…¨æœºåˆ¶ ç½‘ç»œç¼–ç¨‹â€¢ iOSç½‘ç»œå‘é€æœºåˆ¶è°ƒæ•´å’Œä¼˜åŒ–ï¼ˆNSURLSessionï¼‰â€¢ Socketç¼–ç¨‹â€¢ç½‘ç»œä¼ è¾“ä¸­çš„å„ç§ä¿éšœâ€¢å¯¹ä¼ è¾“åè®®çš„è°ƒæ•´ä¼˜åŒ– æ•°æ®åº“&amp;æŒä¹…åŒ–æ–¹æ¡ˆâ€¢ å¸¸è§„æŒä¹…åŒ–æ–¹æ¡ˆï¼ˆKeychain,NSUserDefaults,Sqlite,CoreDataï¼‰â€¢æ•°æ®åº“çš„ä½¿ç”¨å’Œè®¾è®¡ï¼ˆSqliteï¼‰â€¢æ•°æ®ç»“æ„ä¼˜åŒ–ï¼ŒSqlè°ƒä¼˜ å›¾å½¢å›¾åƒç¼–ç¨‹â€¢ UIKit,Core Animationå’ŒCore Textçš„ç»˜åˆ¶â€¢ Core Graphics, Quartz 2D, Media Player, AV Foundationâ€¢ OpenGL ES, GLKit, SpriteKit, SceneKit, Metal æ•°æ®ç»“æ„ &amp; ç®—æ³•â€¢åŸºæœ¬çš„ç®—æ³•å’Œæ•°æ®ç»“æ„ï¼ˆæ’åºæœç´¢ç®—æ³•, æ•°ç»„, é˜Ÿåˆ—ï¼‰â€¢è¾ƒå¤æ‚æ•°æ®ç»“æ„çš„çµæ´»åº”ç”¨ï¼ˆäºŒå‰æ ‘, å›¾ç­‰ï¼‰â€¢å¤æ‚çš„ä¸“é¡¹ç®—æ³•ï¼ˆå›¾åƒè¯†åˆ«ç®—æ³•, æ‹“æ‰‘å®šä½ç­‰ç­‰ï¼‰ å®‰å…¨æ–¹æ¡ˆâ€¢ æœ¬åœ°æ•°æ®å­˜å‚¨å®‰å…¨ï¼ˆKeychainï¼‰â€¢æˆæƒå’Œèº«ä»½éªŒè¯â€¢ä¼ è¾“å®‰å…¨ï¼ˆå¯¹ç§°, éå¯¹ç§°, SSLï¼‰â€¢ Appä»£ç å®‰å…¨ ä¸šåŠ¡èƒ½åŠ›â€¢ä¸€èˆ¬æ€§ä¸šåŠ¡åŠŸèƒ½éœ€æ±‚åˆ†æåŠå®ç°â€¢é‡è¦ä¸šåŠ¡æ¨¡å—çš„éœ€æ±‚åˆ†æåŠå®ç°â€¢ä¸­å°è§„æ¨¡äº§å“çš„æ¶æ„ï¼Œç³»ç»Ÿè®¾è®¡å’Œå®ç°â€¢å¤§è§„æ¨¡äº§å“æˆ–äº§å“çº¿çš„æ¶æ„ï¼Œç³»ç»Ÿè®¾è®¡å’Œå®ç°â€¢å¹³å°çº§äº§å“çš„æ¶æ„ï¼Œç³»ç»Ÿè®¾è®¡å’Œå®ç°","link":"/2016/12/12/iOSå¼€å‘æŠ€æœ¯æ ˆ/"},{"title":"pythonä»£ç è¿è¡Œåœ¨iOSå·¥ç¨‹ä¸­çš„æ–¹æ¡ˆ","text":"ä¸€ç§Xcodeå·¥ç¨‹å†…æ‰§è¡Œpythonè„šæœ¬çš„æ–¹æ³•ï¼Œè¯¦è§ä¸‹æ–‡ã€‚ 1.ä¸‹è½½è§£å‹Python-iOS.zipæ–‡ä»¶ï¼Œæ‰“å¼€python-ios.xcworkspaceã€‚2.Command+Rè¿è¡Œï¼Œæ­¤æ—¶åœ¨æ¨¡æ‹Ÿå™¨ä¸Šä¼šæœ‰appç”Ÿæˆï¼›å¹¶ä¸”Xcodeçš„consoleä¸­ä¼šæœ‰logæ‰“å°3.å¯ä»¥ç‚¹å‡»Send MsgæŒ‰é’®ï¼Œä¼šæœ‰å¦‚ä¸‹log å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥127.0.0.1:8000 å®ç°æ–¹æ³•ï¼š1.ä¸»è¦é›†æˆäº†pythonåŸºç¡€åº“libPythonå’Œé™æ€åº“liblibpython.a2.include python.h,ä»¥åŠpython å‡½æ•°çš„ä½¿ç”¨æ–¹å¼ï¼šçº¢è‰²æ¡†ä¸­server.pyè„šæœ¬è¢«æ”¾åˆ°äº†å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œè§£å†³äº†å¡ä½ä¸»çº¿ç¨‹çš„é—®é¢˜ã€‚ 3.åŒæ—¶æˆ‘ä¹Ÿç»™å‡ºäº†ä¸€ä¸ªåœ¨ç”¨æˆ·ç•Œé¢å‘æœ¬åœ°æœåŠ¡å™¨æ¶ˆæ¯äº¤äº’çš„ä¾‹å­ï¼Œä½¿ç”¨socketã€‚ ä¾‹å­æ¯”è¾ƒç®€å•ï¼Œå®ç°äº†æœ€åŸºç¡€çš„åœ¨ç”¨æˆ·ç•Œé¢ä¸æœ¬åœ°æœåŠ¡å™¨é€šä¿¡çš„ä¾‹å­ã€‚å¹¶ä¸”ä¸å½±å“iOSç›¸å…³ä»£ç çš„ç¼–å†™ã€‚ ç”±äºé™„ä»¶è¾ƒå¤§ï¼Œä¸Šä¼ åˆ°äº†Githubã€‚https://github.com/koalahl/PythonIniOS","link":"/2016/07/11/pythonä»£ç è¿è¡Œåœ¨iOSå·¥ç¨‹ä¸­çš„æ–¹æ¡ˆ/"},{"title":"iOSå¼€å‘ARCå†…å­˜ç®¡ç†æŠ€æœ¯è¦ç‚¹","text":"æœ¬æ–‡è½¬è½½è‡ªiOSå¼€å‘ARCå†…å­˜ç®¡ç†æŠ€æœ¯è¦ç‚¹-è‘—ä½œæƒå½’åŸä½œè€…æ‰€æœ‰ â€œæœ¬æ–‡æ¥æºäºæˆ‘ä¸ªäººçš„ARCå­¦ä¹ ç¬”è®°ï¼Œæ—¨åœ¨é€šè¿‡ç®€æ˜æ‰¼è¦çš„æ–¹å¼æ€»ç»“å‡ºiOSå¼€å‘ä¸­ARC(Automatic Reference Countingï¼Œè‡ªåŠ¨å¼•ç”¨è®¡æ•°)å†…å­˜ç®¡ç†æŠ€æœ¯çš„è¦ç‚¹ï¼Œæ‰€ä»¥ä¸ä¼šæ¶‰åŠå…¨éƒ¨ç»†èŠ‚ã€‚è¿™ç¯‡æ–‡ç« ä¸æ˜¯ä¸€ç¯‡æ ‡å‡†çš„ARCä½¿ç”¨æ•™ç¨‹ï¼Œå¹¶å‡å®šè¯»è€…å·²ç»å¯¹ARCæœ‰äº†ä¸€å®šäº†è§£å’Œä½¿ç”¨ç»éªŒã€‚è¯¦ç»†çš„å…³äºARCçš„ä¿¡æ¯è¯·å‚è§è‹¹æœçš„å®˜æ–¹æ–‡æ¡£ä¸ç½‘ä¸Šçš„å…¶ä»–æ•™ç¨‹ï¼šï¼‰â€ æœ¬æ–‡çš„ä¸»è¦å†…å®¹ï¼š ARCçš„æœ¬è´¨ ARCçš„å¼€å¯ä¸å…³é—­ ARCçš„ä¿®é¥°ç¬¦ ARCä¸Block ARCä¸Toll-Free Bridging ARCçš„æœ¬è´¨ARCæ˜¯ç¼–è¯‘å™¨ï¼ˆæ—¶ï¼‰ç‰¹æ€§ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶ç‰¹æ€§ï¼Œæ›´ä¸æ˜¯åƒåœ¾å›æ”¶å™¨(GC)ã€‚Automatic Reference Counting (ARC) is a compiler-level feature that simplifies the process of managing object lifetimes (memory management) in Cocoa applications. ARCåªæ˜¯ç›¸å¯¹äºMRCï¼ˆManual Reference Countingæˆ–ç§°ä¸ºéARCï¼Œä¸‹æ–‡ä¸­æˆ‘ä»¬ä¼šä¸€ç›´ä½¿ç”¨MRCæ¥æŒ‡ä»£éARCçš„ç®¡ç†æ–¹å¼ï¼‰çš„ä¸€æ¬¡æ”¹è¿›ï¼Œä½†å®ƒå’Œä¹‹å‰çš„æŠ€æœ¯æœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«ã€‚å…·ä½“ä¿¡æ¯å¯ä»¥å‚è€ƒARCç¼–è¯‘å™¨å®˜æ–¹æ–‡æ¡£ã€‚ ARCçš„å¼€å¯ä¸å…³é—­ä¸åŒäºXCode4å¯ä»¥åœ¨åˆ›å»ºå·¥ç¨‹æ—¶é€‰æ‹©å…³é—­ARCï¼ŒXCode5åœ¨åˆ›å»ºçš„å·¥ç¨‹æ˜¯é»˜è®¤å¼€å¯ARCï¼Œæ²¡æœ‰å¯ä»¥å…³é—­ARCçš„é€‰é¡¹ã€‚ å¦‚æœéœ€è¦å¯¹ç‰¹å®šæ–‡ä»¶å¼€å¯æˆ–å…³é—­ARCï¼Œå¯ä»¥åœ¨å·¥ç¨‹é€‰é¡¹ä¸­é€‰æ‹©Targets -&gt; Compile Phases -&gt; Compile Sourcesï¼Œåœ¨é‡Œé¢æ‰¾åˆ°å¯¹åº”æ–‡ä»¶ï¼Œæ·»åŠ flag: æ‰“å¼€ARCï¼š-fobjc-arc å…³é—­ARCï¼š-fno-objc-arcå¦‚å›¾ï¼š ARCçš„ä¿®é¥°ç¬¦ARCä¸»è¦æä¾›äº†4ç§ä¿®é¥°ç¬¦ï¼Œä»–ä»¬åˆ†åˆ«æ˜¯:__strong,__weak,__autoreleasing,__unsafe_unretainedã€‚ __strong è¡¨ç¤ºå¼•ç”¨ä¸ºå¼ºå¼•ç”¨ã€‚å¯¹åº”åœ¨å®šä¹‰propertyæ—¶çš„â€strongâ€ã€‚æ‰€æœ‰å¯¹è±¡åªæœ‰å½“æ²¡æœ‰ä»»ä½•ä¸€ä¸ªå¼ºå¼•ç”¨æŒ‡å‘æ—¶ï¼Œæ‰ä¼šè¢«é‡Šæ”¾ã€‚ æ³¨æ„ï¼šå¦‚æœåœ¨å£°æ˜å¼•ç”¨æ—¶ä¸åŠ ä¿®é¥°ç¬¦ï¼Œé‚£ä¹ˆå¼•ç”¨å°†é»˜è®¤æ˜¯å¼ºå¼•ç”¨ã€‚å½“éœ€è¦é‡Šæ”¾å¼ºå¼•ç”¨æŒ‡å‘çš„å¯¹è±¡æ—¶ï¼Œéœ€è¦å°†å¼ºå¼•ç”¨ç½®nilã€‚ __weak è¡¨ç¤ºå¼•ç”¨ä¸ºå¼±å¼•ç”¨ã€‚å¯¹åº”åœ¨å®šä¹‰propertyæ—¶ç”¨çš„â€weakâ€ã€‚å¼±å¼•ç”¨ä¸ä¼šå½±å“å¯¹è±¡çš„é‡Šæ”¾ï¼Œå³åªè¦å¯¹è±¡æ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘ï¼Œå³ä½¿æœ‰100ä¸ªå¼±å¼•ç”¨å¯¹è±¡æŒ‡å‘ä¹Ÿæ²¡ç”¨ï¼Œè¯¥å¯¹è±¡ä¾ç„¶ä¼šè¢«é‡Šæ”¾ã€‚ä¸è¿‡å¥½åœ¨ï¼Œå¯¹è±¡åœ¨è¢«é‡Šæ”¾çš„åŒæ—¶ï¼ŒæŒ‡å‘å®ƒçš„å¼±å¼•ç”¨ä¼šè‡ªåŠ¨è¢«ç½®nilï¼Œè¿™ä¸ªæŠ€æœ¯å«zeroing weak pointerã€‚è¿™æ ·æœ‰æ•ˆå¾—é˜²æ­¢æ— æ•ˆæŒ‡é’ˆã€é‡æŒ‡é’ˆçš„äº§ç”Ÿã€‚__weakä¸€èˆ¬ç”¨åœ¨delegateå…³ç³»ä¸­é˜²æ­¢å¾ªç¯å¼•ç”¨æˆ–è€…ç”¨æ¥ä¿®é¥°æŒ‡å‘ç”±Interface Builderç¼–è¾‘ä¸ç”Ÿæˆçš„UIæ§ä»¶ã€‚ __autoreleasing è¡¨ç¤ºåœ¨autorelease poolä¸­è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡çš„å¼•ç”¨ï¼Œå’ŒMRCæ—¶ä»£autoreleaseçš„ç”¨æ³•ç›¸åŒã€‚å®šä¹‰propertyæ—¶ä¸èƒ½ä½¿ç”¨è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œä»»ä½•ä¸€ä¸ªå¯¹è±¡çš„propertyéƒ½ä¸åº”è¯¥æ˜¯autoreleaseå‹çš„ã€‚ ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯ï¼Œåœ¨ARCä¸­æ²¡æœ‰autoreleaseï¼Œå› ä¸ºè¿™æ ·ä¸€ä¸ªâ€œè‡ªåŠ¨é‡Šæ”¾â€çœ‹èµ·æ¥å¥½åƒæœ‰ç‚¹å¤šä½™ã€‚è¿™ä¸ªè¯¯è§£å¯èƒ½æºè‡ªäºå°†ARCçš„â€œè‡ªåŠ¨â€å’Œautoreleaseâ€œè‡ªåŠ¨â€çš„æ··æ·†ã€‚å…¶å®ä½ åªè¦çœ‹ä¸€ä¸‹æ¯ä¸ªiOS Appçš„main.mæ–‡ä»¶å°±èƒ½çŸ¥é“ï¼Œautoreleaseä¸ä»…å¥½å¥½çš„å­˜åœ¨ç€ï¼Œå¹¶ä¸”å˜å¾—æ›´fashionäº†ï¼šä¸éœ€è¦å†æ‰‹å·¥è¢«åˆ›å»ºï¼Œä¹Ÿä¸éœ€è¦å†æ˜¾å¼å¾—è°ƒç”¨[drain]æ–¹æ³•é‡Šæ”¾å†…å­˜æ± ã€‚ ä»¥ä¸‹ä¸¤è¡Œä»£ç çš„æ„ä¹‰æ˜¯ç›¸åŒçš„ã€‚12NSString *str = [[[NSString alloc] initWithFormat:@\"hehe\"] autorelease]; // MRCNSString *__autoreleasing str = [[NSString alloc] initWithFormat:@\"hehe\"]; // ARC è¿™é‡Œå…³äºautoreleasepoolå°±ä¸åšå±•å¼€äº†ï¼Œè¯¦ç»†åœ°ä¿¡æ¯å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£æˆ–è€…å…¶ä»–æ–‡ç« ã€‚ __autoreleasingåœ¨ARCä¸­ä¸»è¦ç”¨åœ¨å‚æ•°ä¼ é€’è¿”å›å€¼ï¼ˆout-parametersï¼‰å’Œå¼•ç”¨ä¼ é€’å‚æ•°ï¼ˆpass-by-referenceï¼‰çš„æƒ…å†µä¸‹ã€‚ __autoreleasing is used to denote arguments that are passed by reference (id *) and are autoreleased on return. æ¯”å¦‚å¸¸ç”¨çš„NSErrorçš„ä½¿ç”¨ï¼š12345NSError *__autoreleasing error; ï¿¼if (![data writeToFile:filename options:NSDataWritingAtomic error:&amp;error]) ï¿¼&#123; NSLog(@\"Error: %@\", error); &#125; ï¼ˆåœ¨ä¸Šé¢çš„writeToFileæ–¹æ³•ä¸­errorå‚æ•°çš„ç±»å‹ä¸º(NSError __autoreleasing )ï¼‰ æ³¨æ„ï¼Œå¦‚æœä½ çš„errorå®šä¹‰ä¸ºäº†strongå‹ï¼Œé‚£ä¹ˆï¼Œç¼–è¯‘å™¨ä¼šå¸®ä½ éšå¼åœ°åšå¦‚ä¸‹äº‹æƒ…ï¼Œä¿è¯æœ€ç»ˆä¼ å…¥å‡½æ•°çš„å‚æ•°ä¾ç„¶æ˜¯ä¸ª__autoreleasingç±»å‹çš„å¼•ç”¨ã€‚ 1234567NSError *error; NSError *__autoreleasing tempError = error; // ç¼–è¯‘å™¨æ·»åŠ  if (![data writeToFile:filename options:NSDataWritingAtomic error:&amp;tempError]) ï¿¼&#123; error = tempError; // ç¼–è¯‘å™¨æ·»åŠ  NSLog(@\"Error: %@\", error); &#125; æ‰€ä»¥ä¸ºäº†æé«˜æ•ˆç‡ï¼Œé¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬åœ¨å®šä¹‰errorçš„æ—¶å€™å°†å…¶ï¼ˆè€è€å®å®åœ°=ã€‚=ï¼‰å£°æ˜ä¸º__autoreleasingç±»å‹çš„ï¼š NSError *__autoreleasing error;åœ¨è¿™é‡Œï¼ŒåŠ ä¸Š__autoreleasingä¹‹åï¼Œç›¸å½“äºåœ¨MRCä¸­å¯¹è¿”å›å€¼erroråšäº†å¦‚ä¸‹äº‹æƒ…ï¼š *error = [[[NSError alloc] init] autorelease]; erroræŒ‡å‘çš„å¯¹è±¡åœ¨åˆ›å»ºå‡ºæ¥åï¼Œè¢«æ”¾å…¥åˆ°äº†autoreleasing poolä¸­ï¼Œç­‰å¾…ä½¿ç”¨ç»“æŸåçš„è‡ªåŠ¨é‡Šæ”¾ï¼Œå‡½æ•°å¤–errorçš„ä½¿ç”¨è€…å¹¶ä¸éœ€è¦å…³å¿ƒerroræŒ‡å‘å¯¹è±¡çš„é‡Šæ”¾ã€‚ å¦å¤–ä¸€ç‚¹ï¼Œåœ¨ARCä¸­ï¼Œæ‰€æœ‰è¿™ç§æŒ‡é’ˆçš„æŒ‡é’ˆ ï¼ˆNSError **ï¼‰çš„å‡½æ•°å‚æ•°å¦‚æœä¸åŠ ä¿®é¥°ç¬¦ï¼Œç¼–è¯‘å™¨ä¼šé»˜è®¤å°†ä»–ä»¬è®¤å®šä¸º__autoreleasingç±»å‹ã€‚ æ¯”å¦‚ä¸‹é¢çš„ä¸¤æ®µä»£ç æ˜¯ç­‰åŒçš„ï¼š12345678- (NSString *)doSomething:(NSNumber **)value&#123; // do something &#125;- (NSString *)doSomething:(NSNumber * __autoreleasing *)value&#123; // do something &#125; é™¤éä½ æ˜¾å¼å¾—ç»™valueå£°æ˜äº†__strongï¼Œå¦åˆ™valueé»˜è®¤å°±æ˜¯__autoreleasingçš„ã€‚ æœ€åä¸€ç‚¹ï¼ŒæŸäº›ç±»çš„æ–¹æ³•ä¼šéšå¼åœ°ä½¿ç”¨è‡ªå·±çš„autorelease poolï¼Œåœ¨è¿™ç§æ—¶å€™ä½¿ç”¨__autoreleasingç±»å‹è¦ç‰¹åˆ«å°å¿ƒã€‚ æ¯”å¦‚NSDictionaryçš„[enumerateKeysAndObjectsUsingBlock]æ–¹æ³•ï¼š 123456789101112- (void)loopThroughDictionary:(NSDictionary *)dict error:(NSError **)error&#123; [dict enumerateKeysAndObjectsUsingBlock:^(id key, id obj, BOOL *stop)&#123; // do stuff if (there is some error &amp;&amp; error != nil) &#123; *error = [NSError errorWithDomain:@\"MyError\" ï¿¼code:1 userInfo:nil]; &#125;ï¿¼ &#125;];ï¿¼&#125; ä¼šéšå¼åœ°åˆ›å»ºä¸€ä¸ªautorelease poolï¼Œä¸Šé¢ä»£ç å®é™…ç±»ä¼¼äºï¼š 123456789101112131415- (void)loopThroughDictionary:(NSDictionary *)dict error:(NSError **)error&#123; [dict enumerateKeysAndObjectsUsingBlock:^(id key, id obj, BOOL *stop)&#123; @autoreleasepool // è¢«éšå¼åˆ›å»º &#123; if (there is some error &amp;&amp; error != nil) &#123; *error = [NSError errorWithDomain:@\"MyError\" ï¿¼code:1 userInfo:nil]; &#125;ï¿¼ &#125; &#125;]; // *error åœ¨è¿™é‡Œå·²ç»è¢«dictçš„åšæšä¸¾éå†æ—¶åˆ›å»ºçš„autorelease poolé‡Šæ”¾æ‰äº† ï¼š( ï¿¼&#125; ä¸ºäº†èƒ½å¤Ÿæ­£å¸¸çš„ä½¿ç”¨*errorï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªstrongå‹çš„ä¸´æ—¶å¼•ç”¨ï¼Œåœ¨dictçš„æšä¸¾Blockä¸­æ˜¯ç”¨è¿™ä¸ªä¸´æ—¶å¼•ç”¨ï¼Œä¿è¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ä¸ä¼šåœ¨å‡ºäº†dictçš„æšä¸¾Blockåè¢«é‡Šæ”¾ï¼Œæ­£ç¡®çš„æ–¹å¼å¦‚ä¸‹ï¼š 1234567891011121314151617- (void)loopThroughDictionary:(NSDictionary *)dict error:(NSError **)error&#123; __block NSError* tempError; // åŠ __blockä¿è¯å¯ä»¥åœ¨Blockå†…è¢«ä¿®æ”¹ [dict enumerateKeysAndObjectsUsingBlock:^(id key, id obj, BOOL *stop) &#123; if (there is some error) &#123; *tempError = [NSError errorWithDomain:@\"MyError\" ï¿¼code:1 userInfo:nil]; &#125; ï¿¼ &#125;] if (error != nil) &#123; *error = tempError; &#125; ï¿¼&#125; __unsafe_unretained ARCæ˜¯åœ¨iOS 5å¼•å…¥çš„ï¼Œè€Œè¿™ä¸ªä¿®é¥°ç¬¦ä¸»è¦æ˜¯ä¸ºäº†åœ¨ARCåˆšå‘å¸ƒæ—¶å…¼å®¹iOS 4ä»¥åŠç‰ˆæœ¬æ›´ä½çš„è®¾å¤‡ï¼Œå› ä¸ºè¿™äº›ç‰ˆæœ¬çš„è®¾å¤‡æ²¡æœ‰weak pointer systemï¼Œç®€å•çš„ç†è§£è¿™ä¸ªç³»ç»Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è®²weakæ—¶æåˆ°çš„ï¼Œèƒ½å¤Ÿåœ¨weakå¼•ç”¨æŒ‡å‘å¯¹è±¡è¢«é‡Šæ”¾åï¼ŒæŠŠå¼•ç”¨å€¼è‡ªåŠ¨è®¾ä¸ºnilçš„ç³»ç»Ÿã€‚è¿™ä¸ªä¿®é¥°ç¬¦åœ¨å®šä¹‰propertyæ—¶å¯¹åº”çš„æ˜¯â€unsafe_unretainedâ€ï¼Œå®é™…å¯ä»¥å°†å®ƒç†è§£ä¸ºMRCæ—¶ä»£çš„assignï¼šçº¯ç²¹åªæ˜¯å°†å¼•ç”¨æŒ‡å‘å¯¹è±¡ï¼Œæ²¡æœ‰ä»»ä½•é¢å¤–çš„æ“ä½œï¼Œåœ¨æŒ‡å‘å¯¹è±¡è¢«é‡Šæ”¾æ—¶ä¾ç„¶åŸåŸæœ¬æœ¬åœ°æŒ‡å‘åŸæ¥è¢«é‡Šæ”¾çš„å¯¹è±¡ï¼ˆæ‰€åœ¨çš„å†…å­˜åŒºåŸŸï¼‰ã€‚æ‰€ä»¥éå¸¸ä¸å®‰å…¨ã€‚ ç°åœ¨å¯ä»¥å®Œå…¨å¿½ç•¥æ‰è¿™ä¸ªä¿®é¥°ç¬¦äº†ï¼Œå› ä¸ºiOS 4æ—©å·²é€€å‡ºå†å²èˆå°å¾ˆå¤šå¹´ã€‚ *ä½¿ç”¨ä¿®é¥°ç¬¦çš„æ­£ç¡®å§¿åŠ¿ï¼ˆæ–¹å¼=ã€‚=ï¼‰ è¿™å¯èƒ½æ˜¯å¾ˆå¤šäººéƒ½ä¸çŸ¥é“çš„ä¸€ä¸ªé—®é¢˜ï¼ŒåŒ…æ‹¬ä¹‹å‰çš„æˆ‘ï¼Œä½†å´æ˜¯ä¸€ä¸ªç‰¹åˆ«è¦æ³¨æ„çš„é—®é¢˜ã€‚ è‹¹æœçš„æ–‡æ¡£ä¸­æ˜ç¡®åœ°å†™é“ï¼šYou should decorate variables correctly. When using qualifiers in an object variable declaration, the correct format is: ClassName * qualifier variableName; æŒ‰ç…§è¿™ä¸ªè¯´æ˜ï¼Œè¦å®šä¹‰ä¸€ä¸ªweakå‹çš„NSStringå¼•ç”¨ï¼Œå®ƒçš„å†™æ³•åº”è¯¥æ˜¯ï¼š NSString * __weak str = @&quot;hehe&quot;; // æ­£ç¡®ï¼è€Œä¸åº”è¯¥æ˜¯ï¼š__weak NSString *str = @&quot;hehe&quot;; // é”™è¯¯ï¼æˆ‘ç›¸ä¿¡å¾ˆå¤šäººéƒ½å’Œæˆ‘ä¸€æ ·ï¼Œä»å¼€å§‹ç”¨ARCå°±ä¸€ç›´ç”¨ä¸Šé¢é‚£ç§é”™è¯¯çš„å†™æ³•ã€‚ é‚£è¿™é‡Œå°±æœ‰ç–‘é—®äº†ï¼Œæ—¢ç„¶æ–‡æ¡£è¯´æ˜¯é”™è¯¯çš„ï¼Œä¸ºå•¥ç¼–è¯‘å™¨ä¸æŠ¥é”™å‘¢ï¼Ÿæ–‡æ¡£åˆè§£é‡Šé“ï¼šOther variants are technically incorrect but are â€œforgivenâ€ by the compiler. To understand the issue, seehttp://cdecl.org/. å¥½å§ï¼Œçœ‹æ¥æ˜¯è‹¹æœçˆ¸çˆ¸ï¼ˆ=ã€‚=ï¼‰è€ƒè™‘åˆ°å¾ˆå¤šäººä¼šç”¨é”™ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘å™¨è¿™è¾¹è´´å¿ƒåœ°å¸®æˆ‘ä»¬å¿½ç•¥å¹¶å¤„ç†æ‰äº†è¿™ä¸ªé”™è¯¯ï¼šï¼‰è™½ç„¶ä¸æŠ¥é”™ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯åº”è¯¥æŒ‰ç…§æ­£ç¡®çš„æ–¹å¼å»ä½¿ç”¨è¿™äº›ä¿®é¥°ç¬¦ï¼Œå¦‚æœä½ ä»¥å‰ä¹Ÿå¸¸å¸¸ç”¨é”™è¯¯çš„å†™æ³•ï¼Œé‚£çœ‹åˆ°è¿™é‡Œè®°å¾—ä»¥åä¸è¦è¿™ä¹ˆå†™äº†ï¼Œå“ªå¤©ç¼–è¯‘å™¨æ€’äº†ï¼Œå†ä¸æ”¯æŒé”™è¯¯çš„å†™æ³•ï¼Œå°±è¦éƒé—·äº†ã€‚ æ ˆä¸­æŒ‡é’ˆé»˜è®¤å€¼ä¸ºnil æ— è®ºæ˜¯è¢«strongï¼Œweakè¿˜æ˜¯autoreleasingä¿®é¥°ï¼Œå£°æ˜åœ¨æ ˆä¸­çš„æŒ‡é’ˆé»˜è®¤å€¼éƒ½ä¼šæ˜¯nilã€‚æ‰€æœ‰è¿™ç±»å‹çš„æŒ‡é’ˆä¸ç”¨å†åˆå§‹åŒ–çš„æ—¶å€™ç½®niläº†ã€‚è™½ç„¶å¥½ä¹ æƒ¯æ˜¯æœ€é‡è¦çš„ï¼Œä½†æ˜¯è¿™ä¸ªç‰¹æ€§æ›´åŠ é™ä½äº†â€œé‡æŒ‡é’ˆâ€å‡ºç°çš„å¯èƒ½æ€§ã€‚ åœ¨ARCä¸­ï¼Œä»¥ä¸‹ä»£ç ä¼šè¾“å‡ºnullè€Œä¸æ˜¯crash:)12345- (void)myMethod &#123; NSString *name; NSLog(@\"name: %@\", name);&#125; ARCä¸Blockåœ¨MRCæ—¶ä»£ï¼ŒBlockä¼šéšå¼åœ°å¯¹è¿›å…¥å…¶ä½œç”¨åŸŸå†…çš„å¯¹è±¡ï¼ˆæˆ–è€…è¯´è¢«Blockæ•è·çš„æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ï¼‰åŠ retainï¼Œæ¥ç¡®ä¿Blockä½¿ç”¨åˆ°è¯¥å¯¹è±¡æ—¶ï¼Œèƒ½å¤Ÿæ­£ç¡®çš„è®¿é—®ã€‚ è¿™ä»¶äº‹æƒ…åœ¨ä¸‹é¢ä»£ç å±•ç¤ºçš„æƒ…å†µä¸­è¦æ›´åŠ é¢å¤–å°å¿ƒã€‚ 12345678910MyViewController *myController = [[MyViewController alloc] initâ€¦];// éšå¼åœ°è°ƒç”¨[myController retain];é€ æˆå¾ªç¯å¼•ç”¨myController.completionHandler = ^(NSInteger result) &#123; [myController dismissViewControllerAnimated:YES completion:nil];&#125;;[self presentViewController:myController animated:YES completion:^&#123; [myController release]; // æ³¨æ„ï¼Œè¿™é‡Œè°ƒç”¨[myController release];æ˜¯åœ¨MRCä¸­çš„ä¸€ä¸ªå¸¸è§„å†™æ³•ï¼Œå¹¶ä¸èƒ½è§£å†³ä¸Šé¢å¾ªç¯å¼•ç”¨çš„é—®é¢˜&#125;]; åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒmyControllerçš„completionHandlerè°ƒç”¨äº†myControllerçš„æ–¹æ³•[dismissViewControllerâ€¦]ï¼Œè¿™æ—¶completionHandlerä¼šå¯¹myControlleråšretainæ“ä½œã€‚è€Œæˆ‘ä»¬çŸ¥é“ï¼ŒmyControllerå¯¹completionHandlerä¹Ÿè‡³å°‘æœ‰ä¸€ä¸ªretainï¼ˆä¸€èˆ¬å‡†ç¡®è®²æ˜¯copyï¼‰ï¼Œè¿™æ—¶å°±å‡ºç°äº†åœ¨å†…å­˜ç®¡ç†ä¸­æœ€ç³Ÿç³•çš„æƒ…å†µï¼šå¾ªç¯å¼•ç”¨ï¼ç®€å•ç‚¹è¯´å°±æ˜¯ï¼šmyController retainäº†completionHandlerï¼Œè€ŒcompletionHandlerä¹Ÿretainäº†myControllerã€‚å¾ªç¯å¼•ç”¨å¯¼è‡´äº†myControllerå’ŒcompletionHandleræœ€ç»ˆéƒ½ä¸èƒ½è¢«é‡Šæ”¾ã€‚æˆ‘ä»¬åœ¨delegateå…³ç³»ä¸­ï¼Œå¯¹delegateæŒ‡é’ˆç”¨weakå°±æ˜¯ä¸ºäº†é¿å…è¿™ç§é—®é¢˜ã€‚ ä¸è¿‡å¥½åœ¨ï¼Œç¼–è¯‘å™¨ä¼šåŠæ—¶åœ°ç»™æˆ‘ä»¬ä¸€ä¸ªè­¦å‘Šï¼Œæé†’æˆ‘ä»¬å¯èƒ½ä¼šå‘ç”Ÿè¿™ç±»å‹çš„é—®é¢˜ï¼š å¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬ç”¨å¦‚ä¸‹æ–¹æ³•è§£å†³ï¼šç»™è¦è¿›å…¥Blockçš„æŒ‡é’ˆåŠ ä¸€ä¸ª__blockä¿®é¥°ç¬¦ã€‚ è¿™ä¸ª__blockåœ¨MRCæ—¶ä»£æœ‰ä¸¤ä¸ªä½œç”¨ï¼š è¯´æ˜å˜é‡å¯æ”¹è¯´æ˜æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ä¸åšè¿™ä¸ªéšå¼çš„retainæ“ä½œä¸€ä¸ªå˜é‡å¦‚æœä¸åŠ __block ï¼Œæ˜¯ä¸èƒ½åœ¨Blocké‡Œé¢ä¿®æ”¹çš„ï¼Œä¸è¿‡è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å¤–ï¼šstaticçš„å˜é‡å’Œå…¨å±€å˜é‡ä¸éœ€è¦åŠ __blockå°±å¯ä»¥åœ¨Blockä¸­ä¿®æ”¹ã€‚ ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯¹ä»£ç åšå‡ºä¿®æ”¹ï¼Œè§£å†³äº†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼š123456MyViewController * __block myController = [[MyViewController alloc] initâ€¦];// ...myController.completionHandler = ^(NSInteger result) &#123; [myController dismissViewControllerAnimated:YES completion:nil];&#125;;//ä¹‹åæ­£å¸¸çš„releaseæˆ–è€…retain åœ¨ARCå¼•å…¥åï¼Œæ²¡æœ‰äº†retainå’Œreleaseç­‰æ“ä½œï¼Œæƒ…å†µä¹Ÿå‘ç”Ÿäº†æ”¹å˜ï¼šåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œ__blockä¿®é¥°ç¬¦çš„ä½œç”¨åªæœ‰ä¸Šé¢çš„ç¬¬ä¸€æ¡ï¼šè¯´æ˜å˜é‡å¯æ”¹ã€‚å³ä½¿åŠ ä¸Šäº†__blockä¿®é¥°ç¬¦ï¼Œä¸€ä¸ªè¢«blockæ•è·çš„å¼ºå¼•ç”¨ä¹Ÿä¾ç„¶æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚è¿™æ ·åœ¨ARCä¸‹ï¼Œå¦‚æœæˆ‘ä»¬è¿˜æŒ‰ç…§MRCä¸‹çš„å†™æ³•ï¼ŒcompletionHandlerå¯¹myControlleræœ‰ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œè€ŒmyControllerå¯¹completionHandleræœ‰ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œè¿™ä¾ç„¶æ˜¯å¾ªç¯å¼•ç”¨ï¼Œæ²¡æœ‰è§£å†³é—®é¢˜ï¼šï¼ˆ äºæ˜¯æˆ‘ä»¬è¿˜éœ€è¦å¯¹åŸä»£ç åšä¿®æ”¹ã€‚ç®€å•çš„æƒ…å†µæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š123456__block MyViewController * myController = [[MyViewController alloc] initâ€¦];// ...myController.completionHandler = ^(NSInteger result) &#123; [myController dismissViewControllerAnimated:YES completion:nil]; myController = nil; // æ³¨æ„è¿™é‡Œï¼Œä¿è¯äº†blockç»“æŸmyControllerå¼ºå¼•ç”¨çš„è§£é™¤&#125;; åœ¨completionHandlerä¹‹åå°†myControlleræŒ‡é’ˆç½®nilï¼Œä¿è¯äº†completionHandlerå¯¹myControllerå¼ºå¼•ç”¨çš„è§£é™¤ï¼Œä¸è¿‡ä¹ŸåŒæ—¶è§£é™¤äº†myControllerå¯¹myControllerå¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚è¿™ç§æ–¹æ³•è¿‡äºç®€å•ç²—æš´äº†ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ‰æ›´å¥½çš„æ–¹æ³•ã€‚ è¿™ä¸ªæ›´å¥½çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨weakã€‚ï¼ˆæˆ–è€…ä¸ºäº†è€ƒè™‘iOS4çš„å…¼å®¹æ€§ç”¨unsafe_unretainedï¼Œå…·ä½“ç”¨æ³•å’Œweakç›¸åŒï¼Œè€ƒè™‘åˆ°ç°åœ¨iOS4è®¾å¤‡å¯èƒ½å·²ç»ç»è¿¹äº†ï¼Œè¿™é‡Œå°±ä¸è®²è¿™ä¸ªæ–¹æ³•äº†ï¼‰ï¼ˆå…³äºè¿™ä¸ªæ–¹æ³•çš„æœ¬è´¨æˆ‘ä»¬åé¢ä¼šè°ˆåˆ°ï¼‰ ä¸ºäº†ä¿è¯completionHandlerè¿™ä¸ªBlockå¯¹myControlleræ²¡æœ‰å¼ºå¼•ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªä¸´æ—¶çš„å¼±å¼•ç”¨weakMyViewControlleræ¥æŒ‡å‘åŸmyControllerçš„å¯¹è±¡ï¼Œå¹¶æŠŠè¿™ä¸ªå¼±å¼•ç”¨ä¼ å…¥åˆ°Blockå†…ï¼Œè¿™æ ·å°±ä¿è¯äº†Blockå¯¹myControlleræŒæœ‰çš„æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚å¦‚æ­¤ï¼Œæˆ‘ä»¬ç»§ç»­ä¿®æ”¹ä»£ç ï¼š123456MyViewController *myController = [[MyViewController alloc] initâ€¦];// ...MyViewController * __weak weakMyViewController = myController;myController.completionHandler = ^(NSInteger result) &#123; [weakMyViewController dismissViewControllerAnimated:YES completion:nil];&#125;; è¿™æ ·å¾ªç¯å¼•ç”¨çš„é—®é¢˜å°±è§£å†³äº†ï¼Œä½†æ˜¯å´ä¸å¹¸åœ°å¼•å…¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šç”±äºä¼ å…¥completionHandlerçš„æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨ï¼Œé‚£ä¹ˆå½“myControlleræŒ‡å‘çš„å¯¹è±¡åœ¨completionHandlerè¢«è°ƒç”¨å‰é‡Šæ”¾ï¼Œé‚£ä¹ˆcompletionHandlerå°±ä¸èƒ½æ­£å¸¸çš„è¿ä½œäº†ã€‚åœ¨ä¸€èˆ¬çš„å•çº¿ç¨‹ç¯å¢ƒä¸­ï¼Œè¿™ç§é—®é¢˜å‡ºç°çš„å¯èƒ½æ€§ä¸å¤§ï¼Œä½†æ˜¯åˆ°äº†å¤šçº¿ç¨‹ç¯å¢ƒï¼Œå°±å¾ˆä¸å¥½è¯´äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»§ç»­å®Œå–„è¿™ä¸ªæ–¹æ³•ã€‚ ä¸ºäº†ä¿è¯åœ¨Blockå†…èƒ½å¤Ÿè®¿é—®åˆ°æ­£ç¡®çš„myControllerï¼Œæˆ‘ä»¬åœ¨blockå†…æ–°å®šä¹‰ä¸€ä¸ªå¼ºå¼•ç”¨strongMyControlleræ¥æŒ‡å‘weakMyControlleræŒ‡å‘çš„å¯¹è±¡ï¼Œè¿™æ ·å¤šäº†ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œå°±èƒ½ä¿è¯è¿™ä¸ªmyControllerå¯¹è±¡ä¸ä¼šåœ¨completionHandlerè¢«è°ƒç”¨å‰é‡Šæ”¾æ‰äº†ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å¯¹ä»£ç å†æ¬¡åšå‡ºä¿®æ”¹ï¼š 123456789101112131415MyViewController *myController = [[MyViewController alloc] initâ€¦];// ...MyViewController * __weak weakMyController = myController;myController.completionHandler = ^(NSInteger result) &#123; MyViewController *strongMyController = weakMyController; if (strongMyController) &#123; // ... [strongMyController dismissViewControllerAnimated:YES completion:nil]; // ... &#125; else &#123; // Probably nothing... &#125;&#125;; åˆ°æ­¤ï¼Œä¸€ä¸ªå®Œå–„çš„è§£å†³æ–¹æ¡ˆå°±å®Œæˆäº†ï¼šï¼‰ å®˜æ–¹æ–‡æ¡£å¯¹è¿™ä¸ªé—®é¢˜çš„è¯´æ˜åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œä½†æ˜¯å¯èƒ½å¾ˆå¤šæœ‹å‹ä¼šæœ‰ç–‘é—®ï¼Œä¸æ˜¯è¯´ä¸å¸Œæœ›Blockå¯¹åŸmyControllerå¯¹è±¡å¢åŠ å¼ºå¼•ç”¨ä¹ˆï¼Œè¿™é‡Œä¸ºå•¥å ‚è€Œçš‡ä¹‹åœ°åœ¨Blockå†…æ–°å®šä¹‰äº†ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œè¿™ä¸ªå¼ºå¼•ç”¨ä¸ä¼šé€ æˆå¾ªç¯å¼•ç”¨ä¹ˆï¼Ÿç†è§£è¿™ä¸ªé—®é¢˜çš„å…³é”®åœ¨äºç†è§£è¢«Blockæ•è·çš„å¼•ç”¨å’Œåœ¨Blockå†…å®šä¹‰çš„å¼•ç”¨çš„åŒºåˆ«ã€‚ä¸ºäº†æå¾—æ˜ç™½è¿™ä¸ªé—®é¢˜ï¼Œè¿™é‡Œéœ€è¦äº†è§£ä¸€äº›Blockçš„å®ç°åŸç†ï¼Œä½†ç”±äºç¯‡å¹…çš„ç¼˜æ•…ï¼Œæœ¬æ–‡åœ¨è¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œè¯¦ç»†çš„å†…å®¹å¯ä»¥å‚è€ƒå…¶ä»–çš„æ–‡ç« ï¼Œè¿™é‡Œç‰¹åˆ«æ¨èå”å·§çš„æ–‡ç« å’Œå¦å¤–2ä½ä½œè€…çš„åšæ–‡ï¼šè¿™ä¸ªå’Œè¿™ä¸ªï¼Œè®²çš„éƒ½æ¯”è¾ƒæ¸…æ¥šã€‚ è¿™é‡Œå‡è®¾å¤§å®¶å·²ç»å¯¹Blockçš„å®ç°åŸç†æœ‰æ‰€äº†è§£äº†ã€‚æˆ‘ä»¬å°±ç›´å…¥ä¸»é¢˜äº†ï¼æ³¨æ„å‰æ–¹é«˜èƒ½ï¼ˆ=ã€‚=ï¼‰ ä¸ºäº†æ›´æ¸…æ¥šåœ°è¯´æ˜é—®é¢˜ï¼Œè¿™é‡Œç”¨ä¸€ä¸ªç®€å•çš„ç¨‹åºä¸¾ä¾‹ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰å¦‚ä¸‹ç¨‹åºï¼š 123456789101112131415161718#include &lt;stdio.h&gt;int main()&#123; int b = 10; int *a = &amp;b; void (^blockFunc)() = ^()&#123; int *c = a; &#125;; blockFunc(); return 1;&#125; ç¨‹åºä¸­ï¼ŒåŒä¸ºintå‹çš„æŒ‡é’ˆï¼Œaæ˜¯è¢«Blockæ•è·çš„å˜é‡ï¼Œè€Œcæ˜¯åœ¨Blockå†…å®šä¹‰çš„å˜é‡ã€‚æˆ‘ä»¬ç”¨clang -rewrite-objcå¤„ç†åï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä»£ç ï¼š åŸmainå‡½æ•°ï¼š 123456789101112int main()&#123; int b = 10; int *a = &amp;b; void (*blockFunc)() = (void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, a); ((void (*)(__block_impl *))((__block_impl *)blockFunc)-&gt;FuncPtr)((__block_impl *)blockFunc); return 1;&#125; Blockçš„ç»“æ„ï¼š 12345678910111213struct __main_block_impl_0 &#123; struct __block_impl impl; struct __main_block_desc_0* Desc; int *a; // è¢«æ•è·çš„å¼•ç”¨ a å‡ºç°åœ¨äº†blockçš„ç»“æ„ä½“é‡Œé¢ __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int *_a, int flags=0) : a(_a) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125;&#125;; å®é™…æ‰§è¡Œçš„å‡½æ•°ï¼š 1234567static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123; int *a = __cself-&gt;a; // bound by copy int *c = a; // åœ¨blockä¸­å£°æ˜çš„å¼•ç”¨ c åœ¨å‡½æ•°ä¸­å£°æ˜ï¼Œå­˜åœ¨äºå‡½æ•°æ ˆä¸Š &#125; æˆ‘ä»¬å¯ä»¥æ¸…æ¥šå¾—çœ‹åˆ°ï¼Œaå’Œcå­˜åœ¨çš„ä½ç½®å®Œå…¨ä¸åŒï¼Œå¦‚æœBlockå­˜åœ¨äºå †ä¸Šï¼ˆåœ¨ARCä¸‹Blocké»˜è®¤åœ¨å †ä¸Šï¼‰ï¼Œé‚£ä¹ˆaä½œä¸ºBlockç»“æ„ä½“çš„ä¸€ä¸ªæˆå‘˜ï¼Œä¹Ÿè‡ªç„¶ä¼šå­˜åœ¨äºå †ä¸Šï¼Œè€Œcæ— è®ºå¦‚ä½•ï¼Œæ°¸è¿œä½äºBlockå†…å®é™…æ‰§è¡Œä»£ç çš„å‡½æ•°æ ˆå†…ã€‚è¿™ä¹Ÿå¯¼è‡´äº†ä¸¤ä¸ªå˜é‡ç”Ÿå‘½å‘¨æœŸçš„å®Œå…¨ä¸åŒï¼šcåœ¨Blockçš„å‡½æ•°è¿è¡Œå®Œæ¯•ï¼Œå³ä¼šè¢«é‡Šæ”¾ï¼Œè€Œaå‘¢ï¼Œåªæœ‰åœ¨Blockè¢«ä»å †ä¸Šé‡Šæ”¾çš„æ—¶å€™æ‰ä¼šé‡Šæ”¾ã€‚ å›åˆ°æˆ‘ä»¬çš„MyViewControllerçš„ä¾‹å­ä¸­ï¼ŒåŒä¸Šç†ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥è®©Blockæ•è·æˆ‘ä»¬çš„myControllerå¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼•ç”¨ä¼šè¢«å¤åˆ¶åï¼ˆå¼•ç”¨ç±»å‹ä¹Ÿä¼šè¢«å¤åˆ¶ï¼‰ä½œä¸ºBlockçš„æˆå‘˜å˜é‡å­˜åœ¨äºå…¶æ‰€åœ¨çš„å †ç©ºé—´ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸ºBlockå¢åŠ äº†ä¸€ä¸ªæŒ‡å‘myControllerå¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œè¿™å°±æ˜¯é€ æˆå¾ªç¯å¼•ç”¨çš„æœ¬è´¨åŸå› ã€‚å¯¹äºMyViewControllerçš„ä¾‹å­ï¼ŒBlockçš„ç»“æ„ä½“å¯ä»¥ç†è§£æ˜¯è¿™ä¸ªæ ·å­ï¼šï¼ˆå‡†ç¡®çš„ç»“æ„ä½“è‚¯å®šå’Œä»¥ä¸‹è¿™ä¸ªæœ‰åŒºåˆ«ï¼Œä½†ä¹Ÿè‚¯å®šæ˜¯å¦‚ä¸‹è¿™ç§å½¢å¼ï¼šï¼‰ 12345678910111213struct __main_block_impl_0 &#123; struct __block_impl impl; struct __main_block_desc_0* Desc; MyViewController * __strong myController; // è¢«æ•è·çš„å¼ºå¼•ç”¨myController __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int *_a, int flags=0) : a(_a) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125;&#125;; è€Œåè§‚æˆ‘ä»¬ç»™Blockä¼ å…¥ä¸€ä¸ªå¼±å¼•ç”¨weakMyControllerï¼Œè¿™æ—¶æˆ‘ä»¬Blockçš„ç»“æ„ï¼š 12345678910111213struct __main_block_impl_0 &#123; struct __block_impl impl; struct __main_block_desc_0* Desc; MyViewController * __weak weakMyController; // è¢«æ•è·çš„å¼±å¼•ç”¨weakMyController __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int *_a, int flags=0) : a(_a) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125;&#125;; å†çœ‹åœ¨Blockå†…å£°æ˜çš„å¼ºå¼•ç”¨strongMyControllerï¼Œå®ƒè™½ç„¶æ˜¯å¼ºå¼•ç”¨ï¼Œä½†å­˜åœ¨äºå‡½æ•°æ ˆä¸­ï¼Œåœ¨å‡½æ•°æ‰§è¡ŒæœŸé—´ï¼Œå®ƒä¸€ç›´å­˜åœ¨ï¼Œæ‰€ä»¥myControllerå¯¹è±¡ä¹Ÿä¸€ç›´å­˜åœ¨ï¼Œä½†æ˜¯å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼ŒstrongMyControllerå³è¢«é”€æ¯ï¼Œäºæ˜¯å®ƒå¯¹myControllerå¯¹è±¡çš„å¼ºå¼•ç”¨ä¹Ÿè¢«è§£é™¤ï¼Œè¿™æ—¶Blockå¯¹myControllerå¯¹è±¡å°±ä¸å­˜åœ¨å¼ºå¼•ç”¨å…³ç³»äº†ï¼åŠ å…¥äº†strongMyControllerçš„å‡½æ•°å¤§ä½“ä¼šæ˜¯è¿™ä¸ªæ ·å­ï¼š 1234567static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123; MyViewController * __strong strongMyController = __cself-&gt;weakMyController; // .... &#125; ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨ARCä¸‹ï¼ˆåœ¨MRCä¸‹ä¼šç•¥æœ‰ä¸åŒï¼‰ï¼ŒBlockæ•è·çš„å¼•ç”¨å’ŒBlockå†…å£°æ˜çš„å¼•ç”¨æ— è®ºæ˜¯å­˜åœ¨ç©ºé—´ä¸ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯æˆªç„¶ä¸åŒçš„ï¼Œä¹Ÿæ­£æ˜¯è¿™ç§ä¸åŒï¼Œé€ æˆäº†æˆ‘ä»¬å¯¹ä»–ä»¬ä½¿ç”¨æ–¹å¼çš„åŒºåˆ«ã€‚ ä»¥ä¸Šå°±è§£é‡Šäº†ä¹‹å‰æåˆ°çš„æ‰€æœ‰é—®é¢˜ï¼Œå¸Œæœ›å¤§å®¶èƒ½çœ‹æ˜ç™½ï¼šï¼‰ å¥½çš„ï¼Œæœ€åå†æä¸€ç‚¹ï¼Œåœ¨ARCä¸­ï¼Œå¯¹Blockæ•è·å¯¹è±¡çš„å†…å­˜ç®¡ç†å·²ç»ç®€åŒ–äº†å¾ˆå¤šï¼Œç”±äºæ²¡æœ‰äº†retainå’Œreleaseç­‰æ“ä½œï¼Œå®é™…åªéœ€è¦è€ƒè™‘å¾ªç¯å¼•ç”¨çš„é—®é¢˜å°±è¡Œäº†ã€‚æ¯”å¦‚ä¸‹é¢è¿™ç§ï¼Œæ˜¯æ²¡æœ‰å†…å­˜æ³„éœ²çš„é—®é¢˜çš„ï¼š 123456789TestObject *aObject = [[TestObject alloc] init]; aObject.name = @\"hehe\";self.aBlock = ^()&#123; NSLog(@\"aObject's name = %@\",aObject.name); &#125;; æˆ‘ä»¬ä¸Šé¢æåˆ°çš„è§£å†³æ–¹æ¡ˆï¼Œåªæ˜¯é’ˆå¯¹Blockäº§ç”Ÿå¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œè€Œä¸æ˜¯è¯´æ‰€æœ‰çš„Blockæ•è·å¼•ç”¨éƒ½è¦è¿™ä¹ˆå¤„ç†ï¼Œä¸€å®šè¦æ³¨æ„ï¼ ARCä¸Toll-Free BridgingThere are a number of data types in the Core Foundation framework and the Foundation framework that can be used interchangeably. This capability, called toll-free bridging, means that you can use the same data type as the parameter to a Core Foundation function call or as the receiver of an Objective-C message. Toll-Free Bridingä¿è¯äº†åœ¨ç¨‹åºä¸­ï¼Œå¯ä»¥æ–¹ä¾¿å’Œè°çš„ä½¿ç”¨Core Foundationç±»å‹çš„å¯¹è±¡å’ŒObjective-Cç±»å‹çš„å¯¹è±¡ã€‚è¯¦ç»†çš„å†…å®¹å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ä»¥ä¸‹æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­ç»™å‡ºçš„ä¸€äº›ä¾‹å­ï¼š 12345678910111213NSLocale *gbNSLocale = [[NSLocale alloc] initWithLocaleIdentifier:@\"en_GB\"];CFLocaleRef gbCFLocale = (CFLocaleRef) gbNSLocale;CFStringRef cfIdentifier = CFLocaleGetIdentifier (gbCFLocale);NSLog(@\"cfIdentifier: %@\", (NSString *)cfIdentifier);// logs: \"cfIdentifier: en_GB\"CFRelease((CFLocaleRef) gbNSLocale); CFLocaleRef myCFLocale = CFLocaleCopyCurrent();NSLocale * myNSLocale = (NSLocale *) myCFLocale;[myNSLocale autorelease];NSString *nsIdentifier = [myNSLocale localeIdentifier];CFShow((CFStringRef) [@\"nsIdentifier: \" stringByAppendingString:nsIdentifier]);// logs identifier for current locale åœ¨MRCæ—¶ä»£ï¼Œç”±äºObjective-Cç±»å‹çš„å¯¹è±¡å’ŒCore Foundationç±»å‹çš„å¯¹è±¡éƒ½æ˜¯ç›¸åŒçš„releaseå’Œretainæ“ä½œè§„åˆ™ï¼Œæ‰€ä»¥Toll-Free Bridgingçš„ä½¿ç”¨æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯è‡ªä»ARCåŠ å…¥åï¼ŒObjective-Cç±»å‹çš„å¯¹è±¡å†…å­˜ç®¡ç†è§„åˆ™æ”¹å˜äº†ï¼Œè€ŒCore Foundationä¾ç„¶æ˜¯ä¹‹å‰çš„æœºåˆ¶ï¼Œæ¢å¥è¯è¯´ï¼ŒCore Foundationä¸æ”¯æŒARCã€‚ è¿™ä¸ªæ—¶å€™å°±å¿…é¡»è¦è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜äº†ï¼Œåœ¨åšCore Foundationä¸Objective-Cç±»å‹è½¬æ¢çš„æ—¶å€™ï¼Œç”¨å“ªä¸€ç§è§„åˆ™æ¥ç®¡ç†å¯¹è±¡çš„å†…å­˜ã€‚æ˜¾ç„¶ï¼Œå¯¹äºåŒä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬ä¸èƒ½å¤ŸåŒæ—¶ç”¨ä¸¤ç§è§„åˆ™æ¥ç®¡ç†ï¼Œæ‰€ä»¥è¿™é‡Œå°±å¿…é¡»è¦ç¡®å®šä¸€ä»¶äº‹æƒ…ï¼šå“ªäº›å¯¹è±¡ç”¨Objective-Cï¼ˆä¹Ÿå°±æ˜¯ARCï¼‰çš„è§„åˆ™ï¼Œå“ªäº›å¯¹è±¡ç”¨Core Foundationçš„è§„åˆ™ï¼ˆä¹Ÿå°±æ˜¯MRCï¼‰çš„è§„åˆ™ã€‚æˆ–è€…è¯´è¦ç¡®å®šå¯¹è±¡ç±»å‹è½¬æ¢äº†ä¹‹åï¼Œå†…å­˜ç®¡ç†çš„ownershipçš„æ”¹å˜ã€‚ If you cast between Objective-C and Core Foundation-style objects, you need to tell the compiler about the ownership semantics of the object using either a cast (defined in objc/runtime.h) or a Core Foundation-style macro (defined inNSObject.h) äºæ˜¯è‹¹æœåœ¨å¼•å…¥ARCä¹‹åå¯¹Toll-Free Bridgingçš„æ“ä½œä¹ŸåŠ å…¥äº†å¯¹åº”çš„æ–¹æ³•ä¸ä¿®é¥°ç¬¦ï¼Œç”¨æ¥æŒ‡æ˜ç”¨å“ªç§è§„åˆ™ç®¡ç†å†…å­˜ï¼Œæˆ–è€…è¯´æ˜¯å†…å­˜ç®¡ç†æƒçš„å½’å±ã€‚ è¿™äº›æ–¹æ³•å’Œä¿®é¥°ç¬¦åˆ†åˆ«æ˜¯ï¼š __bridgeï¼ˆä¿®é¥°ç¬¦ï¼‰ åªæ˜¯å£°æ˜ç±»å‹è½¬å˜ï¼Œä½†æ˜¯ä¸åšå†…å­˜ç®¡ç†è§„åˆ™çš„è½¬å˜ã€‚ æ¯”å¦‚ï¼š CFStringRef s1 = (__bridge CFStringRef) [[NSString alloc] initWithFormat:@&quot;Hello, %@!&quot;, name];åªæ˜¯åšäº†NSStringåˆ°CFStringRefçš„è½¬åŒ–ï¼Œä½†ç®¡ç†è§„åˆ™æœªå˜ï¼Œä¾ç„¶è¦ç”¨Objective-Cç±»å‹çš„ARCæ¥ç®¡ç†s1ï¼Œä½ ä¸èƒ½ç”¨CFRelease()å»é‡Šæ”¾s1ã€‚ __bridge_retainedï¼ˆä¿®é¥°ç¬¦ï¼‰ or CFBridgingRetainï¼ˆå‡½æ•°ï¼‰ è¡¨ç¤ºå°†æŒ‡é’ˆç±»å‹è½¬å˜çš„åŒæ—¶ï¼Œå°†å†…å­˜ç®¡ç†çš„è´£ä»»ç”±åŸæ¥çš„Objective-Cäº¤ç»™Core Foundationæ¥å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ï¼Œå°†ARCè½¬å˜ä¸ºMRCã€‚ æ¯”å¦‚ï¼Œè¿˜æ˜¯ä¸Šé¢é‚£ä¸ªä¾‹å­12345NSString *s1 = [[NSString alloc] initWithFormat:@\"Hello, %@!\", name];ï¿¼CFStringRef s2 = (__bridge_retained CFStringRef)s1;ï¿¼// do something with s2//...ï¿¼CFRelease(s2); // æ³¨æ„è¦åœ¨ä½¿ç”¨ç»“æŸååŠ è¿™ä¸ª æˆ‘ä»¬åœ¨ç¬¬äºŒè¡Œåšäº†è½¬åŒ–ï¼Œè¿™æ—¶å†…å­˜ç®¡ç†è§„åˆ™ç”±ARCå˜ä¸ºäº†MRCï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨çš„æ¥ç®¡ç†s2çš„å†…å­˜ï¼Œè€Œå¯¹äºs1ï¼Œæˆ‘ä»¬å³ä½¿å°†å…¶ç½®ä¸ºnilï¼Œä¹Ÿä¸èƒ½é‡Šæ”¾å†…å­˜ã€‚ ç­‰åŒçš„ï¼Œæˆ‘ä»¬çš„ç¨‹åºä¹Ÿå¯ä»¥å†™æˆï¼š123456NSString *s1 = [[NSString alloc] initWithFormat:@\"Hello, %@!\", name];ï¿¼CFStringRef s2 = (CFStringRef)CFBridgingRetain(s1);ï¿¼// do something with s2//...ï¿¼CFRelease(s2); // æ³¨æ„è¦åœ¨ä½¿ç”¨ç»“æŸååŠ è¿™ä¸ª__bridge_transferï¼ˆä¿®é¥°ç¬¦ï¼‰ or CFBridgingReleaseï¼ˆå‡½æ•°ï¼‰ è¿™ä¸ªä¿®é¥°ç¬¦å’Œå‡½æ•°çš„åŠŸèƒ½å’Œä¸Šé¢é‚£ä¸ª__bridge_retainedç›¸åï¼Œå®ƒè¡¨ç¤ºå°†ç®¡ç†çš„è´£ä»»ç”±Core Foundationè½¬äº¤ç»™Objective-Cï¼Œå³å°†ç®¡ç†æ–¹å¼ç”±MRCè½¬å˜ä¸ºARCã€‚ æ¯”å¦‚ï¼š1234CFStringRef result = CFURLCreateStringByAddingPercentEscapes(. . .);ï¿¼NSString *s = (__bridge_transfer NSString *)result;//or NSString *s = (NSString *)CFBridgingRelease(result);ï¿¼return s; è¿™é‡Œæˆ‘ä»¬å°†resultçš„ç®¡ç†è´£ä»»äº¤ç»™äº†ARCæ¥å¤„ç†ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†æ˜¾å¼åœ°å°†CFRelease()äº†ã€‚ å¯¹äº†ï¼Œè¿™é‡Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸€ä¸ªç»†èŠ‚ï¼Œå’ŒARCä¸­é‚£ä¸ª4ä¸ªä¸»è¦çš„ä¿®é¥°ç¬¦ï¼ˆ__strong,__weak,â€¦ï¼‰ä¸åŒï¼Œè¿™é‡Œä¿®é¥°ç¬¦çš„ä½ç½®æ˜¯æ”¾åœ¨ç±»å‹å‰é¢çš„ï¼Œè™½ç„¶å®˜æ–¹æ–‡æ¡£ä¸­æ²¡æœ‰è¯´æ˜ï¼Œä½†çœ‹å®˜æ–¹çš„å¤´æ–‡ä»¶å¯ä»¥çŸ¥é“ã€‚å°ä¼™ä¼´ä»¬ï¼Œè®°å¾—åˆ«æŠŠä½ç½®å†™é”™å“¦ï¼šï¼‰å‘¼~ å¥½äº†ï¼Œä»¥ä¸Šå°±æ˜¯æœ¬ç¯‡æ–‡ç« çš„ä¸»è¦å†…å®¹ã€‚è¿™æ¬¡é‡‡ç”¨äº†æ–°çš„æ’ç‰ˆï¼Œæ„Ÿè§‰æ¯”ä»¥å‰æœ‰æ¡ç†å¾—å¤šï¼Œå¸Œæœ›çš„å¤§å®¶çœ‹çš„èˆ’æœã€‚ æ–‡ç« ä¸­å¦‚æœæœ‰ä»»ä½•é”™è¯¯æˆ–è€…é—®é¢˜ï¼Œå¯ä»¥åœ¨ä¸‹é¢ç•™è¨€æˆ–è€…ç»™æˆ‘å‘ä¿¡ï¼ŒæœŸå¾…ä½ ä»¬çš„å›å¤ã€‚ æ„Ÿè°¢å¤§å®¶çš„æ”¶çœ‹ã€‚","link":"/2017/09/21/iOSå¼€å‘ARCå†…å­˜ç®¡ç†æŠ€æœ¯è¦ç‚¹/"},{"title":"Objc Runtime å†æ¬¡å®è·µ","text":"å¥½ä¹…ä¸ç”¨ï¼Œå†æ¬¡ä½¿ç”¨runtimeé‡å†™ä»£ç ã€‚å°±ç”¨é«˜æ€§èƒ½æ·»åŠ å›¾ç‰‡åœ†è§’æ¥å†ä¸€æ¬¡å®è·µä¸€ä¸‹runtimeçš„åŸºæœ¬ç”¨æ³•ã€‚ runtimeä½¿ç”¨åœºæ™¯ï¼š categoryæ·»åŠ å…³è”å±æ€§ MethodSwizzleæ›¿æ¢/äº¤æ¢ç³»ç»Ÿæ–¹æ³• å¹³å¸¸ä½¿ç”¨cornerRadiuså’ŒmaskToBoundsç»„åˆè®¾ç½®åœ†è§’ categoryæ·»åŠ å…³è”å±æ€§åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç åˆ›å»ºä¸€ä¸ªNSErrorçš„categoryï¼Œæ·»åŠ ä¸€ä¸ªerrorMsgçš„å±æ€§ã€‚å› ä¸ºcategoryæœ¬èº«ä¸èƒ½æ·»åŠ å±æ€§ï¼Œè¿™é‡Œæ˜¯ä½¿ç”¨runtimeåŠ¨æ€æ·»åŠ å…³è”å±æ€§ MethodSwizzleäº¤æ¢ç³»ç»Ÿæ–¹æ³•åˆ›å»ºä¸€ä¸ªUIImageViewçš„categoryï¼Œåœ¨åˆ†ç±»ä¸­äº¤æ¢ï¼ˆexchangeï¼Œæ³¨æ„è¿™é‡Œä¸æ˜¯æ›¿æ¢replaceï¼‰ç³»ç»Ÿçš„setImage: æ–¹æ³•. æˆ‘ä»¬è¦äº¤æ¢ä¸€ä¸ªç±»çš„ç³»ç»Ÿæ–¹æ³•ï¼Œé‚£ä¹ˆé¦–å…ˆæƒ³æƒ³åœ¨å“ªä¸ªæ–¹æ³•ä¸­äº¤æ¢æœ€åˆé€‚å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“appåœ¨å¯åŠ¨ä¹‹åï¼Œä¼šè¿›è¡Œç±»æ³¨å†Œï¼Œè°ƒç”¨ç±»çš„+load()æ–¹æ³•ï¼Œä¸”åªè°ƒç”¨ä¸€æ¬¡ã€‚ï¼ˆæ³¨æ„ä¸+initializeçš„åŒºåˆ«ï¼‰ç¬¬51æ¡:loadä¸initializeçš„åŒºåˆ«æ‰€ä»¥æˆ‘ä»¬åœ¨åˆ†ç±»ä¸­é‡å†™loadæ–¹æ³•ä¸­æ·»åŠ äº¤æ¢æ–¹æ³•ã€‚ é¦–å…ˆæˆ‘ä»¬å€Ÿç”¨AFNetworkingä¸­AFURLSessionManagerä¸­å®šä¹‰çš„swizzleçš„å†…è”å‡½æ•°123456789101112static inline void hl_swizzleSelector(Class theClass, SEL originalSelector, SEL swizzledSelector) &#123; Method originalMethod = class_getInstanceMethod(theClass, originalSelector); Method swizzledMethod = class_getInstanceMethod(theClass, swizzledSelector); method_exchangeImplementations(originalMethod, swizzledMethod);&#125;static inline BOOL hl_addMethod(Class theClass, SEL selector, Method method) &#123; /* YES if the method was added successfully, otherwise NO (for example, the class already contains a method implementation with that name) */ return class_addMethod(theClass, selector, method_getImplementation(method), method_getTypeEncoding(method));&#125;ç„¶ååœ¨+loadæ–¹æ³•ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š1hl_swizzleSelector([self class], @selector(setImage:), @selector(hl_setImage:)); /* è¿™é‡Œå‚è€ƒçš„æ˜¯AFURLSessionManagerä¸­çš„æ–¹å¼æ¥æ·»åŠ æ–¹æ³•ï¼Œä½†æ˜¯å®é™…ä¸Šåœ¨è¿™ä¸ªæƒ…å†µä¸‹æ˜¯æ°¸è¿œè¿”å›NOçš„ åŸå› ï¼šå› ä¸ºæˆ‘ä»¬æ˜¯åœ¨UIImageViewçš„categoryä¸­æ·»åŠ äº†hl_setImage:ï¼Œæ‰€ä»¥åœ¨UIImageViewä¸­å·²ç»å­˜åœ¨äº†è¯¥æ–¹æ³•ï¼Œå†è°ƒç”¨class_addMethodå°±ä¼šè¿”å›NOã€‚ å› æ­¤ä¸‹é¢è¿™äº›ä»£ç å¦‚æœå†™åœ¨categoryä¸­æ˜¯ä¸éœ€è¦çš„äº†ã€‚*/123456Method hlSetImageMethod = class_getInstanceMethod([self class],@selector(hl_setImage:));BOOL result = hl_addMethod([self class],@selector(hl_setImage:), hlSetImageMethod);NSLog(@\"%d\",result);if (result) &#123;&#125; æµ‹è¯•ä¸€ä¸‹ä»£ç ï¼š123456789101112131415UIImageView * v = [[UIImageView alloc]initWithFrame:CGRectMake(0, 0, 240, 240)];v.center = self.view.center;[self.view addSubview:v];UIImage * image = [UIImage imageNamed:@\"IMG_0730.jpg\"];//ä¼šäº§ç”Ÿæ··åˆå›¾å±‚v.layer.cornerRadius = v.frame.size.width / 2;v.layer.masksToBounds = YES;//é‡‡ç”¨UIGraphicImageContexté‡ç»˜å,è§£å†³æ··åˆå›¾å±‚é—®é¢˜[v setImage:[image hl_imageByCroppingForSize:CGSizeMake(240, 240) fillColor:[UIColor whiteColor]]];//ä½¿ç”¨Method swizzleäº¤æ¢setImageå’Œhl_setImage:ä¹‹åï¼šv.image = image; å…¶ä¸­çš„æ€§èƒ½é—®é¢˜æˆ‘ä»¬åœ¨UIImage+HLAddåˆ†ç±»ä¸­ä½¿ç”¨UIGraphicImageContextæ¥é‡æ–°ç»˜å›¾ï¼Œè¿™è‚¯å®šæ˜¯è¦è€—æ—¶çš„æ“ä½œã€‚12345CFTimeInterval start = CACurrentMediaTime();...//ç»˜å›¾...NSLog(@\"%f\",CACurrentMediaTime() - start); 12016-11-22 17:53:42.614 iOS-Kick-On[47630:2598373] 0.003525 å¤§æ¦‚è€—æ—¶åœ¨0.003~0.006ä¹‹é—´ï¼Œä»¥çº³ç§’è¿›è¡Œè¿ç®—çš„cpuæ¥è¯´ï¼Œè¿˜æ˜¯ä¸€ä¸ªç¨å¾®è€—æ—¶çš„æ“ä½œï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ”¾åœ¨åå°çº¿ç¨‹æ¥åšï¼Œç„¶åé‡‡ç”¨å›è°ƒæ¥è·å–è¿”å›çš„image12345678910dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123; UIImage * result = [self hl_imageByCroppingCorner:radius forSize:targetSize fillColor:[UIColor whiteColor]]; dispatch_async(dispatch_get_main_queue(), ^&#123; if (completion) &#123; completion(result); &#125; &#125;);&#125;); æœ¬ç¯‡æ–‡ç« ä»£ç ","link":"/2016/11/22/OBJC-RUNTIME-å†æ¬¡å®è·µ/"},{"title":"ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹è¯»ä¹¦ç¬”è®°-æ¸©æ•…çŸ¥æ–°","text":"åŸºç¡€ç¯‡å›é¡¾ä¸€ä¸‹ä¸¤ä¸ªåŸºç¡€ï¼šå†…å­˜çº¿ç¨‹ å†…å­˜æ—©æœŸçš„è®¡ç®—æœºï¼Œç¨‹åºç›´æ¥è¿è¡Œåœ¨ç‰©ç†å†…å­˜ä¸Šã€‚é‚£ä¹ˆä¹…å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•å°½å¯èƒ½çš„å°†æœ‰é™çš„ç‰©ç†å†…å­˜åˆ†é…ç»™å¤šä¸ªç¨‹åºä½¿ç”¨ã€‚å†…å­˜ä½¿ç”¨å­˜åœ¨çš„é—®é¢˜ï¼š 1.åœ°å€ç©ºé—´ä¸è¶³ 2.å†…å­˜ä½¿ç”¨æ•ˆç‡ä½ 3.ç¨‹åºè¿è¡Œçš„åœ°å€ä¸ç¡®å®š-é‡å®šä½é—®é¢˜ã€‚é‚£ä¹ˆé’ˆå¯¹è¿™ä¸‰ä¸ªé—®é¢˜ï¼Œåˆ©ç”¨ä¸­é—´å±‚,è®©ç¨‹åºé—´æ¥çš„è®¿é—®ç‰©ç†åœ°å€ï¼Œæ¥è§£å†³ä»¥ä¸Šå‡ ä¸ªé—®é¢˜ã€‚- åˆ†æ®µï¼šï¼ˆsegmentï¼‰å°†ç¨‹åºéœ€è¦çš„åœ°å€ç©ºé—´æ˜ å°„åˆ°ä¸€æ®µè™šæ‹Ÿç©ºé—´ä¸Šã€‚ä»¥æ­¤å°†ç¨‹åºé—´éš”ç¦»ã€‚æ­¤æ–¹æ³•è§£å†³ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªé—®é¢˜ã€‚- åˆ†é¡µï¼šï¼ˆpagingï¼‰å°†åœ°å€ç©ºé—´äººä¸ºåˆ†ä¸ºå›ºå®šå¤§å°çš„é¡µï¼ˆpageï¼‰ã€‚ä¸€èˆ¬ä¸º4KBå¤§å°ã€‚è™šæ‹Ÿå†…å­˜çš„å®ç°éœ€è¦ä¾é ç¡¬ä»¶æ”¯æŒã€‚é€šå¸¸é‡‡ç”¨MMU(Memory Management Unit)æ¥è¿›è¡Œpage mappingï¼Œå°†CPUä½¿ç”¨çš„è™šæ‹Ÿåœ°å€æ˜ å°„ä¸ºå®é™…çš„ç‰©ç†åœ°å€ã€‚çº¿ç¨‹ çº¿ç¨‹ç»“æ„ï¼šçº¿ç¨‹IDã€æŒ‡ä»¤æŒ‡é’ˆPCã€çº¿ç¨‹å†…æ ˆå’Œå¯„å­˜å™¨ ç°åœ¨åŸºæœ¬éƒ½æ˜¯å¤šçº¿ç¨‹ã€‚ çº¿ç¨‹çš„è®¿é—®æƒé™ã€‚ çº¿ç¨‹ç§æœ‰ çº¿ç¨‹é—´å…±äº« - å±€éƒ¨å˜é‡ å…¨å±€å˜é‡ - å‡½æ•°çš„å‚æ•° å †ä¸Šçš„æ•°æ® - TLSæ•°æ® å‡½æ•°ä¸­çš„é™æ€å˜é‡ ç¨‹åºä»£ç  æ‰“å¼€çš„æ–‡ä»¶ã€‚çº¿ç¨‹Aæ‰“å¼€çš„æ–‡ä»¶å¯ä»¥ç”±çº¿ç¨‹Bè¯»å†™ çº¿ç¨‹å®‰å…¨ å•æŒ‡ä»¤æ“ä½œç§°ä¸ºåŸå­çš„Atomicã€‚ç®€å•æƒ…å†µä¸‹å¯ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯åœ¨å¤æ‚çš„æ•°æ®ç»“æ„ä¸­ï¼Œå°±æœ‰å¯èƒ½ä¸èƒ½ä¿è¯ã€‚æ­¤æ—¶éœ€è¦æ›´åŠ é€šç”¨çš„æ‰‹æ®µï¼šé” åŒæ­¥ä¸é”ã€‚ä½†æ˜¯è¿˜æ˜¯æœ‰å¯èƒ½å‡ºç°é—®é¢˜ï¼ŒåŸå› æ¥è‡ªäºCPUæ‰§è¡ŒæŒ‡ä»¤çš„æ¢åºï¼ˆCPUæœ‰å¯èƒ½å°†åé¢çš„ä»£ç å…ˆæ‰§è¡Œï¼‰ã€‚ barrieré˜»å¡æœºåˆ¶ã€‚barrieræŒ‡ä»¤ä¼šé˜»æ­¢CPUå°†barrieræŒ‡ä»¤ä¹‹å‰çš„æŒ‡ä»¤äº¤æ¢åˆ°barrierä¹‹åï¼Œåä¹‹äº¦ç„¶ã€‚","link":"/2016/05/10/ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹è¯»ä¹¦ç¬”è®°-æ¸©æ•…çŸ¥æ–°/"},{"title":"ã€ŠiOSå¼€å‘è¿›é˜¶ã€‹é˜…è¯»ç¬”è®°ï¼ˆä¸€ï¼‰å†…å­˜ç®¡ç†é‡Šç–‘","text":"ARC ARCèƒ½å¤Ÿè§£å†³iOSå¼€å‘ä¸­90%çš„å†…å­˜ç®¡ç†é—®é¢˜ï¼Œä½†æ˜¯å¦å¤–è¿˜æœ‰10%çš„å†…å­˜ç®¡ç†æ˜¯éœ€è¦æ‰‹åŠ¨ç®¡ç†çš„ï¼Œä¸»è¦å°±æ˜¯ä¸åº•å±‚Core Foundationå¯¹è±¡äº¤äº’çš„éƒ¨åˆ†ï¼Œå› ä¸ºåº•å±‚Core Foundationå¯¹è±¡ç”±äºä¸åœ¨ARCçš„ç®¡ç†ä¸‹ã€‚ ä½¿ç”¨ARCéœ€è¦é¢å¤–æ³¨æ„çš„ä¸¤ä¸ªé—®é¢˜ï¼š 1.è¿‡åº¦ä½¿ç”¨blockäº§ç”Ÿçš„å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚ 2.åº•å±‚Core Foundationå¯¹è±¡éœ€è¦æ‰‹åŠ¨è¿›è¡Œå†…å­˜ç®¡ç†ã€‚ Core Foundationå¯¹è±¡çš„å†…å­˜ç®¡ç† åº•å±‚çš„Core Foundationå¯¹è±¡çš„åˆ›å»ºï¼Œå¤§å¤šæ•°ä»¥XxxCreateWithXxxè¿™æ ·çš„æ–¹å¼åˆ›å»ºï¼Œä¾‹å¦‚ï¼š 12//åˆ›å»ºä¸€ä¸ªCFStringRefå¯¹è±¡ CFStringRef str = CFStringCreateWithCString(kCFAllocatorDefault,\"hello world\",kCFStringEncodingUTF8); æˆ–è€…123456789//è®¾ç½®å­—é—´è·+ (NSAttributedString *)setLabelAttributeString:(NSString*)labelText withCharactorSpace:(CGFloat)charactorSpace&#123; NSMutableAttributedString * string =[[NSMutableAttributedString alloc]initWithString:labelText]; long number = charactorSpace; CFNumberRef num = CFNumberCreate(kCFAllocatorDefault,kCFNumberSInt8Type,&amp;number); [string addAttribute:(id)kCTKernAttributeName value:(__bridge id)num range:NSMakeRange(0,[string length])]; CFRelease(num); return string;&#125; å¯¹äºè¿™ç§å¯¹è±¡çš„ä¿®æ”¹å’Œé‡Šæ”¾ï¼Œéœ€è¦ç›¸åº”çš„ä½¿ç”¨CFRetainå’ŒCFReleaseã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜éœ€è¦è§£å†³ã€‚åœ¨ARCä¸‹ï¼Œæˆ‘ä»¬æœ‰æ—¶éœ€è¦å°†ä¸€ä¸ªCore Foundationå¯¹è±¡è½¬æ¢æˆObjective-Cå¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè½¬æ¢è¿‡ç¨‹ä¸­çš„å¼•ç”¨è®¡æ•°å¦‚ä½•è°ƒæ•´ã€‚è¿™å°±å¼•å…¥äº†ä¸bridgeç›¸å…³çš„å…³é”®å­—ï¼š __bridge:åªåšç±»å‹è½¬æ¢ï¼Œä¸ä¿®æ”¹ç›¸å…³å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼ŒåŸæ¥çš„Core Foundationå¯¹è±¡åœ¨ä¸ç”¨æ—¶ï¼Œéœ€è¦è°ƒç”¨CFReleaseæ–¹æ³•ã€‚ __bridge_retained:ç±»å‹è½¬æ¢åï¼Œå°†ç›¸å…³å¯¹è±¡çš„å¼•ç”¨è®¡æ•°+1ï¼ŒåŸæ¥çš„Core Foundationå¯¹è±¡åœ¨ä¸ç”¨æ—¶ï¼Œéœ€è¦è°ƒç”¨CFReleaseæ–¹æ³•ã€‚ __bridge_transfer:ç±»å‹è½¬æ¢åï¼Œå°†è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°äº¤ç»™ARCç®¡ç†ï¼ŒCore Foundationå¯¹è±¡åœ¨ä¸ç”¨æ—¶ï¼Œä¸å†éœ€è¦è°ƒç”¨CFReleaseæ–¹æ³•ã€‚ æˆ‘ä»¬æ ¹æ®ä¸šåŠ¡é€»è¾‘ï¼Œåˆç†ä½¿ç”¨ä¸Šé¢ä¸‰ç§è½¬æ¢å…³é”®å­—ï¼Œå°±å¯ä»¥è§£å†³Core Foundationå¯¹è±¡ä¸Objcå¯¹è±¡ç›¸äº’è½¬æ¢çš„é—®é¢˜äº†ã€‚","link":"/2015/12/12/ã€ŠiOSå¼€å‘è¿›é˜¶ã€‹é˜…è¯»ç¬”è®°ï¼ˆä¸€ï¼‰å†…å­˜ç®¡ç†é‡Šç–‘/"},{"title":"iOSè‡ªåŠ¨æ‰“åŒ…è„šæœ¬","text":"ä½¿ç”¨Xcodebuildå’Œxcrunå‘½ä»¤ç”Ÿæˆã€‚å…·ä½“å‚æ•°å¯ä»¥è‡ªå·±é…ç½®ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465#!/bin/bash#Author hanliu#Global declarationSCHEMENAME=\"hongmeng\"#if use git#BRANCHNAME = masterDATE=`date \"+%Y%m%d\"`SOURCEPATH=$(CD \"$(dirname $0)\" &amp;&amp; pwd)BUILDPATH=$(dirname $(dirname $SOURCEPATH))/AutoBuildIPABUILDAPPPATH=$BUILDPATH/Build/Products/Debug-iphoneosIPAPATH=$(dirname $(dirname $SOURCEPATH))/IPAIPANAME=$SCHEMENAME_$DATE.ipaecho \"DATE is \" $DATEecho \"SOURCEPATH:\"$SOURCEPATHecho \"BUILDPATH:\"$BUILDPATHecho \"IPAPATH:\"$IPAPATHecho \"Press any key to continue!\"read -p \"press any \" cif $c;then xcodebuild -listelse echo \"ddd\"fi##Information about project \"xxxxx\":# Targets:# xxxxxx## Build Configurations:# Debug# Release## If no build configuration is specified and -scheme is not passed then \"Release\" is used.## Schemes:# xxxxxx##ä¸æŒ‡å®šconfigurationï¼Œæ‰“åŒ…ä¸ºdebugæ¨¡å¼#xcodebuild -workspace hongmeng.xcworkspace -scheme hongmeng -configuration Debug clean build -derivedDataPath $BUILDPATHxcodebuild -workspace $SCHEMENAME.xcworkspace -scheme $SCHEMENAME -configuration Debug clean build -derivedDataPath $BUILDPATHif [ -e $BUILDPATH ]; then echo \"xcodebuild Successful!\"else echo \"xcodebuild failure!\" exit 1fi#æ‰“åŒ…ipa#xcrun -sdk iphoneos PackageApplication -v AutoBuildIPA/Build/Products/Debug-iphoneos/$SCHEMENAME.app -o $BUILDPATH/$SCHEMENAME_$DATE.ipaxcrun -sdk iphoneos PackageApplication -v $BUILDAPPPATH/$SCHEMENAME.app -o $IPAPATH/$IPANAMEif [ -e $IPAPATH/$IPANAME ]; then echo \"\\n--------------\\n\\n\" echo \"Congratulations! Build Successful!\" open $IPAPATHelse echo \"Build failure!\"fi","link":"/2016/11/30/iOSè‡ªåŠ¨æ‰“åŒ…è„šæœ¬/"},{"title":"ä¸€æ¬¡iOS EXC_BAD_ACCESS çš„åˆ†æè§£å†³è¿‡ç¨‹","text":"æ¸¸æˆå®¢æˆ·ç«¯åœ¨æ–­çº¿é‡è¿åéœ€è¦è°ƒç”¨SDKæ–¹æ³•æ¸…ç©ºæ¶ˆæ¯ç¼“å­˜æ•°æ®ï¼Œä½†æ˜¯å› ä¸ºæ¸¸æˆåœ¨åå°åœç•™æ—¶é—´è¾ƒé•¿ï¼Œéƒ¨åˆ†å†…å­˜è¢«é‡Šæ”¾ï¼Œå¯¼è‡´å‡ºç°EXC_BAD_ACCESSã€‚ ç½‘ä¸Šå¤§éƒ¨åˆ†å…³äºEXC_BAD_ACCESSçš„æ–‡ç« éƒ½æ˜¯å†™äº†å¦‚ä½•æ£€æµ‹ï¼Œå¹¶æ²¡æœ‰è¯´æ˜å¦‚ä½•å¤„ç†è¿™ç§é—®é¢˜ã€‚å½“ç„¶æœ¬æ–‡ä¹Ÿæ˜¯åŸºäºç‰¹å®šåœºæ™¯ä¸‹è§£å†³äº†è¯¥é—®é¢˜ã€‚ ä»€ä¹ˆæ˜¯EXC_BAD_ACCESSï¼ŸEXC_BAD_ACCESSç®€å•çš„è®²å°±æ˜¯ä½¿ç”¨äº†å·²ç»è¢«é‡Šæ”¾çš„å†…å­˜ï¼Œå¯¼è‡´crashã€‚ å†™Demoæµ‹è¯•ClassA(å•ä¾‹å¯¹è±¡) ï¼Œ ä¸€ä¸ª strong çš„NSMutableArray *marr å§ã€‚ @property (nonatomic, strong) NSMutableArray *marr; 1ã€åœºæ™¯ï¼šapp1é€€åˆ°åå°ï¼Œä½¿ç”¨å…¶ä»–appï¼Œç»è¿‡å‡ åˆ†é’Ÿåï¼Œé‡æ–°è¿›å…¥app1ï¼Œä¼šè°ƒç”¨ [[ClassA sharedIndstance] clean]ã€‚cleanæ–¹æ³•ï¼š123- (void)clean &#123; [self.marr removeAllObjects];&#125;2ã€åˆ†æï¼šA1ï¼šClassAå•ä¾‹å¯¹è±¡è¢«é‡Šæ”¾ä½†æ˜¯æ¯æ¬¡ä¸æ˜¯åˆ[ClassA sharedIndstance] äº†å—ï¼ŸA2ï¼šmarr å±æ€§è¢«é‡Šæ”¾ï¼Œè¿™ç§æ€ä¹ˆè®²ï¼Œå•ä¾‹æ²¡é‡Šæ”¾ï¼Œåè€Œé‡Œé¢çš„å±æ€§è¢«é‡Šæ”¾ï¼Ÿï¼Ÿç»æµ‹è¯•ï¼ŒåŸå› ä¸ºåˆ†æ1. [ClassA sharedIndstance] å¹¶ä¸èƒ½é‡æ–°initï¼Œå³ä½¿èƒ½initï¼Œé‚£ä¹Ÿæ˜¯æ–°çš„å†…å­˜å¯¹è±¡äº†ã€‚3ã€æµ‹è¯•è¿‡ç¨‹ï¼š1. æ–°å»ºå•ä¾‹ç±»SingeTonClassï¼Œå¹¶åœ¨xcodeè®¾ç½®ä¸ºMRC.2. åˆå§‹åŒ–ç„¶åæ‰‹åŠ¨releaseï¼Œå†åˆå§‹åŒ–ã€‚ï¿¼ï¿¼ï¿¼åˆå°è¯•äº†è¿™ç§æ–¹å¼åˆå§‹åŒ–ï¼šå¦‚æœå†deallocä¹‹åé‡æ–°ä»¥ allocæ–¹å¼åˆå§‹åŒ–ï¼Œåˆ™å¹¶éä»¥å‰çš„å¯¹è±¡äº†ï¼Œæ— æ„ä¹‰ã€‚ï¿¼ï¿¼é‚£ä¹ˆåˆ°æ­¤ä¸ºæ­¢ï¼Œå¯èƒ½çœ‹èµ·æ¥å°±æš‚æ—¶æ²¡åŠæ³•è§£å†³äº†ã€‚å†²çªç‚¹ï¼šæ­¤ç±»å¿…é¡»ä½¿ç”¨å•ä¾‹ï¼Œå› ä¸ºå·¥ç¨‹é‡Œé¢å…¨éƒ¨ç”¨çš„è¿™ç§æ–¹å¼ï¼›ç„¶åæ–­çº¿é‡è¿åå¿…é¡»è°ƒç”¨cleanæ–¹æ³•ã€‚4ã€æœ€åå¦‚ä½•è§£å†³ï¼Ÿ å…¶å®ä¹Ÿè¿˜æ˜¯é‡‡ç”¨åˆ†æ1çš„æ–¹å¼ï¼Œé‡æ–°åˆå§‹åŒ–å•ä¾‹ç±»[ClassA sharedIndstance]ã€‚ ä¸ºä½•ï¼Ÿé—®é¢˜å‘ç”Ÿçš„åœºæ™¯ã€‚ å› ä¸ºæ¸¸æˆæœ¬èº«æ–­çº¿é‡è¿åè¦æ¸…ç©ºç¼“å­˜æ¶ˆæ¯ï¼Œç›¸å½“äºé‡æ–°åˆå§‹åŒ–ä¸€æ¬¡å•ä¾‹ç±»ã€‚ä¹‹å‰ä¸€ç›´åœ¨æ„é‡æ–°åˆå§‹åŒ–åå¹¶éåŸå¯¹è±¡ï¼Œæ²¡æœ‰è€ƒè™‘é—®é¢˜å‘ç”Ÿçš„åœºæ™¯ã€‚ é‚£ä¹ˆé‡æ–°åˆå§‹åŒ–sharedIndstanceæ—¶ï¼Œéœ€è¦å…ˆæŠŠåŸæ¥çš„å•ä¾‹é”€æ¯ï¼Œæ–¹æ³•:ï¿¼ è‡ªæ­¤ï¼Œé—®é¢˜è§£å†³ã€‚","link":"/2018/02/08/ä¸€æ¬¡iOS-EXC-BAD-ACCESS-çš„åˆ†æè§£å†³è¿‡ç¨‹/"},{"title":"ã€ŠiOSå¼€å‘è¿›é˜¶ã€‹é˜…è¯»ç¬”è®°ï¼ˆäºŒï¼‰â€”â€”å¼€å‘æŠ€å·§","text":"æ”¶èµ·é”®ç›˜ åœ¨UIViewControllerä¸­æ”¶èµ·é”®ç›˜ï¼Œå¤„äº†è°ƒç”¨ç›¸åº”æ§ä»¶çš„resignFirstResponderæ–¹æ³•å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸‰ç§æ–¹æ³•ï¼š é‡è½½UIViewControllerçš„touchBeginæ–¹æ³•ï¼Œç„¶ååœ¨é‡Œé¢æ‰§è¡Œ[self.view endEditing:YES];,è¿™æ ·å•å‡»UIViewControllerçš„ä»»æ„åœ°æ–¹ï¼Œå°±å¯ä»¥æ”¶èµ·é”®ç›˜ï¼› ç›´æ¥æ‰§è¡Œ[[UIApplicatoin sharedApplication] sendAction:@selector(resignFirstResponder) to:nil from:nil forEvent:nil];,ç”¨äºåœ¨è·å¾—å½“å‰UIViewControlleræ¯”è¾ƒå›°éš¾çš„æ—¶å€™ä½¿ç”¨ã€‚ ç›´æ¥æ‰§è¡Œ[[[UIApplicatoin sharedApplication] keyWindow] endEditing:YES];ã€‚ NSJSONSerializationæ¯”NSKeyedArchiveræ›´å¥½ åœ¨é€‰æ‹©æŒä¹…åŒ–æ–¹æ¡ˆæ—¶ï¼Œç³»ç»Ÿæä¾›çš„NSJSONSerializationæ¯”NSKeyedArchiveråœ¨æ•ˆç‡å’Œä½“ç§¯ä¸Šéƒ½æ›´ä¼˜ï¼Œæ›´è¯¦ç»†çš„æµ‹è¯•å‚è€ƒï¼šhttps://github.com/randomsequence/NSSerialisationTests; è®¾ç½®åº”ç”¨å†…çš„ç³»ç»Ÿæ§ä»¶è¯­è¨€ åœ¨å·¥ç¨‹çš„info.plistæ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š12345&lt;key&gt;CFBundleLocalizations&lt;/key&gt;&lt;array&gt; &lt;string&gt;zh_CN&lt;/string&gt; &lt;string&gt;en&lt;/string&gt;&lt;/array&gt; å·§ç”¨ç³»ç»Ÿçš„æˆªå±åŠŸèƒ½ iOS7ä»¥åï¼Œappleæä¾›çš„ç³»ç»Ÿçš„æˆªå±APIï¼š- (UIView *)snapshotViewAfterScreenUpdates:(BOOL)afterUpdatesæ¥å®ç°æˆªå±åŠŸèƒ½ã€‚è€Œå¯¹äºiOS7ä»¥å‰çš„ç³»ç»Ÿï¼Œå¯ä»¥ç”¨è¿‡ä»£ç æ¥å®ç°æˆªå±åŠŸèƒ½ï¼š 123456789+ (UIImage *)captureImageFromView:(UIView *)view&#123; CGRect screenRect = [view bounds]; UIGraphicsBeginImageContext(screenRect.size); CGContextRef ctx = UIGraphicsGetCurrentContext(); [view.layer renderInContext:ctx]; UIImage *image = UIGraphicsGetImageFromCurrentImageContext(); UIGraphicsEndImageContext(); return image;&#125; Javascriptæ–‡ä»¶è®¾ç½®è°ƒæ•´ Javascriptçš„jsåç¼€çš„æ–‡ä»¶é»˜è®¤è¢«æ‹–åŠ¨åˆ°å·¥ç¨‹ä¸­åï¼Œæ˜¯åœ¨ç¼–è¯‘åˆ—è¡¨ä¸­ï¼Œè€Œä¸æ˜¯èµ„æºåˆ—è¡¨ä¸­ã€‚éœ€è¦æ‰‹åŠ¨è°ƒæ•´æœŸä½ç½®ï¼Œå¦åˆ™å®ƒå°±ä¸èƒ½æ‰“åŒ…åˆ°ipaæ–‡ä»¶ä¸­ã€‚ æ³¨ï¼šxcode7å·²ç»ä¿®æ”¹æ­¤é—®é¢˜ï¼Œå¦‚ä¸‹å›¾ï¼š å¿½ç•¥ç¼–è¯‘è­¦å‘Š åœ¨Build Phaseä¸­å¯¹åº”çš„æ–‡ä»¶ä¸­æ·»åŠ  -wå‚æ•°ã€‚ å®šåˆ¶NSLog12345#ifdef DEBUG#define NSLog(args,...) NSLog(@\"-%d%s:%@\",__LINE__,__FUNCTION__,[NSString stringWithFormat:(args), ##__VA_ARGS__])#else#define NSLog(...)#endif å¯¼èˆªæ ä¸Šçš„ä¸€äº›è®¾ç½®1234567å»æ‰å¯¼èˆªæ é˜´å½±é»‘çº¿ã€‚setBackGroundImageä¸­ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨[UIImage new]UINavigationBar *navBar = self.navigationController.navigationBar;[navBar setBackgroundImage:[UIImage imageNamed:@&quot;white_backgroud&quot;] forBarPosition:UIBarPositionAny barMetrics:UIBarMetricsDefault];[navBar setShadowImage:[UIImage new]];å»æ‰searchBarçš„é˜´å½±[self.searchBar setBackgroundImage:[UIImage new]];","link":"/2015/12/13/ã€ŠiOSå¼€å‘è¿›é˜¶ã€‹é˜…è¯»ç¬”è®°ï¼ˆäºŒï¼‰â€”â€”å¼€å‘æŠ€å·§/"},{"title":"å…³äºCoreDataå’ŒSQLiteå¤šçº¿ç¨‹è®¿é—®æ—¶çš„çº¿ç¨‹å®‰å…¨é—®é¢˜","text":"æ•°æ®åº“è¯»å–æ“ä½œä¸€èˆ¬éƒ½æ˜¯å¤šçº¿ç¨‹è®¿é—®çš„ã€‚åœ¨å¯¹æ•°æ®è¿›è¡Œè¯»å–æ—¶ï¼Œæˆ‘ä»¬è¦ä¿è¯å…¶å½“å‰çŠ¶æ€ä¸èƒ½è¢«ä¿®æ”¹ï¼Œå³è¯»å–æ—¶åŠ é”ï¼Œå¦åˆ™å°±ä¼šå‡ºç°æ•°æ®é”™è¯¯æ··ä¹±ã€‚IOSä¸­å¸¸ç”¨çš„ä¸¤ç§æ•°æ®æŒä¹…åŒ–å­˜å‚¨æ–¹å¼ï¼šCoreDataå’ŒSQLiteï¼Œä¸¤è€…éƒ½éœ€è¦è®¾ç½®çº¿ç¨‹å®‰å…¨ï¼Œåœ¨è¿™é‡Œä»¥FMDBæ¥è§£é‡Šå¯¹SQLiteçš„çº¿ç¨‹å®‰å…¨è®¿é—®ã€‚ ä¸€:FMDBçš„çº¿ç¨‹å®‰å…¨ï¼šï¼ˆä»¥è¯»å–å›¾ç‰‡ä¸ºä¾‹ï¼‰ 1.æ²¡æœ‰çº¿ç¨‹å®‰å…¨çš„æ‰§è¡Œæ–¹å¼ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445//************** æ•°æ®åº“ä¿å­˜å›¾ç‰‡ ******************// FMDatabase *database = [FMDatabase databaseWithPath:[self getDatabasePath]]; //æ‰“å¼€æ•°æ®åº“ [database open]; NSString *sql = @\"create table if not exists Test (id integer primary key autoincrement,name text,image blob);\"; //åˆ›å»ºè¡¨ [database executeUpdate:sql]; //æŠŠUIImageå¯¹è±¡è½¬åŒ–ä¸ºNSData NSData *data = UIImagePNGRepresentation([UIImage imageNamed:@\"user_browse\"]); //å†™å…¥æ•°æ® sql = @\"insert into Test (name,image) values (?,?)\"; [database executeUpdate:sql,@\"å¼ ä¸‰\",data]; //è¯»å–æ˜¾ç¤º sql = @\"select * from Test;\"; FMResultSet *resultSet = [database executeQuery:sql]; while (resultSet.next) &#123; //[resultSet dataForColumn:@\"image\"]; NSData *imageData = [resultSet dataForColumnIndex:2]; UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, 300, 300)]; imageView.image = [UIImage imageWithData:imageData]; [self.view addSubview:imageView]; &#125;2ï¼Œä½¿ç”¨çº¿ç¨‹é˜Ÿåˆ—1234567891011121314151617181920212223242526272829303132333435363738394041424344//************** æ•°æ®åº“çº¿ç¨‹å®‰å…¨ ***********// FMDatabaseQueue *queue = [[FMDatabaseQueue alloc] initWithPath:[self getDatabasePath]]; [queue inDatabase:^(FMDatabase *db) &#123; //çº¿ç¨‹å®‰å…¨çš„ __block NSString *sql = @\"create table if not exists Test (id integer primary key autoincrement,name text,image blob);\"; //åˆ›å»ºè¡¨ [database executeUpdate:sql]; &#125;]; //æ’å…¥æ•°æ® [queue inDatabase:^(FMDatabase *db) &#123; //å†™å…¥æ•°æ® sql = @\"insert into Test (name,image) values (?,?)\"; [database executeUpdate:sql,@\"å¼ ä¸‰\",data]; &#125;]; //è¯»å– [queue inDatabase:^(FMDatabase *db) &#123; //è¯»å–æ˜¾ç¤º sql = @\"select * from Test;\"; FMResultSet *resultSet = [database executeQuery:sql]; while (resultSet.next) &#123; //[resultSet dataForColumn:@\"image\"]; NSData *imageData = [resultSet dataForColumnIndex:2]; UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, 300, 300)]; imageView.image = [UIImage imageWithData:imageData]; [self.view addSubview:imageView]; &#125; &#125;]; åˆ†æä¸€ä¸‹çº¿ç¨‹å®‰å…¨ä¸‹çš„FMDBçš„å®ç°ï¼šåœ¨å½“ä½¿ç”¨FMDBDatabaseQueueåˆ›å»ºæ•°æ®åº“æ—¶ï¼Œä¼šä½¿ç”¨GCDåˆ›å»ºä¸€ä¸ªçº¿ç¨‹é˜Ÿåˆ—ï¼š12345ã€‚ã€‚ã€‚ _queue = dispatch_queue_create([[NSString stringWithFormat:@\"fmdb.%@\", self] UTF8String], NULL); dispatch_queue_set_specific(_queue, kDispatchQueueSpecificKey, (__bridge void *)self, NULL); _openFlags = openFlags;ã€‚ã€‚ã€‚ ç„¶ååœ¨è¯»å–æ—¶è°ƒç”¨[queue inDatabase:^(FMDatabase *db)æ–¹æ³•ï¼Œåœ¨blockä¸­ä¼šé”å®šå½“å‰æ•°æ®åº“12345dispatch_sync(_queue, ^() &#123; FMDatabase *db = [self database]; block(db); â€¦â€¦&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®é™…ä¸Šè¿™é‡Œæ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“è¿›è¡ŒåŠ é”ï¼Œä»¥æ­¤æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ã€‚ äºŒã€CoreDataçš„çº¿ç¨‹å®‰å…¨ 1.æ²¡æœ‰çº¿ç¨‹å®‰å…¨çš„coredataæ•°æ®è¯»å–ï¼š NSManagedObjectContextå¯¹è±¡çš„åˆ›å»ºï¼š_managedObjectContext = [[NSManagedObjectContext alloc] init]; æ’å…¥æ•°æ®æ“ä½œï¼šï¼ˆAppDetailModalä¸ºæ•°æ®æ¨¡å‹ï¼‰ context ä¸ºè¿”å›çš„ _managedObjectContext1AppDetailModal *newapp = [NSEntityDescription insertNewObjectForEntityForName:TableName inManagedObjectContext:context]; å…¶ä»–æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤æ“ä½œ//è·å–Entity1NSEntityDescription *entity = [NSEntityDescription entityForName:TableName inManagedObjectContext:context]; 2.çº¿ç¨‹å®‰å…¨çš„coreDataæ“ä½œï¼š é¦–å…ˆåˆ›å»ºå¹¶è¡Œçš„NSManagedObjectContextå¯¹è±¡1NSManagedObjectContext* context=[[NSManagedObjectContext alloc] initWithConcurrencyType:NSPrivateQueueConcurrencyType]; ç„¶ååœ¨æ‰§è¡Œè¯»å–æ“ä½œæ—¶ä½¿ç”¨ä¸€ä¸‹ä¸¤ä¸ªæ–¹æ³•ï¼š -(void)performBlock:(void (^)(void))block -(void)performBlockAndWait:(void (^)(void))block 12345[context performBlock:^&#123; //è¦æ‰§è¡Œçš„è¯»å–æ“ä½œ &#125;];","link":"/2015/12/14/å…³äºCoreDataå’ŒSQLiteå¤šçº¿ç¨‹è®¿é—®æ—¶çš„çº¿ç¨‹å®‰å…¨é—®é¢˜/"},{"title":"å¦‚ä½•åšä¸€ä¸ªåœ†å½¢çš„éŸ³é‡æ—‹é’®","text":"æœ€è¿‘åœ¨Mediumä¸Šæµè§ˆä¸€äº›å›½å¤–çš„iOSå¼€å‘ç›¸å…³çš„æ–‡ç« ï¼Œçœ‹åˆ°æ„Ÿå…´è¶£çš„ä¾¿å®è·µä¸€ç•ªï¼Œè®°å½•ä¸‹æ¥ã€‚ä¸€æ¥ç®—æ˜¯å­¦ä¹ swiftï¼Œå¦ä¸€æ–¹é¢åˆ™æ˜¯ä¸ºäº†æ‹“å®½æŠ€æœ¯é¢ã€‚ è¿™ç¯‡æ–‡ç« æ¥è‡ªKarthik Keyan Balançš„How to create a circular seek bar in iOSä¸»è¦å±•ç¤ºäº†ä¸€ä¸ªåœ†å½¢çš„ç±»ä¼¼éŸ³é‡æ—‹é’®çš„UIæ§ä»¶ï¼Œç”¨swiftå®ç°ã€‚å¦‚ä¸‹å›¾ï¼Œ å¦‚ä½•ç”»å‡ºåœ†å½¢æ—‹é’® ä½¿ç”¨CAShapeLayerï¼Œå¹¶å°†å…¶pathè®¾ç½®ä¸ºè‡ªå®šä¹‰çš„è´å¡å°”æ›²çº¿çš„pathã€‚ 1234567891011121314151617181920212223lazy var seekerBarLayer = CAShapeLayer()...private func addSeekerBar() &#123; let center = CGPointMake(self.bounds.size.width/2, self.bounds.size.height/2) //å¼§åº¦ let sAngle = degreeToRadian(Double(startAngle)) let eAngle = degreeToRadian(Double(endAngle)) let path = UIBezierPath(arcCenter: center, radius: (self.bounds.size.width - 18)/2, startAngle:CGFloat(sAngle) , endAngle:CGFloat(eAngle) , clockwise: true) seekerBarLayer.path = path.CGPath; seekerBarLayer.lineWidth = 4.0 seekerBarLayer.lineCap = kCALineCapRound seekerBarLayer.strokeColor = seekBarColor.CGColor seekerBarLayer.fillColor = UIColor.clearColor().CGColor if seekerBarLayer.superlayer == nil &#123; self.layer.addSublayer(seekerBarLayer) &#125; &#125; æ ¹æ®touchä½ç½®ç§»åŠ¨æ—‹é’®ä½ç½® é‡è½½touchç›¸å…³çš„ä¸‰ä¸ªæ–¹æ³•ï¼Œé‡ç‚¹æ˜¯åœ¨continueTrackingWithTouchæ–¹æ³•ä¸­ï¼Œæ ¹æ®touchçš„åæ ‡è®¡ç®—æŒ‰é’®éœ€è¦ç§»åŠ¨çš„ä½ç½®çš„moveToPointæ–¹æ³•ã€‚ è·å–touchä½ç½® è®¡ç®—æ—‹é’®å¯¹åº”çš„åæ ‡ è·å–touchä½ç½® 12345678910111213141516171819202122232425262728293031//MARK: Touch Eventoverride func beginTrackingWithTouch(touch: UITouch, withEvent event: UIEvent?) -&gt; Bool &#123; let point = touch.locationInView(self) let rect = CGRectInset(self.thumbButton.frame, -20, -20) let canBegin = CGRectContainsPoint(rect, point) if canBegin &#123; UIView.animateWithDuration(0.2, delay: 0.0, options: .CurveEaseIn, animations: &#123; () -&gt; Void in self.thumbButton.transform = CGAffineTransformMakeScale(1.2, 1.2) &#125;, completion: nil) &#125; return canBegin&#125;override func continueTrackingWithTouch(touch: UITouch, withEvent event: UIEvent?) -&gt; Bool &#123; if #available(iOS 9,*)&#123; guard let coalescedTouches = event?.coalescedTouchesForTouch(touch) else&#123; return moveToPoint(touch.locationInView(self)) &#125; let result = true for cTouch in coalescedTouches&#123; let result = moveToPoint(cTouch.locationInView(self)) if result == false &#123;break&#125; &#125; return result &#125; return true&#125;override func endTrackingWithTouch(touch: UITouch?, withEvent event: UIEvent?) &#123; thumbMoveDidComplete()&#125; è®¡ç®—æ—‹é’®å¯¹åº”çš„åæ ‡ 1234567891011121314151617181920212223242526272829303132func moveToPoint(point:CGPoint) -&gt;Bool&#123; var degree = degreeForLocation(point) func moveToClosestEdge(degree:Double)&#123; let startDistance = fabs(CGFloat(degree) - startAngle) let endDistance = fabs(CGFloat(degree) - endAngle) if startDistance &lt; endDistance&#123; currentAngle = startAngle &#125;else&#123; currentAngle = endAngle &#125; &#125; if startAngle &gt; endAngle &#123; if degree &lt; Double(startAngle) &amp;&amp; degree &gt; Double(endAngle)&#123; moveToClosestEdge(degree) thumbMoveDidComplete() return false &#125; &#125; else &#123; if degree &gt; Double(endAngle) || degree &lt; Double(startAngle)&#123; moveToClosestEdge(degree) thumbMoveDidComplete() return false &#125; &#125; currentAngle = CGFloat(degree) return true&#125; æ‰‹åŠ¨å‘é€actionç”±äºè¿™ä¸ªæ§ä»¶æ˜¯ç»§æ‰¿è‡ªUIControlçš„ï¼Œæ­£å¦‚å…¶ä»–ç»§æ‰¿ä¸UIControlçš„æ§ä»¶ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæ§ä»¶çš„çŠ¶æ€äº‹ä»¶ã€‚ä¾‹å¦‚valueChangedã€TouchUpInsideã€TouchOutSideã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦çš„æ˜¯æ§ä»¶çš„ä½ç½®ä¿¡æ¯ï¼Œæ‰€ä»¥å½“endTouchçš„æ—¶å€™å‘é€ä¸€ä¸ªvalueChangedäº‹ä»¶ï¼š1self.sendActionsForControlEvents(.ValueChanged) å…¶ä¸­æœ‰ä¸€ä¸ªå°ç»†èŠ‚ï¼Œå½“ç‚¹å‡»åˆ°æŒ‰é’®æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªå˜å¤§çš„åŠ¨ç”»æ•ˆæœï¼Œå…¶å®ä¹Ÿæ˜¯ç”¨åˆ°äº†ä¸€ä¸ªåŸºæœ¬çš„æ‹‰ä¼¸æ•ˆæœï¼š123UIView.animateWithDuration(0.2, delay: 0.0, options: .CurveEaseIn, animations: &#123; () -&gt; Void in self.thumbButton.transform = CGAffineTransformMakeScale(1.2, 1.2) &#125;, completion: nil) æ€»ç»“ åˆ©ç”¨CAShapeLayer+è´å¡å°”æ›²çº¿ç”»å‡ºUIã€‚ æ ¹æ®è§’åº¦è®¡ç®—å¼§åº¦ï¼Œå¹¶å¯¼å‡ºæŒ‰é’®å¯¹åº”çš„åæ ‡ç‚¹ã€‚ touchäº‹ä»¶çš„å¤„ç†ã€‚- æ‰‹åŠ¨å‘é€actionã€‚ å‚è€ƒä»£ç ï¼šCircularSeek On GitHub","link":"/2016/01/17/å¦‚ä½•åšä¸€ä¸ªåœ†å½¢çš„éŸ³é‡æ—‹é’®/"},{"title":"ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹è¯»ä¹¦ç¬”è®°-ç¼–è¯‘å’Œé“¾æ¥","text":"ä¸€ä¸ªHelloWorld.cç¨‹åºæ˜¯å¦‚ä½•è¢«å¤„ç†ï¼Œå¾—åˆ°ä¸€ä¸ªa.outå¯æ‰§è¡Œç¨‹åºçš„å‘¢ï¼Ÿ$gcc HelloWorld.cå‘½ä»¤ï¼Œå¾—åˆ°a.out$./a.out æ‰§è¡Œ è¯¥è¿‡ç¨‹å¯åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼šé¢„å¤„ç†ï¼ˆPreprocessï¼‰æˆ–è€…å«é¢„ç¼–è¯‘ã€ç¼–è¯‘ï¼ˆCompileï¼‰ã€æ±‡ç¼–ï¼ˆAssemblyï¼‰å’Œé“¾æ¥ï¼ˆLinkingï¼‰ã€‚ é¢„ç¼–è¯‘ é¢„ç¼–è¯‘çš„å‘½ä»¤$gcc -E HelloWorld.c -o HelloWorld.iã€‚é¢„ç¼–è¯‘ä¸­çš„ä¸»è¦è§„åˆ™ï¼š å°†æ‰€æœ‰çš„#defineåˆ é™¤ï¼Œå±•å¼€æ‰€æœ‰çš„å®å®šä¹‰ å¤„ç†æ‰€æœ‰çš„æ¡ä»¶é¢„ç¼–è¯‘æŒ‡ä»¤ï¼Œæ¯”å¦‚#if,#ifdef,#endif,#elif,#else. å¤„ç†#includeæŒ‡ä»¤ï¼Œå°†è¢«åŒ…å«çš„æ–‡ä»¶æ’å…¥åˆ°è¯¥é¢„ç¼–è¯‘æŒ‡ä»¤çš„ä½ç½®ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯é€’å½’è¿›è¡Œçš„ åˆ é™¤æ‰€æœ‰çš„æ³¨é‡Š//å’Œ/**/. æ·»åŠ è¡Œå·å’Œæ–‡ä»¶åæ ‡è¯†ã€‚ ä¿ç•™æ‰€æœ‰çš„#pragmaç¼–è¯‘å™¨æŒ‡ä»¤ï¼Œå› ä¸ºç¼–è¯‘å™¨è¦ä½¿ç”¨å®ƒã€‚ ç¼–è¯‘ ç¼–è¯‘å™¨ ï¼šcc1ç¨‹åºç¼–è¯‘è¿‡ç¨‹å°±æ˜¯æŠŠé¢„å¤„ç†å®Œçš„.iæ–‡ä»¶è¿›è¡Œä¸€ç³»åˆ—çš„è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æä»¥åŠä»£ç ä¼˜åŒ–åäº§ç”Ÿç›¸åº”çš„æ±‡ç¼–ä»£ç ç¼–è¯‘çš„å‘½ä»¤$gcc -S HelloWorld.c -o HelloWorld.sã€‚ æ±‡ç¼– æ±‡ç¼–å™¨ asæ±‡ç¼–è¿‡ç¨‹å°†æ±‡ç¼–ä»£ç è½¬æ¢æˆæœºå™¨ä»£ç ã€‚æ ¹æ®æ±‡ç¼–æŒ‡ä»¤å’Œæœºå™¨ä»£ç çš„å¯¹ç…§è¡¨ä¸€ä¸€ç¿»è¯‘ã€‚æ±‡ç¼–çš„å‘½ä»¤$gcc -c HelloWorld.c -o HelloWorld.oã€‚ é“¾æ¥ é“¾æ¥å™¨ ldä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œé“¾æ¥å™¨ä¸»è¦æ˜¯æŠŠä»£ç çš„.oæ–‡ä»¶ä¸é™æ€åº“é“¾æ¥åœ¨ä¸€èµ·ã€‚","link":"/2016/05/10/ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹è¯»ä¹¦ç¬”è®°-ç¼–è¯‘å’Œé“¾æ¥/"},{"title":"å¦‚ä½•åœ¨swifté¡¹ç›®ä¸­åˆ›å»ºObjective-C Bridging header","text":"åœ¨swiftå·¥ç¨‹ä¸­ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿéœ€è¦ä½¿ç”¨OBJCä»£ç å†™çš„ç¬¬ä¸‰æ–¹åº“æˆ–è€…å·¥å…·ç±»ç­‰ï¼Œè¿™æ—¶å°±éœ€è¦åˆ›å»ºobjcæ–‡ä»¶åˆ°swiftçš„æ¡¥æ¥headerã€‚ç°åœ¨æœ‰ä¸¤ç§æ–¹æ³•åˆ›å»ºObjective-C Bridging Header: Create Objective-C File as HeaderGo to File &gt; New &gt; File and Select Objective-C: ç„¶åä¸€ç›´nextï¼Œæœ€åå‡ºç°å¦‚ä¸‹å›¾æ—¶ï¼Œç‚¹å‡»yesï¼š è¿™ç§æ–¹å¼ä¼šåˆ›å»ºå‡º.hå’Œ.mæ–‡ä»¶ã€‚ Create Objective-C Header File DirectlyGo to File &gt; New &gt; File and Select Objective-C Header File: æœ€åï¼Œä¸¤ç§æ–¹æ³•åˆ›å»ºçš„.hæ–‡ä»¶ä¸­importä½ å°†ä½¿ç”¨çš„ç±»ã€‚1#import \"xxxx\" ä¸€èˆ¬åœ¨é¡¹ç›®ä¸­æˆ‘ä»¬ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ã€‚","link":"/2015/12/30/å¦‚ä½•åœ¨swifté¡¹ç›®ä¸­åˆ›å»ºObjective-C-Bridging-header/"},{"title":"ä¿®æ”¹UIBarButtonItemæ ‡é¢˜æ–‡å­—å¤§å°ã€é¢œè‰²ã€é˜´å½±ç­‰","text":"ä¿®æ”¹UIBarButtonItemçš„æ ‡é¢˜æ–‡å­—å¤§å°ã€é¢œè‰²ã€é˜´å½±ç­‰æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸‹å¯¼èˆªæ å³ä¾§æŒ‰é’®æ ‡é¢˜çš„å¤§å°ã€é¢œè‰²ç­‰ç­‰ï¼Œä½†æ˜¯UIBarButtonItemæ²¡æœ‰ç›´æ¥æä¾›ç›¸å…³æ–¹æ³•ã€‚é€šè¿‡æŸ¥çœ‹UIbarButtonItemå®˜æ–¹æ–‡æ¡£ï¼Œæ€»ç»“å‡ºæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ç¬¬ä¸€ç§ï¼šä½¿ç”¨initWithCustomViewæ–¹æ³•åˆ›å»ºUIBarButtonItemã€‚ç¬¬äºŒç§ï¼šé€šè¿‡KVCæ¥ä¿®æ”¹ç›¸å…³å±æ€§ã€‚ é‚£ä¹ˆå…ˆçœ‹çœ‹ç¬¬ä¸€ç§æ–¹æ³•ï¼š1234567891011UIButton * edit = [UIButton buttonWithType:UIButtonTypeCustom];edit.frame = CGRectMake(0, 0, 80, 30);[edit setTitle:@\"æ‰¹é‡ç®¡ç†\" forState:UIControlStateNormal];[edit setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];[edit addTarget:self action:@selector(edit) forControlEvents:UIControlEventTouchUpInside];edit.titleLabel.font = [UIFont systemFontOfSize:13];edit.titleLabel.textAlignment = NSTextAlignmentRight;UIBarButtonItem * rightBtn = [[UIBarButtonItem alloc]initWithCustomView:edit];[rightBtn setTintColor:COLOR(black)];self.navigationItem.rightBarButtonItem = rightBtn; è¿™ç§æ–¹æ³•æ¯”è¾ƒç®€ä¾¿ï¼Œèƒ½å¤Ÿå¿«é€Ÿç†è§£ã€‚ ç¬¬äºŒç§æ–¹æ³•ï¼š12345678UIBarButtonItem * submitComment = [[UIBarButtonItem alloc] initWithTitle:@\"æäº¤è¯„ä»·\" style:UIBarButtonItemStylePlain target:self action:@selector(submitComment:)];submitComment.tintColor = [UIColor darkGrayColor];[[UIBarButtonItem appearance] setTitleTextAttributes: [NSDictionary dictionaryWithObjectsAndKeys:[UIFont boldSystemFontOfSize:15], NSFontAttributeName, nil] forState:UIControlStateNormal]; Also,å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š1234[[UIBarButtonItem appearanceWhenContainedIn:[UINavigationController class], nil] setTitleTextAttributes:[NSDictionary dictionaryWithObjectsAndKeys: [UIFont boldSystemFontOfSize:15], NSFontAttributeName, nil] forState:UIControlStateNormal]; å…¶ä¸­å¯¹äºè¿™äº›keyéœ€è¦çœ‹ä¸€ä¸‹ï¼Œå¸¸ç”¨çš„å‡ ä¸ªkeyå·²ç»è¢«NSFontAttributeName, NSForegroundColorAttributeName, NSShadowAttributeNameä»£æ›¿:123456789101112/* Keys for text attributes dictionaries. These keys are superseded by the corresponding attribute name keys (NSFontAttributeName, NSForegroundColorAttributeName, NSShadowAttributeName) in NSAttributedString.h. */// Key to the font in the text attributes dictionary. A UIFont instance is expected. Use a font with size 0.0 to get the default font size for the situation.UIKIT_EXTERN NSString *const UITextAttributeFont NS_DEPRECATED_IOS(5_0, 7_0, \"Use NSFontAttributeName\") __TVOS_PROHIBITED;// Key to the text color in the text attributes dictionary. A UIColor instance is expected.UIKIT_EXTERN NSString *const UITextAttributeTextColor NS_DEPRECATED_IOS(5_0, 7_0, \"Use NSForegroundColorAttributeName\") __TVOS_PROHIBITED;// Key to the text shadow color in the text attributes dictionary. A UIColor instance is expected.UIKIT_EXTERN NSString *const UITextAttributeTextShadowColor NS_DEPRECATED_IOS(5_0, 7_0, \"Use NSShadowAttributeName with an NSShadow instance as the value\") __TVOS_PROHIBITED;// Key to the offset used for the text shadow in the text attributes dictionary. An NSValue instance wrapping a UIOffset struct is expected.UIKIT_EXTERN NSString *const UITextAttributeTextShadowOffset NS_DEPRECATED_IOS(5_0, 7_0, \"Use NSShadowAttributeName with an NSShadow instance as the value\") __TVOS_PROHIBITED; 12345678910111213141516171819202122232425262728/************************ Attributes ************************/// Predefined character attributes for text. If the key is not in the dictionary, then use the default values as described below.UIKIT_EXTERN NSString * const NSFontAttributeName NS_AVAILABLE(10_0, 6_0); // UIFont, default Helvetica(Neue) 12UIKIT_EXTERN NSString * const NSParagraphStyleAttributeName NS_AVAILABLE(10_0, 6_0); // NSParagraphStyle, default defaultParagraphStyleUIKIT_EXTERN NSString * const NSForegroundColorAttributeName NS_AVAILABLE(10_0, 6_0); // UIColor, default blackColorUIKIT_EXTERN NSString * const NSBackgroundColorAttributeName NS_AVAILABLE(10_0, 6_0); // UIColor, default nil: no backgroundUIKIT_EXTERN NSString * const NSLigatureAttributeName NS_AVAILABLE(10_0, 6_0); // NSNumber containing integer, default 1: default ligatures, 0: no ligaturesUIKIT_EXTERN NSString * const NSKernAttributeName NS_AVAILABLE(10_0, 6_0); // NSNumber containing floating point value, in points; amount to modify default kerning. 0 means kerning is disabled.UIKIT_EXTERN NSString * const NSStrikethroughStyleAttributeName NS_AVAILABLE(10_0, 6_0); // NSNumber containing integer, default 0: no strikethroughUIKIT_EXTERN NSString * const NSUnderlineStyleAttributeName NS_AVAILABLE(10_0, 6_0); // NSNumber containing integer, default 0: no underlineUIKIT_EXTERN NSString * const NSStrokeColorAttributeName NS_AVAILABLE(10_0, 6_0); // UIColor, default nil: same as foreground colorUIKIT_EXTERN NSString * const NSStrokeWidthAttributeName NS_AVAILABLE(10_0, 6_0); // NSNumber containing floating point value, in percent of font point size, default 0: no stroke; positive for stroke alone, negative for stroke and fill (a typical value for outlined text would be 3.0)UIKIT_EXTERN NSString * const NSShadowAttributeName NS_AVAILABLE(10_0, 6_0); // NSShadow, default nil: no shadowUIKIT_EXTERN NSString *const NSTextEffectAttributeName NS_AVAILABLE(10_10, 7_0); // NSString, default nil: no text effectUIKIT_EXTERN NSString * const NSAttachmentAttributeName NS_AVAILABLE(10_0, 7_0); // NSTextAttachment, default nilUIKIT_EXTERN NSString * const NSLinkAttributeName NS_AVAILABLE(10_0, 7_0); // NSURL (preferred) or NSStringUIKIT_EXTERN NSString * const NSBaselineOffsetAttributeName NS_AVAILABLE(10_0, 7_0); // NSNumber containing floating point value, in points; offset from baseline, default 0UIKIT_EXTERN NSString * const NSUnderlineColorAttributeName NS_AVAILABLE(10_0, 7_0); // UIColor, default nil: same as foreground colorUIKIT_EXTERN NSString * const NSStrikethroughColorAttributeName NS_AVAILABLE(10_0, 7_0); // UIColor, default nil: same as foreground colorUIKIT_EXTERN NSString * const NSObliquenessAttributeName NS_AVAILABLE(10_0, 7_0); // NSNumber containing floating point value; skew to be applied to glyphs, default 0: no skewUIKIT_EXTERN NSString * const NSExpansionAttributeName NS_AVAILABLE(10_0, 7_0); // NSNumber containing floating point value; log of expansion factor to be applied to glyphs, default 0: no expansionUIKIT_EXTERN NSString * const NSWritingDirectionAttributeName NS_AVAILABLE(10_6, 7_0); // NSArray of NSNumbers representing the nested levels of writing direction overrides as defined by Unicode LRE, RLE, LRO, and RLO characters. The control characters can be obtained by masking NSWritingDirection and NSTextWritingDirection values. LRE: NSWritingDirectionLeftToRight|NSWritingDirectionEmbedding, RLE: NSWritingDirectionRightToLeft|NSWritingDirectionEmbedding, LRO: NSWritingDirectionLeftToRight|NSWritingDirectionOverride, RLO: NSWritingDirectionRightToLeft|NSWritingDirectionOverride,UIKIT_EXTERN NSString * const NSVerticalGlyphFormAttributeName NS_AVAILABLE(10_7, 6_0); // An NSNumber containing an integer value. 0 means horizontal text. 1 indicates vertical text. If not specified, it could follow higher-level vertical orientation settings. Currently on iOS, it's always horizontal. The behavior for any other value is undefined.","link":"/2015/12/29/ä¿®æ”¹UIBarButtonItemæ ‡é¢˜æ–‡å­—å¤§å°ã€é¢œè‰²ã€é˜´å½±ç­‰/"},{"title":"ç†è§£Objective-Cä¸­çš„æ¶ˆæ¯å‘é€","text":"æ¶ˆæ¯å‘é€é¦–å…ˆæ¥çœ‹çœ‹æ€ä¹ˆç†è§£å‘é€æ¶ˆæ¯çš„å«ä¹‰ï¼šé¢å¯¹ç€ Cocoa ä¸­å¤§é‡ APIï¼ŒåªçŸ¥é“ç®€å•çš„æŸ¥æ–‡æ¡£å’Œè°ƒç”¨ã€‚è¿˜è®°å¾—åˆå­¦ Objective-C æ—¶æŠŠ[receiver message]å½“æˆç®€å•çš„æ–¹æ³•è°ƒç”¨ï¼Œè€Œæ— è§†äº†â€œå‘é€æ¶ˆæ¯â€è¿™å¥è¯çš„æ·±åˆ»å«ä¹‰ã€‚äºæ˜¯[receiver message]ä¼šè¢«ç¼–è¯‘å™¨è½¬åŒ–ä¸ºï¼š objc_msgSend(receiver, selector)å¦‚æœæ¶ˆæ¯å«æœ‰å‚æ•°ï¼Œåˆ™ä¸ºï¼š objc_msgSend(receiver, selector, arg1, arg2, ...)å¦‚æœæ¶ˆæ¯çš„æ¥æ”¶è€…èƒ½å¤Ÿæ‰¾åˆ°å¯¹åº”çš„selectorï¼Œé‚£ä¹ˆå°±ç›¸å½“äºç›´æ¥æ‰§è¡Œäº†æ¥æ”¶è€…è¿™ä¸ªå¯¹è±¡çš„ç‰¹å®šæ–¹æ³•ï¼›å¦åˆ™ï¼Œæ¶ˆæ¯è¦ä¹ˆè¢«è½¬å‘ï¼Œæˆ–æ˜¯ä¸´æ—¶å‘æ¥æ”¶è€…åŠ¨æ€æ·»åŠ è¿™ä¸ªselectorå¯¹åº”çš„å®ç°å†…å®¹ï¼Œè¦ä¹ˆå°±å¹²è„†ç©å®Œå´©æºƒæ‰ã€‚ç°åœ¨å¯ä»¥çœ‹å‡º[receiver message]çœŸçš„ä¸æ˜¯ä¸€ä¸ªç®€ç®€å•å•çš„æ–¹æ³•è°ƒç”¨ã€‚å› ä¸ºè¿™åªæ˜¯åœ¨ç¼–è¯‘é˜¶æ®µç¡®å®šäº†è¦å‘æ¥æ”¶è€…å‘é€messageè¿™æ¡æ¶ˆæ¯ï¼Œè€Œreceiveå°†è¦å¦‚ä½•å“åº”è¿™æ¡æ¶ˆæ¯ï¼Œé‚£å°±è¦çœ‹è¿è¡Œæ—¶å‘ç”Ÿçš„æƒ…å†µæ¥å†³å®šäº†ã€‚Objective-C çš„ Runtime é“¸å°±äº†å®ƒåŠ¨æ€è¯­è¨€çš„ç‰¹æ€§ï¼Œè¿™äº›æ·±å±‚æ¬¡çš„çŸ¥è¯†è™½ç„¶å¹³æ—¶å†™ä»£ç ç”¨çš„å°‘ä¸€äº›ï¼Œä½†æ˜¯å´æ˜¯æ¯ä¸ª Objc ç¨‹åºå‘˜éœ€è¦äº†è§£çš„ã€‚Objc Runtimeä½¿å¾—Cå…·æœ‰äº†é¢å‘å¯¹è±¡èƒ½åŠ›ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶åˆ›å»ºï¼Œæ£€æŸ¥ï¼Œä¿®æ”¹ç±»ã€å¯¹è±¡å’Œå®ƒä»¬çš„æ–¹æ³•ã€‚å¯ä»¥ä½¿ç”¨runtimeçš„ä¸€ç³»åˆ—æ–¹æ³•å®ç°ã€‚Cè¯­è¨€ä¸­çš„åŠ¨æ€æ–¹æ³•ç”±äºObjective-Cæ˜¯Cè¯­è¨€çš„è¶…é›†ï¼Œæ‰€ä»¥æœ€å¥½å…ˆç†è§£Cè¯­è¨€çš„å‡½æ•°è°ƒç”¨æ–¹å¼ã€‚Cè¯­è¨€ä½¿ç”¨â€œé™æ€ç»‘å®šï¼ˆstatic bindingï¼‰â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç¼–è¯‘å™¨å°±èƒ½å†³å®šè¿è¡Œæ—¶æ‰€åº”è°ƒç”¨çš„å‡½æ•°ã€‚ç¤ºä¾‹ä»£ç ï¼š123456789101112131415161718#import &lt;stdio.h&gt;void printHello() &#123; printf(\"Hello,world\\n\");&#125;void printGoodBye() &#123; printf(\"GoodBye,world\\n\");&#125;void doThings(int type) &#123; if(type == 0)&#123; printHello(); &#125;else&#123; printGoodBye(); &#125; return 0;&#125;ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ä»£ç çš„æ—¶å€™å°±çŸ¥é“ç¨‹åºä¸­æœ‰printHello,printGoodByeä¸¤ä¸ªå‡½æ•°äº†ï¼Œå‡½æ•°åœ°å€ä¹Ÿç¡¬ç¼–ç åœ¨æŒ‡ä»¤ä¹‹ä¸­ã€‚1234567891011121314151617181920#import &lt;stdio.h&gt;void printHello() &#123; printf(\"Hello,world\\n\");&#125;void printGoodBye() &#123; printf(\"GoodBye,world\\n\");&#125;void doThings(int type) &#123; void (*func)(); if(type == 0)&#123; func = printHello; &#125;else&#123; func = printGoodBye; &#125; func(); return 0;&#125;è¿™æ ·å°±æ˜¯åŠ¨æ€ç»‘å®šï¼ˆdynamic bindingï¼‰äº†ï¼Œå› ä¸ºç´¢è¦è°ƒç”¨çš„å‡½æ•°ç›´åˆ°è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šã€‚é¡ºä¾¿é™„ä¸ŠOCä¸­ä¸€ä¸ªç±»çš„åº•å±‚æ•°æ®ç»“æ„macç”µè„‘ä¸Šçš„è·¯å¾„/usr/include/objc/runtime.h12345678910111213141516 struct objc_class &#123; Class isa OBJC_ISA_AVAILABILITY; //isaæŒ‡é’ˆæŒ‡å‘Meta Classï¼Œå› ä¸ºObjcçš„ç±»çš„æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªObjectï¼Œä¸ºäº†å¤„ç†è¿™ä¸ªå…³ç³»ï¼Œr untimeå°±åˆ›é€ äº†Meta Classï¼Œå½“ç»™ç±»å‘é€[NSObject alloc]è¿™æ ·æ¶ˆæ¯æ—¶ï¼Œå®é™…ä¸Šæ˜¯æŠŠè¿™ä¸ªæ¶ˆæ¯å‘ç»™äº†Class Object #if !__OBJC2__ Class super_class OBJC2_UNAVAILABLE; // çˆ¶ç±» const char *name OBJC2_UNAVAILABLE; // ç±»å long version OBJC2_UNAVAILABLE; // ç±»çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œé»˜è®¤ä¸º0 long info OBJC2_UNAVAILABLE; // ç±»ä¿¡æ¯ï¼Œä¾›è¿è¡ŒæœŸä½¿ç”¨çš„ä¸€äº›ä½æ ‡è¯† long instance_size OBJC2_UNAVAILABLE; // è¯¥ç±»çš„å®ä¾‹å˜é‡å¤§å° struct objc_ivar_list *ivars OBJC2_UNAVAILABLE; // è¯¥ç±»çš„æˆå‘˜å˜é‡é“¾è¡¨ struct objc_method_list **methodLists OBJC2_UNAVAILABLE; // æ–¹æ³•å®šä¹‰çš„é“¾è¡¨ struct objc_cache *cache OBJC2_UNAVAILABLE; // æ–¹æ³•ç¼“å­˜ï¼Œå¯¹è±¡æ¥åˆ°ä¸€ä¸ªæ¶ˆæ¯ä¼šæ ¹æ®isaæŒ‡é’ˆæŸ¥æ‰¾æ¶ˆæ¯å¯¹è±¡ï¼Œè¿™æ—¶ä¼šåœ¨method Listsä¸­éå†ï¼Œå¦‚æœcacheäº†ï¼Œå¸¸ç”¨çš„æ–¹æ³•è°ƒç”¨æ—¶å°±èƒ½å¤Ÿæé«˜è°ƒç”¨çš„æ•ˆç‡ã€‚ struct objc_protocol_list *protocols OBJC2_UNAVAILABLE; // åè®®é“¾è¡¨ #endif&#125; OBJC2_UNAVAILABLE;OCä¸­ä¸€ä¸ªç±»çš„å¯¹è±¡å®ä¾‹çš„æ•°æ®ç»“æ„ï¼ˆ/usr/include/objc/objc.hï¼‰ï¼Œå°±æ˜¯å®šä¹‰äº†ä¸€ä¸ª12345678910111213typedef struct objc_class *Class;/// Represents an instance of a class.struct objc_object &#123; Class isa OBJC_ISA_AVAILABILITY;&#125;;/// A pointer to an instance of a class.typedef struct objc_object *id;å‘objectå‘é€æ¶ˆæ¯æ—¶ï¼ŒRuntimeåº“ä¼šæ ¹æ®objectçš„isaæŒ‡é’ˆæ‰¾åˆ°è¿™ä¸ªå®ä¾‹objectæ‰€å±äºçš„ç±»ï¼Œç„¶ååœ¨ç±»çš„æ–¹æ³•åˆ—è¡¨ä»¥åŠçˆ¶ç±»æ–¹æ³•åˆ—è¡¨å¯»æ‰¾å¯¹åº”çš„æ–¹æ³•è¿è¡Œã€‚idæ˜¯ä¸€ä¸ªobjc_objectç»“æ„ç±»å‹çš„æŒ‡é’ˆï¼Œè¿™ä¸ªç±»å‹çš„å¯¹è±¡èƒ½å¤Ÿè½¬æ¢æˆä»»ä½•ä¸€ç§å¯¹è±¡ã€‚ç„¶åå†æ¥çœ‹çœ‹æ¶ˆæ¯å‘é€çš„å‡½æ•°ï¼šobjc_msgSendå‡½æ•°åœ¨å¼•è¨€ä¸­å·²ç»å¯¹objc_msgSendè¿›è¡Œäº†ä¸€ç‚¹ä»‹ç»ï¼Œçœ‹èµ·æ¥åƒæ˜¯objc_msgSendè¿”å›äº†æ•°æ®ï¼Œå…¶å®objc_msgSendä»ä¸è¿”å›æ•°æ®è€Œæ˜¯ä½ çš„æ–¹æ³•è¢«è°ƒç”¨åè¿”å›äº†æ•°æ®ã€‚ä¸‹é¢è¯¦ç»†å™è¿°ä¸‹æ¶ˆæ¯å‘é€æ­¥éª¤ï¼š1.æ£€æµ‹è¿™ä¸ª selector æ˜¯ä¸æ˜¯è¦å¿½ç•¥çš„ã€‚æ¯”å¦‚ Mac OS X å¼€å‘ï¼Œæœ‰äº†åƒåœ¾å›æ”¶å°±ä¸ç†ä¼š retain,release è¿™äº›å‡½æ•°äº†ã€‚2.æ£€æµ‹è¿™ä¸ª target æ˜¯ä¸æ˜¯ nil å¯¹è±¡ã€‚ObjC çš„ç‰¹æ€§æ˜¯å…è®¸å¯¹ä¸€ä¸ª nil å¯¹è±¡æ‰§è¡Œä»»ä½•ä¸€ä¸ªæ–¹æ³•ä¸ä¼š Crashï¼Œå› ä¸ºä¼šè¢«å¿½ç•¥æ‰ã€‚3.å¦‚æœä¸Šé¢ä¸¤ä¸ªéƒ½è¿‡äº†ï¼Œé‚£å°±å¼€å§‹æŸ¥æ‰¾è¿™ä¸ªç±»çš„ IMPï¼Œå…ˆä» cache é‡Œé¢æ‰¾ï¼Œå®Œäº† æ‰¾å¾—åˆ°å°±è·³åˆ°å¯¹åº”çš„å‡½æ•°å»æ‰§è¡Œã€‚4.å¦‚æœ cache æ‰¾ä¸åˆ°å°±æ‰¾ä¸€ä¸‹æ–¹æ³•åˆ†å‘è¡¨ã€‚5.å¦‚æœåˆ†å‘è¡¨æ‰¾ä¸åˆ°å°±åˆ°è¶…ç±»çš„åˆ†å‘è¡¨å»æ‰¾ï¼Œä¸€ç›´æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°NSObjectç±»ä¸ºæ­¢ã€‚6.å¦‚æœè¿˜æ‰¾ä¸åˆ°å°±è¦å¼€å§‹è¿›å…¥åŠ¨æ€æ–¹æ³•è§£æäº†ï¼Œåé¢ä¼šæåˆ°ã€‚è¿™ä¹ˆä¸€æƒ³ï¼Œè°ƒç”¨ä¸€ä¸ªæ–¹æ³•ä¼¼ä¹éœ€è¦å¾ˆå¤šæ­¥éª¤ã€‚ä¸è¿‡objc_msgSendä¼šå°†åŒ¹é…ç»“æœç¼“å­˜åœ¨fast mapå¿«é€Ÿæ˜ å°„è¡¨é‡Œé¢ï¼Œæ¯ä¸ªç±»éƒ½æœ‰è¿™æ ·ä¸€å—ç¼“å­˜ã€‚å½“ç„¶è¿™ç§fast path è¿˜æ˜¯ä¸å¦‚é™æ€ç»‘å®šçš„å‡½æ•°è°ƒç”¨é‚£æ ·è¿…é€Ÿï¼Œä¸è¿‡åªè¦æŠŠSelectorç¼“å­˜èµ·æ¥ï¼Œä¹Ÿå°±ä¸ä¼šæ…¢å¾ˆå¤šï¼Œå®é™…ä¸Šï¼Œè¿™å¹¶ä¸æ˜¯ç“¶é¢ˆã€‚æ¶ˆæ¯è½¬å‘æœºåˆ¶ å½“ä¸€ä¸ªå¯¹è±¡æ¥æ”¶åˆ°æ— æ³•è§£è¯»çš„æ¶ˆæ¯æ—¶ï¼Œå°±ä¼šå¯åŠ¨æ¶ˆæ¯è½¬å‘ï¼ˆmessage forwordingï¼‰æœºåˆ¶ã€‚coderå¯ç»ç”±æ­¤è¿‡ç¨‹å‘Šè¯‰å¯¹è±¡åº”è¯¥å¦‚ä½•å¤„ç†ä½ç½®æ¶ˆæ¯ã€‚ä¾‹å¦‚ç»™æŸä¸€ä¸ªå¯¹è±¡å®ä¾‹å‘é€äº†ä¸€ä¸ªè¯¥å¯¹è±¡ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œæœ€åå°±ä¼šcrashæ‰ã€‚-[NSCFDictionary indexOfObject:]: unrecognized selector sent to instance 0x10773929356æ¶ˆæ¯è½¬å‘åˆ†ä¸ºä¸¤å¤§é˜¶æ®µã€‚ ç¬¬ä¸€é˜¶æ®µå…ˆè¯¢é—®æ¥å—å¯¹è±¡æ‰€å±çš„ç±»æ˜¯å¦èƒ½å¤ŸåŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œä»¥å¤„ç†è¿™ä¸ªunknown selectorï¼Œè¿™å«åšåŠ¨æ€æ–¹æ³•è§£æï¼ˆdynamic method resolutionï¼‰. ç¬¬äºŒé˜¶æ®µè®¾è®¡å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼ˆfull forwording mechanismï¼‰ã€‚å¦‚æœåœ¨è¿è¡ŒæœŸï¼Œç³»ç»Ÿå·²ç»æŠŠç¬¬ä¸€é˜¶æ®µæ‰§è¡Œå®Œäº†ï¼Œé‚£ä¹ˆæ¥å—è€…è‡ªå·±å°±æ— æ³•å†ä»¥åŠ¨æ€æ·»åŠ æ–¹æ³•çš„æ–¹å¼æ¥å“åº”åŒ…å«è¯¥unknown selectorçš„æ¶ˆæ¯äº†ã€‚æ­¤æ—¶ï¼Œè¿è¡ŒæœŸç³»ç»Ÿä¼šè¯·æ±‚æ¥å—è€…ä»¥å…¶ä»–æ‰‹æ®µæ¥å¤„ç†ä¸æ¶ˆæ¯ç›¸å…³çš„æ–¹æ³•è°ƒç”¨ã€‚è¿™é‡Œåˆåˆ†ä¸ºä¸¤å°æ­¥ï¼š 2.1 é¦–å…ˆï¼Œæ¥å—è€…æŸ¥çœ‹æ˜¯å¦æœ‰å…¶ä»–å¯¹è±¡èƒ½å¤„ç†è¿™æ¡æ¶ˆæ¯ï¼Œè‹¥æœ‰ï¼Œåˆ™è¿è¡Œæ—¶ç³»ç»Ÿä¼šå°†æ¶ˆæ¯è½¬ç»™é‚£ä¸ªå¯¹è±¡ï¼Œä¸€åˆ‡å¦‚å¸¸ã€‚ 2.2 è‹¥æ²¡æœ‰å¯æ›¿ä»£çš„æ¥å—è€…ï¼ˆreplacement receiverï¼‰ï¼Œåˆ™å¯åŠ¨å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šæŠŠä¸æ¶ˆæ¯æœ‰å…³çš„å…¨éƒ¨ç»†èŠ‚éƒ½å°è£…åˆ°NSInvocationå¯¹è±¡ä¸­ï¼Œå†ç»™æ¥å—è€…æœ€åä¸€æ¬¡æœºä¼šï¼Œä»¤å…¶è®¾æ³•è§£å†³å½“å‰è¿˜æœªå¤„ç†çš„æ¶ˆæ¯ã€‚ a.åŠ¨æ€æ–¹æ³•è§£æ12+ (Bool)resolveInstanceMethod:(SEL)Selector+ (Bool)resolveClassMethod:(SEL)Selector b.æ¶ˆæ¯è½¬å‘ç»™å¯æ›¿ä»£æ¥å—è€…ï¼Œå°è¯•æ‰¾åˆ°ä¸€ä¸ªèƒ½å“åº”è¯¥æ¶ˆæ¯çš„å¯¹è±¡ï¼ˆreplacement receiverï¼‰1- (id)forwardingTargetForSelector:(SEL)Selector c.ä¸‹ä¸€æ­¥ï¼Œæ„é€ NSInvocationå¯¹è±¡1234//å°è¯•è·å¾—ä¸€ä¸ªæ–¹æ³•ç­¾å- (id)methodSignatureForSelector:(SEL)selector //å°†ä¸Šä¸€æ­¥è·å–åˆ°çš„æ–¹æ³•ç­¾ååŒ…è£…æˆ Invocation ä¼ å…¥ï¼Œå¦‚ä½•å¤„ç†å°±åœ¨è¿™é‡Œé¢äº†ï¼Œå¹¶è¿”å›éni- (id)forwardInvocation:(NSInvocation *)invocation æ€»ç»“ æ¶ˆæ¯ç”±æ¥å—è€…ã€é€‰æ‹©å™¨åŠå‚æ•°æ„æˆã€‚ç»™æŸå¯¹è±¡å‘é€æ¶ˆæ¯ï¼ˆinvoke a messageï¼‰ï¼Œä¹Ÿå°±ç›¸å½“äºåœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•ï¼ˆcalla methodï¼‰ å‘ç»™æŸå¯¹è±¡çš„å…¨éƒ¨æ¶ˆæ¯éƒ½è¦æœ‰åŠ¨æ€æ¶ˆæ¯æ´¾å‘ç³»ç»Ÿï¼ˆdynamic message dispatch systemï¼‰æ¥å¤„ç†ï¼Œè¯¥ç³»ç»Ÿä¼šæŸ¥å‡ºå¯¹åº”çš„æ–¹æ³•ï¼Œå¹¶æ‰§è¡Œå…¶ä»£ç ã€‚ è‹¥å¯¹è±¡æ— æ³•å“åº”æŸä¸ªé€‰æ‹©å™¨ä¸­çš„æ¶ˆæ¯ï¼Œåˆ™è¿›å…¥æ¶ˆæ¯è½¬å‘è¿‡ç¨‹ã€‚ é€šè¿‡è¿è¡ŒæœŸçš„åŠ¨æ€æ–¹æ³•è§£ææœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨éœ€è¦ç”¨åˆ°æŸä¸ªæ–¹æ³•æ—¶å†å°†å…¶åŠ å…¥ç±»ä¸­ã€‚ å¯¹è±¡å¯ä»¥æŠŠå…¶æ— æ³•è§£è¯»çš„æ¶ˆæ¯è½¬äº¤ç»™å…¶ä»–å¯¹è±¡æ¥å¤„ç†ã€‚ è‹¥ç»è¿‡ä¸Šè¿°ä¸¤æ­¥è¿˜æ˜¯æ²¡åŠæ³•å¤„ç†æ¶ˆæ¯ï¼Œåˆ™å¯åŠ¨å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ã€‚ è¯¦æƒ…å¯å‚è€ƒ Objective-C Runtime","link":"/2015/12/16/ç†è§£Objective-Cä¸­çš„æ¶ˆæ¯å‘é€/"},{"title":"æµ…è°ˆiOSä¸­çš„userAgent","text":"User-Agentï¼ˆç”¨æˆ·ä»£ç†ï¼‰å­—ç¬¦ä¸²æ˜¯Webæµè§ˆå™¨ç”¨äºå£°æ˜è‡ªèº«å‹å·ç‰ˆæœ¬å¹¶éšHTTPè¯·æ±‚å‘é€ç»™WebæœåŠ¡å™¨çš„å­—ç¬¦ä¸²ï¼Œåœ¨WebæœåŠ¡å™¨ä¸Šå¯ä»¥è·å–åˆ°è¯¥å­—ç¬¦ä¸²ã€‚ åœ¨å…¬å¸äº§å“ä¸­ï¼Œåœ¨userAgentä¸­å¢åŠ äº†NetTypeå­—æ®µï¼Œç”¨äºæ ‡è¯†å®¢æˆ·ç«¯å½“å‰çš„ç½‘ç»œç¯å¢ƒã€‚ NetType/WIFI NetType/3GwebæœåŠ¡å™¨ç«¯æ ¹æ®NetTypeç±»å‹åŠ è½½ä¸åŒåˆ†è¾¨ç‡çš„å•†å“å›¾ç‰‡ã€‚æˆ‘ä»¬åªæœ‰ä¸¤ç§ï¼ŒWIFIä¸‹é«˜æ¸…å›¾ï¼ŒéWIFIä½åˆ†è¾¨ç‡å›¾ã€‚ è·å–WebViewçš„userAgentiOSå®¢æˆ·ç«¯ä¸­è·å–webViewçš„userAgentçš„æ–¹æ³•ï¼š1NSMutableString *userAgent = [NSMutableString stringWithString:[[UIWebView new] stringByEvaluatingJavaScriptFromString:@\"navigator.userAgent\"]];æ ¹æ®éœ€è¦æ·»åŠ ä¸åŒçš„æ ‡è¯†åˆ°æ–°çš„userAgentä¸­,è¿™é‡Œæ·»åŠ ä¸€ä¸ªWMallæ ‡è¯†ã€‚123NSString *newUagent = [NSString stringWithFormat:@\"%@ WMall/%@\", userAgent, [SystemInfo appShortVersion]];NSDictionary *dictionnary = [[NSDictionary alloc] initWithObjectsAndKeys:newUagent, @\"UserAgent\", nil];[[NSUserDefaults standardUserDefaults] registerDefaults:dictionnary];newUagent ä¸ºMozilla/5.0 (iPhone; CPU iPhone OS 9_3 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13E230 WMall/3.0æ ¹æ®ç½‘ç»œç±»å‹è®¾ç½®ä¸åŒçš„NetTypeæ ‡è¯† iOSä¸­åˆ¤æ–­ç½‘ç»œçŠ¶æ€ä¸€èˆ¬ç”¨AFNetWorkingä¸­çš„æ–¹æ³•ï¼šåœ¨appDelegateçš„application didFinishLaunchingWithOptionsæ–¹æ³•ä¸­å¯åŠ¨ç½‘ç»œçŠ¶æ€ç›‘å¬ï¼š12[[AFNetworkReachabilityManager sharedManager] startMonitoring];[[AFNetworkActivityIndicatorManager sharedManager] setEnabled:YES]; ç„¶ååœ¨åŸºç±»BaseViewControllerä¸­ç›‘å¬ç½‘ç»œæ›´æ–°é€šçŸ¥1[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(networkReachabilityStatusDidChange:) name:AFNetworkingReachabilityDidChangeNotification object:nil]; 12345678910111213141516171819202122- (void)networkReachabilityStatusDidChange:(NSNotification *)notify&#123; NSLog(@\"ç½‘ç»œå˜åŒ–é€šçŸ¥ï¼š%@\",notify.userInfo[AFNetworkingReachabilityNotificationStatusItem]); AFNetworkReachabilityStatus status = [notify.userInfo[AFNetworkingReachabilityNotificationStatusItem] integerValue]; NSString *net = nil; switch (status) &#123; case AFNetworkReachabilityStatusNotReachable: net = @\"æ— ç½‘ç»œ\"; break; case AFNetworkReachabilityStatusReachableViaWiFi: net = @\"WIFI\"; [self changeUserAgentWithType:@\"WIFI\"]; break; case AFNetworkReachabilityStatusReachableViaWWAN: net = @\"2G/3G/4G\"; [self changeUserAgentWithType:@\"3G\"]; break; default: net = @\"xxx\"; break; &#125; [Error showError:[NSString stringWithFormat:@\"å½“å‰ç½‘ç»œçŠ¶æ€%@\",net]];&#125; æ³¨æ„å…ˆåˆ¤æ–­userAgentä¸­æ˜¯å¦å­˜åœ¨NetType12345678910111213141516171819202122//æ›´æ–°NetType- (void)changeUserAgentWithType:(NSString *)type&#123; NSMutableString *userAgent = [NSMutableString stringWithString:[[UIWebView new] stringByEvaluatingJavaScriptFromString:@\"navigator.userAgent\"]]; NSString *newUagent = nil; NSString *temp = nil; if ([userAgent containsString:@\"NetType\"]) &#123; if ([userAgent containsString:@\"WIFI\"]) &#123; temp = @\"WIFI\"; &#125;else if([userAgent containsString:@\"3G\"])&#123; temp = @\"3G\"; &#125; newUagent = [userAgent stringByReplacingOccurrencesOfString:temp withString:type]; &#125;else&#123; newUagent = [NSString stringWithFormat:@\"%@ NetType/%@\", userAgent, type]; &#125; NSDictionary *dictionnary = [[NSDictionary alloc] initWithObjectsAndKeys:newUagent, @\"UserAgent\", nil]; NSLog(@\"new useragent:%@\",newUagent); [[NSUserDefaults standardUserDefaults] registerDefaults:dictionnary];&#125; newUagent ä¸ºMozilla/5.0 (iPhone; CPU iPhone OS 9_3 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13E230 WMall/3.0 NetType/WIFI å‚è€ƒå¾®ä¿¡6.0å†…åµŒæµè§ˆå™¨User-Agentå­—ç¬¦ä¸²å¢åŠ äº†NetTypeå­—æ®µè·å– UIWebview çš„ Useragentï¼Œä»¥åŠé™„åŠ è‡ªå®šä¹‰å­—æ®µåˆ° Useragent","link":"/2016/04/10/æµ…è°ˆiOSä¸­çš„userAgent/"},{"title":"å¸¸ç”¨æ’åºç®—æ³•","text":"åœ¨æ­¤æ€»ç»“ä¸€ä¸‹å¸¸ç”¨æ’åºç®—æ³•çš„ä»£ç å®ç° #include &lt;iostream&gt;using namespace std;typedef int ElemType; /*1ã€æ’å…¥æ’åºï¼ˆ1ï¼‰ç›´æ¥æ’å…¥æ’åºç®—æ³•ç®—æ³•æ€æƒ³ï¼šå°†ç­‰æ’åºåˆ—åˆ’åˆ†ä¸ºæœ‰åºä¸æ— åºä¸¤éƒ¨åˆ†ï¼Œç„¶åå†ä¾æ¬¡å°†æ— åºéƒ¨åˆ†æ’å…¥åˆ°å·²ç»æœ‰åºçš„éƒ¨åˆ†ï¼Œæœ€å å°±å¯ä»¥å½¢æˆæœ‰åºåºåˆ—ã€‚æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š1ï¼‰æŸ¥æ‰¾å‡ºå…ƒç´ Lï¼ˆiï¼‰åœ¨è¡¨ä¸­çš„æ’å…¥ä½ç½®Kï¼›2ï¼‰å°†è¡¨ä¸­çš„ç¬¬Kä¸ªå…ƒç´ ä¹‹å‰çš„å…ƒç´ ä¾æ¬¡åç§»ä¸€ä¸ªä½ç½®ï¼›3ï¼‰å°†Lï¼ˆiï¼‰å¤åˆ¶åˆ°Lï¼ˆKï¼‰ã€‚ */æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(n^2) 1234567891011121314151617181920void InsertSort(ElemType arr[], int length)&#123; int i, j; ElemType guard; // å“¨å…µ for (i = 1; i &lt; length; ++i) &#123; if (arr[i]() &lt; arr[i-1]()) // åœ¨æ— åºéƒ¨åˆ†å¯»æ‰¾ä¸€ä¸ªå…ƒç´ ï¼Œä½¿ä¹‹æ’å…¥åˆ°æœ‰åºéƒ¨åˆ†åä»ç„¶æœ‰åº &#123; guard = arr[i]();// å¤åˆ¶åˆ°â€œå“¨å…µâ€ // å°†ç¬¬iä¸ªå…ƒç´ ä¹‹å‰çš„å…ƒç´ ä¾æ¬¡åç§»ä¸€ä¸ªä½ç½® for (j = i - 1; arr[j]() &gt; guard; j--) &#123; arr[j + 1]() = arr[j](); &#125; arr[j + 1]() = guard; // å¤åˆ¶åˆ°æ’å…¥ä½ç½® &#125; &#125;&#125; 2ã€æŠ˜åŠæ’å…¥æ’åº ä½¿ç”¨äºæ’åºè¡¨ä¸ºé¡ºåºå­˜å‚¨çš„çº¿æ€§è¡¨ åœ¨æŸ¥æ‰¾æ’å…¥ä½ç½®æ—¶ï¼Œé‡‡ç”¨æŠ˜åŠæŸ¥æ‰¾ ç®—æ³•æ€æƒ³æ˜¯ï¼š 1ï¼‰è®¾ç½®æŠ˜åŠæŸ¥æ‰¾èŒƒå›´ï¼› 2ï¼‰æŠ˜åŠæŸ¥æ‰¾ 3ï¼‰ç§»åŠ¨å…ƒç´  4ï¼‰æ’å…¥å…ƒç´  5ï¼‰ç»§ç»­æ“ä½œ1ï¼‰ã€2ï¼‰ã€3ï¼‰ã€4ï¼‰æ­¥ï¼Œç›´åˆ°è¡¨æˆæœ‰åºã€‚ 123456789101112131415161718192021222324252627282930313233void BinaryInsertSort(ElemType arr[], int length)&#123; int i, j, low, high, mid; ElemType tmp; for ( i = 1; i &lt; length; ++i ) &#123; tmp = arr[i](); // å¤åˆ¶åˆ°å“¨å…µ // è®¾ç½®æŠ˜åŠæŸ¥æ‰¾èŒƒå›´ low = 0; high = i; while (low &lt;= high) // æŠ˜åŠæŸ¥æ‰¾ &#123; mid = (low + high) / 2; if (arr[mid]() &gt; tmp) // åœ¨å·¦åŠéƒ¨åˆ†æŸ¥æ‰¾ &#123; high = mid - 1; &#125; else &#123; low = mid + 1; // åœ¨å³åŠéƒ¨åˆ†æŸ¥æ‰¾ &#125; &#125; // ç§»åŠ¨å…ƒç´  for ( j = i - 1; j &gt;= high + 1; --j ) &#123; arr[j + 1]() = arr[j](); &#125; arr[j + 1]() = tmp; &#125;&#125; /*3ã€å¸Œå°”(Shell)æ’åº åŸºæœ¬æ€æƒ³ï¼š å…ˆå°†å¾…æ’åºçš„è¡¨åˆ†å‰²æˆè‹¥å¹²ä¸ªå½¢è‹¥L[i, i+d, i+2d, â€¦, i+kd]çš„â€œç‰¹æ®Šâ€å­è¡¨ï¼Œåˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œ å½“æ•´ä¸ªè¡¨å·²å‘ˆâ€œåŸºæœ¬æœ‰åºâ€æ—¶ï¼Œå†å¯¹å…¨ä½“è®°å½•è¿›è¡Œä¸€æ¬¡ç›´æ¥æ’å…¥æ’åºã€‚ ç®—æ³•è¿‡ç¨‹ï¼š 1ï¼‰å…ˆå–ä¸€ä¸ªå°äºnçš„æ­¥é•¿d1,æŠŠè¡¨ä¸­å…¨éƒ¨è®°å½•åˆ†æˆd1ä¸ªç»„ï¼Œæ‰€æœ‰è·ç¦»ä¸ºd1çš„å€æ•°çš„è®°å½•æ”¾åœ¨åŒä¸€ç»„ä¸­ï¼Œåœ¨å„ ç»„ä¸­è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼› 2ï¼‰ç„¶åå–ç¬¬äºŒä¸ªæ­¥é•¿d2 \\&lt; d1, é‡å¤æ­¥éª¤1 3ï¼‰ç›´åˆ°dk = 1ï¼Œå†è¿›è¡Œæœ€åä¸€æ¬¡ç›´æ¥æ’å…¥æ’åº*/ 12345678910111213141516171819202122232425void ShellSort(ElemType arr[], int length)&#123; int i, j, dk = length / 2; ElemType tmp; while (dk &gt;= 1)// æ§åˆ¶æ­¥é•¿ &#123; for (i = dk; i &lt; length; ++i) &#123; if (arr[i]() &lt; arr[i - dk]()) &#123; tmp = arr[i](); // æš‚å­˜ // åç§» for (j = i - dk; j &gt;= 0 &amp;&amp; tmp &lt; arr[j](); j -= dk) &#123; arr[j + dk]() = arr[j](); &#125; arr[j + dk]() = tmp; &#125; &#125; dk /= 2; &#125;&#125; *4ã€å†’æ³¡æ’åºç®—æ³• åŸºæœ¬æ€æƒ³ï¼š å‡è®¾å¾…æ’åºçš„è¡¨é•¿ä¸ºnï¼Œ ä»åå‘å‰æˆ–ä»å‰å‘åä¸¤ä¸¤æ¯”è¾ƒç›¸é‚»å…ƒç´ çš„å€¼ï¼Œè‹¥ä¸ºé€†åºï¼Œåˆ™äº¤æ¢ä¹‹ï¼Œç›´åˆ°åºåˆ—æ¯”è¾ƒå®Œã€‚ è¿™æ ·ä¸€å›å°±ç§°ä¸ºä¸€è¶Ÿå†’æ³¡ã€‚è¿™æ ·å€¼è¾ƒå¤§çš„å…ƒç´ å¾€ä¸‹â€œæ²‰â€ï¼Œè€Œå€¼è¾ƒå°çš„å…ƒç´ å…¥ä¸Šâ€œæµ®â€ã€‚ æ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)*/ 123456789101112131415161718void BubbleSort(ElemType arr[], int length)&#123;int i, j,k; ElemType tmp; for (k = 0; k &lt; length; ++i)// è¶Ÿæ¬¡æ€»å…±å¾ªç¯lengthæ¬¡ &#123; for (i = 0; i &lt; length - 1; ++i)//ä¸¤ä¸¤æ¯”è¾ƒ &#123; j = i + 1; if (arr[j]() &gt; arr[i]()) &#123; tmp = arr[i](); arr[i]() = arr[j](); arr[j]() = tmp; &#125; &#125; &#125;&#125; /*5ã€å¿«é€Ÿæ’åºç®—æ³• åŸºæœ¬æ€æƒ³ï¼šåŸºäºåˆ†æ²»æ³•ï¼Œåœ¨å¾…æ’åºçš„nä¸ªå…ƒç´ ä¸­ä»»å–ä¸€ä¸ªå…ƒç´ pivotä½œä¸ºåŸºå‡†ï¼Œé€šè¿‡ä¸€è¶Ÿæ’åºå°†å¾…æ’åºè¡¨åˆ’åˆ†ä¸ºç‹¬ç«‹çš„ ä¸¤éƒ¨åˆ†L[1..k-1]å’ŒL[k+1 .. n],ä½¿å¾—ç¬¬ä¸€éƒ¨åˆ†ä¸­çš„æ‰€æœ‰å…ƒç´ å€¼éƒ½å°äºpivotï¼Œè€Œç¬¬äºŒéƒ¨åˆ†ä¸­çš„æ‰€æœ‰å…ƒç´ å€¼éƒ½å¤§äºpivotï¼Œ åˆ™åŸºå‡†å…ƒç´ æ”¾åœ¨äº†å…¶æœ€ç»ˆä½ç½®Lï¼ˆKï¼‰ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸ºä¸€è¶Ÿå¿«é€Ÿæ’åºã€‚è€Œååˆ†åˆ«é€’å½’åœ°å¯¹ä¸¤ä¸ªå­è¡¨é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ°æ¯ éƒ¨åˆ†å†…åªæœ‰ä¸€ä¸ªå…ƒç´ æˆ–ä¸ºç©ºä¸ºæ­¢ï¼Œå³æ‰€æœ‰å…ƒç´ éƒ½æ”¾åœ¨äº†å…¶æœ€ç»ˆä½ç½®ä¸Šã€‚*/ 12345678910111213141516171819202122232425262728293031323334353637int Partition(ElemType arr[], int left, int right)&#123; ElemType pivot = arr[left]; // ä»¥å½“å‰è¡¨ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºæ¢è½´å€¼ while (left \\&lt; right) &#123; // ä»å³å‘å·¦æ‰¾ä¸€ä¸ªæ¯”æ¢è½´å€¼å°çš„å…ƒç´ çš„ä½ç½® while (left \\&lt; right &amp;&amp; arr[right]() \\&gt;= pivot) &#123; --right; &#125; arr[left]() = arr[right](); // å°†æ¯”æ¢è½´å€¼å°çš„å…ƒç´ ç§»åŠ¨åˆ°å·¦ç«¯ // ä»å·¦å‘å³æŸ¥æ‰¾æ¯”æ¢è½´å€¼å¤§çš„å…ƒç´ çš„ä½ç½® while (left \\&lt; right &amp;&amp; arr[left]() \\&lt;= pivot) &#123; ++left; &#125; arr[right]() = arr[left]();// å°†æ¯”æ¢è½´å€¼å¤§çš„å…ƒç´ ç§»åŠ¨åˆ°å³ç«¯ &#125; arr[left]() = pivot; // å°†æ¢è½´å…ƒç´ æ”¾åœ¨æœ€ç»ˆä½ç½® return left;&#125;void QuickSort(ElemType arr[], int left, int right)&#123; if (left \\&lt; right) &#123; int pivotPos = Partition(arr, left, right); // åˆ’åˆ† QuickSort(arr, left, pivotPos - 1); // å¿«é€Ÿæ’åºå·¦åŠéƒ¨åˆ† QuickSort(arr, pivotPos + 1, right); // å¿«é€Ÿæ’åºå³åŠéƒ¨åˆ† &#125;&#125; /*6ã€ç®€å•é€‰æ‹©æ’åºç®—æ³• åŸºæœ¬æ€æƒ³ï¼š å‡è®¾æ’åºè¡¨ä¸ºL[1â€¦n],ç¬¬iè¶Ÿæ’åºä»è¡¨ä¸­é€‰æ‹©å…³é”®å­—æœ€å°çš„å…ƒç´ ä¸Liäº¤æ¢ï¼Œç¬¬ä¸€è¶Ÿæ’åºå¯ä»¥ç¡®å®šä¸€ä¸ªå…ƒç´ çš„ æœ€ç»ˆä½ç½®ï¼Œè¿™æ ·ç»è¿‡n-1è¶Ÿæ’åºå°±å¯ä»¥ä½¿å¾—æ•´ä¸ªæ’åºè¡¨æœ‰åºã€‚*/ 12345678910111213141516171819202122232425void SelectSort(ElemType arr[], int length)&#123; int i, j, min; ElemType tmp; for (i = 0; i \\&lt; length - 1; ++i) // éœ€è¦n-1è¶Ÿ &#123; min = i; for (j = i + 1; j \\&lt; length; ++j) &#123; if (arr[j]() \\&lt; arr[min]()) // æ¯ä¸€è¶Ÿé€‰æ‹©å…ƒç´ å€¼æœ€å°çš„ä¸‹æ ‡ &#123; min = j; &#125; &#125; if (min != i) // å¦‚æœç¬¬iè¶Ÿçš„Liå…ƒç´ å€¼è¯¥è¶Ÿæ‰¾åˆ°çš„æœ€å°å…ƒç´ å€¼ï¼Œåˆ™äº¤æ¢ï¼Œä»¥ä½¿Liå€¼æœ€å° &#123; tmp = arr[i](); arr[i]() = arr[min](); arr[min]() = tmp; &#125; &#125;&#125; /*7ã€å †æ’åºç®—æ³• å †çš„å®šä¹‰å¦‚ä¸‹ï¼šnä¸ªå…³é”®å­—åºåˆ—å·L1..nç§°ä¸ºå †ï¼Œä»…å½“è¯¥åºåˆ—æ»¡è¶³ï¼š1ï¼‰L(i) \\&lt;= L(2i)ä¸”L(i) \\&lt;= L(2i+1) æˆ– 2)L(i) >= L(2i)ä¸”L(i) >= L(2i+1)æ»¡è¶³ç¬¬ä¸€ç§æƒ…å†µçš„å †ï¼Œç§°ä¸ºå°æ ¹å †ï¼ˆå°é¡¶å †ï¼‰ï¼›æ»¡è¶³ç¬¬äºŒç§æƒ…å†µçš„å †ï¼Œç§°ä¸ºå¤§æ ¹å †ï¼ˆå¤§é¡¶å †ï¼‰ã€‚*/ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071void HeapAdjust(ElemType \\*a,int i,int size) //è°ƒæ•´å †&#123; int lchild = 2 \\* i; //içš„å·¦å­©å­èŠ‚ç‚¹åºå· int rchild = 2 \\* i + 1; //içš„å³å­©å­èŠ‚ç‚¹åºå· int max = i; //ä¸´æ—¶å˜é‡ if(i \\&lt;= size / 2) //å¦‚æœiæ˜¯å¶èŠ‚ç‚¹å°±ä¸ç”¨è¿›è¡Œè°ƒæ•´&#123;if (lchild \\&lt;= size &amp;&amp; a[lchild]() \\&gt; a[max]())&#123;max = lchild; // å·¦å­©å­æ¯”åŒäº²å€¼è¿˜å¤§ï¼Œéœ€è¦è°ƒæ•´&#125;if (rchild \\&lt;= size &amp;&amp; a[rchild]() \\&gt; a[max]())&#123;max = rchild;// å³å­©å­æ¯”åŒäº²å€¼è¿˜å¤§ï¼Œéœ€è¦è°ƒæ•´&#125;if (max != i) // éœ€è¦è°ƒæ•´&#123;ElemType tmp = a[max]();a[max]() = a[i]();a[i]() = tmp;HeapAdjust(a, max, size); //é¿å…è°ƒæ•´ä¹‹åä»¥maxä¸ºçˆ¶èŠ‚ç‚¹çš„å­æ ‘ä¸æ˜¯å †&#125;&#125;&#125;void BuildHeap(ElemType \\*a,int size) //å»ºç«‹å †&#123; for (int i = size / 2; i \\&gt;= 0; i--) //éå¶èŠ‚ç‚¹æœ€å¤§åºå·å€¼ä¸ºsize/2 &#123; HeapAdjust(a, i, size); &#125;&#125;void HeapSort(ElemType \\*a, int size) //å †æ’åº&#123; BuildHeap(a,size);for(int i = size - 1; i \\&gt;= 0; i--)&#123;swap(a[0](), a[i]()); //äº¤æ¢å †é¡¶å’Œæœ€åä¸€ä¸ªå…ƒç´ ï¼Œå³æ¯æ¬¡å°†å‰©ä½™å…ƒç´ ä¸­çš„æœ€å¤§è€…æ”¾åˆ°æœ€åé¢BuildHeap(a, i-1); //å°†ä½™ä¸‹å…ƒç´ é‡æ–°å»ºç«‹ä¸ºå¤§é¡¶å †HeapAdjust(a,1,i-1); //é‡æ–°è°ƒæ•´å †é¡¶èŠ‚ç‚¹æˆä¸ºå¤§é¡¶å †&#125;&#125;void Display(ElemType arr[], int length)&#123; for ( int i = 0; i \\&lt; length; ++i ) &#123; cout \\&lt;\\&lt; arr[i] \\&lt;\\&lt; \" \"; &#125; cout \\&lt;\\&lt; endl;&#125;int main()&#123; ElemType arr[] = &#123;2, 1, 5, 3, 4, 0, 6, 9, -1, 4, 12&#125;;//InsertSort(arr, sizeof(arr) / sizeof(ElemType));//BinaryInsertSort(arr, sizeof(arr) / sizeof(ElemType));//ShellSort(arr, sizeof(arr) / sizeof(ElemType));//BubbleSort(arr, sizeof(arr) / sizeof(ElemType));//QuickSort(arr, 0, sizeof(arr) / sizeof(ElemType) - 1);HeapSort(arr, sizeof(arr) / sizeof(ElemType));Display(arr, sizeof(arr) / sizeof(ElemType));return 0;&#125;","link":"/2015/11/30/å¸¸ç”¨æ’åºç®—æ³•/"},{"title":"ç§»åŠ¨IMå¼€å‘è¦ç‚¹","text":"ä¸ªäººå¯¹äºIMå¼€å‘ä¸­å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œç½‘æœä¸€ç¯‡å¥½æ–‡ï¼Œè®°å½•ä¸‹æ¥ã€‚è½¬è½½äº ç§»åŠ¨IMå¼€å‘é‚£äº›äº‹ é€šè®¯æ–¹å¼é€‰æ‹©IMé€šè®¯æ–¹å¼æ— éä¸¤ç§é€‰æ‹©:è®¾å¤‡ç›´è¿(P2P)å’Œé€šè¿‡æœåŠ¡å™¨ä¸­è½¬ã€‚P2PP2På¤šè§äºå±€åŸŸç½‘å†…èŠå¤©å·¥å…·ï¼Œå…¸å‹çš„åº”ç”¨æœ‰:é£é¸½ä¼ ä¹¦ï¼Œå¤©ç½‘Maze(ä½ æ‡‚çš„)ç­‰ã€‚è¿™ç±»è½¯ä»¶åœ¨å¯åŠ¨åä¸€èˆ¬åšä¸¤ä»¶äº‹æƒ… è¿›è¡ŒUDPå¹¿æ’­:å‘é€è‡ªå·±ä¿¡æ¯å’Œæ¥å—åŒå±€åŸŸç½‘å†…å…¶ä»–ç«¯ä¿¡æ¯ å¼€å¯TCPç›‘å¬:ç­‰å¾…å…¶ä»–ç«¯è¿›è¡Œè¿æ¥è¯¦ç»†çš„æµç¨‹å¯ä»¥å‚è€ƒé£é¸½ä¼ ä¹¦æºç ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼åœ¨æœ‰ç§ç§é™åˆ¶å’Œä¸ä¾¿:ä¸€æ–¹é¢å®ƒåªé€‚åˆåœ¨çº¿çš„ç‚¹å¯¹ç‚¹æ¶ˆæ¯ä¼ è¾“ï¼Œå¯¹ç¦»çº¿ï¼Œç¾¤ç»„ç­‰ä¸šåŠ¡æ”¯æŒä¸å¤Ÿã€‚å¦ä¸€æ–¹é¢ç”±äº NAT çš„å­˜åœ¨ï¼Œä½¿å¾—ä¸åŒå±€åŸŸç½‘å†…æœºå™¨äº’è”éš¾åº¦å¤§å¤§ä¸Šå‡ï¼Œåœ¨æŸäº›ç½‘ç»œç±»å‹(å¯¹ç§°NAT)ä¸‹æ— æ³•å»ºç«‹è¿æ¥ã€‚æœåŠ¡å™¨ä¸­è½¬å‡ ä¹æ‰€æœ‰äº’è”ç½‘IMäº§å“éƒ½é‡‡ç”¨æœåŠ¡å™¨ä¸­è½¬è¿™ç§æ–¹å¼è¿›è¡Œæ¶ˆæ¯ä¼ è¾“ï¼Œç›¸å¯¹äºP2Pçš„æ–¹å¼ï¼Œå®ƒæœ‰å¦‚ä¸‹çš„ä¼˜ç‚¹: èƒ½å¤Ÿæ”¯æŒæ›´å¤šP2Pæ— æ³•æ”¯æŒæˆ–æ”¯æŒä¸å¥½çš„ä¸šåŠ¡ï¼Œå¦‚ç¦»çº¿æ¶ˆæ¯ï¼Œç¾¤ç»„ï¼ŒèŠå¤©å®¤æœåŠ¡ æ–¹ä¾¿ä¸šåŠ¡é€»è¾‘çš„æ‹“å±•å’Œæ–°æ—§ç‰ˆæœ¬çš„å…¼å®¹å½“ç„¶å®ƒä¹Ÿæœ‰è‡ªå·±çš„é—®é¢˜:æœåŠ¡å™¨æ¶æ„å¤æ‚ï¼Œå¹¶å‘è¦æ±‚é«˜ã€‚ç½‘ç»œè¿æ¥æ–¹å¼IMä¸»æµç½‘ç»œè¿æ¥æ–¹å¼æœ‰ä¸¤ç§: åŸºäºTCPçš„é•¿è¿æ¥ åŸºäºHTTPçŸ­è¿æ¥PULLçš„æ–¹å¼åè€…å¸¸è§äºWEB IMç³»ç»Ÿ(å½“ç„¶ç°åœ¨å¾ˆå¤šWEB IMéƒ½æ˜¯åŸºäºWebSocketå®ç°)ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œæ–¹ä¾¿å¼€å‘ä¸Šæ‰‹ï¼Œé—®é¢˜æ˜¯æµé‡å¤§ï¼ŒæœåŠ¡å™¨è´Ÿè½½è¾ƒå¤§ï¼Œæ¶ˆæ¯åŠæ—¶æ€§æ— æ³•å¾ˆå¥½åœ°ä¿è¯ï¼Œå¯¹å¤§è§„æ¨¡çš„ç”¨æˆ·é‡æ”¯æŒä¸å¤Ÿï¼Œæ¯”è¾ƒé€‚åˆå°å‹çš„IMç³»ç»Ÿ,å¦‚å°ç½‘ç«™çš„å®¢æˆ·ç³»ç»Ÿã€‚åŸºäºTCPé•¿è¿æ¥åˆ™èƒ½å¤Ÿæ›´å¥½åœ°æ”¯æŒå¤§æ‰¹é‡ç”¨æˆ·ï¼Œé—®é¢˜æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„å®ç°æ¯”è¾ƒå¤æ‚ã€‚å½“ç„¶ä¹Ÿè¿˜æœ‰ä¸€äº›å˜ç§ï¼Œå¦‚ä¸‹è¡Œä½¿ç”¨MQTTè¿›è¡ŒæœåŠ¡å™¨é€šçŸ¥/æ¶ˆæ¯çš„ä¸‹å‘ï¼Œä¸Šè¡Œä½¿ç”¨HTTPçŸ­è¿æ¥è¿›è¡ŒæŒ‡ä»¤å’Œæ¶ˆæ¯çš„ä¸Šä¼ ã€‚è¿™ç§æ–¹å¼èƒ½å¤Ÿä¿è¯ä¸‹è¡Œæ¶ˆæ¯/æŒ‡ä»¤çš„åŠæ—¶æ€§ï¼Œä½†æ˜¯åœ¨å¼±ç½‘ç»œä¸‹ä¸Šè¡Œæ…¢çš„é—®é¢˜è¿˜æ˜¯æ¯”è¾ƒä¸¥é‡ã€‚æ—©æœŸçš„æ¥å¾€å°±æ˜¯åŸºäºè¿™ç§æ–¹å¼ã€‚åè®®é€‰æ‹© IMåè®®é€‰æ‹©åŸåˆ™ä¸€èˆ¬æ˜¯:æ˜“äºæ‹“å±•ï¼Œæ–¹ä¾¿è¦†ç›–å„ç§ä¸šåŠ¡é€»è¾‘ï¼ŒåŒæ—¶åˆæ¯”è¾ƒèŠ‚çº¦æµé‡ã€‚åä¸€ç‚¹çš„éœ€æ±‚åœ¨ç§»åŠ¨ç«¯IMä¸Šå°¤å…¶é‡è¦ã€‚ å¸¸è§çš„åè®®æœ‰: XMPP SIP MQTT ç§æœ‰åè®® XMPPåè®®çš„ä¼˜ç‚¹åœ¨äº:åè®®å¼€æºï¼Œå¯æ‹“å±•æ€§å¼ºï¼Œåœ¨å„ä¸ªç«¯(åŒ…æ‹¬æœåŠ¡å™¨)æœ‰å„ç§è¯­è¨€çš„å®ç°ï¼Œå¼€å‘è€…æ¥å…¥æ–¹ä¾¿ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯ä¸å°‘:XMLè¡¨ç°åŠ›å¼±ï¼Œæœ‰å¤ªå¤šå†—ä½™ä¿¡æ¯ï¼Œæµé‡å¤§ï¼Œå®é™…ä½¿ç”¨æ—¶æœ‰å¤§é‡å¤©å‘ã€‚ SIPåè®®å¤šç”¨äºVOIPç›¸å…³çš„æ¨¡å—ï¼Œæ˜¯ä¸€ç§æ–‡æœ¬åè®®ï¼Œç”±äºæˆ‘å¹¶æ²¡æœ‰å®é™…ç”¨è¿‡ï¼Œæ‰€ä»¥ä¸åšè¯„è®ºï¼Œä½†ä»å®ƒæ˜¯æ–‡æœ¬åè®®è¿™ä¸€ç‚¹å‡ ä¹å¯ä»¥æ–­å®šå®ƒçš„æµé‡ä¸ä¼šå°ã€‚ MQTTçš„ä¼˜ç‚¹æ˜¯åè®®ç®€å•ï¼Œæµé‡å°‘ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºIMè®¾è®¡çš„åè®®ï¼Œå¤šä½¿ç”¨äºæ¨é€ã€‚ è€Œå¸‚é¢ä¸Šå‡ ä¹æ‰€æœ‰ä¸»æµIM APPéƒ½æ˜¯æ˜¯ä½¿ç”¨ç§æœ‰åè®®ï¼Œä¸€ä¸ªè¢«è‰¯å¥½è®¾è®¡çš„ç§æœ‰åè®®ä¸€èˆ¬æœ‰å¦‚ä¸‹ä¼˜ç‚¹:é«˜æ•ˆï¼ŒèŠ‚çº¦æµé‡(ä¸€èˆ¬ä½¿ç”¨äºŒè¿›åˆ¶åè®®)ï¼Œå®‰å…¨æ€§é«˜ï¼Œéš¾ä»¥ç ´è§£ã€‚ç¼ºç‚¹åˆ™æ˜¯åœ¨å¼€å‘åˆæœŸæ²¡æœ‰ç°æœ‰æ ·åˆ—å¯ä»¥å‚è€ƒï¼Œå¯¹äºè®¾è®¡è€…çš„è¦æ±‚æ¯”è¾ƒé«˜ã€‚ ä¸€ä¸ªå¥½çš„åè®®éœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶:é«˜æ•ˆï¼Œç®€æ´ï¼Œå¯è¯»æ€§å¥½ï¼ŒèŠ‚çº¦æµé‡ï¼Œæ˜“äºæ‹“å±•ï¼ŒåŒæ—¶åˆèƒ½å¤ŸåŒ¹é…å½“å‰å›¢é˜Ÿçš„æŠ€æœ¯å †æ ˆã€‚åŸºäºå¦‚ä¸ŠåŸåˆ™ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å‡º:å¦‚æœå›¢é˜Ÿå°ï¼Œå›¢é˜ŸæŠ€æœ¯åœ¨IMä¸Šç§¯ç´¯ä¸å¤Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨XMPPæˆ–è€…MQTT+HTTPçŸ­è¿æ¥çš„å®ç°ã€‚åä¹‹å¯ä»¥è€ƒè™‘è‡ªå·±è®¾è®¡å’Œå®ç°ç§æœ‰åè®®ã€‚ ç§æœ‰åè®®çš„è®¾è®¡ åºåˆ—åŒ–é€‰æ‹©ç§»åŠ¨äº’è”ç½‘ç›¸å¯¹äºæœ‰çº¿ç½‘ç»œæœ€å¤§ç‰¹ç‚¹æ˜¯:å¸¦å®½ä½ï¼Œå»¶è¿Ÿé«˜ï¼Œä¸¢åŒ…ç‡é«˜å’Œç¨³å®šæ€§å·®ï¼Œæµé‡è´¹ç”¨é«˜ã€‚æ‰€ä»¥åœ¨ç§æœ‰åè®®çš„åºåˆ—åŒ–ä¸Šä¸€èˆ¬ä½¿ç”¨äºŒè¿›åˆ¶åè®®ï¼Œè€Œä¸æ˜¯æ–‡æœ¬åè®®ã€‚å¸¸è§çš„äºŒè¿›åˆ¶åºåˆ—åŒ–åº“æœ‰protobufå’ŒMessagePackï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªå·±å®ç°è‡ªå·±çš„äºŒè¿›åˆ¶åè®®åºåˆ—åŒ–å’Œååºåˆ—çš„è¿‡ç¨‹ï¼Œæ¯”å¦‚è˜‘è‡è¡—çš„TeamTalkã€‚ä½†æ˜¯å‰é¢äºŒè€…æ— è®ºæ˜¯å¯æ‹“å±•æ€§è¿˜æ˜¯å¯è¯»æ€§éƒ½å®Œçˆ†TeamTalk(TeamTalkè¿Variantéƒ½ä¸æ”¯æŒï¼Œä¸€ä¸ªintä¼ è¾“æ—¶å›ºå®šå ç”¨4ä¸ªå­—èŠ‚)ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿˜æ˜¯ä¸æ¨èè‡ªå·±å»å®ç°äºŒè¿›åˆ¶åè®®çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ã€‚åè®®æ ¼å¼è®¾è®¡ åŸºäºTCPçš„åº”ç”¨å±‚åè®®ä¸€èˆ¬éƒ½åˆ†ä¸ºåŒ…å¤´å’ŒåŒ…ä½“(å¦‚HTTP)ï¼ŒIMåè®®ä¹Ÿä¸ä¾‹å¤–ã€‚åŒ…å¤´ä¸€èˆ¬ç”¨äºè¡¨ç¤ºæ¯ä¸ªè¯·æ±‚/åé¦ˆçš„å…¬å…±éƒ¨åˆ†ï¼Œå¦‚åŒ…é•¿ï¼Œè¯·æ±‚ç±»å‹ï¼Œè¿”å›ç ç­‰ã€‚è€ŒåŒ…å¤´åˆ™å¡«å……ä¸åŒè¯·æ±‚/åé¦ˆå¯¹åº”çš„ä¿¡æ¯ã€‚ ä¸€ä¸ªæœ€ç®€å•çš„åŒ…å¤´å¯ä»¥å®šä¹‰ä¸º 1234567struct PackHeader&#123; int32_t length_; //åŒ…é•¿åº¦ int32_t serial_; //åŒ…åºåˆ—å· int32_t command_; //åŒ…è¯·æ±‚ç±»å‹ int32_t code_; //è¿”å›ç &#125;; ä»¥å¿ƒè·³åŒ…ä¸ºä¾‹ï¼Œå‡è®¾å½“å‰çš„serialä¸º1ï¼Œå¿ƒè·³åŒ…çš„commandä¸º10ï¼Œé‚£ä¹ˆä½¿ç”¨MessagePackåšåºåˆ—åŒ–æ—¶:length=4ï¼Œserial=1ï¼Œcommand=10ï¼Œcode=0ï¼Œæ¯ä¸ªå­—æ®µå„å ä¸€ä¸ªå­—èŠ‚ï¼ŒåŒ…ä½“ä¸ºç©ºï¼Œä»…éœ€è¦4ä¸ªå­—èŠ‚ã€‚ å½“ç„¶è¿™æ˜¯æœ€ç®€å•çš„ä¸€ä¸ªä¾‹å­ï¼Œé¢å¯¹çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘æ—¶ï¼ŒåŒ…ä½“é‡Œé¢ä¼šéœ€è¦å¡å…¥æ›´å¤šåœ°ä¿¡æ¯ï¼Œè¿™ä¸ªéœ€è¦å¼€å‘æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘æ€»ç»“å…¬å…±éƒ¨åˆ†,å¦‚ä¸ºäº†å…¼å®¹åŠ å…¥çš„åè®®ç‰ˆæœ¬å·,ä¸ºäº†è´Ÿè½½å‡è¡¡åŠ å…¥çš„æ¨¡å—idç­‰ã€‚ å…¶ä»–é—®é¢˜ä¸Šé¢å°±æ˜¯ä¸€ä¸ªIMç³»ç»Ÿå¤§è‡´çš„é€‰å‹è¿‡ç¨‹:é€šè®¯æ–¹å¼ï¼Œè¿æ¥æ–¹å¼ï¼Œåè®®é€‰æ‹©ï¼Œåè®®è®¾è®¡ã€‚ä½†æ˜¯å®é™…å¼€å‘è¿‡ç¨‹ä¸­è¿˜æœ‰å¤§é‡çš„é—®é¢˜éœ€è¦å¤„ç†ã€‚ åè®®åŠ å¯†ä¸ºäº†ä¿è¯åè®®ä¸å®¹æ˜“è¢«ç ´è§£ï¼Œå¸‚é¢ä¸Šå‡ ä¹æ‰€æœ‰ä¸»æµIMéƒ½ä¼šå¯¹åè®®è¿›è¡ŒåŠ å¯†ä¼ è¾“ã€‚å¸¸è§çš„æµç¨‹å’ŒHTTPSåŠ å¯†ç›¸ä¼¼:å»ºç«‹è¿æ¥åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›è¡Œè¿›è¡Œåå•†ï¼Œæœ€ç»ˆå®¢æˆ·ç«¯è·å¾—ä¸€ä¸ªå½“å‰Sessinoçš„ç§˜é’¥ï¼Œåç»­çš„æ•°æ®ä¼ è¾“éƒ½é€šè¿‡è¿™ä¸ªç§˜é’¥è¿›è¡ŒåŠ è§£å¯†ã€‚ä¸€èˆ¬å‡ºäºæ•ˆç‡çš„è€ƒè™‘éƒ½ä¼šé‡‡ç”¨æµå¼åŠ å¯†ï¼Œå¦‚RC4ã€‚è€Œå‰æœŸåå•†è¿‡ç¨‹åˆ™æ¨èä½¿ç”¨RSAç­‰éå¯¹ç§°åŠ å¯†ä»¥å¢åŠ ç ´è§£éš¾åº¦ã€‚ å¿«é€Ÿè¿æ¥(ç™»å½•)å¯¹iOS APPè€Œè¨€ï¼Œå› ä¸ºæ²¡æœ‰çœŸåå°çš„å­˜åœ¨ï¼ŒAPPæ¯æ¬¡å¯åŠ¨åŸºæœ¬éƒ½éœ€è¦ä¸€æ¬¡é‡è¿ç™»å½•(çŸ­æ—¶é—´å†…åˆ‡æ¢é™¤å¤–)ï¼Œæ‰€ä»¥å¦‚ä½•å¿«é€Ÿé‡è¿é‡ç™»å°±éå¸¸é‡è¦ã€‚å¸¸è§çš„ä¼˜åŒ–æ€è·¯å¦‚ä¸‹: æœ¬åœ°ç¼“å­˜æœåŠ¡å™¨IPå¹¶å®šæœŸåˆ·æ–°ã€‚ç§»åŠ¨ç½‘ç»œè°ƒä¼˜å¯ä»¥å‚è€ƒã€ŠiOSç§»åŠ¨ç½‘ç»œè°ƒä¼˜é‚£äº›äº‹ã€‹ã€‚ åˆå¹¶éƒ¨åˆ†è¯·æ±‚ã€‚å¦‚åŠ å¯†å’Œç™»å½•æ“ä½œå¯ä»¥åˆå¹¶ä¸ºåŒä¸€ä¸ªæ“ä½œï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘ä¸€æ¬¡ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚æ¥å›çš„æ—¶é—´ã€‚ ç®€åŒ–ç™»å½•åçš„åŒæ­¥è¯·æ±‚ï¼Œéƒ¨åˆ†åŒæ­¥è¯·æ±‚å¯ä»¥æ¨è¿Ÿåˆ°UIæ“ä½œæ—¶è¿›è¡Œï¼Œå¦‚ç¾¤æˆå‘˜ä¿¡æ¯åˆ·æ–°ã€‚ è¿æ¥ä¿æŒä¸€èˆ¬APPå®ç°è¿æ¥ä¿æŒçš„æ–¹å¼æ— éæ˜¯é‡‡ç”¨åº”ç”¨å±‚çš„å¿ƒè·³ï¼Œé€šè¿‡å¿ƒè·³åŒ…çš„è¶…æ—¶å’Œå…¶ä»–æ¡ä»¶(ç½‘ç»œåˆ‡æ¢)æ¥æ‰§è¡Œé‡è¿æ“ä½œã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†:ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åº”ç”¨å±‚å¿ƒè·³å’Œå¦‚ä½•è®¾è®¡åº”ç”¨å±‚å¿ƒè·³ã€‚ ä¼—æ‰€å‘¨çŸ¥TCPåè®®æ˜¯æœ‰KEEPALIVEè¿™ä¸ªè®¾ç½®é€‰é¡¹ï¼Œè®¾ç½®ä¸ºKEEPALIVEåï¼Œå®¢æˆ·ç«¯æ¯éš”Nç§’(é»˜è®¤æ˜¯7200s)ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªå‘é€å¿ƒè·³åŒ…ã€‚ä½†å®é™…æ“ä½œä¸­æˆ‘ä»¬æ›´å¤šçš„æ—¶æ˜¯ä½¿ç”¨åº”ç”¨å±‚å¿ƒè·³ã€‚åŸå› å¦‚ä¸‹: KEEPALIVEå¯¹æœåŠ¡å™¨è´Ÿè½½å‹åŠ›æ¯”è¾ƒå¤§(æœåŠ¡å™¨å¤§å¤§æ˜¯è¿™ä¹ˆè¯´çš„â€¦) socksä»£ç†å¯¹KEEPALIVEå¹¶ä¸æ”¯æŒ éƒ¨åˆ†å¤æ‚æƒ…å†µä¸‹KEEPALIVEä¼šå¤±æ•ˆï¼Œå¦‚è·¯ç”±å™¨æŒ‚æ‰ï¼Œç½‘çº¿(ç§»åŠ¨ç«¯æ²¡æœ‰ç½‘çº¿â€¦)ç›´æ¥è¢«æ‹”é™¤ ç§»åŠ¨ç«¯åœ¨å®é™…æ“ä½œæ—¶ä¸ºäº†èŠ‚çº¦æµé‡å’Œç”µé‡ä¸€èˆ¬ä¼šåœ¨å¿ƒè·³åŒ…ä¸Šåšä¸€äº›å°ä¼˜åŒ– ç²¾ç®€å¿ƒè·³åŒ…ï¼Œä¿è¯ä¸€ä¸ªå¿ƒè·³åŒ…å¤§å°åœ¨10å­—èŠ‚ä¹‹å†… å¿ƒè·³åŒ…åªåœ¨ç©ºé—²æ—¶å‘é€ æ ¹æ®APPå‰åå°çŠ¶æ€è°ƒæ•´å¿ƒè·³åŒ…é—´éš” (ä¸»è¦æ˜¯å®‰å“) æ¶ˆæ¯å¯è¾¾åœ¨ç§»åŠ¨ç½‘ç»œä¸‹ï¼Œä¸¢åŒ…ï¼Œç½‘ç»œé‡è¿ç­‰æƒ…å†µéå¸¸ä¹‹å¤šï¼Œä¸ºäº†ä¿è¯æ¶ˆæ¯çš„å¯è¾¾ï¼Œä¸€èˆ¬éœ€è¦åšæ¶ˆæ¯å›æ‰§å’Œé‡å‘æœºåˆ¶ã€‚å‚è€ƒæ˜“ä¿¡ï¼Œæ¯æ¡æ¶ˆæ¯ä¼šæœ€å¤šä¼šæœ‰3æ¬¡é‡å‘ï¼Œè¶…æ—¶æ—¶é—´ä¸º15ç§’ï¼ŒåŒæ—¶åœ¨å‘é€ä¹‹å‰ä¼šæ£€æµ‹å½“å‰è¿æ¥çŠ¶æ€ï¼Œå¦‚æœå½“å‰è¿æ¥å¹¶æ²¡æœ‰æ­£ç¡®å»ºç«‹ï¼Œç¼“å­˜æ¶ˆæ¯ä¸”å®šæ—¶æ£€æŸ¥(æ¯éš”2ç§’æ£€æŸ¥ä¸€æ¬¡ï¼Œæ£€æŸ¥15æ¬¡)ã€‚æ‰€ä»¥ä¸€æ¡æ¶ˆæ¯åœ¨æœ€å·®çš„æƒ…å†µä¸‹ä¼šæœ‰2åˆ†é’Ÿå·¦å³çš„é‡è¯•æ—¶é—´ï¼Œä»¥ä¿è¯æ¶ˆæ¯çš„å¯è¾¾ã€‚ å› ä¸ºé‡å‘çš„å­˜åœ¨ï¼Œæ¥å—ç«¯å¶å°”ä¼šæ”¶åˆ°é‡å¤æ¶ˆæ¯ï¼Œè¿™ç§æƒ…å†µä¸‹å°±éœ€è¦æ¥æ”¶ç«¯è¿›è¡Œå»é‡ã€‚é€šç”¨çš„åšæ³•æ˜¯æ¯æ¡æ¶ˆæ¯éƒ½å¸¦ä¸Šè‡ªå·±å”¯ä¸€çš„message id(ä¸€èˆ¬æ˜¯uuid)ã€‚ æ–‡ä»¶ä¸Šä¼ ä¼˜åŒ–IMæ¶ˆæ¯(åŒ…æ‹¬SNSæ¨¡å—)å†…åŒ…å«å¤§é‡çš„æ–‡ä»¶ä¸Šä¼ çš„éœ€æ±‚ï¼Œå¦‚ä½•ä¼˜åŒ–æ–‡ä»¶çš„ä¸Šä¼ å°±æˆäº†ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ä¸»é¢˜ã€‚å¸¸è§æœ‰ä¸‹é¢è¿™äº›ä¼˜åŒ–æ€è·¯: å°†ä¸Šä¼ æµç¨‹æå‰:éŸ³é¢‘æä¾›è¾¹å½•è¾¹ä¼ ã€‚æœ‹å‹åœˆçš„å›¾ç‰‡è¿›è¡Œé¢„ä¸Šä¼ ï¼Œé€‰æ‹©å›¾ç‰‡åç”¨æˆ·ä¸€èˆ¬ä¼šè¿›è¡Œæ–‡æœ¬è¾“å…¥ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…åå°å°±å¯ä»¥é»˜é»˜å°†é€‰å¥½çš„å›¾ç‰‡è¿›è¡Œä¸Šä¼ ã€‚ æä¾›é—ªç”µä¸Šä¼ çš„æ–¹å¼:æœåŠ¡å™¨æ ¹æ®MD5è¿›è¡Œæ–‡ä»¶å»é‡ã€‚ ä¼˜åŒ–å’Œä¸Šä¼ æœåŠ¡å™¨çš„è¿æ¥(å‚è€ƒå¿«é€Ÿè¿æ¥)ï¼Œæä¾›è¿æ¥é‡ç”¨çš„åŠŸèƒ½ã€‚ æ–‡ä»¶åˆ†å—ä¸Šä¼ :å› ä¸ºç§»åŠ¨ç½‘ç»œä¸¢åŒ…ä¸¥é‡ï¼Œå°†æ–‡ä»¶åˆ†å—ä¸Šä¼ å¯ä»¥ä½¿å¾—ä¸€ä¸ªåˆ†ç»„åŒ…å«åˆç†æ•°é‡çš„TCPåŒ…ï¼Œä½¿å¾—é‡è¯•æ¦‚ç‡ä¸‹é™ï¼Œé‡è¯•ä»£ä»·å˜å°ï¼Œæ›´å®¹æ˜“ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚ åœ¨åˆ†åŒ…çš„å‰æä¸‹æ”¯æŒä¸Šä¼ çš„pipelineï¼Œé¿å…ä¸å¿…è¦çš„ç½‘ç»œç­‰å¾…æ—¶é—´ã€‚ æ”¯æŒæ–­ç‚¹ç»­ä¼  æ€»ç»“æ­¤å¤„æ˜¯è½¯æ–‡ï¼Œè¯·å…¨é€‰é˜…è¯»:ä¸€ä¸ªå¤§å‹IMç³»ç»Ÿæ¶‰åŠåˆ°ä¸œè¥¿å®åœ¨å¤ªå¤šï¼Œå¦‚æœIMæ¨¡å—åªæ˜¯APPçš„é™„å±åŠŸèƒ½ï¼Œå¹¶ä¸æ¨èè‡ªå·±å»ä»å¤´å®ç°IMæ¨¡å—æˆ–è€…ä½¿ç”¨XMPPè¿™ç§æœ‰å¤©å‘çš„å¼€æºå®ç°ï¼Œç›´æ¥ä½¿ç”¨å¸‚é¢ä¸Šçš„ç¬¬ä¸‰æ–¹SDKå³å¯ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„äº‘ä¿¡ã€‚æ¯•ç«Ÿï¼Œæˆ‘ä»¬ï¼Œæ˜¯ï¼Œä¸“ä¸šçš„ï¼~~~~","link":"/2016/02/28/ç§»åŠ¨IMå¼€å‘è¦ç‚¹/"},{"title":"çŸ¥ä¹ä¸ŠæŸäººçš„iOSé¢è¯•é¢˜","text":"è¿™æ˜¯å‰å¹´åœ¨çŸ¥ä¹ä¸Šæ€»ç»“å›ç­”MrPeakçš„é—®é¢˜ï¼Œç°åœ¨æ¬è¿åˆ°è‡ªå·±çš„blogä¸­ã€‚çŸ¥ä¹é“¾æ¥ï¼šhttp://www.zhihu.com/question/19604641 ###1.ä»€ä¹ˆæ˜¯arcï¼Ÿï¼ˆarcæ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜è¯ç”Ÿçš„ï¼Ÿï¼‰é¦–å…ˆè§£é‡ŠARC: automatic reference countingè‡ªåŠ¨å¼•ç”¨è®¡æ•°ã€‚ARCå‡ ä¸ªè¦ç‚¹ï¼šåœ¨å¯¹è±¡è¢«åˆ›å»ºæ—¶ retain count +1ï¼Œåœ¨å¯¹è±¡è¢«releaseæ—¶ retain count -1.å½“retain count ä¸º0 æ—¶ï¼Œé”€æ¯å¯¹è±¡ã€‚ç¨‹åºä¸­åŠ autoreleasepooçš„å¯¹è±¡ä¼šç”±ç³»ç»Ÿè‡ªåŠ¨åŠ ä¸Šautoreleaseæ–¹æ³•ï¼Œå¦‚æœè¯¥å¯¹è±¡å¼•ç”¨è®¡æ•°ä¸º0ï¼Œåˆ™é”€æ¯ã€‚é‚£ä¹ˆARCæ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜è¯ç”Ÿçš„å‘¢ï¼Ÿè¿™ä¸ªå¾—è¿½æº¯åˆ°MRCæ‰‹åŠ¨å†…å­˜ç®¡ç†æ—¶ä»£è¯´èµ·ã€‚MRCä¸‹å†…å­˜ç®¡ç†çš„ç¼ºç‚¹ï¼š å½“æˆ‘ä»¬è¦é‡Šæ”¾ä¸€ä¸ªå †å†…å­˜æ—¶ï¼Œé¦–å…ˆè¦ç¡®å®šæŒ‡å‘è¿™ä¸ªå †ç©ºé—´çš„æŒ‡é’ˆéƒ½è¢«releaseäº†ã€‚ï¼ˆé¿å…æå‰é‡Šæ”¾ï¼‰ é‡Šæ”¾æŒ‡é’ˆæŒ‡å‘çš„å †ç©ºé—´ï¼Œé¦–å…ˆè¦ç¡®å®šå“ªäº›æŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªå †ï¼Œè¿™äº›æŒ‡é’ˆåªèƒ½é‡Šæ”¾ä¸€æ¬¡ã€‚ï¼ˆMRCä¸‹å³è°åˆ›å»ºï¼Œè°é‡Šæ”¾ï¼Œé¿å…é‡å¤é‡Šæ”¾ï¼‰ æ¨¡å—åŒ–æ“ä½œæ—¶ï¼Œå¯¹è±¡å¯èƒ½è¢«å¤šä¸ªæ¨¡å—åˆ›å»ºå’Œä½¿ç”¨ï¼Œä¸èƒ½ç¡®å®šæœ€åç”±è°å»é‡Šæ”¾ã€‚ å¤šçº¿ç¨‹æ“ä½œæ—¶ï¼Œä¸ç¡®å®šå“ªä¸ªçº¿ç¨‹æœ€åä½¿ç”¨å®Œæ¯• ###2.è¯·è§£é‡Šä»¥ä¸‹keywordsçš„åŒºåˆ«ï¼š assign vs weak, __block vs __weakassigné€‚ç”¨äºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œweakæ˜¯é€‚ç”¨äºNSObjectå¯¹è±¡ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨ã€‚assignå…¶å®ä¹Ÿå¯ä»¥ç”¨æ¥ä¿®é¥°å¯¹è±¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸ç”¨å®ƒå‘¢ï¼Ÿå› ä¸ºè¢«assignä¿®é¥°çš„å¯¹è±¡åœ¨é‡Šæ”¾ä¹‹åï¼ŒæŒ‡é’ˆçš„åœ°å€è¿˜æ˜¯å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æŒ‡é’ˆå¹¶æ²¡æœ‰è¢«ç½®ä¸ºnilã€‚å¦‚æœåœ¨åç»­çš„å†…å­˜åˆ†é…ä¸­ï¼Œåˆšå¥½åˆ†åˆ°äº†è¿™å—åœ°å€ï¼Œç¨‹åºå°±ä¼šå´©æºƒæ‰ã€‚è€Œweakä¿®é¥°çš„å¯¹è±¡åœ¨é‡Šæ”¾ä¹‹åï¼ŒæŒ‡é’ˆåœ°å€ä¼šè¢«ç½®ä¸ºnilã€‚æ‰€ä»¥ç°åœ¨ä¸€èˆ¬å¼±å¼•ç”¨å°±æ˜¯ç”¨weakã€‚ é¦–å…ˆ__blockæ˜¯ç”¨æ¥ä¿®é¥°ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡å°±å¯ä»¥åœ¨blockä¸­è¢«ä¿®æ”¹ï¼ˆå‚è€ƒblockå®ç°åŸç†ï¼‰__blockï¼šä½¿ç”¨ blockä¿®é¥°çš„å˜é‡åœ¨blockä»£ç å¿«ä¸­ä¼šè¢«retainï¼ˆARCä¸‹ï¼ŒMRCä¸‹ä¸ä¼šretainï¼‰`weak` ï¼šä½¿ç”¨ weakä¿®é¥°çš„å˜é‡ä¸ä¼šåœ¨blockä»£ç å—ä¸­è¢«retainåŒæ—¶ï¼Œåœ¨ARCä¸‹ï¼Œè¦é¿å…blockå‡ºç°å¾ªç¯å¼•ç”¨ ``weak typedof(self)weakSelf = self``; ###3.blockåœ¨arcå’Œéarcä¸‹å«ä¹‰ä¸€æ ·å—ï¼Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚åœ¨MRCä¸­ block variable åœ¨blockä¸­ä½¿ç”¨æ˜¯ä¸æœƒretainçš„,ä½†æ˜¯ARCä¸­ blockå‰‡æ˜¯æœƒRetainçš„ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ç”¨ `weakæˆ–æ˜¯__unsafe_unretained` ä¾†æ›´ç²¾ç¢ºçš„æè¿°weak referenceçš„ç›®çš„å…¶ä¸­å‰è€…åªèƒ½åœ¨iOS5ä¹‹å¾Œå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯æ¯”è¼ƒå¥½ (è©²ç‰©ä»¶releaseä¹‹å¾Œï¼Œæ­¤pointeræœƒè‡ªå‹•è¨­æˆnil)è€Œå¾Œè€…æ˜¯ARCçš„ç’°å¢ƒä¸‹ç‚ºäº†ç›¸å®¹4.xçš„è§£æ±ºæ–¹æ¡ˆã€‚æ‰€ä»¥ä¸Šé¢çš„ç¯„ä¾‹ä¸­123__block MyClass* temp = â€¦; // MRCç’°å¢ƒä¸‹ä½¿ç”¨__weak MyClass* temp = â€¦; // ARCä½†åªæ”¯æ´iOS5.0ä»¥ä¸Šçš„ç‰ˆæœ¬__unsafe_retained MyClass* temp = â€¦; //ARCä¸”å¯ä»¥ç›¸å®¹4.xä»¥å¾Œçš„ç‰ˆæœ¬ ###4.ä½¿ç”¨nonatomicä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿï¼ˆï¼‰ä¸æ˜¯çš„ã€‚atomicåŸå­æ“ä½œï¼Œç³»ç»Ÿä¼šä¸ºsetteræ–¹æ³•åŠ é”ã€‚ å…·ä½“ä½¿ç”¨ @synchronized(self){//code }nonatomicä¸ä¼šä¸ºsetteræ–¹æ³•åŠ é”ã€‚atomicï¼šçº¿ç¨‹å®‰å…¨ï¼Œéœ€è¦æ¶ˆè€—å¤§é‡ç³»ç»Ÿèµ„æºæ¥ä¸ºå±æ€§åŠ é”nonatomicï¼šéçº¿ç¨‹å®‰å…¨ï¼Œé€‚åˆå†…å­˜è¾ƒå°çš„ç§»åŠ¨è®¾å¤‡ ###5.æè¿°ä¸€ä¸ªä½ é‡åˆ°è¿‡çš„retain cycleä¾‹å­ã€‚blockä¸­çš„å¾ªç¯å¼•ç”¨ï¼šä¸€ä¸ªviewController123456@property (nonatomic,strong)HttpRequestHandler * handler;@property (nonatomic,strong)NSData *data;_handler = [httpRequestHandler sharedManager];[ downloadData:^(id responseData)&#123; _data = responseData;&#125;]; self æ‹¥æœ‰_handler, _handler æ‹¥æœ‰block, blockæ‹¥æœ‰selfï¼ˆå› ä¸ºä½¿ç”¨äº†selfçš„_dataå±æ€§ï¼Œblockä¼šcopy ä¸€ä»½selfï¼‰è§£å†³æ–¹æ³•ï¼š1234__weak typedof(self)weakSelf = self[ downloadData:^(id responseData)&#123; weakSelf.data = responseData;&#125;]; 6.+(void)load; +(void)initializeï¼›æœ‰ä»€ä¹ˆç”¨å¤„ï¼Ÿåœ¨Objective-Cä¸­ï¼Œruntimeä¼šè‡ªåŠ¨è°ƒç”¨æ¯ä¸ªç±»çš„ä¸¤ä¸ªæ–¹æ³•ã€‚+loadä¼šåœ¨ç±»åˆå§‹åŠ è½½æ—¶è°ƒç”¨ï¼Œ+initializeä¼šåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ç±»çš„ç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•ä¹‹å‰è¢«è°ƒç”¨ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯å¯é€‰çš„ï¼Œä¸”åªæœ‰åœ¨å®ç°äº†å®ƒä»¬æ—¶æ‰ä¼šè¢«è°ƒç”¨ã€‚å…±åŒç‚¹ï¼šä¸¤ä¸ªæ–¹æ³•éƒ½åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚ 7.ä¸ºä»€ä¹ˆå…¶ä»–è¯­è¨€é‡Œå«å‡½æ•°è°ƒç”¨ï¼Œ objective cé‡Œåˆ™æ˜¯ç»™å¯¹è±¡å‘æ¶ˆæ¯ï¼ˆæˆ–è€…è°ˆä¸‹å¯¹runtimeçš„ç†è§£ï¼‰å…ˆæ¥çœ‹çœ‹æ€ä¹ˆç†è§£å‘é€æ¶ˆæ¯çš„å«ä¹‰ï¼š æ›¾ç»è§‰å¾—Objcç‰¹åˆ«æ–¹ä¾¿ä¸Šæ‰‹ï¼Œé¢å¯¹ç€ Cocoa ä¸­å¤§é‡ APIï¼ŒåªçŸ¥é“ç®€å•çš„æŸ¥æ–‡æ¡£å’Œè°ƒç”¨ã€‚è¿˜è®°å¾—åˆå­¦ Objective-C æ—¶æŠŠ[receiver message]å½“æˆç®€å•çš„æ–¹æ³•è°ƒç”¨ï¼Œè€Œæ— è§†äº†â€œå‘é€æ¶ˆæ¯â€è¿™å¥è¯çš„æ·±åˆ»å«ä¹‰ã€‚äºæ˜¯[receiver message]ä¼šè¢«ç¼–è¯‘å™¨è½¬åŒ–ä¸ºï¼šobjc_msgSend(receiver, selector)å¦‚æœæ¶ˆæ¯å«æœ‰å‚æ•°ï¼Œåˆ™ä¸ºï¼šobjc_msgSend(receiver, selector, arg1, arg2, ...) å¦‚æœæ¶ˆæ¯çš„æ¥æ”¶è€…èƒ½å¤Ÿæ‰¾åˆ°å¯¹åº”çš„selectorï¼Œé‚£ä¹ˆå°±ç›¸å½“äºç›´æ¥æ‰§è¡Œäº†æ¥æ”¶è€…è¿™ä¸ªå¯¹è±¡çš„ç‰¹å®šæ–¹æ³•ï¼›å¦åˆ™ï¼Œæ¶ˆæ¯è¦ä¹ˆè¢«è½¬å‘ï¼Œæˆ–æ˜¯ä¸´æ—¶å‘æ¥æ”¶è€…åŠ¨æ€æ·»åŠ è¿™ä¸ªselectorå¯¹åº”çš„å®ç°å†…å®¹ï¼Œè¦ä¹ˆå°±å¹²è„†ç©å®Œå´©æºƒæ‰ã€‚ ç°åœ¨å¯ä»¥çœ‹å‡º[receiver message]çœŸçš„ä¸æ˜¯ä¸€ä¸ªç®€ç®€å•å•çš„æ–¹æ³•è°ƒç”¨ã€‚å› ä¸ºè¿™åªæ˜¯åœ¨ç¼–è¯‘é˜¶æ®µç¡®å®šäº†è¦å‘æ¥æ”¶è€…å‘é€messageè¿™æ¡æ¶ˆæ¯ï¼Œè€Œreceiveå°†è¦å¦‚ä½•å“åº”è¿™æ¡æ¶ˆæ¯ï¼Œé‚£å°±è¦çœ‹è¿è¡Œæ—¶å‘ç”Ÿçš„æƒ…å†µæ¥å†³å®šäº†ã€‚ Objective-C çš„ Runtime é“¸å°±äº†å®ƒåŠ¨æ€è¯­è¨€çš„ç‰¹æ€§ï¼Œè¿™äº›æ·±å±‚æ¬¡çš„çŸ¥è¯†è™½ç„¶å¹³æ—¶å†™ä»£ç ç”¨çš„å°‘ä¸€äº›ï¼Œä½†æ˜¯å´æ˜¯æ¯ä¸ª Objc ç¨‹åºå‘˜éœ€è¦äº†è§£çš„ã€‚ Objc Runtimeä½¿å¾—Cå…·æœ‰äº†é¢å‘å¯¹è±¡èƒ½åŠ›ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶åˆ›å»ºï¼Œæ£€æŸ¥ï¼Œä¿®æ”¹ç±»ã€å¯¹è±¡å’Œå®ƒä»¬çš„æ–¹æ³•ã€‚å¯ä»¥ä½¿ç”¨runtimeçš„ä¸€ç³»åˆ—æ–¹æ³•å®ç°ã€‚ é¡ºä¾¿é™„ä¸ŠOCä¸­ä¸€ä¸ªç±»çš„æ•°æ®ç»“æ„ /usr/include/objc/runtime.h12345678910111213141516 struct objc_class &#123;Class isa OBJC_ISA_AVAILABILITY; //isaæŒ‡é’ˆæŒ‡å‘Meta Classï¼Œå› ä¸ºObjcçš„ç±»çš„æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªObjectï¼Œä¸ºäº†å¤„ç†è¿™ä¸ªå…³ç³»ï¼Œr untimeå°±åˆ›é€ äº†Meta Classï¼Œå½“ç»™ç±»å‘é€[NSObject alloc]è¿™æ ·æ¶ˆæ¯æ—¶ï¼Œå®é™…ä¸Šæ˜¯æŠŠè¿™ä¸ªæ¶ˆæ¯å‘ç»™äº†Class Object#if !__OBJC2__Class super_class OBJC2_UNAVAILABLE; // çˆ¶ç±»const char *name OBJC2_UNAVAILABLE; // ç±»ålong version OBJC2_UNAVAILABLE; // ç±»çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œé»˜è®¤ä¸º0long info OBJC2_UNAVAILABLE; // ç±»ä¿¡æ¯ï¼Œä¾›è¿è¡ŒæœŸä½¿ç”¨çš„ä¸€äº›ä½æ ‡è¯†long instance_size OBJC2_UNAVAILABLE; // è¯¥ç±»çš„å®ä¾‹å˜é‡å¤§å°struct objc_ivar_list *ivars OBJC2_UNAVAILABLE; // è¯¥ç±»çš„æˆå‘˜å˜é‡é“¾è¡¨struct objc_method_list **methodLists OBJC2_UNAVAILABLE; // æ–¹æ³•å®šä¹‰çš„é“¾è¡¨struct objc_cache *cache OBJC2_UNAVAILABLE; // æ–¹æ³•ç¼“å­˜ï¼Œå¯¹è±¡æ¥åˆ°ä¸€ä¸ªæ¶ˆæ¯ä¼šæ ¹æ®isaæŒ‡é’ˆæŸ¥æ‰¾æ¶ˆæ¯å¯¹è±¡ï¼Œè¿™æ—¶ä¼šåœ¨method Listsä¸­éå†ï¼Œå¦‚æœcacheäº†ï¼Œå¸¸ç”¨çš„æ–¹æ³•è°ƒç”¨æ—¶å°±èƒ½å¤Ÿæé«˜è°ƒç”¨çš„æ•ˆç‡ã€‚struct objc_protocol_list *protocols OBJC2_UNAVAILABLE; // åè®®é“¾è¡¨#endif&#125; OBJC2_UNAVAILABLE; OCä¸­ä¸€ä¸ªç±»çš„å¯¹è±¡å®ä¾‹çš„æ•°æ®ç»“æ„ï¼ˆ/usr/include/objc/objc.hï¼‰:12345678910111213typedef struct objc_class *Class;/// Represents an instance of a class.struct objc_object &#123; Class isa OBJC_ISA_AVAILABILITY;&#125;;/// A pointer to an instance of a class.typedef struct objc_object *id; å‘objectå‘é€æ¶ˆæ¯æ—¶ï¼ŒRuntimeåº“ä¼šæ ¹æ®objectçš„isaæŒ‡é’ˆæ‰¾åˆ°è¿™ä¸ªå®ä¾‹objectæ‰€å±äºçš„ç±»ï¼Œç„¶ååœ¨ç±»çš„æ–¹æ³•åˆ—è¡¨ä»¥åŠçˆ¶ç±»æ–¹æ³•åˆ—è¡¨å¯»æ‰¾å¯¹åº”çš„æ–¹æ³•è¿è¡Œã€‚idæ˜¯ä¸€ä¸ªobjc_objectç»“æ„ç±»å‹çš„æŒ‡é’ˆï¼Œè¿™ä¸ªç±»å‹çš„å¯¹è±¡èƒ½å¤Ÿè½¬æ¢æˆä»»ä½•ä¸€ç§å¯¹è±¡ã€‚ ç„¶åå†æ¥çœ‹çœ‹æ¶ˆæ¯å‘é€çš„å‡½æ•°ï¼šobjc_msgSendå‡½æ•° åœ¨å¼•è¨€ä¸­å·²ç»å¯¹objc_msgSendè¿›è¡Œäº†ä¸€ç‚¹ä»‹ç»ï¼Œçœ‹èµ·æ¥åƒæ˜¯objc_msgSendè¿”å›äº†æ•°æ®ï¼Œå…¶å®objc_msgSendä»ä¸è¿”å›æ•°æ®è€Œæ˜¯ä½ çš„æ–¹æ³•è¢«è°ƒç”¨åè¿”å›äº†æ•°æ®ã€‚ä¸‹é¢è¯¦ç»†å™è¿°ä¸‹æ¶ˆæ¯å‘é€æ­¥éª¤ï¼š æ£€æµ‹è¿™ä¸ª selector æ˜¯ä¸æ˜¯è¦å¿½ç•¥çš„ã€‚æ¯”å¦‚ Mac OS X å¼€å‘ï¼Œæœ‰äº†åƒåœ¾å›æ”¶å°±ä¸ç†ä¼š retain,release è¿™äº›å‡½æ•°äº†ã€‚æ£€æµ‹è¿™ä¸ª target æ˜¯ä¸æ˜¯ nil å¯¹è±¡ã€‚ObjC çš„ç‰¹æ€§æ˜¯å…è®¸å¯¹ä¸€ä¸ª nil å¯¹è±¡æ‰§è¡Œä»»ä½•ä¸€ä¸ªæ–¹æ³•ä¸ä¼š Crashï¼Œå› ä¸ºä¼šè¢«å¿½ç•¥æ‰ã€‚å¦‚æœä¸Šé¢ä¸¤ä¸ªéƒ½è¿‡äº†ï¼Œé‚£å°±å¼€å§‹æŸ¥æ‰¾è¿™ä¸ªç±»çš„ IMPï¼Œå…ˆä» cache é‡Œé¢æ‰¾ï¼Œå®Œäº†æ‰¾å¾—åˆ°å°±è·³åˆ°å¯¹åº”çš„å‡½æ•°å»æ‰§è¡Œã€‚å¦‚æœ cache æ‰¾ä¸åˆ°å°±æ‰¾ä¸€ä¸‹æ–¹æ³•åˆ†å‘è¡¨ã€‚å¦‚æœåˆ†å‘è¡¨æ‰¾ä¸åˆ°å°±åˆ°è¶…ç±»çš„åˆ†å‘è¡¨å»æ‰¾ï¼Œä¸€ç›´æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°NSObjectç±»ä¸ºæ­¢ã€‚å¦‚æœè¿˜æ‰¾ä¸åˆ°å°±è¦å¼€å§‹è¿›å…¥åŠ¨æ€æ–¹æ³•è§£æäº†ï¼Œåé¢ä¼šæåˆ°ã€‚ åé¢è¿˜æœ‰ï¼šåŠ¨æ€æ–¹æ³•è§£æresolveThisMethodDynamicallyæ¶ˆæ¯è½¬å‘forwardingTargetForSelector è¯¦æƒ…å¯å‚è€ƒ http://www.jianshu.com/p/620022378e97 ###8.ä»€ä¹ˆæ˜¯method swizzling?Method Swizzling åŸç†ï¼ˆæ–¹æ³•äº¤æ¢ï¼Ÿï¼‰ åœ¨Objective-Cä¸­è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œå…¶å®æ˜¯å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯ï¼ŒæŸ¥æ‰¾æ¶ˆæ¯çš„å”¯ä¸€ä¾æ®æ˜¯selectorçš„åå­—ã€‚åˆ©ç”¨Objective-Cçš„åŠ¨æ€ç‰¹æ€§ï¼Œå¯ä»¥å®ç°åœ¨è¿è¡Œæ—¶å·æ¢selectorå¯¹åº”çš„æ–¹æ³•å®ç°ï¼Œè¾¾åˆ°ç»™æ–¹æ³•æŒ‚é’©çš„ç›®çš„ã€‚æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªæ–¹æ³•åˆ—è¡¨ï¼Œå­˜æ”¾ç€selectorçš„åå­—å’Œæ–¹æ³•å®ç°çš„æ˜ å°„å…³ç³»ã€‚IMPæœ‰ç‚¹ç±»ä¼¼å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘å…·ä½“çš„Methodå®ç°ã€‚ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ method_exchangeImplementations æ¥äº¤æ¢2ä¸ªæ–¹æ³•ä¸­çš„IMPï¼Œ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ class_replaceMethod æ¥ä¿®æ”¹ç±»ï¼Œ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ method_setImplementation æ¥ç›´æ¥è®¾ç½®æŸä¸ªæ–¹æ³•çš„IMPï¼Œâ€¦â€¦å½’æ ¹ç»“åº•ï¼Œéƒ½æ˜¯å·æ¢äº†selectorçš„IMPï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¯¦æƒ…ï¼šhttp://blog.csdn.net/yiyaaixuexi/article/details/9374411 ###9.UIViewå’ŒCALayeræ˜¯å•¥å…³ç³»ï¼Ÿ 1.UIViewæ˜¯iOSç³»ç»Ÿä¸­ç•Œé¢å…ƒç´ çš„åŸºç¡€ï¼Œæ‰€æœ‰çš„ç•Œé¢å…ƒç´ éƒ½ç»§æ‰¿è‡ªå®ƒã€‚å®ƒæœ¬èº«å®Œå…¨æ˜¯ç”±CoreAnimationæ¥å®ç°çš„ ï¼ˆMacä¸‹ä¼¼ä¹ä¸æ˜¯è¿™æ ·ï¼‰ã€‚å®ƒçœŸæ­£çš„ç»˜å›¾éƒ¨åˆ†ï¼Œæ˜¯ç”±ä¸€ä¸ªå«CALayerï¼ˆCore Animation Layerï¼‰çš„ç±»æ¥ç®¡ç†ã€‚ UIViewæœ¬èº«ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªCALayerçš„ç®¡ç†å™¨ï¼Œè®¿é—®å®ƒçš„è·Ÿç»˜å›¾å’Œè·Ÿåæ ‡æœ‰å…³çš„å±æ€§ï¼Œä¾‹å¦‚frameï¼Œboundsç­‰ ç­‰ï¼Œå®é™…ä¸Šå†…éƒ¨éƒ½æ˜¯åœ¨è®¿é—®å®ƒæ‰€åŒ…å«çš„CALayerçš„ç›¸å…³å±æ€§ã€‚ 2.UIViewæœ‰ä¸ªlayerå±æ€§ï¼Œå¯ä»¥è¿”å›å®ƒçš„ä¸»CALayerå®ä¾‹ï¼ŒUIViewæœ‰ä¸€ä¸ªlayerClassæ–¹æ³•ï¼Œè¿”å›ä¸»layeræ‰€ä½¿ç”¨çš„ ç±»ï¼ŒUIViewçš„å­ç±»ï¼Œå¯ä»¥é€šè¿‡é‡è½½è¿™ä¸ªæ–¹æ³•ï¼Œæ¥è®©UIViewä½¿ç”¨ä¸åŒçš„CALayeræ¥æ˜¾ç¤ºï¼Œä¾‹å¦‚é€šè¿‡123- (class) layerClass &#123; return ([CAEAGLLayer class]);&#125; ä½¿æŸä¸ªUIViewçš„å­ç±»ä½¿ç”¨GLæ¥è¿›è¡Œç»˜åˆ¶ã€‚ 3.UIViewçš„CALayerç±»ä¼¼UIViewçš„å­Viewæ ‘å½¢ç»“æ„ï¼Œä¹Ÿå¯ä»¥å‘å®ƒçš„layerä¸Šæ·»åŠ å­layerï¼Œæ¥å®ŒæˆæŸäº›ç‰¹æ®Šçš„è¡¨ ç¤ºã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç 12345grayCover = [[CALayer alloc] init];grayCover.backgroundColor = [[[UIColor blackColor] colorWithAlphaComponent:0.2] CGColor];[self.layer addSubLayer: grayCover]; ä¼šåœ¨ç›®æ ‡Viewä¸Šæ•·ä¸Šä¸€å±‚é»‘è‰²çš„é€æ˜è–„è†œã€‚ 4.UIViewçš„layeræ ‘å½¢åœ¨ç³»ç»Ÿå†…éƒ¨ï¼Œè¢«ç³»ç»Ÿç»´æŠ¤ç€ä¸‰ä»½copyï¼ˆè¿™æ®µç†è§£æœ‰ç‚¹åƒä¸å‡†ï¼‰ã€‚ é€»è¾‘æ ‘ï¼Œå°±æ˜¯ä»£ç é‡Œå¯ä»¥æ“çºµçš„ï¼Œä¾‹å¦‚æ›´æ”¹layerçš„å±æ€§ç­‰ç­‰å°±åœ¨è¿™ä¸€ä»½ã€‚ åŠ¨ç”»æ ‘ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸­é—´å±‚ï¼Œç³»ç»Ÿæ­£åœ¨è¿™ä¸€å±‚ä¸Šæ›´æ”¹å±æ€§ï¼Œè¿›è¡Œå„ç§æ¸²æŸ“æ“ä½œã€‚ æ˜¾ç¤ºæ ‘ï¼Œè¿™æ£µæ ‘çš„å†…å®¹æ˜¯å½“å‰æ­£è¢«æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„å†…å®¹ã€‚ è¿™ä¸‰æ£µæ ‘çš„é€»è¾‘ç»“æ„éƒ½æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åªæœ‰å„è‡ªçš„å±æ€§ã€‚ ###10. å¦‚ä½•é«˜æ€§èƒ½çš„ç»™UIImageViewåŠ ä¸ªåœ†è§’ï¼Ÿï¼ˆä¸å‡†è¯´layer.cornerRadius!ï¼‰ æˆ‘è§‰å¾—åº”è¯¥æ˜¯ä½¿ç”¨Quartz2Dç›´æ¥ç»˜åˆ¶å›¾ç‰‡,å¾—æŠŠè¿™ä¸ªçœ‹çœ‹ã€‚æ­¥éª¤ï¼š aã€åˆ›å»ºç›®æ ‡å¤§å°(cropWidthï¼ŒcropHeight)çš„ç”»å¸ƒã€‚ bã€ä½¿ç”¨UIImageçš„drawInRectæ–¹æ³•è¿›è¡Œç»˜åˆ¶çš„æ—¶å€™ï¼ŒæŒ‡å®šrectä¸º(-xï¼Œ-yï¼Œwidthï¼Œheight)ã€‚ cã€ä»ç”»å¸ƒä¸­å¾—åˆ°è£å‰ªåçš„å›¾åƒã€‚1234567891011121314151617- (UIImage*)cropImageWithRect:(CGRect)cropRect&#123; CGRect drawRect = CGRectMake(-cropRect.origin.x , -cropRect.origin.y, self.size.width * self.scale, self.size.height * self.scale); UIGraphicsBeginImageContext(cropRect.size); CGContextRef context = UIGraphicsGetCurrentContext(); CGContextClearRect(context, CGRectMake(0, 0, cropRect.size.width, cropRect.size.height)); [self drawInRect:drawRect]; UIImage *image = UIGraphicsGetImageFromCurrentImageContext(); UIGraphicsEndImageContext(); return image;&#125;@end ###11. ä½¿ç”¨drawRectæœ‰ä»€ä¹ˆå½±å“ï¼Ÿï¼ˆè¿™ä¸ªå¯æ·±å¯æµ…ï¼Œä½ è‡³å°‘å¾—ç”¨è¿‡ã€‚ã€‚ï¼‰drawRectæ–¹æ³•ä¾èµ–Core Graphicsæ¡†æ¶æ¥è¿›è¡Œè‡ªå®šä¹‰çš„ç»˜åˆ¶ï¼Œä½†è¿™ç§æ–¹æ³•ä¸»è¦çš„ç¼ºç‚¹å°±æ˜¯å®ƒå¤„ç†touchäº‹ä»¶çš„æ–¹å¼ï¼šæ¯æ¬¡æŒ‰é’®è¢«ç‚¹å‡»åï¼Œéƒ½ä¼šç”¨setNeddsDisplayè¿›è¡Œå¼ºåˆ¶é‡ç»˜ï¼›è€Œä¸”ä¸æ­¢ä¸€æ¬¡ï¼Œæ¯æ¬¡å•ç‚¹äº‹ä»¶è§¦å‘ä¸¤æ¬¡æ‰§è¡Œã€‚è¿™æ ·çš„è¯ä»æ€§èƒ½çš„è§’åº¦æ¥è¯´ï¼Œå¯¹CPUå’Œå†…å­˜æ¥è¯´éƒ½æ˜¯æ¬ ä½³çš„ã€‚ç‰¹åˆ«æ˜¯å¦‚æœåœ¨æˆ‘ä»¬çš„ç•Œé¢ä¸Šæœ‰å¤šä¸ªè¿™æ ·çš„UIButtonå®ä¾‹ã€‚ ###12. ASIHttpRequestæˆ–è€…SDWebImageé‡Œé¢ç»™UIImageViewåŠ è½½å›¾ç‰‡çš„é€»è¾‘æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿè¯¦è§SDWebImageçš„å®ç°æµç¨‹ http://www.cnblogs.com/6duxz/p/4159572.html ###13. éº»çƒ¦ä½ è®¾è®¡ä¸ªç®€å•çš„å›¾ç‰‡å†…å­˜ç¼“å­˜å™¨ï¼ˆç§»é™¤ç­–ç•¥æ˜¯ä¸€å®šè¦è¯´çš„ï¼‰å›¾ç‰‡çš„å†…å­˜ç¼“å­˜ï¼Œå¯ä»¥è€ƒè™‘å°†å›¾ç‰‡æ•°æ®ä¿å­˜åˆ°ä¸€ä¸ªæ•°æ®æ¨¡å‹ä¸­ã€‚æ‰€ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶è¿™ä¸ªæ¨¡å‹éƒ½å­˜åœ¨å†…å­˜ä¸­ã€‚ç§»é™¤ç­–ç•¥ï¼šé‡Šæ”¾æ•°æ®æ¨¡å‹å¯¹è±¡ã€‚ ###14. è®²è®²ä½ ç”¨Instrumentä¼˜åŒ–åŠ¨ç”»æ€§èƒ½çš„ç»å†å§ï¼ˆåˆ«é—®æˆ‘ä»€ä¹ˆæ˜¯Instrumentï¼‰å¯ä»¥å‚è€ƒiOS Appæ€§èƒ½ä¼˜åŒ– ###15. loadViewæ˜¯å¹²å˜›ç”¨çš„ï¼Ÿå½“ä½ è®¿é—®ä¸€ä¸ªViewControllerçš„viewå±æ€§æ—¶ï¼Œå¦‚æœæ­¤æ—¶viewçš„å€¼æ˜¯nilï¼Œé‚£ä¹ˆï¼ŒViewControllerå°±ä¼šè‡ªåŠ¨è°ƒç”¨loadViewè¿™ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å°±ä¼šåŠ è½½æˆ–è€…åˆ›å»ºä¸€ä¸ªviewå¯¹è±¡ï¼Œèµ‹å€¼ç»™viewå±æ€§ã€‚loadViewé»˜è®¤åšçš„äº‹æƒ…æ˜¯ï¼šå¦‚æœæ­¤ViewControllerå­˜åœ¨ä¸€ä¸ªå¯¹åº”çš„nibæ–‡ä»¶ï¼Œé‚£ä¹ˆå°±åŠ è½½è¿™ä¸ªnibã€‚å¦åˆ™ï¼Œå°±åˆ›å»ºä¸€ä¸ªUIViewå¯¹è±¡ã€‚ å¦‚æœä½ ç”¨Interface Builderæ¥åˆ›å»ºç•Œé¢ï¼Œé‚£ä¹ˆä¸åº”è¯¥é‡è½½è¿™ä¸ªæ–¹æ³•ã€‚ å¦‚æœä½ æƒ³è‡ªå·±åˆ›å»ºviewå¯¹è±¡ï¼Œé‚£ä¹ˆå¯ä»¥é‡è½½è¿™ä¸ªæ–¹æ³•ã€‚æ­¤æ—¶ä½ éœ€è¦è‡ªå·±ç»™viewå±æ€§èµ‹å€¼ã€‚ä½ è‡ªå®šä¹‰çš„æ–¹æ³•ä¸åº”è¯¥è°ƒç”¨superã€‚å¦‚æœä½ éœ€è¦å¯¹viewåšä¸€äº›å…¶ä»–çš„å®šåˆ¶æ“ä½œï¼Œåœ¨viewDidLoadé‡Œé¢å»åšã€‚ ========================================= æ ¹æ®ä¸Šé¢çš„æ–‡æ¡£å¯ä»¥çŸ¥é“ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š 1ã€å¦‚æœä½ ç”¨äº†nibæ–‡ä»¶ï¼Œé‡è½½è¿™ä¸ªæ–¹æ³•å°±æ²¡æœ‰å¤ªå¤§æ„ä¹‰ã€‚å› ä¸ºloadViewçš„ä½œç”¨å°±æ˜¯åŠ è½½nibã€‚å¦‚æœä½ é‡è½½äº†è¿™ä¸ªæ–¹æ³•ä¸è°ƒç”¨superï¼Œé‚£ä¹ˆnibæ–‡ä»¶å°±ä¸ä¼šè¢«åŠ è½½ã€‚å¦‚æœè°ƒç”¨äº†superï¼Œé‚£ä¹ˆviewå·²ç»åŠ è½½å®Œäº†ï¼Œä½ éœ€è¦åšçš„å…¶ä»–äº‹æƒ…åœ¨viewDidLoadé‡Œé¢åšæ›´åˆé€‚ã€‚ 2ã€å¦‚æœä½ æ²¡æœ‰ç”¨nibï¼Œè¿™ä¸ªæ–¹æ³•é»˜è®¤å°±æ˜¯åˆ›å»ºä¸€ä¸ªç©ºçš„viewå¯¹è±¡ã€‚å¦‚æœä½ æƒ³è‡ªå·±æ§åˆ¶viewå¯¹è±¡çš„åˆ›å»ºï¼Œä¾‹å¦‚åˆ›å»ºä¸€ä¸ªç‰¹æ®Šå°ºå¯¸çš„viewï¼Œé‚£ä¹ˆå¯ä»¥é‡è½½è¿™ä¸ªæ–¹æ³•ï¼Œè‡ªå·±åˆ›å»ºä¸€ä¸ªUIViewå¯¹è±¡ï¼Œç„¶åæŒ‡å®š self.view = myView; ä½†è¿™ç§æƒ…å†µä¹Ÿæ²¡æœ‰å¿…è¦è°ƒç”¨superï¼Œå› ä¸ºåæ­£ä½ ä¹Ÿä¸éœ€è¦åœ¨superæ–¹æ³•é‡Œé¢åˆ›å»ºçš„viewå¯¹è±¡ã€‚å¦‚æœè°ƒç”¨äº†superï¼Œé‚£ä¹ˆå°±æ˜¯æµªè´¹äº†ä¸€äº›èµ„æºè€Œå·²å‚è€ƒï¼šhttp://www.cnblogs.com/dyllove98/archive/2013/06/06/3123005.html ###16. viewWillLayoutSubViewä½ æ€»æ˜¯çŸ¥é“çš„ã€‚æ¨ªç«–å±åˆ‡æ¢çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šå“åº”ä¸€äº›å‡½æ•°ï¼Œå…¶ä¸­ viewWillLayoutSubviews å’Œ viewDidLayoutSubviewsã€‚ 1234567891011121314- (void)viewWillLayoutSubviews&#123; [self _shouldRotateToOrientation:(UIDeviceOrientation)[UIApplication sharedApplication].statusBarOrientation];&#125;- (void)_shouldRotateToOrientation:(UIDeviceOrientation)orientation &#123; if (orientation == UIDeviceOrientationPortrait ||orientation == UIDeviceOrientationPortraitUpsideDown) &#123; // ç«–å±&#125;else &#123; // æ¨ªå± &#125;&#125; é€šè¿‡ä¸Šè¿°ä¸€ä¸ªå‡½æ•°å°±çŸ¥é“æ¨ªç«–å±åˆ‡æ¢çš„æ¥å£äº†ã€‚æ³¨æ„ï¼šviewWillLayoutSubviewsåªèƒ½ç”¨åœ¨ViewControlleré‡Œé¢ï¼Œåœ¨viewé‡Œé¢æ²¡æœ‰å“åº”ã€‚ ###17. GCDé‡Œé¢æœ‰å“ªå‡ ç§Queueï¼Ÿä½ è‡ªå·±å»ºç«‹è¿‡ä¸²è¡Œqueueå—ï¼ŸèƒŒåçš„çº¿ç¨‹æ¨¡å‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ1.ä¸»é˜Ÿåˆ— dispatch_main_queue(); ä¸²è¡Œ ï¼Œæ›´æ–°UI2.å…¨å±€é˜Ÿåˆ— dispatch_global_queue(); å¹¶è¡Œï¼Œå››ä¸ªä¼˜å…ˆçº§ï¼šbackgroundï¼Œlowï¼Œdefaultï¼Œhigh3.è‡ªå®šä¹‰é˜Ÿåˆ— dispatch_queue_t queue ; å¯ä»¥è‡ªå®šä¹‰æ˜¯å¹¶è¡Œï¼šDISPATCH_QUEUE_CONCURRENTæˆ–è€…ä¸²è¡ŒDISPATCH_QUEUE_SERIAL ###18. ç”¨è¿‡coredataæˆ–è€…sqliteå—ï¼Ÿè¯»å†™æ˜¯åˆ†çº¿ç¨‹çš„å—ï¼Ÿé‡åˆ°è¿‡æ­»é”æ²¡ï¼Ÿå’‹è§£å†³çš„ï¼Ÿå‚è€ƒï¼šCoreDataä¸SQLiteçš„çº¿ç¨‹å®‰å…¨ ###19. httpçš„postå’Œgetå•¥åŒºåˆ«ï¼Ÿï¼ˆåŒºåˆ«æŒºå¤šçš„ï¼Œéº»çƒ¦å¤šè¯´ç‚¹ï¼‰1.GETè¯·æ±‚çš„æ•°æ®ä¼šé™„åœ¨URLä¹‹åï¼ˆå°±æ˜¯æŠŠæ•°æ®æ”¾ç½®åœ¨HTTPåè®®å¤´ä¸­ï¼‰ï¼Œä»¥?åˆ†å‰²URLå’Œä¼ è¾“æ•°æ®ï¼Œå‚æ•°ä¹‹é—´ä»¥&amp;ç›¸è¿ï¼Œå¦‚ï¼šlogin.action?name=hyddd&amp;password=idontknow&amp;verify=%E4%BD%A0%E5%A5%BDã€‚å¦‚æœæ•°æ®æ˜¯è‹±æ–‡å­—æ¯/æ•°å­—ï¼ŒåŸæ ·å‘é€ï¼Œå¦‚æœæ˜¯ç©ºæ ¼ï¼Œè½¬æ¢ä¸º+ï¼Œå¦‚æœæ˜¯ä¸­æ–‡/å…¶ä»–å­—ç¬¦ï¼Œåˆ™ç›´æ¥æŠŠå­—ç¬¦ä¸²ç”¨BASE64åŠ å¯†ï¼Œå¾—å‡ºå¦‚ï¼š%E4%BD%A0%E5%A5%BDï¼Œå…¶ä¸­ï¼…XXä¸­çš„XXä¸ºè¯¥ç¬¦å·ä»¥16è¿›åˆ¶è¡¨ç¤ºçš„ASCIIã€‚ POSTæŠŠæäº¤çš„æ•°æ®åˆ™æ”¾ç½®åœ¨æ˜¯HTTPåŒ…çš„åŒ…ä½“ä¸­ã€‚ 2.â€GETæ–¹å¼æäº¤çš„æ•°æ®æœ€å¤šåªèƒ½æ˜¯1024å­—èŠ‚ï¼Œç†è®ºä¸ŠPOSTæ²¡æœ‰é™åˆ¶ï¼Œå¯ä¼ è¾ƒå¤§é‡çš„æ•°æ®ï¼ŒIIS4ä¸­æœ€å¤§ä¸º80KBï¼ŒIIS5ä¸­ä¸º100KBâ€ï¼Ÿï¼Ÿï¼ ä»¥ä¸Šè¿™å¥æ˜¯æˆ‘ä»å…¶ä»–æ–‡ç« è½¬è¿‡æ¥çš„ï¼Œå…¶å®è¿™æ ·è¯´æ˜¯é”™è¯¯çš„ï¼Œä¸å‡†ç¡®çš„ï¼š (1).é¦–å…ˆæ˜¯â€GETæ–¹å¼æäº¤çš„æ•°æ®æœ€å¤šåªèƒ½æ˜¯1024å­—èŠ‚â€ï¼Œå› ä¸ºGETæ˜¯é€šè¿‡URLæäº¤æ•°æ®ï¼Œé‚£ä¹ˆGETå¯æäº¤çš„æ•°æ®é‡å°±è·ŸURLçš„é•¿åº¦æœ‰ç›´æ¥å…³ç³»äº†ã€‚è€Œå®é™…ä¸Šï¼ŒURLä¸å­˜åœ¨å‚æ•°ä¸Šé™çš„é—®é¢˜ï¼ŒHTTPåè®®è§„èŒƒæ²¡æœ‰å¯¹URLé•¿åº¦è¿›è¡Œé™åˆ¶ã€‚è¿™ä¸ªé™åˆ¶æ˜¯ç‰¹å®šçš„æµè§ˆå™¨åŠæœåŠ¡å™¨å¯¹å®ƒçš„é™åˆ¶ã€‚IEå¯¹URLé•¿åº¦çš„é™åˆ¶æ˜¯2083å­—èŠ‚(2K+35)ã€‚å¯¹äºå…¶ä»–æµè§ˆå™¨ï¼Œå¦‚Netscapeã€FireFoxç­‰ï¼Œç†è®ºä¸Šæ²¡æœ‰é•¿åº¦é™åˆ¶ï¼Œå…¶é™åˆ¶å–å†³äºæ“ä½œç³»ç»Ÿçš„æ”¯æŒã€‚ æ³¨æ„è¿™æ˜¯é™åˆ¶æ˜¯æ•´ä¸ªURLé•¿åº¦ï¼Œè€Œä¸ä»…ä»…æ˜¯ä½ çš„å‚æ•°å€¼æ•°æ®é•¿åº¦ã€‚[è§å‚è€ƒèµ„æ–™5] (2).ç†è®ºä¸Šè®²ï¼ŒPOSTæ˜¯æ²¡æœ‰å¤§å°é™åˆ¶çš„ï¼ŒHTTPåè®®è§„èŒƒä¹Ÿæ²¡æœ‰è¿›è¡Œå¤§å°é™åˆ¶ï¼Œè¯´â€œPOSTæ•°æ®é‡å­˜åœ¨80K/100Kçš„å¤§å°é™åˆ¶â€æ˜¯ä¸å‡†ç¡®çš„ï¼ŒPOSTæ•°æ®æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼Œèµ·é™åˆ¶ä½œç”¨çš„æ˜¯æœåŠ¡å™¨çš„å¤„ç†ç¨‹åºçš„å¤„ç†èƒ½åŠ›ã€‚ 3.åœ¨ASPä¸­ï¼ŒæœåŠ¡ç«¯è·å–GETè¯·æ±‚å‚æ•°ç”¨Request.QueryStringï¼Œè·å–POSTè¯·æ±‚å‚æ•°ç”¨Request.Formã€‚åœ¨JSPä¸­ï¼Œç”¨request.getParameter(\\â€XXXX\\â€)æ¥è·å–ï¼Œè™½ç„¶jspä¸­ä¹Ÿæœ‰request.getQueryString()æ–¹æ³•ï¼Œä½†ä½¿ç”¨èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œæ¯”å¦‚ï¼šä¼ ä¸€ä¸ªtest.jsp?name=hyddd&amp;password=hydddï¼Œç”¨request.getQueryString()å¾—åˆ°çš„æ˜¯ï¼šname=hyddd&amp;password=hydddã€‚åœ¨PHPä¸­ï¼Œå¯ä»¥ç”¨$_GETå’Œ$_POSTåˆ†åˆ«è·å–GETå’ŒPOSTä¸­çš„æ•°æ®ï¼Œè€Œ$_REQUESTåˆ™å¯ä»¥è·å–GETå’ŒPOSTä¸¤ç§è¯·æ±‚ä¸­çš„æ•°æ®ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒJSPä¸­ä½¿ç”¨requestå’ŒPHPä¸­ä½¿ç”¨$_REQUESTéƒ½ä¼šæœ‰éšæ‚£ï¼Œè¿™ä¸ªä¸‹æ¬¡å†å†™ä¸ªæ–‡ç« æ€»ç»“ã€‚ 4.POSTçš„å®‰å…¨æ€§è¦æ¯”GETçš„å®‰å…¨æ€§é«˜ã€‚æ³¨æ„ï¼šè¿™é‡Œæ‰€è¯´çš„å®‰å…¨æ€§å’Œä¸Šé¢GETæåˆ°çš„â€œå®‰å…¨â€ä¸æ˜¯åŒä¸ªæ¦‚å¿µã€‚ä¸Šé¢â€œå®‰å…¨â€çš„å«ä¹‰ä»…ä»…æ˜¯ä¸ä½œæ•°æ®ä¿®æ”¹ï¼Œè€Œè¿™é‡Œå®‰å…¨çš„å«ä¹‰æ˜¯çœŸæ­£çš„Securityçš„å«ä¹‰ï¼Œæ¯”å¦‚ï¼šé€šè¿‡GETæäº¤æ•°æ®ï¼Œç”¨æˆ·åå’Œå¯†ç å°†æ˜æ–‡å‡ºç°åœ¨URLä¸Šï¼Œå› ä¸º(1)ç™»å½•é¡µé¢æœ‰å¯èƒ½è¢«æµè§ˆå™¨ç¼“å­˜ï¼Œ(2)å…¶ä»–äººæŸ¥çœ‹æµè§ˆå™¨çš„å†å²çºªå½•ï¼Œé‚£ä¹ˆåˆ«äººå°±å¯ä»¥æ‹¿åˆ°ä½ çš„è´¦å·å’Œå¯†ç äº†ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨GETæäº¤æ•°æ®è¿˜å¯èƒ½ä¼šé€ æˆCross-site request forgeryæ”»å‡»ã€‚ æ€»ç»“ä¸€ä¸‹ï¼ŒGetæ˜¯å‘æœåŠ¡å™¨å‘ç´¢å–æ•°æ®çš„ä¸€ç§è¯·æ±‚ï¼Œè€ŒPostæ˜¯å‘æœåŠ¡å™¨æäº¤æ•°æ®çš„ä¸€ç§è¯·æ±‚ï¼Œåœ¨FORMï¼ˆè¡¨å•ï¼‰ä¸­ï¼ŒMethodé»˜è®¤ä¸ºâ€GETâ€ï¼Œå®è´¨ä¸Šï¼ŒGETå’ŒPOSTåªæ˜¯å‘é€æœºåˆ¶ä¸åŒï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå–ä¸€ä¸ªå‘ï¼ ###20. æˆ‘çŸ¥é“ä½ å¤§å­¦æ¯•ä¸šè¿‡åå°±æ²¡æ¥è§¦è¿‡ç®—æ³•æ•°æ®ç»“æ„äº†ï¼Œä½†æ˜¯è¯·ä½ ä¸€å®šå‘Šè¯‰æˆ‘ä»€ä¹ˆæ˜¯Binary search tree? searchçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼ŸBinary search tree:äºŒå‰æœç´¢æ ‘ã€‚ä¸»è¦ç”±å››ä¸ªæ–¹æ³•ï¼šï¼ˆç”¨Cè¯­è¨€å®ç°æˆ–è€…Pythonï¼‰1.searchï¼šæ—¶é—´å¤æ‚åº¦ä¸ºO(h)ï¼Œhä¸ºæ ‘çš„é«˜åº¦ 2.traversalï¼šæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œnä¸ºæ ‘çš„æ€»ç»“ç‚¹æ•°ã€‚ 3.insertï¼šæ—¶é—´å¤æ‚åº¦ä¸ºO(h)ï¼Œhä¸ºæ ‘çš„é«˜åº¦ã€‚ 4.deleteï¼šæœ€åæƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(h)+æŒ‡é’ˆçš„ç§»åŠ¨å¼€é”€ã€‚ å¯ä»¥çœ‹åˆ°ï¼ŒäºŒå‰æœç´¢æ ‘çš„dictionary operationçš„æ—¶é—´å¤æ‚åº¦ä¸æ ‘çš„é«˜åº¦hç›¸å…³ã€‚æ‰€ä»¥éœ€è¦å°½å¯èƒ½çš„é™ä½æ ‘çš„é«˜åº¦ï¼Œç”±æ­¤å¼•å‡ºå¹³è¡¡äºŒå‰æ ‘Balanced binary treeã€‚å®ƒè¦æ±‚å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ã€‚è¿™æ ·å°±å¯ä»¥å°†æœç´¢æ ‘çš„é«˜åº¦å°½é‡å‡å°ã€‚å¸¸ç”¨ç®—æ³•æœ‰çº¢é»‘æ ‘ã€AVLã€Treapã€ä¼¸å±•æ ‘ç­‰ã€‚","link":"/2017/09/15/çŸ¥ä¹ä¸ŠæŸäººçš„iOSé¢è¯•é¢˜/"},{"title":"ä¸€èµ·å”±ï¼Œå›¢ç»“å°±æ˜¯åŠ›é‡","text":"ä¸¤ä¸ªäººæ¥åˆ°æ²³è¾¹ï¼Œæƒ³è¦æ¸¡æ²³ï¼Œäºæ˜¯åŒä¹˜ä¸€æ¡èˆ¹ã€‚ä¸€äººèˆ¹å°¾ï¼Œä¸€äººèˆ¹è‰ï¼Œå„è‡ªæ‹¿èµ·ä¸€å¯¹æ¡¨å¥‹åŠ›åœ°åˆ’ç€ã€‚å¯æ˜¯è¿‡äº†è€åŠå¤©ä¹Ÿä¸è§å°èˆ¹é©¶å‘å¯¹å²¸ï¼Œä¸¤äººè½¬å¤´ä¸€çœ‹ï¼ŒåŸæ¥å„è‡ªæŠŠè‡ªå·±çš„ä½ç½®å½“æˆèˆ¹è‰äº†ï¼Œæœç€ç›¸åçš„æ–¹å‘åˆ’å»äº†ã€‚ä»–ä»¬äº’ç›¸æŒ‡è´£å¯¹æ–¹çš„è¿‡å¤±ï¼Œåˆ°äº†å¤ªé˜³è½å±±ä¾ç„¶è¿˜åœç•™åœ¨åŸåœ°ã€‚","link":"/2016/11/18/ä¸€èµ·å”±ï¼Œå›¢ç»“å°±æ˜¯åŠ›é‡/"},{"title":"è…¾è®¯SNGæŸéƒ¨é—¨iOSé¢è¯•ç»å†","text":"è…¾è®¯SNGé¢è¯•ï¼Œç®—æ˜¯ç§¯æ”’ä¸€æ¬¡é¢è¯•ç»éªŒäº†ã€‚å¯ä»¥çœ‹å‡ºï¼Œé«˜çº§å·¥ç¨‹å¸ˆä¸ä»…è¦ä¼šç”¨ä¸€äº›å¸¸ç”¨åº“ï¼Œè¿˜è¦æ‡‚å¾—å®ƒä»¬çš„åŸç†ã€‚ 1.APPæ€§èƒ½ä¼˜åŒ–ï¼šå†…å­˜æ³„éœ²æ£€æµ‹ã€å¡é¡¿æ£€æµ‹,è‡ªå·±åšåº”è¯¥æ€ä¹ˆåšï¼Ÿå†…å­˜æ³„éœ²æ£€æµ‹ï¼š 1. Instrumentså·¥å…·ï¼šLeaksï¼ŒAllocation. 2. MLeakFinderå·¥å…·ã€‚MLeaksFinderï¼šç²¾å‡† iOS å†…å­˜æ³„éœ²æ£€æµ‹å·¥å…·iOSå†…å­˜æ³„æ¼è‡ªåŠ¨æ£€æµ‹å·¥å…·PLeakSnifferå¡é¡¿æ£€æµ‹ï¼š 1. å¼€å‘é˜¶æ®µå¯ä»¥ç”¨CADisplayLinkï¼Œæ·»åŠ åˆ°runloopä¸­. 2. çº¿ä¸Šç›‘æµ‹ï¼Œé™¤äº†ç”¨ç¬¬ä¸‰æ–¹SDKä¹‹å¤–ï¼Œå¯ä»¥ä½¿ç”¨ â€œåœ¨å­çº¿ç¨‹æ·»åŠ observerç›‘æµ‹ä¸»çº¿ç¨‹â€çš„æ–¹å¼.å¾®ä¿¡è¯»ä¹¦ iOS æ€§èƒ½ä¼˜åŒ–æ€»ç»“å¡é¡¿æ£€æµ‹çš„å®ç°ä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼šæ£€æµ‹iOSçš„APPæ€§èƒ½çš„ä¸€äº›æ–¹æ³•å¼€æºå·¥å…·ï¼š- FBRetainCycleDetector- MLeaksFinder- PLCrashreporter2.AsycDisplayKit åŸç†ã€‚ AsyncDisplayKitæ˜¯ Facebook æ¨å‡ºçš„ç”¨äºä¿æŒç•Œé¢æµç•…æ€§çš„æ¡†æ¶ï¼Œå…¶åŸç†å¤§è‡´å¦‚ä¸‹ï¼šUI çº¿ç¨‹ä¸­ä¸€æ—¦å‡ºç°ç¹é‡çš„ä»»åŠ¡å°±ä¼šå¯¼è‡´ç•Œé¢å¡é¡¿ï¼Œè¿™ç±»ä»»åŠ¡é€šå¸¸åˆ†ä¸º3ç±»ï¼šæ’ç‰ˆï¼Œç»˜åˆ¶ï¼ŒUIå¯¹è±¡æ“ä½œã€‚æ’ç‰ˆé€šå¸¸åŒ…æ‹¬è®¡ç®—è§†å›¾å¤§å°ã€è®¡ç®—æ–‡æœ¬é«˜åº¦ã€é‡æ–°è®¡ç®—å­å¼å›¾çš„æ’ç‰ˆç­‰æ“ä½œã€‚ ç»˜åˆ¶ä¸€èˆ¬æœ‰æ–‡æœ¬ç»˜åˆ¶ (ä¾‹å¦‚ CoreText)ã€å›¾ç‰‡ç»˜åˆ¶ (ä¾‹å¦‚é¢„å…ˆè§£å‹)ã€å…ƒç´ ç»˜åˆ¶ (Quartz)ç­‰æ“ä½œã€‚UIå¯¹è±¡æ“ä½œé€šå¸¸åŒ…æ‹¬ UIView/CALayer ç­‰ UI å¯¹è±¡çš„åˆ›å»ºã€è®¾ç½®å±æ€§å’Œé”€æ¯ã€‚ å…¶ä¸­å‰ä¸¤ç±»æ“ä½œå¯ä»¥é€šè¿‡å„ç§æ–¹æ³•æ‰”åˆ°åå°çº¿ç¨‹æ‰§è¡Œï¼Œè€Œæœ€åä¸€ç±»æ“ä½œåªèƒ½åœ¨ä¸»çº¿ç¨‹å®Œæˆï¼Œå¹¶ä¸”æœ‰æ—¶åé¢çš„æ“ä½œéœ€è¦ä¾èµ–å‰é¢æ“ä½œçš„ç»“æœ ï¼ˆä¾‹å¦‚TextViewåˆ›å»ºæ—¶å¯èƒ½éœ€è¦æå‰è®¡ç®—å‡ºæ–‡æœ¬çš„å¤§å°ï¼‰ã€‚ASDK æ‰€åšçš„ï¼Œå°±æ˜¯å°½é‡å°†èƒ½æ”¾å…¥åå°çš„ä»»åŠ¡æ”¾å…¥åå°ï¼Œä¸èƒ½çš„åˆ™å°½é‡æ¨è¿Ÿ (ä¾‹å¦‚è§†å›¾çš„åˆ›å»ºã€å±æ€§çš„è°ƒæ•´)ã€‚ä¸ºæ­¤ï¼ŒASDK åˆ›å»ºäº†ä¸€ä¸ªåä¸º ASDisplayNode çš„å¯¹è±¡ï¼Œå¹¶åœ¨å†…éƒ¨å°è£…äº† UIView/CALayerï¼Œå®ƒå…·æœ‰å’Œ UIView/CALayer ç›¸ä¼¼çš„å±æ€§ï¼Œä¾‹å¦‚ frameã€backgroundColorç­‰ã€‚æ‰€æœ‰è¿™äº›å±æ€§éƒ½å¯ä»¥åœ¨åå°çº¿ç¨‹æ›´æ”¹ï¼Œå¼€å‘è€…å¯ä»¥åªé€šè¿‡ Node æ¥æ“ä½œå…¶å†…éƒ¨çš„ UIView/CALayerï¼Œè¿™æ ·å°±å¯ä»¥å°†æ’ç‰ˆå’Œç»˜åˆ¶æ”¾å…¥äº†åå°çº¿ç¨‹ã€‚ä½†æ˜¯æ— è®ºæ€ä¹ˆæ“ä½œï¼Œè¿™äº›å±æ€§æ€»éœ€è¦åœ¨æŸä¸ªæ—¶åˆ»åŒæ­¥åˆ°ä¸»çº¿ç¨‹çš„ UIView/CALayer å»ã€‚ ASDK ä»¿ç…§ QuartzCore/UIKit æ¡†æ¶çš„æ¨¡å¼ï¼Œå®ç°äº†ä¸€å¥—ç±»ä¼¼çš„ç•Œé¢æ›´æ–°çš„æœºåˆ¶ï¼šå³åœ¨ä¸»çº¿ç¨‹çš„ RunLoop ä¸­æ·»åŠ ä¸€ä¸ª Observerï¼Œç›‘å¬äº† kCFRunLoopBeforeWaiting å’Œ kCFRunLoopExit äº‹ä»¶ï¼Œåœ¨æ”¶åˆ°å›è°ƒæ—¶ï¼Œéå†æ‰€æœ‰ä¹‹å‰æ”¾å…¥é˜Ÿåˆ—çš„å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œç„¶åä¸€ä¸€æ‰§è¡Œã€‚ å…·ä½“çš„ä»£ç å¯ä»¥çœ‹è¿™é‡Œï¼š_ASAsyncTransactionGroupã€‚ 3.Crash ï¼ŒBugæ”¶é›† SDKçš„åŸç†ï¼Œè‡ªå·±åšåº”è¯¥æ€ä¹ˆåšï¼Ÿ æ³¨å†ŒNSSetUncaughtExceptionHandlerï¼ŒåŒ…æ‹¬ä¸¤ç§ï¼š HandleException SignalHandler æ¼«è°ˆiOS Crashæ”¶é›†æ¡†æ¶ iOSå´©æºƒæ•è·ä»¥åŠæ”¶é›†åŸç† 4.Core animation åŠ¨ç”»ä¸UIViewåŠ¨ç”»çš„åŒºåˆ«,åŠ¨ç”»æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦å“åº”äº‹ä»¶ï¼Ÿ UIView animation ç”±CPUæ‰§è¡Œï¼ŒCore Animationç”±GPUæ‰§è¡Œã€‚ CALayeræœ¬èº«ä¸èƒ½å“åº”äº‹ä»¶ï¼ŒUIViewæ˜¯åœ¨CAlayerä¹‹ä¸Šï¼Œå¢åŠ äº†è§¦æ‘¸å“åº”,æ‰‹åŠ¿è¯†åˆ«ç­‰äº‹ä»¶å“åº”ã€‚ Core Animation is not executed on the CPU. Their commands are more offloaded to the GPU and used to create the graphics that are shown on the screen, powered by the GPU hardware. Core Graphics is entirely done on the CPU, and cannot be performed on the GPU. Because it is an entirely CPU-bound operation, it is sometimes slower on older devices (e.g. the iPad 2 or the iPad 3rd Generation). This is something you need to keep in mind when using it in your apps. But, the good thing about Core Graphics is you can combine it with Core Animation. Advanced Graphics with Core Animation Core Animation does the rest, handing most of the actual drawing work off to the onboard graphics hardware to accelerate the rendering. This automatic graphics acceleration results in high frame rates and smooth animations without burdening the CPU and slowing down your app. Core Animation Programming Guide åŠ¨ç”»æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦å“åº”äº‹ä»¶ï¼Ÿ12345678910111213- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; NSLog(@\"%s\",__func__); UITouch *touch = [touches anyObject]; CGPoint point = [touch locationInView:self.view]; if (CGRectContainsPoint(self.colorLayer.presentationLayer.frame, point)) &#123; [self startAnimation]; &#125; if (CGRectContainsPoint(self.myView.frame, point)) &#123; [self startUIViewAnimation:nil]; &#125;&#125; ç»è¿‡æµ‹è¯•ï¼ŒCALayeræ˜¯å¯ä»¥å“åº”touchäº‹ä»¶çš„,è€ŒUIViewçš„block animationåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸èƒ½å“åº”å…¶è‡ªèº«çš„è§¦æ‘¸äº‹ä»¶ã€‚ æ³¨æ„CALayeråœ¨åŠ¨ç”»æ‰§è¡Œè¿‡ç¨‹ä¸­è¦æ˜¯ç”¨presentationLayerå±æ€§æ‰èƒ½è·å–åˆ°ä¸­é—´çŠ¶æ€çš„layerCore Animation çš„removedOnCompletion å±æ€§é»˜è®¤æ˜¯YESï¼Œå³åŠ¨ç”»ç»“æŸä¹‹åä¼šç§»é™¤åŠ¨ç”»ï¼ŒCALayerä¼šå›åˆ°åŸæ¥çš„çŠ¶æ€ å¯ä»¥æŸ¥çœ‹Core Animation Programming Guide çš„æ˜¾å¼åŠ¨ç”»ä¸€ç« ã€‚ å¦å¤–é™„ä¸€ç¯‡æœ‰æ„æ€çš„æ–‡ç«  UIDynamics, UIKit or OpenGL? 3 Types of iOS Animations for the Star Wars,å€¼å¾—ä¸€è¯»ã€‚ 5.Httpsæ¦‚å¿µï¼ŒiOSä¸­è®¾ç½®httpsã€‚ç•¥6.100Wæ•°æ®ä¸­æ‰¾åˆ°æœ€å¤§çš„1Wä¸ªæ•°ï¼Œä½¿ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„ï¼Ÿ æœ€å°å † å…ˆæ‹¿10000ä¸ªæ•°å»ºå †ï¼Œç„¶åä¸€æ¬¡æ·»åŠ å‰©ä½™å…ƒç´ ï¼Œå¦‚æœå¤§äºå †é¡¶çš„æ•°ï¼ˆ10000ä¸­æœ€å°çš„ï¼‰ï¼Œå°†è¿™ä¸ªæ•°æ›¿æ¢å †é¡¶ï¼Œå¹¶è°ƒæ•´ç»“æ„ä½¿ä¹‹ä»ç„¶æ˜¯ä¸€ä¸ªæœ€å°å †ï¼Œè¿™æ ·ï¼Œéå†å®Œåï¼Œå †ä¸­çš„10000ä¸ªæ•°å°±æ˜¯æ‰€éœ€çš„æœ€å¤§çš„10000ä¸ªã€‚å»ºå †æ—¶é—´å¤æ‚åº¦æ˜¯Oï¼ˆmlogmï¼‰ï¼Œç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºOï¼ˆnmlogmï¼‰ï¼ˆnä¸º10äº¿ï¼Œmä¸º10000ï¼‰ã€‚ ä¼˜åŒ–çš„æ–¹æ³•ï¼šå¯ä»¥æŠŠæ‰€æœ‰10äº¿ä¸ªæ•°æ®åˆ†ç»„å­˜æ”¾ï¼Œæ¯”å¦‚åˆ†åˆ«æ”¾åœ¨1000ä¸ªæ–‡ä»¶ä¸­ã€‚è¿™æ ·å¤„ç†å°±å¯ä»¥åˆ†åˆ«åœ¨æ¯ä¸ªæ–‡ä»¶çš„10^6ä¸ªæ•°æ®ä¸­æ‰¾å‡ºæœ€å¤§çš„10000ä¸ªæ•°ï¼Œåˆå¹¶åˆ°ä¸€èµ·åœ¨å†æ‰¾å‡ºæœ€ç»ˆçš„ç»“æœã€‚ æµ·é‡æ•°æ®å¤„ç† - 10äº¿ä¸ªæ•°ä¸­æ‰¾å‡ºæœ€å¤§çš„10000ä¸ªæ•°ï¼ˆtop Ké—®é¢˜ï¼‰ 7.éŸ³è§†é¢‘å¼€å‘ï¼Œæ²¡åšè¿‡ï¼Œç„¶åæåˆ°ç®€å†ä¸Šçš„äºŒç»´ç æ‰«æåº“ - AVFoundationã€‚å½±å“äºŒç»´ç æ‰«æé€Ÿåº¦çš„éš¾ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘å›ç­”æ˜¯äºŒç»´ç å›¾åƒçš„æ¸…æ™°åº¦ï¼Œé¢è¯•å®˜è¿˜æåˆ°äº†äºŒç»´ç å›¾åƒçš„è§’åº¦ï¼Œè¯¥å¦‚ä½•ä¼˜åŒ–ã€‚å¯¹äºAVFoundationæ¥è¯´ï¼Œæœ‰ä¸¤ä¸ªå› ç´ ï¼š1. å›¾åƒåˆ†è¾¨ç‡ AVCaptureSession å¯ä»¥è®¾ç½® sessionPreset å±æ€§ï¼Œè¿™ä¸ªå†³å®šäº†è§†é¢‘è¾“å…¥æ¯ä¸€å¸§å›¾åƒè´¨é‡çš„å¤§å°ã€‚ AVCaptureSessionPreset320x240 AVCaptureSessionPreset352x288 AVCaptureSessionPreset640x480 AVCaptureSessionPreset960x540 AVCaptureSessionPreset1280x720 AVCaptureSessionPreset1920x10802. æ‰«æèŒƒå›´ AVCaptureMetadataOutput çš„ rectOfInterest å±æ€§æ¥é…ç½®è§£æèŒƒå›´8.ç¦»å±æ¸²æŸ“é—®é¢˜çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ é¦–å…ˆç¦»å±æ¸²æŸ“æŒ‡çš„æ˜¯åœ¨GPUåœ¨å½“å‰å±å¹•ç¼“å†²åŒºä»¥å¤–å¼€è¾Ÿä¸€ä¸ªç¼“å†²åŒºè¿›è¡Œæ¸²æŸ“æ“ä½œ. å½“ä½¿ç”¨åœ†è§’ï¼Œé˜´å½±ï¼Œé®ç½©çš„æ—¶å€™ï¼Œå›¾å±‚å±æ€§çš„æ··åˆä½“è¢«æŒ‡å®šä¸ºåœ¨æœªé¢„åˆæˆä¹‹å‰(ä¸‹ä¸€ä¸ªHSyncä¿¡å·å¼€å§‹å‰)ä¸èƒ½ç›´æ¥åœ¨å±å¹•ä¸­ç»˜åˆ¶ï¼Œæ‰€ä»¥å°±éœ€è¦å±å¹•å¤–æ¸²æŸ“ã€‚ å…·ä½“å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šiOS-ç¦»å±æ¸²æŸ“è¯¦è§£ æ€»ç»“ï¼š æœ¬æ¬¡é¢è¯•é—®é¢˜ä¾§é‡äºå®é™…é¡¹ç›®ï¼Œå¾ˆå¤šä¸œè¥¿ä¹‹å‰æœ‰çœ‹è¿‡ï¼Œä½†éƒ½å¿˜äº†å¤§æ¦‚ï¼Œç”¨åˆ°ä½†æ²¡æœ‰æ·±å…¥ç ”ç©¶æ˜¯ä¸€å¤§åŠ£åŠ¿ã€‚ æ‰€ä»¥è¯´å¤šå¤šé¢è¯•è¿˜æ˜¯æœ‰å¸®åŠ©çš„ğŸ˜†ï¼ é¢è¯•å¿…çœ‹æ–‡ç« ï¼šiOS ä¿æŒç•Œé¢æµç•…çš„æŠ€å·§iOS åº”ç”¨ç¨³å®šæ€§ç›‘æµ‹å’ŒæŒ‡æ ‡é—®é¢˜ iOS æ€§èƒ½ç›‘æ§æ–¹æ¡ˆï¼ˆä¸Šç¯‡ï¼‰iOS æ€§èƒ½ç›‘æ§æ–¹æ¡ˆï¼ˆä¸‹ç¯‡ï¼‰","link":"/2017/09/05/è…¾è®¯SNGæŸéƒ¨é—¨iOSé¢è¯•ç»å†/"},{"title":"æ·±å…¥ç†è§£iOS Rendering Process","text":"å‰è¨€iOS æœ€æ—©åä¸º iPhone OSï¼Œæ˜¯Appleå…¬å¸ä¸“é—¨ä¸ºå…¶ç¡¬ä»¶è®¾å¤‡å¼€å‘çš„æ“ä½œç³»ç»Ÿï¼Œæœ€åˆäº 2007 å¹´éšç¬¬ä¸€ä»£ iPhone æ¨å‡ºï¼Œåæ‰©å±•ä¸ºæ”¯æŒ Apple å…¬å¸æ——ä¸‹çš„å…¶ä»–ç¡¬ä»¶è®¾å¤‡ï¼Œå¦‚ iPodã€iPad ç­‰ã€‚ä½œä¸ºä¸€å iOS Developerï¼Œç›¸ä¿¡å¤§å¤šæ•°äººéƒ½æœ‰å†™å‡ºè¿‡é€ æˆ iOS è®¾å¤‡å¡é¡¿çš„ä»£ç ç»å†ï¼Œç›¸åº”çš„ä¹Ÿæœ‰è¿‡æƒ³æ–¹è®¾æ³•ä¼˜åŒ–å¡é¡¿ä»£ç çš„ç»éªŒã€‚æœ¬æ–‡å°†ä» OpenGL çš„è§’åº¦ç»“åˆ Apple å®˜æ–¹ç»™å‡ºçš„éƒ¨åˆ†èµ„æ–™ï¼Œä»‹ç» iOS Rendering Process çš„æ¦‚å¿µåŠå…¶æ•´ä¸ªåº•å±‚æ¸²æŸ“ç®¡é“çš„å„ä¸ªæµç¨‹ã€‚ç›¸ä¿¡åœ¨ç†è§£äº† iOS Rendering Process çš„åº•å±‚å„ä¸ªé˜¶æ®µä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¹³æ—¥çš„å¼€å‘å·¥ä½œä¹‹ä¸­å†™å‡ºæ€§èƒ½æ›´é«˜çš„ä»£ç ï¼Œåœ¨è§£å†³å¸§ç‡ä¸è¶³çš„æ˜¾ç¤ºå¡é¡¿é—®é¢˜æ—¶ä¹Ÿå¯ä»¥å¤šä¸€äº›æ€è·¯~ ç´¢å¼•iOS Rendering Process æ¦‚å¿µiOS Rendering æŠ€æœ¯æ¡†æ¶OpenGL ä¸»è¦æ¸²æŸ“æ­¥éª¤OpenGL Render PipelineCore Animation PipelineCommit TransactionAnimationå…¨æ–‡æ€»ç»“æ‰©å±•é˜…è¯» iOS Rendering Process æ¦‚å¿µiOS Rendering Process è¯‘ä¸º iOS æ¸²æŸ“æµç¨‹ï¼Œæœ¬æ–‡ç‰¹æŒ‡ iOS è®¾å¤‡ä»è®¾ç½®å°†è¦æ˜¾ç¤ºçš„å›¾å…ƒæ•°æ®åˆ°æœ€ç»ˆåœ¨è®¾å¤‡å±å¹•æˆåƒçš„æ•´ä¸ªè¿‡ç¨‹ã€‚åœ¨å¼€å§‹å‰–æ iOS Rendering Process ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ iOS çš„æ¸²æŸ“æ¦‚å¿µæœ‰ä¸€ä¸ªåŸºæœ¬çš„è®¤çŸ¥ï¼š åŸºäºå¹³é“ºçš„æ¸²æŸ“iOS è®¾å¤‡çš„å±å¹•åˆ†ä¸º N * N åƒç´ çš„å›¾å—ï¼Œæ¯ä¸ªå›¾å—éƒ½é€‚åˆäº SoC ç¼“å­˜ï¼Œå‡ ä½•ä½“åœ¨å›¾å—å†…è¢«å¤§é‡æ‹†åˆ†ï¼Œåªæœ‰åœ¨æ‰€æœ‰å‡ ä½•ä½“å…¨éƒ¨æäº¤ä¹‹åæ‰å¯ä»¥è¿›è¡Œå…‰æ …åŒ–ï¼ˆRasterizationï¼‰ã€‚Note: è¿™é‡Œçš„å…‰æ …åŒ–æŒ‡å°†å±å¹•ä¸Šé¢è¢«å¤§é‡æ‹†åˆ†å‡ºæ¥çš„å‡ ä½•ä½“æ¸²æŸ“ä¸ºåƒç´ ç‚¹çš„è¿‡ç¨‹ã€‚ iOS Rendering æŠ€æœ¯æ¡†æ¶äº‹å®ä¸Š iOS æ¸²æŸ“ç›¸å…³çš„å±‚çº§åˆ’åˆ†å¤§æ¦‚å¦‚ä¸‹ï¼š UIKitå˜›~ ä½œä¸ºä¸€å iOS Developer æ¥è¯´ï¼Œåº”è¯¥å¯¹ UIKit éƒ½ä¸é™Œç”Ÿï¼Œæˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨çš„ç”¨æˆ·äº¤äº’ç»„ä»¶éƒ½æ¥è‡ªäº UIKit Frameworkï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½® UIKit ç»„ä»¶çš„ Layout ä»¥åŠ BackgroundColor ç­‰å±æ€§æ¥å®Œæˆæ—¥å¸¸çš„ç•Œé¢ç»˜ç”»å·¥ä½œã€‚å…¶å® UIKit Framework è‡ªèº«å¹¶ä¸å…·å¤‡åœ¨å±å¹•æˆåƒçš„èƒ½åŠ›ï¼Œå®ƒä¸»è¦è´Ÿè´£å¯¹ç”¨æˆ·æ“ä½œäº‹ä»¶çš„å“åº”ï¼Œäº‹ä»¶å“åº”çš„ä¼ é€’å¤§ä½“æ˜¯ç»è¿‡é€å±‚çš„è§†å›¾æ ‘éå†å®ç°çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬æ—¥å¸¸å†™çš„ UIKit ç»„ä»¶ä¸ºä»€ä¹ˆå¯ä»¥å‘ˆç°åœ¨ iOS è®¾å¤‡çš„å±å¹•ä¸Šå‘¢ï¼Ÿ Core AnimationCore Animation å…¶å®æ˜¯ä¸€ä¸ªä»¤äººè¯¯è§£çš„å‘½åã€‚ä½ å¯èƒ½è®¤ä¸ºå®ƒåªæ˜¯ç”¨æ¥åšåŠ¨ç”»çš„ï¼Œä½†å®é™…ä¸Šå®ƒæ˜¯ä»ä¸€ä¸ªå«åšLayer Kitè¿™ä¹ˆä¸€ä¸ªä¸æ€ä¹ˆå’ŒåŠ¨ç”»æœ‰å…³çš„åå­—æ¼”å˜è€Œæ¥çš„ï¼Œæ‰€ä»¥åšåŠ¨ç”»ä»…ä»…æ˜¯ Core Animation ç‰¹æ€§çš„å†°å±±ä¸€è§’ã€‚Core Animation æœ¬è´¨ä¸Šå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå¤åˆå¼•æ“ï¼Œæ—¨åœ¨å°½å¯èƒ½å¿«çš„ç»„åˆå±å¹•ä¸Šä¸åŒçš„æ˜¾ç¤ºå†…å®¹ã€‚è¿™äº›æ˜¾ç¤ºå†…å®¹è¢«åˆ†è§£æˆç‹¬ç«‹çš„å›¾å±‚ï¼Œå³ CALayerï¼ŒCALayer æ‰æ˜¯ä½ æ‰€èƒ½åœ¨å±å¹•ä¸Šçœ‹è§çš„ä¸€åˆ‡çš„åŸºç¡€ã€‚å…¶å®å¾ˆå¤šåŒå­¦éƒ½åº”è¯¥çŸ¥é“ CALayerï¼ŒUIKit ä¸­éœ€è¦åœ¨å±å¹•å‘ˆç°çš„ç»„ä»¶å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ CALayerï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ Backing Layerã€‚æ­£æ˜¯å› ä¸ºä¸€ä¸€å¯¹åº”ï¼Œæ‰€ä»¥ CALayer ä¹Ÿæ˜¯æ ‘å½¢ç»“æ„çš„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå›¾å±‚æ ‘ã€‚è§†å›¾çš„èŒè´£å°±æ˜¯åˆ›å»ºå¹¶ç®¡ç†è¿™ä¸ªå›¾å±‚ï¼Œä»¥ç¡®ä¿å½“å­è§†å›¾åœ¨å±‚çº§å…³ç³»ä¸­æ·»åŠ æˆ–è€…è¢«ç§»é™¤çš„æ—¶å€™ï¼Œä»–ä»¬å…³è”çš„å›¾å±‚ä¹ŸåŒæ ·å¯¹åº”åœ¨å±‚çº§å…³ç³»æ ‘å½“ä¸­æœ‰ç›¸åŒçš„æ“ä½œã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆ iOS è¦åŸºäº UIView å’Œ CALayer æä¾›ä¸¤ä¸ªå¹³è¡Œçš„å±‚çº§å…³ç³»å‘¢ï¼Ÿä¸ºä»€ä¹ˆä¸ç”¨ä¸€ä¸ªç®€å•çš„å±‚çº§å…³ç³»æ¥å¤„ç†æ‰€æœ‰äº‹æƒ…å‘¢ï¼ŸåŸå› åœ¨äºè¦åšèŒè´£åˆ†ç¦»ï¼Œè¿™æ ·ä¹Ÿèƒ½é¿å…å¾ˆå¤šé‡å¤ä»£ç ã€‚åœ¨ iOS å’Œ Mac OS X ä¸¤ä¸ªå¹³å°ä¸Šï¼Œäº‹ä»¶å’Œç”¨æˆ·äº¤äº’æœ‰å¾ˆå¤šåœ°æ–¹çš„ä¸åŒï¼ŒåŸºäºå¤šç‚¹è§¦æ§çš„ç”¨æˆ·ç•Œé¢å’ŒåŸºäºé¼ æ ‡é”®ç›˜çš„äº¤äº’æœ‰ç€æœ¬è´¨çš„åŒºåˆ«ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ iOS æœ‰ UIKit å’Œ UIViewï¼Œè€Œ Mac OS X æœ‰ AppKit å’Œ NSView çš„åŸå› ã€‚ä»–ä»¬åŠŸèƒ½ä¸Šå¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯åœ¨å®ç°ä¸Šæœ‰ç€æ˜¾è‘—çš„åŒºåˆ«ã€‚Note: å®é™…ä¸Šï¼Œè¿™é‡Œå¹¶ä¸æ˜¯ä¸¤ä¸ªå±‚çº§å…³ç³»ï¼Œè€Œæ˜¯å››ä¸ªï¼Œæ¯ä¸€ä¸ªéƒ½æ‰®æ¼”ä¸åŒçš„è§’è‰²ï¼Œé™¤äº†è§†å›¾æ ‘å’Œå›¾å±‚æ ‘ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨å‘ˆç°æ ‘å’Œæ¸²æŸ“æ ‘ã€‚ OpenGL ES &amp; Core Graphics OpenGL ESOpenGL ESç®€ç§° GLESï¼Œå³ OpenGL for Embedded Systemsï¼Œæ˜¯ OpenGL çš„å­é›†ï¼Œé€šå¸¸é¢å‘å›¾å½¢ç¡¬ä»¶åŠ é€Ÿå¤„ç†å•å…ƒï¼ˆGPUï¼‰æ¸²æŸ“ 2D å’Œ 3D è®¡ç®—æœºå›¾å½¢ï¼Œä¾‹å¦‚è§†é¢‘æ¸¸æˆä½¿ç”¨çš„è®¡ç®—æœºå›¾å½¢ã€‚OpenGL ES ä¸“ä¸ºæ™ºèƒ½æ‰‹æœºï¼Œå¹³æ¿ç”µè„‘ï¼Œè§†é¢‘æ¸¸æˆæœºå’Œ PDA ç­‰åµŒå…¥å¼ç³»ç»Ÿè€Œè®¾è®¡ ã€‚OpenGL ES æ˜¯â€œå†å²ä¸Šåº”ç”¨æœ€å¹¿æ³›çš„ 3D å›¾å½¢ APIâ€ã€‚ Core GraphicsCore GraphicsFramework åŸºäº Quartz é«˜çº§ç»˜å›¾å¼•æ“ã€‚å®ƒæä¾›äº†å…·æœ‰æ— ä¸ä¼¦æ¯”çš„è¾“å‡ºä¿çœŸåº¦çš„ä½çº§åˆ«è½»é‡çº§ 2D æ¸²æŸ“ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤æ¡†æ¶æ¥å¤„ç†åŸºäºè·¯å¾„çš„ç»˜å›¾ï¼Œè½¬æ¢ï¼Œé¢œè‰²ç®¡ç†ï¼Œç¦»å±æ¸²æŸ“ï¼Œå›¾æ¡ˆï¼Œæ¸å˜å’Œé˜´å½±ï¼Œå›¾åƒæ•°æ®ç®¡ç†ï¼Œå›¾åƒåˆ›å»ºå’Œå›¾åƒé®ç½©ä»¥åŠ PDF æ–‡æ¡£åˆ›å»ºï¼Œæ˜¾ç¤ºå’Œåˆ†æã€‚Note: åœ¨ Mac OS X ä¸­ï¼ŒCore Graphics è¿˜åŒ…æ‹¬ç”¨äºå¤„ç†æ˜¾ç¤ºç¡¬ä»¶ï¼Œä½çº§ç”¨æˆ·è¾“å…¥äº‹ä»¶å’Œçª—å£ç³»ç»Ÿçš„æœåŠ¡ã€‚ Graphics HardwareGraphics Hardwareè¯‘ä¸ºå›¾å½¢ç¡¬ä»¶ï¼ŒiOS è®¾å¤‡ä¸­ä¹Ÿæœ‰è‡ªå·±çš„å›¾å½¢ç¡¬ä»¶è®¾å¤‡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸æåŠçš„ GPUã€‚å›¾å½¢å¤„ç†å•å…ƒï¼ˆGPUï¼‰æ˜¯ä¸€ç§ä¸“ç”¨ç”µå­ç”µè·¯ï¼Œæ—¨åœ¨å¿«é€Ÿæ“ä½œå’Œæ”¹å˜å­˜å‚¨å™¨ï¼Œä»¥åŠ é€Ÿåœ¨ç”¨äºè¾“å‡ºåˆ°æ˜¾ç¤ºè®¾å¤‡çš„å¸§ç¼“å†²å™¨ä¸­åˆ›å»ºå›¾åƒã€‚GPU è¢«ç”¨äºåµŒå…¥å¼ç³»ç»Ÿï¼Œæ‰‹æœºï¼Œä¸ªäººç”µè„‘ï¼Œå·¥ä½œç«™å’Œæ¸¸æˆæ§åˆ¶å°ã€‚ç°ä»£ GPU åœ¨å¤„ç†è®¡ç®—æœºå›¾å½¢å’Œå›¾åƒæ–¹é¢éå¸¸é«˜æ•ˆï¼Œå¹¶ä¸” GPU çš„é«˜åº¦å¹¶è¡Œç»“æ„ä½¿å…¶åœ¨å¤§å—æ•°æ®å¹¶è¡Œå¤„ç†çš„ç®—æ³•ä¸­æ¯”é€šç”¨ CPU æ›´æœ‰æ•ˆã€‚ OpenGL ä¸»è¦æ¸²æŸ“æ­¥éª¤OpenGLå…¨ç§° Open Graphics Libraryï¼Œè¯‘ä¸ºå¼€æ”¾å›¾å½¢åº“ï¼Œæ˜¯ç”¨äºæ¸²æŸ“ 2D å’Œ 3D çŸ¢é‡å›¾å½¢çš„è·¨è¯­è¨€ï¼Œè·¨å¹³å°çš„åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰ã€‚OpenGL å¯ä»¥ç›´æ¥è®¿é—® GPUï¼Œä»¥å®ç°ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“ã€‚ ä¸€ä¸ªç”¨æ¥æ¸²æŸ“å›¾åƒçš„ OpenGL ç¨‹åºä¸»è¦å¯ä»¥å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼šè®¾ç½®å›¾å…ƒæ•°æ®ç€è‰²å™¨-shader è®¡ç®—å›¾å…ƒæ•°æ®ï¼ˆä½ç½®Â·é¢œè‰²Â·å…¶ä»–ï¼‰å…‰æ …åŒ–-rasterization æ¸²æŸ“ä¸ºåƒç´ fragment shaderï¼Œå†³å®šæœ€ç»ˆæˆåƒå…¶ä»–æ“ä½œï¼ˆæ˜¾ç¤ºÂ·éšè—Â·èåˆï¼‰Note: å…¶å®è¿˜æœ‰ä¸€äº›éå¿…è¦çš„æ­¥éª¤ï¼Œä¸æœ¬æ–‡ä¸»é¢˜ä¸ç›¸å…³ï¼Œè¿™é‡Œç‚¹åˆ°ä¸ºæ­¢ã€‚æˆ‘ä»¬æ—¥å¸¸å¼€å‘æ—¶ä½¿ç”¨ UIKit å¸ƒå±€è§†å›¾æ§ä»¶ï¼Œè®¾ç½®é€æ˜åº¦ç­‰ç­‰éƒ½å±äºè®¾ç½®å›¾å…ƒæ•°æ®è¿™æ­¥ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­å¯ä»¥å½±å“ OpenGL æ¸²æŸ“çš„ä¸»è¦æ­¥éª¤ã€‚ OpenGL Render Pipelineå¦‚æœæœ‰åŒå­¦çœ‹è¿‡ WWDC çš„ä¸€äº›æ¼”è®²ç¨¿æˆ–è€…æ¥è§¦è¿‡ä¸€äº› OpenGL çŸ¥è¯†ï¼Œåº”è¯¥å¯¹ Render Pipeline è¿™ä¸ªä¸“ä¸šæœ¯è¯­å¹¶ä¸é™Œç”Ÿã€‚ä¸è¿‡ Render Pipeline å®åœ¨æ˜¯ä¸€ä¸ªåˆæ¬¡è§é¢ä¸å¤ªå®¹æ˜“ç†è§£çš„è¯ï¼Œå®ƒè¯‘ä¸ºæ¸²æŸ“ç®¡é“ï¼Œä¹Ÿæœ‰è¯‘ä¸ºæ¸²æŸ“ç®¡çº¿çš„â€¦å…¶å® Render Pipeline æŒ‡çš„æ˜¯ä»åº”ç”¨ç¨‹åºæ•°æ®è½¬æ¢åˆ°æœ€ç»ˆæ¸²æŸ“çš„å›¾åƒä¹‹é—´çš„ä¸€ç³»åˆ—æ•°æ®å¤„ç†è¿‡ç¨‹ã€‚å¥½æ¯”æˆ‘ä»¬ä¸Šæ–‡ä¸­æåˆ°çš„ OpenGL ä¸»è¦æ¸²æŸ“æ­¥éª¤ä¸€æ ·ï¼Œæˆ‘ä»¬å¼€å‘åº”ç”¨ç¨‹åºæ—¶åœ¨è®¾ç½®å›¾å…ƒæ•°æ®è¿™æ­¥ä¸ºè§†å›¾æ§ä»¶çš„è®¾å®šå¸ƒå±€ï¼ŒèƒŒæ™¯é¢œè‰²ï¼Œé€æ˜åº¦ä»¥åŠé˜´å½±ç­‰ç­‰æ•°æ®ã€‚ä¸‹é¢ä»¥ OpenGL 4.5 çš„ Render Pipeline ä¸ºä¾‹ä»‹ç»ä¸€ä¸‹ï¼šè¿™äº›å›¾å…ƒæ•°æ®æµå…¥ OpenGL ä¸­ï¼Œä¼ å…¥é¡¶ç‚¹ç€è‰²å™¨ï¼ˆvetex shaderï¼‰ï¼Œç„¶åé¡¶ç‚¹ç€è‰²å™¨å¯¹å…¶è¿›è¡Œç€è‰²å™¨å†…éƒ¨çš„å¤„ç†åæµå‡ºã€‚ä¹‹åå¯èƒ½è¿›å…¥ç»†åˆ†ç€è‰²é˜¶æ®µï¼ˆtessellation shading stageï¼‰ï¼Œå…¶ä¸­åˆæœ‰å¯èƒ½åˆ†ä¸ºç»†åˆ†æ§åˆ¶ç€è‰²å™¨å’Œç»†åˆ†èµ‹å€¼ç€è‰²å™¨ä¸¤éƒ¨åˆ†å¤„ç†ï¼Œè¿˜å¯èƒ½ä¼šè¿›å…¥å‡ ä½•ç€è‰²é˜¶æ®µï¼ˆgeometry shading stageï¼‰ï¼Œæ•°æ®ä»ä¸­ä¼ é€’ã€‚æœ€åéƒ½ä¼šèµ°ç‰‡å…ƒç€è‰²é˜¶æ®µï¼ˆfragment shading stageï¼‰ã€‚Note: å›¾å…ƒæ•°æ®æ˜¯ä»¥ copy çš„å½¢å¼æµå…¥ shader çš„ï¼Œshader ä¸€èˆ¬ä¼šä»¥ç‰¹æ®Šçš„ç±»ä¼¼å…¨å±€å˜é‡çš„å½¢å¼æ¥æ”¶æ•°æ®ã€‚OpenGL åœ¨æœ€ç»ˆæˆåƒä¹‹å‰è¿˜ä¼šç»å†ä¸€ä¸ªé˜¶æ®µåä¸ºè®¡ç®—ç€è‰²é˜¶æ®µï¼ˆcompute shaing stageï¼‰ï¼Œè¿™ä¸ªé˜¶æ®µ OpenGL ä¼šè®¡ç®—æœ€é‡è¦åœ¨å±å¹•ä¸­æˆåƒçš„åƒç´ ä½ç½®ä»¥åŠé¢œè‰²ï¼Œå¦‚æœåœ¨ä¹‹å‰æäº¤ä»£ç æ—¶ç”¨åˆ°äº† CALayer ä¼šå¼•èµ·blendingçš„æ˜¾ç¤ºæ•ˆæœï¼ˆä¾‹å¦‚ Shadowï¼‰æˆ–è€…è§†å›¾é¢œè‰²æˆ–å†…å®¹å›¾ç‰‡çš„ alpha é€šé“å¼€å¯ï¼Œéƒ½å°†ä¼šåŠ å¤§è¿™ä¸ªé˜¶æ®µ OpenGL çš„å·¥ä½œé‡ã€‚ Core Animation Pipelineä¸Šæ–‡è¯´åˆ°äº† iOS è®¾å¤‡ä¹‹æ‰€ä»¥å¯ä»¥æˆåƒä¸æ˜¯å› ä¸º UIKit è€Œæ˜¯å› ä¸º LayerKitï¼Œå³ Core Animationã€‚Core Animation å›¾å±‚ï¼Œå³ CALayer ä¸­åŒ…å«ä¸€ä¸ªå±æ€§ contentsï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™è¿™ä¸ªå±æ€§èµ‹å€¼æ¥æ§åˆ¶ CALayer æˆåƒçš„å†…å®¹ã€‚è¿™ä¸ªå±æ€§çš„ç±»å‹å®šä¹‰ä¸º idï¼Œåœ¨ç¨‹åºç¼–è¯‘æ—¶ä¸è®ºæˆ‘ä»¬ç»™ contents èµ‹äºˆä»»ä½•ç±»å‹çš„å€¼ï¼Œéƒ½æ˜¯å¯ä»¥ç¼–è¯‘é€šè¿‡çš„ã€‚ä½†å®è·µä¸­ï¼Œå¦‚æœ contents èµ‹å€¼ç±»å‹ä¸æ˜¯ CGImageï¼Œé‚£ä¹ˆä½ å°†ä¼šå¾—åˆ°ä¸€ä¸ªç©ºç™½å›¾å±‚ã€‚Note: é€ æˆ contents å±æ€§çš„å¥‡æ€ªè¡¨ç°çš„åŸå› æ˜¯ Mac OS X çš„å†å²åŒ…è¢±ï¼Œå®ƒä¹‹æ‰€ä»¥è¢«å®šä¹‰ä¸º id ç±»å‹æ˜¯å› ä¸ºåœ¨ Mac OS X ä¸­è¿™ä¸ªå±æ€§å¯¹ CGImage å’Œ NSImage ç±»å‹çš„å€¼éƒ½èµ·ä½œç”¨ã€‚ä½†æ˜¯åœ¨ iOS ä¸­ï¼Œå¦‚æœä½ èµ‹äºˆä¸€ä¸ª UIImage å±æ€§çš„å€¼ï¼Œä»…ä»…ä¼šå¾—åˆ°ä¸€ä¸ªç©ºç™½å›¾å±‚ã€‚è¯´å®Œ Core Animation çš„ contents å±æ€§ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹ iOS ä¸­ Core Animation Pipelineï¼šåœ¨ Application ä¸­å¸ƒå±€ UIKit è§†å›¾æ§ä»¶é—´æ¥çš„å…³è” Core Animation å›¾å±‚Core Animation å›¾å±‚ç›¸å…³çš„æ•°æ®æäº¤åˆ° iOS Render Serverï¼Œå³ OpenGL ES &amp; Core GraphicsRender Server å°†ä¸ GPU é€šä¿¡æŠŠæ•°æ®ç»è¿‡å¤„ç†ä¹‹åä¼ é€’ç»™ GPUGPU è°ƒç”¨ iOS å½“å‰è®¾å¤‡æ¸²æŸ“ç›¸å…³çš„å›¾å½¢è®¾å¤‡ DisplayNote: ç”±äº iOS è®¾å¤‡ç›®å‰çš„æ˜¾ç¤ºå±æœ€å¤§æ”¯æŒ60 FPSçš„åˆ·æ–°ç‡ï¼Œæ‰€ä»¥æ¯ä¸ªå¤„ç†é—´éš”ä¸º 16.67 msã€‚å¯ä»¥çœ‹åˆ°ä» Commit Transaction ä¹‹åæˆ‘ä»¬çš„å›¾å…ƒæ•°æ®å°±å°†ä¼šåœ¨ä¸‹ä¸€æ¬¡ RunLoop æ—¶è¢« Application å‘é€ç»™åº•å±‚çš„ Render Serverï¼Œåº•å±‚ Render Server ç›´æ¥é¢å‘ GPU ç»è¿‡ä¸€äº›åˆ—çš„æ•°æ®å¤„ç†å°†å¤„ç†å®Œæ¯•çš„æ•°æ®ä¼ é€’ç»™ GPUï¼Œç„¶å GPU è´Ÿè´£æ¸²æŸ“å·¥ä½œï¼Œæ ¹æ®å½“å‰ iOS è®¾å¤‡çš„å±å¹•è®¡ç®—å›¾åƒåƒç´ ä½ç½®ä»¥åŠåƒç´  alpha é€šé“æ··è‰²è®¡ç®—ç­‰ç­‰æœ€ç»ˆåœ¨å½“å‰ iOS è®¾å¤‡çš„æ˜¾ç¤ºå±ä¸­å‘ˆç°å›¾åƒã€‚å˜›~ ç”±äº Core Animation Pipeline ä¸­ Render Server åŒ…å« OpenGL ES &amp; Core Graphicsï¼Œå…¶ä¸­ OpenGL ES çš„æ¸²æŸ“å¯ä»¥å‚è€ƒä¸Šæ–‡ OpenGL Render Pipeline ç†è§£ã€‚ Commit TransactionCore Animation Pipeline çš„æ•´ä¸ªç®¡çº¿ä¸­ iOS å¸¸è§„å¼€å‘ä¸€èˆ¬å¯ä»¥å½±å“åˆ°çš„èŒƒå›´ä¹Ÿå°±ä»…ä»…æ˜¯åœ¨ Application ä¸­å¸ƒå±€ UIKit è§†å›¾æ§ä»¶é—´æ¥çš„å…³è” Core Animation å›¾å±‚è¿™ä¸€çº§ï¼Œå³Commit Transaction ä¹‹å‰çš„ä¸€äº›æ“ä½œã€‚é‚£ä¹ˆåœ¨ Commit Transaction ä¹‹å‰æˆ‘ä»¬ä¸€èˆ¬è¦åšçš„äº‹æƒ…æœ‰å“ªäº›ï¼ŸLayoutï¼Œæ„å»ºè§†å›¾Displayï¼Œç»˜åˆ¶è§†å›¾Prepareï¼Œé¢å¤–çš„ Core Animation å·¥ä½œCommitï¼Œæ‰“åŒ…å›¾å±‚å¹¶å°†å®ƒä»¬å‘é€åˆ° Render Server Layoutåœ¨ Layout é˜¶æ®µæˆ‘ä»¬èƒ½åšçš„æ˜¯æŠŠ constraint å†™çš„å°½é‡é«˜æ•ˆï¼ŒiOS çš„ Layout Constraint ç±»ä¼¼äº Android çš„ Relative Layoutã€‚Note: Emmmmmâ€¦ æ®è§‚å¯Ÿ iOS çš„ Layout Constraint åœ¨ä¹¦å†™æ—¶åº”è¯¥å°½é‡å°‘çš„ä¾èµ–äºè§†å›¾æ ‘ä¸­åŒå±‚çº§çš„å…„å¼Ÿè§†å›¾èŠ‚ç‚¹ï¼Œå®ƒä¼šæ‹–æ…¢æ•´ä¸ªè§†å›¾æ ‘çš„ Layout è®¡ç®—è¿‡ç¨‹ã€‚è¿™ä¸ªé˜¶æ®µçš„ Layout è®¡ç®—å·¥ä½œæ˜¯åœ¨ CPU å®Œæˆçš„ï¼ŒåŒ…æ‹¬ layoutSubviews æ–¹æ³•çš„é‡è½½ï¼ŒaddSubview: æ–¹æ³•å¡«å……å­è§†å›¾ç­‰ Displayå…¶å®è¿™é‡Œçš„ Display ä»…ä»…æ˜¯æˆ‘ä»¬è®¾ç½® iOS è®¾å¤‡è¦æœ€ç»ˆæˆåƒçš„å›¾å…ƒæ•°æ®è€Œå·²ï¼Œé‡è½½è§†å›¾ drawRect: æ–¹æ³•å¯ä»¥è‡ªå®šä¹‰ UIView çš„æ˜¾ç¤ºï¼Œå…¶åŸç†æ˜¯åœ¨ drawRect: æ–¹æ³•å†…éƒ¨ç»˜åˆ¶ bitmapã€‚Note: é‡è½½ drawRect: æ–¹æ³•ç»˜åˆ¶ bitmap è¿‡ç¨‹ä½¿ç”¨ CPU å’Œ å†…å­˜ã€‚æ‰€ä»¥é‡è½½ drawRect: ä½¿ç”¨ä¸å½“ä¼šé€ æˆ CPU è´Ÿè½½è¿‡é‡ï¼ŒApp å†…å­˜é£™å‡ç­‰é—®é¢˜ã€‚ Prepareè¿™ä¸ªæ­¥éª¤å±äºé™„åŠ æ­¥éª¤ï¼Œä¸€èˆ¬å¤„ç†å›¾åƒçš„è§£ç  &amp; è½¬æ¢ç­‰æ“ä½œã€‚ CommitCommit æ­¥éª¤æŒ‡æ‰“åŒ…å›¾å±‚å¹¶å°†å®ƒä»¬å‘é€åˆ° Render Serverã€‚Note: Commit æ“ä½œä¼šé€’å½’æ‰§è¡Œï¼Œç”±äºå›¾å±‚å’Œè§†å›¾ä¸€æ ·æ˜¯ä»¥æ ‘å½¢ç»“æ„å­˜åœ¨çš„ï¼Œå½“å›¾å±‚æ ‘è¿‡äºå¤æ‚æ—¶ Commit æ“ä½œçš„å¼€é”€ä¹Ÿä¼šéå¸¸å¤§ã€‚ CATransactionCATransaction æ˜¯ Core Animation ä¸­ç”¨äºå°†å¤šä¸ªå›¾å±‚æ ‘æ“ä½œåˆ†é…åˆ°æ¸²æŸ“æ ‘çš„åŸå­æ›´æ–°ä¸­çš„æœºåˆ¶ï¼Œå¯¹å›¾å±‚æ ‘çš„æ¯ä¸ªä¿®æ”¹éƒ½å¿…é¡»æ˜¯äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ã€‚CATransaction ç±»æ²¡æœ‰å±æ€§æˆ–è€…å®ä¾‹æ–¹æ³•ï¼Œå¹¶ä¸”ä¹Ÿä¸èƒ½ç”¨ +alloc å’Œ -init æ–¹æ³•åˆ›å»ºå®ƒï¼Œæˆ‘ä»¬åªèƒ½ç”¨ç±»æ–¹æ³• +begin å’Œ +commit åˆ†åˆ«æ¥å…¥æ ˆæˆ–è€…å‡ºæ ˆã€‚äº‹å®ä¸Šä»»ä½•å¯åŠ¨ç”»åŒ–çš„å›¾å±‚å±æ€§éƒ½ä¼šè¢«æ·»åŠ åˆ°æ ˆé¡¶çš„äº‹åŠ¡ï¼Œä½ å¯ä»¥é€šè¿‡ +setAnimationDuration: æ–¹æ³•è®¾ç½®å½“å‰äº‹åŠ¡çš„åŠ¨ç”»æ—¶é—´ï¼Œæˆ–è€…é€šè¿‡ +animationDuration æ–¹æ³•æ¥è·å–æ—¶é•¿å€¼ï¼ˆé»˜è®¤ 0.25 ç§’ï¼‰ã€‚Core Animation åœ¨æ¯ä¸ª RunLoop å‘¨æœŸä¸­è‡ªåŠ¨å¼€å§‹ä¸€æ¬¡æ–°çš„äº‹åŠ¡ï¼Œå³ä½¿ä½ ä¸æ˜¾å¼åœ°ä½¿ç”¨ [CATransaction begin] å¼€å§‹ä¸€æ¬¡äº‹åŠ¡ï¼Œåœ¨ä¸€ä¸ªç‰¹å®š RunLoop å¾ªç¯ä¸­çš„ä»»ä½•å±æ€§çš„å˜åŒ–éƒ½ä¼šè¢«æ”¶é›†èµ·æ¥ï¼Œç„¶ååšä¸€æ¬¡ 0.25 ç§’çš„åŠ¨ç”»ï¼ˆCALayer éšå¼åŠ¨ç”»ï¼‰ã€‚Note: CATransaction æ”¯æŒåµŒå¥—ã€‚ Animationå¯¹äº App ç”¨æˆ·äº¤äº’ä½“éªŒæå‡æœ€æ˜æ˜¾çš„å·¥ä½œè«è¿‡äºä½¿ç”¨åŠ¨ç”»äº†ï¼Œé‚£ä¹ˆ iOS æ˜¯å¦‚ä½•å¤„ç†åŠ¨ç”»çš„æ¸²æŸ“è¿‡ç¨‹çš„å‘¢ï¼Ÿæ—¥å¸¸å¼€å‘ä¸­å¦‚æœä¸æ˜¯ç‰¹åˆ«å¤æ‚çš„åŠ¨ç”»æˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨ UIView Animation å®ç°ï¼ŒiOS å°† UIView Animation çš„å¤„ç†è¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µï¼šè°ƒç”¨ animateWithDuration:animations: æ–¹æ³•åœ¨ Animation Block ä¸­è¿›è¡Œ Layoutï¼ŒDisplayï¼ŒPrepareï¼ŒCommitRender Server æ ¹æ® Animation é€å¸§æ¸²æŸ“Note: åŸç†æ˜¯ animateWithDuration:animations: å†…éƒ¨ä½¿ç”¨äº† CATransaction æ¥å°†æ•´ä¸ª Animation Block ä¸­çš„ä»£ç ä½œä¸ºåŸå­æ“ä½œ commit ç»™äº† RunLoopã€‚ åŸºäº CATransaction å®ç°é“¾å¼åŠ¨ç”»äº‹å®ä¸Šå¤§å¤šæ•°çš„åŠ¨ç”»äº¤äº’éƒ½æ˜¯æœ‰åŠ¨ç”»æ‰§è¡Œé¡ºåºçš„ï¼Œå°½ç®¡ UIView Animation å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯åœ¨å†™ä¸€äº›é¡ºåºåŠ¨ç”»æ—¶ä½¿ç”¨ UIView Animation åªèƒ½åœ¨ + (void)animateWithDuration:delay:options:animations:completion: æ–¹æ³•çš„ completion block ä¸­å±‚çº§åµŒå¥—ï¼Œå†™æˆä¸€å¨ä¸€å¨ block å †ç Œè€Œæˆçš„ä»£ç ï¼Œå®åœ¨æ˜¯éš¾ä»¥é˜…è¯»æ›´åˆ«æåæœŸç»´æŠ¤äº†ã€‚åœ¨å¾—çŸ¥ UIView Animation ä½¿ç”¨äº† CATransaction æ—¶ï¼Œæˆ‘ä»¬ä¸ç¦ä¼šæƒ³åˆ°è¿™ä¸ª completion block æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯åŸºäº CATransaction å®ç°çš„å‘¢ï¼ŸBingoï¼CATransaction ä¸­æœ‰ +completionBlock ä»¥åŠ +setCompletionBlock: æ–¹æ³•å¯ä»¥å¯¹åº”äº UIView Animation çš„ completion block çš„ä¹¦å†™ã€‚Note: æˆ‘çš„ä¸€ä¸ªå¼€æºåº“LSAnimator - å¯å¤šé“¾å¼åŠ¨ç”»åº“åœ¨åŠ¨ç”»é¡ºåºé“¾æ¥æ—¶ä¹Ÿç”¨åˆ°äº† CATransactionã€‚ å…¨æ–‡æ€»ç»“ç»“åˆä¸Šä¸‹æ–‡ä¸éš¾æ¢³ç†å‡ºä¸€ä¸ªiOS æœ€åŸºæœ¬çš„å®Œæ•´æ¸²æŸ“ç»è¿‡ï¼ˆRendering passï¼‰ã€‚ æ€§èƒ½æ£€æµ‹æ€è·¯åŸºäºæ•´ç¯‡æ–‡ç« çš„å†…å®¹å½’çº³ä¸€ä¸‹æˆ‘ä»¬åœ¨æ—¥å¸¸çš„å¼€å‘å·¥ä½œä¸­é‡åˆ°æ€§èƒ½é—®é¢˜æ—¶æ£€æµ‹é—®é¢˜ä»£ç çš„æ€è·¯ï¼šæ–‡ç« å†™å¾—æ¯”è¾ƒç”¨å¿ƒï¼ˆæ˜¯æˆ‘ä¸ªäººçš„åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜https://lision.me/ï¼‰ï¼Œå¦‚æœå‘ç°é”™è¯¯ä¼šä¼˜å…ˆåœ¨æˆ‘çš„ä¸ªäººåšå®¢ ä¸­æ›´æ–°ã€‚å¦‚æœæœ‰ä»»ä½•é—®é¢˜æ¬¢è¿åœ¨æˆ‘çš„å¾®åš @Lision è”ç³»æˆ‘~å¸Œæœ›æˆ‘çš„æ–‡ç« å¯ä»¥ä¸ºä½ å¸¦æ¥ä»·å€¼~ æ‰©å±•é˜…è¯»WWDC2014-Advanced Graphics and Animations for iOS AppsiOS ä¿æŒç•Œé¢æµç•…çš„æŠ€å·§iOS-Core-Animation-Advanced-Techniques æœ¬æ–‡è½¬è½½è‡ªLisionâ€™s Blog | ELSEWHEREä½œè€…ï¼šLisionâ€™s Blog | ELSEWHEREé“¾æ¥ï¼šhttps://lision.me/ios-rendering-process/è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚","link":"/2018/04/20/æ·±å…¥ç†è§£iOS-Rendering-Process/"},{"title":"è€å¸æœº iOS å‘¨æŠ¥ #15","text":"è€å¸æœº iOS å‘¨æŠ¥ï¼Œåªä¸ºä½ å‘ˆç°æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚ä½ ä¹Ÿå¯ä»¥ä¸ºè¿™ä¸ªé¡¹ç›®å‡ºä¸€ä»½åŠ›ï¼Œå¦‚æœå‘ç°æœ‰ä»·å€¼çš„ä¿¡æ¯ã€æ–‡ç« ã€å·¥å…·ç­‰å¯ä»¥åˆ° Issues é‡Œæç»™æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¼šå°½å¿«å¤„ç†ã€‚è®°å¾—å†™ä¸Šæ¨èçš„ç†ç”±å“¦ã€‚æœ‰å»ºè®®å’Œæ„è§ä¹Ÿæ¬¢è¿åˆ° Issues æå‡ºã€‚ ###æ–‡ç« ğŸ¢ ğŸŒŸ æ·±å…¥æµ…å‡º GCD ç³»åˆ—æ–‡ç« è¿™æ˜¯ cocoa-chen é˜…è¯» GCD æºç ååˆ†äº«çš„ç³»åˆ—æ–‡ç« ã€‚è¯¥ç³»åˆ—æ–‡ç« ä»¥å¸¸ç”¨çš„ 5 ä¸ª GCD API ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»ã€ä½¿ç”¨åœºæ™¯ã€åˆ°ã€åŸç†æ·±ç©¶ã€å†åˆ°ã€æ€»ç»“ã€å¾ªåºæ¸è¿›ååˆ†ç»†è‡´åœ°é˜è¿°äº† GCD æ˜¯æ€ä¹ˆå®ç°è¿™äº› API æ¥ç®¡ç†ç»´æŠ¤çº¿ç¨‹æ± çš„ã€‚ç³»åˆ—æ–‡ç« ä¸€å…±æœ‰ 6 ç¯‡ï¼Œå¤§å®¶å¯ä»¥å„å–æ‰€éœ€ï¼š æ·±å…¥æµ…å‡º GCD ä¹‹åŸºç¡€ç¯‡ æ·±å…¥æµ…å‡º GCD ä¹‹ dispatch_queue æ·±å…¥æµ…å‡º GCD ä¹‹ dispatch_semaphore æ·±å…¥æµ…å‡º GCD ä¹‹ dispatch_group æ·±å…¥æµ…å‡º GCD ä¹‹ dispatch_once æ·±å…¥æµ…å‡º GCD ä¹‹ dispatch_source ğŸ¢ æ·±å…¥ç†è§£ Swift æ´¾å‘æœºåˆ¶(è‹±æ–‡åŸæ–‡)2016 å¹´çš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸»è¦å†…å®¹æ˜¯è®²å…³äº Swift å„ç§ç±»å‹çš„æ–¹æ³•æ´¾å‘æœºåˆ¶ï¼Œä»¥åŠ NSObject ä¸ Swift åŸç”Ÿç±»å‹çš„å·®å¼‚ç­‰ç­‰ï¼Œè¯»å®Œè¿™ç¯‡æ–‡ç« æˆ‘æ‰ç¬¬ä¸€æ¬¡å¯¹äº Swift çš„æ´¾å‘æœºåˆ¶æœ‰äº†æ¯”è¾ƒæ¸…æ™°å…¨é¢çš„è®¤è¯†ï¼Œè™½ç„¶æœ‰ä¸€å°éƒ¨åˆ†å†…å®¹å·²ç»è¿‡æ—¶äº†ï¼Œä½†è¿˜æ˜¯å¼ºçƒˆæ¨èå¤§å®¶çœ‹ä¸€ä¸‹ã€‚ ğŸ iOS App è¿ç»­é—ªé€€æ—¶å¦‚ä½•ä¸ŠæŠ¥ crash æ—¥å¿—å¦‚æœæ˜¯æˆ‘ä»¬è‡ªå·±å¼€å‘ä¸€å¥— crash æ—¥å¿—æ”¶é›†ç³»ç»Ÿçš„è¯ï¼Œå¯èƒ½å°±ä¼šå‘ç°åœ¨ App å¯åŠ¨é˜¶æ®µå°±è¿ç»­é—ªé€€çš„åœºæ™¯ä¸‹å¾€å¾€æ— æ³•æ­£ç¡®ä¸ŠæŠ¥å´©æºƒæ—¥å¿—ã€‚Peak ä»ã€å¦‚ä½•æ£€æµ‹è¿ç»­é—ªé€€ã€å’Œã€å¦‚ä½•åœ¨é—ªé€€åç»§ç»­ä¸Šä¼ æ—¥å¿—ã€ä¸¤æ–¹é¢åˆ†æå’Œè§£å†³äº†è¿™ä¸ªç—›ç‚¹ã€‚å¦å¤–ï¼Œå¾®ä¿¡è¯»ä¹¦å›¢é˜Ÿä»¥å‰ä¹Ÿåˆ†äº«è¿‡ç±»ä¼¼çš„æ–¹æ¡ˆâ€”â€”iOS å¯åŠ¨è¿ç»­é—ªé€€ä¿æŠ¤æ–¹æ¡ˆï¼Œå¹¶ä¸”è¯¥æ–¹æ¡ˆé¢å¤–é›†æˆäº†è‡ªä¿®å¤ç³»ç»Ÿã€‚ ğŸ How To Keep Learning After 50 and Other Ways to Hack Your Brain at any Ageè¿™ç¯‡æ–‡ç« é€šè¿‡ä»‹ç»äº†â€œç¥ç»å¯å¡‘æ€§â€ï¼ˆNeuroplastcityï¼‰ç†è®ºï¼Œè®ºè¯äº†æ´»åˆ°è€ã€å­¦åˆ°è€æ˜¯æœ‰ç§‘å­¦ä¾æ®çš„ã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¯¥æ–‡è¿˜æå‡ºå¹´é¾„é€æ¸å˜å¤§ä¹‹åå¦‚ä½•â€œhackâ€è‡ªå·±çš„å¤§è„‘æ¥è®©è‡ªå·±æ›´æœ‰æ•ˆçš„å­¦ä¹ çš„æ–¹æ³•ã€‚æœ‰è¶£çš„æ˜¯ï¼Œæ–‡ç« ä¸ºäº†è®¨è®ºè¿™ä¸ªè¯é¢˜ï¼Œè¿˜é‚€è¯·äº† 25 åå¹´é•¿çš„è‰ºæœ¯å®¶ã€æ•™ç»ƒå’Œç¨‹åºå‘˜æ¥å‚ä¸è°ƒæŸ¥ï¼Œä»–ä»¬ä¸­å‡ ä¹æ‰€æœ‰éƒ½åœ¨æŒç»­çš„å­¦ä¹ ï¼Œå°¤å…¶æ˜¯å…¶ä¸­è¿˜æœ‰ä» Fortran ä¸€è·¯å†™åˆ° Swift çš„ç¨‹åºå‘˜ï¼Œå¯ä»¥è¯´æ˜¯ç›¸å½“èµ„æ·±äº†ã€‚ä½œä¸ºç„¦è™‘çš„å‡†ä¸­å¹´ç¨‹åºå‘˜ï¼Œè¿™ç¯‡æ–‡ç« å¯¹æˆ‘çš„è§¦åŠ¨å¯è°“æ˜¯å¾ˆå¤§çš„ã€‚é™¤äº†å†…å®¹æœ¬èº«å€¼å¾—æ€è€ƒä¹‹å¤–ï¼Œæ–‡é£è¯»èµ·æ¥å°±åƒã€Šè€äººä¸æµ·ã€‹é‚£æ ·å……æ»¡åŠ›é‡æ„Ÿã€‚å€¼å¾—æ”¶è—ï¼ ğŸ¢ Behind-the scenes improvements in Swift 4.1æŒæ¡ç¼–ç¨‹è¯­è¨€çš„è®¾è®¡ä¸å®ç°ä¸€ç›´ä»¥æ¥éƒ½å¤„äºæŠ€æœ¯åœˆé„™è§†é“¾çš„é¡¶ç«¯ï¼Œç›¸ä¿¡ç»å¤§å¤šæ•°ç¨‹åºå‘˜éƒ½æ›¾ç»è·ƒè·ƒæ¬²è¯•ã€‚å¦‚æœä½ æ˜¯å¯¹ Swift è¯­è¨€çš„å®ç°åŸç†æ„Ÿå…´è¶£çš„åŒå­¦ï¼Œä¸€å®šä¸è¦é”™è¿‡è¿™ç¯‡æ–‡ç« ã€‚æ–‡ç« æ ‡é¢˜çœ‹ä¸Šå»å¥½åƒä¹Ÿå°±æ˜¯åˆ—ä¸¾ä¸€ä¸‹ Swift4.1 ä¸€äº›æ”¹è¿›ï¼Œä½†å®é™…ä¸Šæ˜¯é’ˆå¯¹ Swift è¯­è¨€è®¾è®¡ä¸Šé¢ä¸´çš„è¯¸å¤šé—®é¢˜å’Œè§£å†³æ–¹æ¡ˆè¿›è¡Œäº†æ·±å…¥è®¨è®ºï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä¸ºä»€ä¹ˆ protocol ä¸­é»˜è®¤å®ç°çš„æ–¹æ³•ä¸èƒ½è¿”å› selfï¼ŒOC ç±»æ¡¥æ¥åˆ° Swift ä¸­éƒ½å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä»¥åŠæ³›å‹å‚æ•°æ”¯æŒä¸­çˆ¶å­å…³ç³»å¦‚ä½•å®ç°ç­‰ç­‰ã€‚çœ‹å®Œåå¯¹äºâ€ä¸ºä»€ä¹ˆ 4.1 çš„ç¼–è¯‘é€Ÿåº¦å¥½åƒå˜å¿«äº†ï¼Ÿâ€ä»¥åŠâ€Swift çš„ ABI ä»€ä¹ˆæ—¶å€™æ‰èƒ½ç¨³å®šï¼Ÿâ€è¿™ä¸¤ä¸ªç»å…¸é—®é¢˜ï¼Œä½ åº”è¯¥ä¼šæœ‰è‡ªå·±çš„ç­”æ¡ˆã€‚ ğŸ• âœ¨âœ¨å·¥ç¨‹å¸ˆå¦‚ä½•åœ¨å·¥ä½œä¸­æå‡è‡ªå·±ï¼Ÿç¾å›¢ç‚¹è¯„æŠ€æœ¯å›¢é˜Ÿåˆ˜ä¸å¯¹å·¥ç¨‹å¸ˆå‘å±•çš„ä¸€äº›æ€è€ƒå’Œæ€»ç»“ï¼Œå†™çš„å¾ˆå…¨é¢ã€‚æ–‡ç« ç¬¬ä¸€éƒ¨åˆ†é˜è¿°äº†ä¸€äº›å­¦ä¹ çš„åŸåˆ™ï¼›äºŒéƒ¨åˆ†åˆ†æäº†ä½œè€…åœ¨å·¥ä½œä¸­ç¢°åˆ°å’Œçœ‹åˆ°çš„ä¸€äº›å…¸å‹å›°æƒ‘ï¼›ç¬¬ä¸‰éƒ¨åˆ†å‰–ææ¶æ„å¸ˆçš„èƒ½åŠ›æ¨¡å‹ï¼Œè®©å¤§å®¶å¯¹ç›®æ ‡æ‰€éœ€èƒ½åŠ›æœ‰ä¸€ä¸ªæ¯”è¾ƒæ¸…æ™°çš„è®¤çŸ¥ã€‚ ğŸ å¦‚ä½•å¿«é€Ÿæˆé•¿ä¸ºæŠ€æœ¯å¤§ç‰›æŠ€æœ¯äººå‘˜å¤©å¤©å†™ä¸šåŠ¡ä»£ç è¿˜åŠ ç­ï¼Œå¦‚ä½•æ‰èƒ½æˆä¸ºæŠ€æœ¯å¤§ç‰›ï¼Ÿï¼Œæ–‡ç« åˆ—å‡ºäº†ä¸€äº›å…¸å‹çš„è¯¯åŒºåŠæ­£ç¡®åšæ³•ï¼šDo moreã€Do betterã€Do exerciseã€‚ ğŸ Swift Tip: Local Computed Variablesæœ¬æ–‡ä»‹ç»äº†ä¸€ç§é€šè¿‡åœ¨å‡½æ•°ä½“å†…éƒ¨å£°æ˜è®¡ç®—å±æ€§ä»è€Œå®ç°å±€éƒ¨ä»£ç å¤ç”¨çš„ç¼–ç æ–¹æ³•ï¼Œä¸è¿‡ä¹Ÿä»…ä»…æ˜¯ä»£ç å¤ç”¨ï¼Œæ€§èƒ½æ–¹é¢æœ¨æœ‰ä»»ä½•æå‡ï¼Œç±»ä¼¼äºä¸€ä¸ªå±€éƒ¨å‡½æ•°ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥äº†è§£ä¸€ä¸‹ã€‚ ğŸ• è¯» SnapKit å’Œ Masonry è‡ªåŠ¨å¸ƒå±€æ¡†æ¶æºç ä»‹ç»äº†ä¸»æµ AutoLayout å¸ƒå±€æ¡†æ¶ SnapKit å’Œ Masonry æºç ç»“æ„ã€‚SnapKit çš„è®¾è®¡æ€è·¯å¾ˆå¥½ç†è§£ï¼Œä¹Ÿæœ‰å€¼å¾—å­¦ä¹ çš„è®¾è®¡ç»éªŒã€‚å¦‚æœè‡ªå·±å…ˆå°è¯•è¯»è¯»æºç å†çœ‹è¿™ç¯‡æ–‡ç« ä¼šæ¯”è¾ƒå¥½ç†è§£ã€‚ ğŸ¢ 11 Tips for Working on the iPadMacStories æ•´ç†äº† 11 æ¡æŒ‡å—å’Œå°çªé—¨ï¼Œå¸®ä½ æé«˜ iPad åœ¨ iOS 11 ä¸‹çš„ç”Ÿäº§åŠ›ã€‚ä»å¤–æ¥é”®ç›˜æ¨èå’Œå¿«æ·é”®åˆ°æ‰‹åŠ¿å’Œ Siriï¼Œå…¨éƒ½æ˜¯ Federico Viticci æ—¥å¸¸ä½¿ç”¨ iPad Pro çš„å°æŠ€å·§ã€‚ ğŸ• iOS ä¸­åˆ¶ä½œåŸå‹åŠ¨ç”»çš„ä¸€äº›æ–¹å¼ä»‹ç»äº†ä¸¤ç§åŠ¨ç”»åŸå‹çš„åˆ¶ä½œæ–¹å¼ã€‚åˆ©ç”¨ Xcode çš„ playground å’Œ PaintCodeã€‚åœ¨æˆ‘çœ‹æ¥è¿™ä¸¤ç§æ–¹å¼å…¶å®éƒ½æœ‰ç¼ºç‚¹ã€‚playground ç¼–è¯‘é€Ÿåº¦å¤ªæ…¢å¹¶ä¸”è°ƒå‚è¿˜æ˜¯ç”¨ä»£ç ã€‚æ•ˆæœåŸºæœ¬é è’™ã€‚PaintCode é€‚ç”¨èŒƒå›´å¤ªå±€é™ã€‚åŸºæœ¬éƒ½æ˜¯ç»˜åˆ¶è·¯å¾„ã€‚ç°åœ¨æœ€å¼ºçš„çš„åŸå‹å·¥å…·åº”è¯¥æ˜¯ Principleã€‚ ğŸ fastlane å‘å¸ƒ CI aplha ç‰ˆæœ¬alpha ç‰ˆæœ¬å‘å¸ƒäº†ã€‚å…¶å®å…³äºå…¬å¸çš„è‡ªåŠ¨åŒ–ä¹Ÿæ˜¯è€ç”Ÿå¸¸è°ˆçš„é—®é¢˜äº†ã€‚ä½“éªŒæ¯”è¾ƒå¥½çš„è‡ªåŠ¨åŒ–é…ç½®åœ¨æˆ‘çœ‹æ¥æ˜¯ï¼ŒSlack + Xcode server + Fastlane + Phabricator + Arcanist + Trello(jira)ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç ”ç©¶ä¸€ä¸‹ã€‚ ###å·¥å…·IBM Watson Services for Core MLWatson Services æ˜¯ IBM çš„äººå·¥æ™ºèƒ½å®éªŒå®¤æä¾›å¯¹å¤–çš„ AI æœåŠ¡ï¼ŒåŒ…å«äº†èŠå¤©å¯¹è¯/è§†è§‰è¯†åˆ«/è¯­éŸ³å¤„ç†/è¯­è¨€ç¿»è¯‘ç­‰å¤šæ–¹é¢èƒ½åŠ›ï¼Œè€Œ IBM Watson Services for Core ML æ˜¯ IBM ä¸è‹¹æœåˆä½œçš„ï¼Œå°† Watson Services çš„ AI èƒ½åŠ›ä¸è‹¹æœçš„ CoreML ç›¸ç»“åˆç§»åŠ¨ç«¯ AI æœåŠ¡ï¼Œä»¥ SDK çš„å½¢å¼æ¥å…¥ç§»åŠ¨ç«¯ï¼Œæ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿæ„å»ºå…·æœ‰ AI èƒ½åŠ›çš„ Appã€‚ è‹¹æœäº§å“è´­ä¹°æ—¶æœºå»ºè®®è‹¹æœæ›´æ–°å…¶äº§å“çš„æ—¶å€™å¾€å¾€æ˜¯è¯¥äº§å“çš„æœ€ä½³è´­ä¹°æ—¶æœºï¼Œå¦‚æœé”™è¿‡äº†ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨è¿™ä¸ªç½‘ç«™ä¸Šæ‰¾åˆ°è´­ä¹°å»ºè®®ï¼Œç½‘ç«™ä¼šæ ¹æ®è¯¥äº§å“è·ç¦»ä¸Šæ¬¡æ›´æ–°çš„æ—¶é•¿ï¼Œä»¥åŠå†å²ä»¥æ¥çš„å¹³å‡æ›´æ–°å‘¨æœŸç»™å‡ºæŒ‡å¯¼ï¼Œå¹¶æ”¶é›†äº†äº§å“ç›¸å…³çš„æœ€æ–°ä¼ é—»ç»™ä¸ä½ ä½œä¸ºå‚è€ƒã€‚ ###å†…æ¨å¥‡å¿—ä¿¡æ¯ç§‘æŠ€: æ­å·/å¹¿å· iOS å·¥ç¨‹å¸ˆæˆ‘ï¼ˆ@æ²¡æ•…äº‹çš„å“åŒå­¦ï¼‰ç°åœ¨çš„å…¬å¸ï¼ŒSwift å¼€å‘ï¼Œåº”ç”¨æ”¯æŒä» iOS 10 å¼€å§‹ï¼Œæ­å·å’Œå¹¿å·éƒ½æœ‰ç ”å‘å›¢é˜Ÿï¼Œæ— äººæœºåº”ç”¨æ–¹å‘ã€‚iOSã€Androidã€å‰ç«¯ã€UI éƒ½æ‹›ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹æ¬¢è¿ç®€å†æŠ•åˆ° hr@kiwiinc.net ã€‚ ä¸Šæµ·äº«ç‰©è¯´ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ï¼šä¸Šæµ· iOS å·¥ç¨‹å¸ˆæˆ‘ (@EyreFree) ç°åœ¨æ‰€åœ¨çš„å…¬å¸ï¼Œä½äºä¸Šæµ·å®œå±±è·¯åœ°é“ç«™é™„è¿‘ï¼Œä¸»è¥å†…å®¹ä¸ºäºŒæ‰‹äº’é€ç¤¾åŒºï¼ŒSwift å¼€å‘ï¼Œåº”ç”¨æ”¯æŒä» iOS 9 å¼€å§‹ã€‚é™¤ iOS èŒä½ä»¥å¤–ï¼Œè¿˜æœ‰ Web å‰ç«¯ / Android å·¥ç¨‹å¸ˆç­‰å²—ä½ç©ºç¼ºï¼Œæ±‚ä¸‰å¹´å·¦å³ç»éªŒçš„å¤§ä½¬ï¼Œä¸‰é¤ä¾›åº”ï¼Œä½å®¿è¡¥è´´ã€‚æ„Ÿå…´è¶£çš„æœ‹å‹æ¬¢è¿ç®€å†æŠ•åˆ° eyrefree@eyrefree.orgã€‚ ###ä¸“æ onevcat çš„å°ä¸“æ ï¼šå¼€å‘ç¬”è®°ç°¿è®°å½•äº†å–µç¥æ—¥å¸¸å¼€å‘æ—¶é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶ä¹Ÿä¼šæ”¶è—ä¸€äº›å­¦ä¹ æ—¶è®°å½•çš„ç¬”è®°ï¼Œéšæƒ³ç­‰ã€‚å®šä»· Â¥99ï¼Œå› ä¸ºè‡³å°‘ä¼šæœ‰ä¸€ä¸¤å¹´çš„é•¿æœŸæ›´æ–°ï¼Œæ‰€ä»¥è¿™ä¸ªä»·æ ¼æ˜¯éå¸¸è‰¯å¿ƒçš„ã€‚è€Œä¸”ç›®å‰å·²ç»æ›´æ–°äº† 9 ç¯‡ï¼Œæ¶‰åŠçš„èŒƒå›´ä¹Ÿæ¯”è¾ƒå¹¿ï¼Œå€¼å¾—è®¢é˜…ï¼ ###ç¦åˆ©å‘¨æŠ¥è¯»è€…ä¸“å± Reveal 50 å…ƒä¼˜æƒ åˆ¸æˆ‘ä»¬å’Œ Price Tag çš„åˆä½œï¼Œç»™è¯»è€…é€ä¸€ä¸ªå°ç¦åˆ©ï¼Œç‚¹å‡»ä¸Šé¢é“¾æ¥å¯ä»¥é¢†å– Reveal 14 ä¼˜æƒ åˆ¸ã€‚é¢†å–ååˆ°è¿™é‡Œå¯ä»¥ä½¿ç”¨ï¼šè´­ä¹°é“¾æ¥ ã€‚ å…³æ³¨æˆ‘ä»¬æˆ‘ä»¬å¼€é€šäº†å…¬ä¼—å·ï¼Œæ¯æœŸå‘å¸ƒæ—¶å…¬ä¼—å·ä¼šæ¨é€æ¶ˆæ¯ï¼Œæ¬¢è¿å…³æ³¨ã€‚ ä½œè€…ï¼šè€å¸æœºiOSå‘¨æŠ¥é“¾æ¥ï¼šhttps://juejin.im/post/5ad437596fb9a028d567933aæ¥æºï¼šæ˜é‡‘è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚","link":"/2018/04/16/è€å¸æœº-iOS-å‘¨æŠ¥-15/"},{"title":"è€å¸æœº iOS å‘¨æŠ¥ #1","text":"è€å¸æœº iOS å‘¨æŠ¥ï¼Œåªä¸ºä½ å‘ˆç°æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚æœ‰å»ºè®®æˆ–è€…æœ‰ä¿¡æ¯æ¨èå¯ä»¥åˆ°æˆ‘ä»¬ github ä¸‹é¢æ issueã€‚ ###æ–°é—»è‡´å¹¿å¤§ç”¨æˆ·å…³äº iPhone ç”µæ± åŠæ€§èƒ½çš„è¯´æ˜è‹¹æœå¯¹ç”µæ± è€åŒ–ä¼šå¯¼è‡´ iPhone æ€§èƒ½ä¸‹é™åšçš„æ²Ÿé€šè¯´æ˜ã€‚è¡¨ç¤º ä»æ¥æ²¡æœ‰ã€ä¹Ÿæ°¸è¿œä¸ä¼šé€šè¿‡ä»»ä½•æ‰‹æ®µï¼Œæ¥æœ‰æ„ç¼©çŸ­ä»»ä½• Apple äº§å“çš„ä½¿ç”¨å¯¿å‘½ï¼Œæ›´ä¸ä¼šé™ä½ç”¨æˆ·ä½“éªŒæ¥è¿«ä½¿å¤§å®¶å‡çº§è®¾å¤‡ã€‚ä¸ºäº†å®‰æŠšå¤§å®¶çš„ä¸æ»¡ï¼Œè‹¹æœå°†æ›´æ¢ç”µæ± çš„è´¹ç”¨ä¸‹è°ƒäº† 390 å…ƒï¼Œä» 608 å…ƒé™åˆ° 218 å…ƒã€‚ä¸è¿‡è¿™ä¸ªé™ä»·ä¸æ˜¯æ°¸ä¹…æ€§çš„ï¼ŒåªæŒç»­åˆ° 18 å¹´ 12 æœˆã€‚Swift å¿«è¦å¯ä»¥å’Œ Python æ— ç¼äº¤äº’äº†è¿™æ˜¯ Chris Lattner å¤§ç¥åˆ° Google ä¹‹åçš„ç¬¬ä¸€ä¸ªææ¡ˆï¼Œè®© Swift å¯ä»¥å’Œ Python æ— ç¼äº¤äº’ï¼ŒChris æ¯æ¬¡ææ¡ˆåŸºæœ¬ä¸Šéƒ½ä¼šå¸¦ä¸Š Demoï¼Œè¿™ä¸€æ¬¡ä¹Ÿä¸ä¾‹å¤–ï¼Œåªç”¨äº†ä¸åˆ°ä¸€åƒè¡Œä»£ç å°±æŠŠäº¤äº’é€»è¾‘ç»™å®ç°äº†å‡ºæ¥ğŸ¤·â€â™‚ï¸ï¼Œå¤§å®¶å¯ä»¥ç›´æ¥ä¸‹è½½è¿™ä¸ª playground è¯•ä¸€ä¸‹ç”¨ Swift å†™ Python æ˜¯ä»€ä¹ˆæ„Ÿè§‰ã€‚å¦å¤– Chris è¿˜æå‡ºä½¿ç”¨ä¸€å¥— DynamicMemberProtocol å»ä¼˜åŒ–äº† Python äº¤äº’çš„è¯­æ³•ï¼Œ ä¸ Python çš„äº¤äº’éƒ½æ˜¯ä¾èµ–äºå­—ç¬¦ä¸²ï¼Œç”»é£å¤§æ¦‚æ˜¯è¿™æ ·çš„ let a = np.call(member: â€œarangeâ€, args: 15).call(member: â€œreshapeâ€, args: 3, 5)ï¼Œå¦‚æœå®ç°äº† DynamicMemberProtocol çš„è¯ï¼Œå°±å¯ä»¥åœ¨ Swift é‡Œåƒ Python ä»£ç ä¸€æ ·è°ƒç”¨ Python çš„æ–¹æ³• np.arange(15).reshape(3, 5)ï¼Œç¼–è¯‘å™¨ä¸ä¼šç»™éµå¾ªäº†è¿™ä¸ªåè®®çš„å¯¹è±¡åšé™æ€æ£€æŸ¥ï¼Œä½†è¿™æœ¬è´¨ä¸Šåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œç¼–è¯‘æ—¶è¿˜æ˜¯ä¼šè½¬åŒ–ä¸ºå‰è€…çš„æ ¼å¼å»è°ƒç”¨ã€‚ è‹¹æœå®£å¸ƒæ”¶è´­ BuddybuildBuddybuild æ˜¯è‘—åçš„è‡ªåŠ¨åŒ– CI æ‰˜ç®¡æœåŠ¡å¹³å°ï¼Œè‹¹æœæ”¶è´­å Buddybuild å…¬å¸å°†ä¼šåŠ å…¥ Xcode å›¢é˜Ÿã€‚æœŸå¾… Xcode å¯¹ CI çš„æ”¯æŒå°†ä¼šæ›´è¿›ä¸€æ­¥ã€‚ Swift Weekly Brief å®£å¸ƒåœæ›´Jesse Squires å®£å¸ƒåœæ­¢æ›´æ–° Swift Weeklyï¼Œä¸€ç›´ä»¥æ¥è¿™ä¸ª News Letter éƒ½æ˜¯æˆ‘äº†è§£ Swift å¼€å‘è¿›åº¦æœ€ä¸»è¦çš„é€”å¾„ï¼Œç°åœ¨è¦åœæ›´äº†ï¼Œç¡®å®å¾ˆå¯æƒœã€‚Jesse æåˆ°åœæ­¢æ›´æ–°çš„ç†ç”±ï¼Œä¸»è¦æ˜¯å› ä¸ºå½“åˆå¼€å§‹ Swift Weekly çš„æ—¶å€™ï¼ŒSwift åˆšåˆšå¼€æºï¼Œå¯¹äºåŠŸèƒ½å’Œè®¾è®¡çš„è®¨è®ºéå¸¸éå¸¸å¤šï¼Œå¹¶ä¸” Mailing List è¿™ç§å½¢å¼è®©äººå¾ˆéš¾æ‰¾åˆ°æœ‰ä»·å€¼çš„å†…å®¹ï¼Œæ‰€ä»¥è¿™æ ·ä¸€ä¸ª News Letter åœ¨å½“æ—¶æ˜¯éå¸¸æœ‰æ„ä¹‰çš„ã€‚ä½†ç°åœ¨ Swift å·²ç»é€æ¸æˆç†Ÿï¼Œç¤¾åŒºé‡Œçš„è®¨è®ºå˜å¾—è¶Šæ¥è¶Šæ·±å…¥ï¼Œè€Œä¸” Swift æœ€è¿‘è¿˜ä» Mailing List è¿ç§»åˆ°äº†è®ºå›ä¸Šï¼Œç›¸å…³èµ„è®¯çš„è·å–å·²ç»å˜å¾—è¶Šæ¥è¶Šæ–¹ä¾¿äº†ï¼ŒSwift Weekly çš„å­˜åœ¨ä»·å€¼ä¹Ÿå·²ç»å¤§ä¸å¦‚å‰äº†ï¼Œæ‰€ä»¥æ‰æ‰“ç®—åœæ­¢æ›´æ–°ã€‚ä½†åœæ›´åªæ˜¯ä¸ªäººæ„ä¹‰ä¸Šçš„åœæ›´ï¼ŒJesse æ¬¢è¿ç¤¾åŒºçš„äººæ¥æ‰‹è¿‡å»ç»§ç»­æ›´æ–°ï¼Œå¹¶ä¸”åœ¨åŸæ–‡ä»‹ç»äº†ä¸€ç³»åˆ—æ¥æ‰‹çš„æ³¨æ„äº‹é¡¹ã€‚ Apple æ›´æ–° App Store Review Guidelinesï¼Œå¢åŠ  VPN å’Œ loot boxes ç­‰æ¡æ¬¾Apple äº 2017.12.21 æ›´æ–°äº†å…¶ App Store Review Guidelines. ä¸»è¦å˜åŒ–é›†ä¸­åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š æ–°ä¸Šæ¶ App å¼•å…¥ pre-order æœºåˆ¶ è™šæ‹Ÿç‰©å“æŠ½å¥–å¿…é¡»å…¬å¸ƒå„é¡¹æ¦‚ç‡(loot boxes) VPN ç±»åº”ç”¨å¦‚éœ€åœ¨ç‰¹å®šåœ°åŒºå‘å¸ƒï¼Œå¿…é¡»æä¾›ç›¸åº”è®¸å¯ä¿¡æ¯ ç¬¦åˆç‰¹å®šå‰æä¸‹ï¼Œå…è®¸é€šè¿‡æ¨¡æ¿ç”Ÿæˆçš„ App ä¸Šæ¶å‘å¸ƒ LiberiOS jailbreak for iOS 11 officially released, includes support for the iPhone XLiberiOS æ­£å¼å‘å¸ƒ iOS 11.0 - 11.1.2 çš„è¶Šç‹±å·¥å…·ï¼ŒåŒ…æ‹¬å¯¹ iPhone X çš„æ”¯æŒã€‚ ###æ–‡ç« iOS çŸ¥è¯†å°é›†å›½å†…çŸ¥åå¼€å‘è€… @å—å³°å­ æŠŠè¿‡å»å¾®åšä¸Šå‘å‡ºæ¥çš„ iOS å¼€å‘çŸ¥è¯†æ•´ç†äº†å‡ºæ¥ï¼Œå‘åœ¨äº† GitHub ä¸Šï¼Œæ®ä»‹ç»è¿™ä¸€ç³»åˆ—çš„å¾®åšå·²ç»æœ‰ 1000w çš„é˜…è¯»é‡äº†ï¼ï¼ï¼ Swift Tipsè·Ÿå‰é¢ iOS Tips å°é›†ç±»ä¼¼çš„é¡¹ç›®ï¼Œä¸åŒçš„æ˜¯è¿™ä¸ªé¡¹ç›®é‡Œè®²çš„æ˜¯ä¸€äº› Swift çš„å° Tipsï¼Œé‡Œé¢ #7ï¼Œ#22 ç­‰æŠ€å·§æˆ‘éƒ½æœ‰å®é™…ç”¨äºé¡¹ç›®ä¸­ï¼Œæ¨èå¤§å®¶çœ‹ä¸€ä¸‹ã€‚ Weak Arraysobjc.io åœ¨è¿™ç¯‡åšå®¢é‡Œç®€å•ä»‹ç»äº†åœ¨ Swift ä¸­è‡ªå®šä¹‰å¼±å¼•ç”¨æ•°ç»„çš„ä¸€ç§å®ç°æ–¹å¼ã€‚ When and how to use Value and Reference Types in Swiftå…¨é¢ä»‹ç»äº† Swift ä¸­çš„å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„ä½¿ç”¨åŒºåˆ«ã€‚ Building an enum based analytics system in swiftä½¿ç”¨ enum å’Œ protocol æ„å»ºå®‰å…¨ã€é«˜æ•ˆã€çµæ´»çš„ Swift äº‹ä»¶ç»Ÿè®¡ç³»ç»Ÿã€‚ Measuring Swift compile times in Xcode 9å¯¹ Xcode è¿›è¡Œä¸€äº›é…ç½®çœ‹çœ‹å“ªäº› Swift ä»£ç æ‹–æ…¢äº†ä½ çš„ç¼–è¯‘é€Ÿåº¦ã€‚ ###å·¥å…·App Hostä¸€ä¸ªè½»é‡çº§çš„åŒ…æ‰˜ç®¡ç½‘ç«™ï¼Œapp-host ä¸»è¦ç”¨äº iOS å’Œ Android çš„åŒ…ç®¡ç†ï¼Œä½œç”¨ç±»ä¼¼äºfir.imï¼Œä¸åŒä¹‹å¤„æ˜¯å¯ä»¥è‡ªç”±éƒ¨ç½²åœ¨å†…ç½‘ï¼Œæ–¹ä¾¿äº†å…¬å¸é¡¹ç›®ä¿å¯†ã€‚å¹¶ä¸”ä»£ç å¼€æºä¹Ÿå¯ä»¥æ–¹ä¾¿æ ¹æ®å„è‡ªéœ€æ±‚è¿›è¡Œå®šåˆ¶åŒ–å¼€å‘ã€‚ XcodeGenXcodeGen æ˜¯ä¸€ä¸ªæ ¹æ®å·²æœ‰çš„ä»£ç æ–‡ä»¶ / ç›®å½•å’Œç®€å•çš„é…ç½®æ–‡ä»¶æ¥ç”Ÿæˆ Xcode project çš„å¼€æºå·¥å…·ï¼Œå¿«é€Ÿç”Ÿæˆæ¨¡æ¿å·¥ç¨‹ã€å°† .xcodeproj ä» Git è¿½è¸ªä¸­å¿½ç•¥ã€æ–¹ä¾¿åœ°å’Œä»–äººåˆ†äº«è‡ªå·±çš„å·¥ç¨‹é…ç½®ç­‰ï¼Œæ— é™å¯èƒ½ï¼Œç­‰ä½ å°è¯•ã€‚ ###ä»£ç WCDB SwiftWCDB æ˜¯å¾®ä¿¡å›¢é˜Ÿå¼€æºçš„ SQLite æ•°æ®åº“ï¼Œè¿‘æ—¥æ”¾å‡º WCDB Swift çš„ 1.0 æ­£å¼ç‰ˆï¼ŒWCDB Swift ä½¿ç”¨çº¯ Swift ç¼–å†™ï¼Œå‡ ä¹ä¸åŒ…å« Cocoa çš„ä»£ç ï¼Œä¸”ä¸ ObjC ç‰ˆä¿æŒå®Œå…¨ä¸€è‡´çš„åŠŸèƒ½ã€‚å…¶åŸºäº Swift 4.0 çš„ Codable åè®®å®ç°æ¨¡å‹ç»‘å®šï¼Œé€šè¿‡å»ºç«‹ Swift ç±»å‹ä¸æ•°æ®åº“è¡¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥é€šè¿‡ç±»å¯¹è±¡ç›´æ¥æ“ä½œæ•°æ®åº“ã€‚è™½ç„¶é¡¹ç›®æ²¡æœ‰å®é™…ä½¿ç”¨äºå¾®ä¿¡ä¸­ï¼Œä½†è¿™åªæ˜¯ç¬¬ä¸€æ­¥å˜›ï¼Œå¹¶ä¸”æ–‡ç« æœ€åè¿˜è¡¨ç¤ºæµ‹è¯•ç”¨ä¾‹çš„ä»£ç è¦†ç›–ç‡å·²ç»è¾¾åˆ°äº† 91.34% äº†ğŸ¤‘ï¼Œæ‰€ä»¥å¤§å®¶çœŸçš„å¯ä»¥è€ƒè™‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ã€‚ Task automation in Swift with SakeiOS è¿˜æ²¡æœ‰ä½¿ç”¨ Swift è¯­è¨€ç¼–å†™çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œç›®å‰æµè¡Œçš„éƒ½æ˜¯é‡‡ç”¨ bashã€ruby ç¼–å†™çš„ã€‚äºæ˜¯ä½œè€…å°è¯•åˆ©ç”¨ Swift å†™äº† Sakeã€‚è¿™ä¸ªé¡¹ç›®ç›®å‰è¿˜å¤„äºæ—©æœŸã€‚ Fluid SliderRamotion å‡ºå“çš„æ»‘åŠ¨æ§ä»¶ã€‚å¾®ä¿¡è·³ä¸€è·³å¯ä»¥ç›´æ¥æ›´æ”¹åˆ†æ•°ï¼ŒPOST è¯·æ±‚æ²¡æœ‰æ ¡éªŒv2ex ä¸Šä¹Ÿæœ‰è·å¾—å¾®ä¿¡å°æ¸¸æˆè·³ä¸€è·³æºç çš„è®¨è®ºã€‚ ###ä¹¦Swift è¿›é˜¶Swift ç»å…¸ä¹¦ç±ã€ŠSwift è¿›é˜¶ã€‹æ›´æ–°äº† Swift 4 çš„ç›¸å…³å†…å®¹ã€‚ æœ¬æœŸç¼–è¾‘@æ²¡æ•…äº‹çš„å“åŒå­¦ï¼Œ@å››å¨˜ï¼Œ@mmoaayï¼Œ@äº«è€³å…ˆæ£®ï¼Œ@EyreFree ä½œè€…ï¼šè€å¸æœºiOSå‘¨æŠ¥é“¾æ¥ï¼šhttps://juejin.im/post/5a5207bf6fb9a01c9c1ed94cæ¥æºï¼šæ˜é‡‘è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚","link":"/2018/01/08/è€å¸æœº-iOS-å‘¨æŠ¥-1/"},{"title":"ç®€è®° - è®°å½•ä½ çš„ç”Ÿæ´»","text":"ç®€è®° â€”â€” è®°å½•ä½ çš„ç”Ÿæ´»æœ€ç®€å•çš„æ–‡å­—è®°å½•appï¼Œå¸¦ç»™ä½ æ¸…æ–°ï¼Œç®€çº¦çš„æ°”æ¯ã€‚ æ²¡ä»€ä¹ˆç‰¹ç‚¹çš„æ–‡å­—ç¼–è¾‘appã€‚ â€”â€”â€”æˆ‘æ˜¯åˆ†å‰²çº¿â€”â€”â€”â€“ç‰¹ç‚¹ï¼š(âŠ™vâŠ™)å—¯ï¼Œå°±æ˜¯ç®€å•ã€‚ æ–‡é›†åˆ†ç±»ç®¡ç†æ—¥è®°ã€‚å¿«é€Ÿåˆ›å»ºæ—¥è®°ã€‚åˆ†äº«ç»™å¥½å‹å•¦ã€‚ è”ç³»é‚®ç®±: hanangellove@icloud.com","link":"/2017/03/11/ç®€è®°-è®°å½•ä½ çš„ç”Ÿæ´»/"}],"tags":[{"name":"Effective-Ojective C 2.0","slug":"Effective-Ojective-C-2-0","link":"/tags/Effective-Ojective-C-2-0/"},{"name":"LearnSwift","slug":"LearnSwift","link":"/tags/LearnSwift/"},{"name":"NSURLSession","slug":"NSURLSession","link":"/tags/NSURLSession/"},{"name":"category","slug":"category","link":"/tags/category/"},{"name":"block","slug":"block","link":"/tags/block/"},{"name":"NS_ENUM","slug":"NS-ENUM","link":"/tags/NS-ENUM/"},{"name":"NSString","slug":"NSString","link":"/tags/NSString/"},{"name":"iOS","slug":"iOS","link":"/tags/iOS/"},{"name":"swift","slug":"swift","link":"/tags/swift/"},{"name":"MVVM","slug":"MVVM","link":"/tags/MVVM/"},{"name":"QRCode","slug":"QRCode","link":"/tags/QRCode/"},{"name":"AVFoundation","slug":"AVFoundation","link":"/tags/AVFoundation/"},{"name":"CoreImage","slug":"CoreImage","link":"/tags/CoreImage/"},{"name":"Xcode8","slug":"Xcode8","link":"/tags/Xcode8/"},{"name":"NavigationBar","slug":"NavigationBar","link":"/tags/NavigationBar/"},{"name":"SDWebImage","slug":"SDWebImage","link":"/tags/SDWebImage/"},{"name":"UIView","slug":"UIView","link":"/tags/UIView/"},{"name":"UIButton","slug":"UIButton","link":"/tags/UIButton/"},{"name":"xib","slug":"xib","link":"/tags/xib/"},{"name":"drawRect","slug":"drawRect","link":"/tags/drawRect/"},{"name":"tableViewCell","slug":"tableViewCell","link":"/tags/tableViewCell/"},{"name":"cellé«˜åº¦","slug":"cellé«˜åº¦","link":"/tags/cellé«˜åº¦/"},{"name":"skills","slug":"skills","link":"/tags/skills/"},{"name":"è“ç‰™","slug":"è“ç‰™","link":"/tags/è“ç‰™/"},{"name":"CoreBluetooth","slug":"CoreBluetooth","link":"/tags/CoreBluetooth/"},{"name":"SDK","slug":"SDK","link":"/tags/SDK/"},{"name":"Lua","slug":"Lua","link":"/tags/Lua/"},{"name":"cocos2d","slug":"cocos2d","link":"/tags/cocos2d/"},{"name":"python","slug":"python","link":"/tags/python/"},{"name":"ARC","slug":"ARC","link":"/tags/ARC/"},{"name":"å†…å­˜ç®¡ç†","slug":"å†…å­˜ç®¡ç†","link":"/tags/å†…å­˜ç®¡ç†/"},{"name":"runtime","slug":"runtime","link":"/tags/runtime/"},{"name":"å†…å­˜","slug":"å†…å­˜","link":"/tags/å†…å­˜/"},{"name":"ã€ŠiOSå¼€å‘è¿›é˜¶ã€‹é˜…è¯»ç¬”è®°","slug":"ã€ŠiOSå¼€å‘è¿›é˜¶ã€‹é˜…è¯»ç¬”è®°","link":"/tags/ã€ŠiOSå¼€å‘è¿›é˜¶ã€‹é˜…è¯»ç¬”è®°/"},{"name":"shell","slug":"shell","link":"/tags/shell/"},{"name":"EXC_BAD_ACCESS","slug":"EXC-BAD-ACCESS","link":"/tags/EXC-BAD-ACCESS/"},{"name":"CoreData","slug":"CoreData","link":"/tags/CoreData/"},{"name":"SQLite","slug":"SQLite","link":"/tags/SQLite/"},{"name":"ç¼–è¯‘","slug":"ç¼–è¯‘","link":"/tags/ç¼–è¯‘/"},{"name":"é“¾æ¥","slug":"é“¾æ¥","link":"/tags/é“¾æ¥/"},{"name":"Objc Bridging Header","slug":"Objc-Bridging-Header","link":"/tags/Objc-Bridging-Header/"},{"name":"UIBarButtonItem","slug":"UIBarButtonItem","link":"/tags/UIBarButtonItem/"},{"name":"Runtime","slug":"Runtime","link":"/tags/Runtime/"},{"name":"userAgent","slug":"userAgent","link":"/tags/userAgent/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","link":"/tags/ç®—æ³•/"},{"name":"IM","slug":"IM","link":"/tags/IM/"},{"name":"xmpp","slug":"xmpp","link":"/tags/xmpp/"},{"name":"çŸ¥ä¹","slug":"çŸ¥ä¹","link":"/tags/çŸ¥ä¹/"},{"name":"è…¾è®¯","slug":"è…¾è®¯","link":"/tags/è…¾è®¯/"},{"name":"Rendering","slug":"Rendering","link":"/tags/Rendering/"},{"name":"OpenGL","slug":"OpenGL","link":"/tags/OpenGL/"},{"name":"ç®€è®°","slug":"ç®€è®°","link":"/tags/ç®€è®°/"}],"categories":[{"name":"iOS","slug":"iOS","link":"/categories/iOS/"},{"name":"Swift","slug":"Swift","link":"/categories/Swift/"},{"name":"sourcecode","slug":"sourcecode","link":"/categories/sourcecode/"},{"name":"ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»","slug":"ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»","link":"/categories/ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»/"},{"name":"algorithm","slug":"algorithm","link":"/categories/algorithm/"},{"name":"iOSInterview","slug":"iOSInterview","link":"/categories/iOSInterview/"},{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","link":"/categories/ç”Ÿæ´»/"},{"name":"graphic","slug":"graphic","link":"/categories/graphic/"},{"name":"swiftOldDriver","slug":"swiftOldDriver","link":"/categories/swiftOldDriver/"},{"name":"app","slug":"app","link":"/categories/app/"}]}